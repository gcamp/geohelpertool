<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GeoHelperTool</title>
    <script type="module" crossorigin>function mg(C,R){for(var k=0;k<R.length;k++){const I=R[k];if(typeof I!="string"&&!Array.isArray(I)){for(const V in I)if(V!=="default"&&!(V in C)){const q=Object.getOwnPropertyDescriptor(I,V);q&&Object.defineProperty(C,V,q.get?q:{enumerable:!0,get:()=>I[V]})}}}return Object.freeze(Object.defineProperty(C,Symbol.toStringTag,{value:"Module"}))}(function(){const R=document.createElement("link").relList;if(R&&R.supports&&R.supports("modulepreload"))return;for(const V of document.querySelectorAll('link[rel="modulepreload"]'))I(V);new MutationObserver(V=>{for(const q of V)if(q.type==="childList")for(const E of q.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&I(E)}).observe(document,{childList:!0,subtree:!0});function k(V){const q={};return V.integrity&&(q.integrity=V.integrity),V.referrerPolicy&&(q.referrerPolicy=V.referrerPolicy),V.crossOrigin==="use-credentials"?q.credentials="include":V.crossOrigin==="anonymous"?q.credentials="omit":q.credentials="same-origin",q}function I(V){if(V.ep)return;V.ep=!0;const q=k(V);fetch(V.href,q)}})();function $m(C){return C&&C.__esModule&&Object.prototype.hasOwnProperty.call(C,"default")?C.default:C}var $p={exports:{}},Zd={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lm;function gg(){if(lm)return Zd;lm=1;var C=Symbol.for("react.transitional.element"),R=Symbol.for("react.fragment");function k(I,V,q){var E=null;if(q!==void 0&&(E=""+q),V.key!==void 0&&(E=""+V.key),"key"in V){q={};for(var c in V)c!=="key"&&(q[c]=V[c])}else q=V;return V=q.ref,{$$typeof:C,type:I,key:E,ref:V!==void 0?V:null,props:q}}return Zd.Fragment=R,Zd.jsx=k,Zd.jsxs=k,Zd}var cm;function _g(){return cm||(cm=1,$p.exports=gg()),$p.exports}var Pt=_g(),Hp={exports:{}},mi={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var um;function yg(){if(um)return mi;um=1;var C=Symbol.for("react.transitional.element"),R=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),V=Symbol.for("react.profiler"),q=Symbol.for("react.consumer"),E=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),pe=Symbol.for("react.suspense"),se=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),ce=Symbol.iterator;function K(ye){return ye===null||typeof ye!="object"?null:(ye=ce&&ye[ce]||ye["@@iterator"],typeof ye=="function"?ye:null)}var Q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Ie=Object.assign,Qe={};function St(ye,He,ot){this.props=ye,this.context=He,this.refs=Qe,this.updater=ot||Q}St.prototype.isReactComponent={},St.prototype.setState=function(ye,He){if(typeof ye!="object"&&typeof ye!="function"&&ye!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,ye,He,"setState")},St.prototype.forceUpdate=function(ye){this.updater.enqueueForceUpdate(this,ye,"forceUpdate")};function at(){}at.prototype=St.prototype;function Ct(ye,He,ot){this.props=ye,this.context=He,this.refs=Qe,this.updater=ot||Q}var Xe=Ct.prototype=new at;Xe.constructor=Ct,Ie(Xe,St.prototype),Xe.isPureReactComponent=!0;var Je=Array.isArray,nt={H:null,A:null,T:null,S:null,V:null},Ye=Object.prototype.hasOwnProperty;function vt(ye,He,ot,dt,At,Ht){return ot=Ht.ref,{$$typeof:C,type:ye,key:He,ref:ot!==void 0?ot:null,props:Ht}}function Nt(ye,He){return vt(ye.type,He,void 0,void 0,void 0,ye.props)}function Jt(ye){return typeof ye=="object"&&ye!==null&&ye.$$typeof===C}function Lt(ye){var He={"=":"=0",":":"=2"};return"$"+ye.replace(/[=:]/g,function(ot){return He[ot]})}var _i=/\/+/g;function ni(ye,He){return typeof ye=="object"&&ye!==null&&ye.key!=null?Lt(""+ye.key):He.toString(36)}function Ci(){}function Tn(ye){switch(ye.status){case"fulfilled":return ye.value;case"rejected":throw ye.reason;default:switch(typeof ye.status=="string"?ye.then(Ci,Ci):(ye.status="pending",ye.then(function(He){ye.status==="pending"&&(ye.status="fulfilled",ye.value=He)},function(He){ye.status==="pending"&&(ye.status="rejected",ye.reason=He)})),ye.status){case"fulfilled":return ye.value;case"rejected":throw ye.reason}}throw ye}function ki(ye,He,ot,dt,At){var Ht=typeof ye;(Ht==="undefined"||Ht==="boolean")&&(ye=null);var Ft=!1;if(ye===null)Ft=!0;else switch(Ht){case"bigint":case"string":case"number":Ft=!0;break;case"object":switch(ye.$$typeof){case C:case R:Ft=!0;break;case X:return Ft=ye._init,ki(Ft(ye._payload),He,ot,dt,At)}}if(Ft)return At=At(ye),Ft=dt===""?"."+ni(ye,0):dt,Je(At)?(ot="",Ft!=null&&(ot=Ft.replace(_i,"$&/")+"/"),ki(At,He,ot,"",function(Ki){return Ki})):At!=null&&(Jt(At)&&(At=Nt(At,ot+(At.key==null||ye&&ye.key===At.key?"":(""+At.key).replace(_i,"$&/")+"/")+Ft)),He.push(At)),1;Ft=0;var Yi=dt===""?".":dt+":";if(Je(ye))for(var Mi=0;Mi<ye.length;Mi++)dt=ye[Mi],Ht=Yi+ni(dt,Mi),Ft+=ki(dt,He,ot,Ht,At);else if(Mi=K(ye),typeof Mi=="function")for(ye=Mi.call(ye),Mi=0;!(dt=ye.next()).done;)dt=dt.value,Ht=Yi+ni(dt,Mi++),Ft+=ki(dt,He,ot,Ht,At);else if(Ht==="object"){if(typeof ye.then=="function")return ki(Tn(ye),He,ot,dt,At);throw He=String(ye),Error("Objects are not valid as a React child (found: "+(He==="[object Object]"?"object with keys {"+Object.keys(ye).join(", ")+"}":He)+"). If you meant to render a collection of children, use an array instead.")}return Ft}function We(ye,He,ot){if(ye==null)return ye;var dt=[],At=0;return ki(ye,dt,"","",function(Ht){return He.call(ot,Ht,At++)}),dt}function je(ye){if(ye._status===-1){var He=ye._result;He=He(),He.then(function(ot){(ye._status===0||ye._status===-1)&&(ye._status=1,ye._result=ot)},function(ot){(ye._status===0||ye._status===-1)&&(ye._status=2,ye._result=ot)}),ye._status===-1&&(ye._status=0,ye._result=He)}if(ye._status===1)return ye._result.default;throw ye._result}var _t=typeof reportError=="function"?reportError:function(ye){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var He=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof ye=="object"&&ye!==null&&typeof ye.message=="string"?String(ye.message):String(ye),error:ye});if(!window.dispatchEvent(He))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",ye);return}console.error(ye)};function qt(){}return mi.Children={map:We,forEach:function(ye,He,ot){We(ye,function(){He.apply(this,arguments)},ot)},count:function(ye){var He=0;return We(ye,function(){He++}),He},toArray:function(ye){return We(ye,function(He){return He})||[]},only:function(ye){if(!Jt(ye))throw Error("React.Children.only expected to receive a single React element child.");return ye}},mi.Component=St,mi.Fragment=k,mi.Profiler=V,mi.PureComponent=Ct,mi.StrictMode=I,mi.Suspense=pe,mi.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=nt,mi.__COMPILER_RUNTIME={__proto__:null,c:function(ye){return nt.H.useMemoCache(ye)}},mi.cache=function(ye){return function(){return ye.apply(null,arguments)}},mi.cloneElement=function(ye,He,ot){if(ye==null)throw Error("The argument must be a React element, but you passed "+ye+".");var dt=Ie({},ye.props),At=ye.key,Ht=void 0;if(He!=null)for(Ft in He.ref!==void 0&&(Ht=void 0),He.key!==void 0&&(At=""+He.key),He)!Ye.call(He,Ft)||Ft==="key"||Ft==="__self"||Ft==="__source"||Ft==="ref"&&He.ref===void 0||(dt[Ft]=He[Ft]);var Ft=arguments.length-2;if(Ft===1)dt.children=ot;else if(1<Ft){for(var Yi=Array(Ft),Mi=0;Mi<Ft;Mi++)Yi[Mi]=arguments[Mi+2];dt.children=Yi}return vt(ye.type,At,void 0,void 0,Ht,dt)},mi.createContext=function(ye){return ye={$$typeof:E,_currentValue:ye,_currentValue2:ye,_threadCount:0,Provider:null,Consumer:null},ye.Provider=ye,ye.Consumer={$$typeof:q,_context:ye},ye},mi.createElement=function(ye,He,ot){var dt,At={},Ht=null;if(He!=null)for(dt in He.key!==void 0&&(Ht=""+He.key),He)Ye.call(He,dt)&&dt!=="key"&&dt!=="__self"&&dt!=="__source"&&(At[dt]=He[dt]);var Ft=arguments.length-2;if(Ft===1)At.children=ot;else if(1<Ft){for(var Yi=Array(Ft),Mi=0;Mi<Ft;Mi++)Yi[Mi]=arguments[Mi+2];At.children=Yi}if(ye&&ye.defaultProps)for(dt in Ft=ye.defaultProps,Ft)At[dt]===void 0&&(At[dt]=Ft[dt]);return vt(ye,Ht,void 0,void 0,null,At)},mi.createRef=function(){return{current:null}},mi.forwardRef=function(ye){return{$$typeof:c,render:ye}},mi.isValidElement=Jt,mi.lazy=function(ye){return{$$typeof:X,_payload:{_status:-1,_result:ye},_init:je}},mi.memo=function(ye,He){return{$$typeof:se,type:ye,compare:He===void 0?null:He}},mi.startTransition=function(ye){var He=nt.T,ot={};nt.T=ot;try{var dt=ye(),At=nt.S;At!==null&&At(ot,dt),typeof dt=="object"&&dt!==null&&typeof dt.then=="function"&&dt.then(qt,_t)}catch(Ht){_t(Ht)}finally{nt.T=He}},mi.unstable_useCacheRefresh=function(){return nt.H.useCacheRefresh()},mi.use=function(ye){return nt.H.use(ye)},mi.useActionState=function(ye,He,ot){return nt.H.useActionState(ye,He,ot)},mi.useCallback=function(ye,He){return nt.H.useCallback(ye,He)},mi.useContext=function(ye){return nt.H.useContext(ye)},mi.useDebugValue=function(){},mi.useDeferredValue=function(ye,He){return nt.H.useDeferredValue(ye,He)},mi.useEffect=function(ye,He,ot){var dt=nt.H;if(typeof ot=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return dt.useEffect(ye,He)},mi.useId=function(){return nt.H.useId()},mi.useImperativeHandle=function(ye,He,ot){return nt.H.useImperativeHandle(ye,He,ot)},mi.useInsertionEffect=function(ye,He){return nt.H.useInsertionEffect(ye,He)},mi.useLayoutEffect=function(ye,He){return nt.H.useLayoutEffect(ye,He)},mi.useMemo=function(ye,He){return nt.H.useMemo(ye,He)},mi.useOptimistic=function(ye,He){return nt.H.useOptimistic(ye,He)},mi.useReducer=function(ye,He,ot){return nt.H.useReducer(ye,He,ot)},mi.useRef=function(ye){return nt.H.useRef(ye)},mi.useState=function(ye){return nt.H.useState(ye)},mi.useSyncExternalStore=function(ye,He,ot){return nt.H.useSyncExternalStore(ye,He,ot)},mi.useTransition=function(){return nt.H.useTransition()},mi.version="19.1.0",mi}var hm;function am(){return hm||(hm=1,Hp.exports=yg()),Hp.exports}var ut=am();const Hm=$m(ut);var Xp={exports:{}},qd={},Yp={exports:{}},Kp={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fm;function vg(){return fm||(fm=1,function(C){function R(We,je){var _t=We.length;We.push(je);e:for(;0<_t;){var qt=_t-1>>>1,ye=We[qt];if(0<V(ye,je))We[qt]=je,We[_t]=ye,_t=qt;else break e}}function k(We){return We.length===0?null:We[0]}function I(We){if(We.length===0)return null;var je=We[0],_t=We.pop();if(_t!==je){We[0]=_t;e:for(var qt=0,ye=We.length,He=ye>>>1;qt<He;){var ot=2*(qt+1)-1,dt=We[ot],At=ot+1,Ht=We[At];if(0>V(dt,_t))At<ye&&0>V(Ht,dt)?(We[qt]=Ht,We[At]=_t,qt=At):(We[qt]=dt,We[ot]=_t,qt=ot);else if(At<ye&&0>V(Ht,_t))We[qt]=Ht,We[At]=_t,qt=At;else break e}}return je}function V(We,je){var _t=We.sortIndex-je.sortIndex;return _t!==0?_t:We.id-je.id}if(C.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var q=performance;C.unstable_now=function(){return q.now()}}else{var E=Date,c=E.now();C.unstable_now=function(){return E.now()-c}}var pe=[],se=[],X=1,ce=null,K=3,Q=!1,Ie=!1,Qe=!1,St=!1,at=typeof setTimeout=="function"?setTimeout:null,Ct=typeof clearTimeout=="function"?clearTimeout:null,Xe=typeof setImmediate<"u"?setImmediate:null;function Je(We){for(var je=k(se);je!==null;){if(je.callback===null)I(se);else if(je.startTime<=We)I(se),je.sortIndex=je.expirationTime,R(pe,je);else break;je=k(se)}}function nt(We){if(Qe=!1,Je(We),!Ie)if(k(pe)!==null)Ie=!0,Ye||(Ye=!0,ni());else{var je=k(se);je!==null&&ki(nt,je.startTime-We)}}var Ye=!1,vt=-1,Nt=5,Jt=-1;function Lt(){return St?!0:!(C.unstable_now()-Jt<Nt)}function _i(){if(St=!1,Ye){var We=C.unstable_now();Jt=We;var je=!0;try{e:{Ie=!1,Qe&&(Qe=!1,Ct(vt),vt=-1),Q=!0;var _t=K;try{t:{for(Je(We),ce=k(pe);ce!==null&&!(ce.expirationTime>We&&Lt());){var qt=ce.callback;if(typeof qt=="function"){ce.callback=null,K=ce.priorityLevel;var ye=qt(ce.expirationTime<=We);if(We=C.unstable_now(),typeof ye=="function"){ce.callback=ye,Je(We),je=!0;break t}ce===k(pe)&&I(pe),Je(We)}else I(pe);ce=k(pe)}if(ce!==null)je=!0;else{var He=k(se);He!==null&&ki(nt,He.startTime-We),je=!1}}break e}finally{ce=null,K=_t,Q=!1}je=void 0}}finally{je?ni():Ye=!1}}}var ni;if(typeof Xe=="function")ni=function(){Xe(_i)};else if(typeof MessageChannel<"u"){var Ci=new MessageChannel,Tn=Ci.port2;Ci.port1.onmessage=_i,ni=function(){Tn.postMessage(null)}}else ni=function(){at(_i,0)};function ki(We,je){vt=at(function(){We(C.unstable_now())},je)}C.unstable_IdlePriority=5,C.unstable_ImmediatePriority=1,C.unstable_LowPriority=4,C.unstable_NormalPriority=3,C.unstable_Profiling=null,C.unstable_UserBlockingPriority=2,C.unstable_cancelCallback=function(We){We.callback=null},C.unstable_forceFrameRate=function(We){0>We||125<We?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Nt=0<We?Math.floor(1e3/We):5},C.unstable_getCurrentPriorityLevel=function(){return K},C.unstable_next=function(We){switch(K){case 1:case 2:case 3:var je=3;break;default:je=K}var _t=K;K=je;try{return We()}finally{K=_t}},C.unstable_requestPaint=function(){St=!0},C.unstable_runWithPriority=function(We,je){switch(We){case 1:case 2:case 3:case 4:case 5:break;default:We=3}var _t=K;K=We;try{return je()}finally{K=_t}},C.unstable_scheduleCallback=function(We,je,_t){var qt=C.unstable_now();switch(typeof _t=="object"&&_t!==null?(_t=_t.delay,_t=typeof _t=="number"&&0<_t?qt+_t:qt):_t=qt,We){case 1:var ye=-1;break;case 2:ye=250;break;case 5:ye=1073741823;break;case 4:ye=1e4;break;default:ye=5e3}return ye=_t+ye,We={id:X++,callback:je,priorityLevel:We,startTime:_t,expirationTime:ye,sortIndex:-1},_t>qt?(We.sortIndex=_t,R(se,We),k(pe)===null&&We===k(se)&&(Qe?(Ct(vt),vt=-1):Qe=!0,ki(nt,_t-qt))):(We.sortIndex=ye,R(pe,We),Ie||Q||(Ie=!0,Ye||(Ye=!0,ni()))),We},C.unstable_shouldYield=Lt,C.unstable_wrapCallback=function(We){var je=K;return function(){var _t=K;K=je;try{return We.apply(this,arguments)}finally{K=_t}}}}(Kp)),Kp}var dm;function xg(){return dm||(dm=1,Yp.exports=vg()),Yp.exports}var Wp={exports:{}},ya={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pm;function bg(){if(pm)return ya;pm=1;var C=am();function R(pe){var se="https://react.dev/errors/"+pe;if(1<arguments.length){se+="?args[]="+encodeURIComponent(arguments[1]);for(var X=2;X<arguments.length;X++)se+="&args[]="+encodeURIComponent(arguments[X])}return"Minified React error #"+pe+"; visit "+se+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function k(){}var I={d:{f:k,r:function(){throw Error(R(522))},D:k,C:k,L:k,m:k,X:k,S:k,M:k},p:0,findDOMNode:null},V=Symbol.for("react.portal");function q(pe,se,X){var ce=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:V,key:ce==null?null:""+ce,children:pe,containerInfo:se,implementation:X}}var E=C.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(pe,se){if(pe==="font")return"";if(typeof se=="string")return se==="use-credentials"?se:""}return ya.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,ya.createPortal=function(pe,se){var X=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!se||se.nodeType!==1&&se.nodeType!==9&&se.nodeType!==11)throw Error(R(299));return q(pe,se,null,X)},ya.flushSync=function(pe){var se=E.T,X=I.p;try{if(E.T=null,I.p=2,pe)return pe()}finally{E.T=se,I.p=X,I.d.f()}},ya.preconnect=function(pe,se){typeof pe=="string"&&(se?(se=se.crossOrigin,se=typeof se=="string"?se==="use-credentials"?se:"":void 0):se=null,I.d.C(pe,se))},ya.prefetchDNS=function(pe){typeof pe=="string"&&I.d.D(pe)},ya.preinit=function(pe,se){if(typeof pe=="string"&&se&&typeof se.as=="string"){var X=se.as,ce=c(X,se.crossOrigin),K=typeof se.integrity=="string"?se.integrity:void 0,Q=typeof se.fetchPriority=="string"?se.fetchPriority:void 0;X==="style"?I.d.S(pe,typeof se.precedence=="string"?se.precedence:void 0,{crossOrigin:ce,integrity:K,fetchPriority:Q}):X==="script"&&I.d.X(pe,{crossOrigin:ce,integrity:K,fetchPriority:Q,nonce:typeof se.nonce=="string"?se.nonce:void 0})}},ya.preinitModule=function(pe,se){if(typeof pe=="string")if(typeof se=="object"&&se!==null){if(se.as==null||se.as==="script"){var X=c(se.as,se.crossOrigin);I.d.M(pe,{crossOrigin:X,integrity:typeof se.integrity=="string"?se.integrity:void 0,nonce:typeof se.nonce=="string"?se.nonce:void 0})}}else se==null&&I.d.M(pe)},ya.preload=function(pe,se){if(typeof pe=="string"&&typeof se=="object"&&se!==null&&typeof se.as=="string"){var X=se.as,ce=c(X,se.crossOrigin);I.d.L(pe,X,{crossOrigin:ce,integrity:typeof se.integrity=="string"?se.integrity:void 0,nonce:typeof se.nonce=="string"?se.nonce:void 0,type:typeof se.type=="string"?se.type:void 0,fetchPriority:typeof se.fetchPriority=="string"?se.fetchPriority:void 0,referrerPolicy:typeof se.referrerPolicy=="string"?se.referrerPolicy:void 0,imageSrcSet:typeof se.imageSrcSet=="string"?se.imageSrcSet:void 0,imageSizes:typeof se.imageSizes=="string"?se.imageSizes:void 0,media:typeof se.media=="string"?se.media:void 0})}},ya.preloadModule=function(pe,se){if(typeof pe=="string")if(se){var X=c(se.as,se.crossOrigin);I.d.m(pe,{as:typeof se.as=="string"&&se.as!=="script"?se.as:void 0,crossOrigin:X,integrity:typeof se.integrity=="string"?se.integrity:void 0})}else I.d.m(pe)},ya.requestFormReset=function(pe){I.d.r(pe)},ya.unstable_batchedUpdates=function(pe,se){return pe(se)},ya.useFormState=function(pe,se,X){return E.H.useFormState(pe,se,X)},ya.useFormStatus=function(){return E.H.useHostTransitionStatus()},ya.version="19.1.0",ya}var mm;function Xm(){if(mm)return Wp.exports;mm=1;function C(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(C)}catch(R){console.error(R)}}return C(),Wp.exports=bg(),Wp.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gm;function wg(){if(gm)return qd;gm=1;var C=xg(),R=am(),k=Xm();function I(i){var s="https://react.dev/errors/"+i;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)s+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function V(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function q(i){var s=i,u=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,(s.flags&4098)!==0&&(u=s.return),i=s.return;while(i)}return s.tag===3?u:null}function E(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function c(i){if(q(i)!==i)throw Error(I(188))}function pe(i){var s=i.alternate;if(!s){if(s=q(i),s===null)throw Error(I(188));return s!==i?null:i}for(var u=i,p=s;;){var x=u.return;if(x===null)break;var S=x.alternate;if(S===null){if(p=x.return,p!==null){u=p;continue}break}if(x.child===S.child){for(S=x.child;S;){if(S===u)return c(x),i;if(S===p)return c(x),s;S=S.sibling}throw Error(I(188))}if(u.return!==p.return)u=x,p=S;else{for(var U=!1,W=x.child;W;){if(W===u){U=!0,u=x,p=S;break}if(W===p){U=!0,p=x,u=S;break}W=W.sibling}if(!U){for(W=S.child;W;){if(W===u){U=!0,u=S,p=x;break}if(W===p){U=!0,p=S,u=x;break}W=W.sibling}if(!U)throw Error(I(189))}}if(u.alternate!==p)throw Error(I(190))}if(u.tag!==3)throw Error(I(188));return u.stateNode.current===u?i:s}function se(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i;for(i=i.child;i!==null;){if(s=se(i),s!==null)return s;i=i.sibling}return null}var X=Object.assign,ce=Symbol.for("react.element"),K=Symbol.for("react.transitional.element"),Q=Symbol.for("react.portal"),Ie=Symbol.for("react.fragment"),Qe=Symbol.for("react.strict_mode"),St=Symbol.for("react.profiler"),at=Symbol.for("react.provider"),Ct=Symbol.for("react.consumer"),Xe=Symbol.for("react.context"),Je=Symbol.for("react.forward_ref"),nt=Symbol.for("react.suspense"),Ye=Symbol.for("react.suspense_list"),vt=Symbol.for("react.memo"),Nt=Symbol.for("react.lazy"),Jt=Symbol.for("react.activity"),Lt=Symbol.for("react.memo_cache_sentinel"),_i=Symbol.iterator;function ni(i){return i===null||typeof i!="object"?null:(i=_i&&i[_i]||i["@@iterator"],typeof i=="function"?i:null)}var Ci=Symbol.for("react.client.reference");function Tn(i){if(i==null)return null;if(typeof i=="function")return i.$$typeof===Ci?null:i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Ie:return"Fragment";case St:return"Profiler";case Qe:return"StrictMode";case nt:return"Suspense";case Ye:return"SuspenseList";case Jt:return"Activity"}if(typeof i=="object")switch(i.$$typeof){case Q:return"Portal";case Xe:return(i.displayName||"Context")+".Provider";case Ct:return(i._context.displayName||"Context")+".Consumer";case Je:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case vt:return s=i.displayName||null,s!==null?s:Tn(i.type)||"Memo";case Nt:s=i._payload,i=i._init;try{return Tn(i(s))}catch{}}return null}var ki=Array.isArray,We=R.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,je=k.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,_t={pending:!1,data:null,method:null,action:null},qt=[],ye=-1;function He(i){return{current:i}}function ot(i){0>ye||(i.current=qt[ye],qt[ye]=null,ye--)}function dt(i,s){ye++,qt[ye]=i.current,i.current=s}var At=He(null),Ht=He(null),Ft=He(null),Yi=He(null);function Mi(i,s){switch(dt(Ft,s),dt(Ht,i),dt(At,null),s.nodeType){case 9:case 11:i=(i=s.documentElement)&&(i=i.namespaceURI)?zd(i):0;break;default:if(i=s.tagName,s=s.namespaceURI)s=zd(s),i=Rd(s,i);else switch(i){case"svg":i=1;break;case"math":i=2;break;default:i=0}}ot(At),dt(At,i)}function Ki(){ot(At),ot(Ht),ot(Ft)}function uo(i){i.memoizedState!==null&&dt(Yi,i);var s=At.current,u=Rd(s,i.type);s!==u&&(dt(Ht,i),dt(At,u))}function cr(i){Ht.current===i&&(ot(At),ot(Ht)),Yi.current===i&&(ot(Yi),ee._currentValue=_t)}var ho=Object.prototype.hasOwnProperty,rn=C.unstable_scheduleCallback,ta=C.unstable_cancelCallback,ia=C.unstable_shouldYield,il=C.unstable_requestPaint,Wi=C.unstable_now,Nr=C.unstable_getCurrentPriorityLevel,yr=C.unstable_ImmediatePriority,Rs=C.unstable_UserBlockingPriority,ba=C.unstable_NormalPriority,ql=C.unstable_LowPriority,Is=C.unstable_IdlePriority,ss=C.log,fo=C.unstable_setDisableYieldValue,Fr=null,an=null;function tr(i){if(typeof ss=="function"&&fo(i),an&&typeof an.setStrictMode=="function")try{an.setStrictMode(Fr,i)}catch{}}var ir=Math.clz32?Math.clz32:Ce,Oc=Math.log,os=Math.LN2;function Ce(i){return i>>>=0,i===0?32:31-(Oc(i)/os|0)|0}var H=256,Y=4194304;function te(i){var s=i&42;if(s!==0)return s;switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return i&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return i}}function he(i,s,u){var p=i.pendingLanes;if(p===0)return 0;var x=0,S=i.suspendedLanes,U=i.pingedLanes;i=i.warmLanes;var W=p&134217727;return W!==0?(p=W&~S,p!==0?x=te(p):(U&=W,U!==0?x=te(U):u||(u=W&~i,u!==0&&(x=te(u))))):(W=p&~S,W!==0?x=te(W):U!==0?x=te(U):u||(u=p&~i,u!==0&&(x=te(u)))),x===0?0:s!==0&&s!==x&&(s&S)===0&&(S=x&-x,u=s&-s,S>=u||S===32&&(u&4194048)!==0)?s:x}function be(i,s){return(i.pendingLanes&~(i.suspendedLanes&~i.pingedLanes)&s)===0}function Ee(i,s){switch(i){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Le(){var i=H;return H<<=1,(H&4194048)===0&&(H=256),i}function Se(){var i=Y;return Y<<=1,(Y&62914560)===0&&(Y=4194304),i}function qe(i){for(var s=[],u=0;31>u;u++)s.push(i);return s}function Ue(i,s){i.pendingLanes|=s,s!==268435456&&(i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0)}function Ae(i,s,u,p,x,S){var U=i.pendingLanes;i.pendingLanes=u,i.suspendedLanes=0,i.pingedLanes=0,i.warmLanes=0,i.expiredLanes&=u,i.entangledLanes&=u,i.errorRecoveryDisabledLanes&=u,i.shellSuspendCounter=0;var W=i.entanglements,_e=i.expirationTimes,Ne=i.hiddenUpdates;for(u=U&~u;0<u;){var tt=31-ir(u),lt=1<<tt;W[tt]=0,_e[tt]=-1;var Ve=Ne[tt];if(Ve!==null)for(Ne[tt]=null,tt=0;tt<Ve.length;tt++){var Ge=Ve[tt];Ge!==null&&(Ge.lane&=-536870913)}u&=~lt}p!==0&&Ke(i,p,0),S!==0&&x===0&&i.tag!==0&&(i.suspendedLanes|=S&~(U&~s))}function Ke(i,s,u){i.pendingLanes|=s,i.suspendedLanes&=~s;var p=31-ir(s);i.entangledLanes|=s,i.entanglements[p]=i.entanglements[p]|1073741824|u&4194090}function xe(i,s){var u=i.entangledLanes|=s;for(i=i.entanglements;u;){var p=31-ir(u),x=1<<p;x&s|i[p]&s&&(i[p]|=s),u&=~x}}function yt(i){switch(i){case 2:i=1;break;case 8:i=4;break;case 32:i=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:i=128;break;case 268435456:i=134217728;break;default:i=0}return i}function jt(i){return i&=-i,2<i?8<i?(i&134217727)!==0?32:268435456:8:2}function bt(){var i=je.p;return i!==0?i:(i=window.event,i===void 0?32:Et(i.type))}function Rt(i,s){var u=je.p;try{return je.p=i,s()}finally{je.p=u}}var Bt=Math.random().toString(36).slice(2),ai="__reactFiber$"+Bt,ri="__reactProps$"+Bt,fi="__reactContainer$"+Bt,Ut="__reactEvents$"+Bt,di="__reactListeners$"+Bt,Yn="__reactHandles$"+Bt,ft="__reactResources$"+Bt,Sn="__reactMarker$"+Bt;function Qi(i){delete i[ai],delete i[ri],delete i[Ut],delete i[di],delete i[Yn]}function jr(i){var s=i[ai];if(s)return s;for(var u=i.parentNode;u;){if(s=u[fi]||u[ai]){if(u=s.alternate,s.child!==null||u!==null&&u.child!==null)for(i=Tp(i);i!==null;){if(u=i[ai])return u;i=Tp(i)}return s}i=u,u=i.parentNode}return null}function na(i){if(i=i[ai]||i[fi]){var s=i.tag;if(s===5||s===6||s===13||s===26||s===27||s===3)return i}return null}function mt(i){var s=i.tag;if(s===5||s===26||s===27||s===6)return i.stateNode;throw Error(I(33))}function Xt(i){var s=i[ft];return s||(s=i[ft]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Ot(i){i[Sn]=!0}var Cr=new Set,$l={};function ur(i,s){Yt(i,s),Yt(i+"Capture",s)}function Yt(i,s){for($l[i]=s,i=0;i<s.length;i++)Cr.add(s[i])}var ls=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ds={},xn={};function Hl(i){return ho.call(xn,i)?!0:ho.call(Ds,i)?!1:ls.test(i)?xn[i]=!0:(Ds[i]=!0,!1)}function Ls(i,s,u){if(Hl(s))if(u===null)i.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":i.removeAttribute(s);return;case"boolean":var p=s.toLowerCase().slice(0,5);if(p!=="data-"&&p!=="aria-"){i.removeAttribute(s);return}}i.setAttribute(s,""+u)}}function ra(i,s,u){if(u===null)i.removeAttribute(s);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(s);return}i.setAttribute(s,""+u)}}function Ur(i,s,u,p){if(p===null)i.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":i.removeAttribute(u);return}i.setAttributeNS(s,u,""+p)}}var vr,sn;function po(i){if(vr===void 0)try{throw Error()}catch(u){var s=u.stack.trim().match(/\n( *(at )?)/);vr=s&&s[1]||"",sn=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+vr+i+sn}var mo=!1;function nl(i,s){if(!i||mo)return"";mo=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var p={DetermineComponentFrameRoot:function(){try{if(s){var lt=function(){throw Error()};if(Object.defineProperty(lt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(lt,[])}catch(Ge){var Ve=Ge}Reflect.construct(i,[],lt)}else{try{lt.call()}catch(Ge){Ve=Ge}i.call(lt.prototype)}}else{try{throw Error()}catch(Ge){Ve=Ge}(lt=i())&&typeof lt.catch=="function"&&lt.catch(function(){})}}catch(Ge){if(Ge&&Ve&&typeof Ge.stack=="string")return[Ge.stack,Ve.stack]}return[null,null]}};p.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(p.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(p.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var S=p.DetermineComponentFrameRoot(),U=S[0],W=S[1];if(U&&W){var _e=U.split(`
`),Ne=W.split(`
`);for(x=p=0;p<_e.length&&!_e[p].includes("DetermineComponentFrameRoot");)p++;for(;x<Ne.length&&!Ne[x].includes("DetermineComponentFrameRoot");)x++;if(p===_e.length||x===Ne.length)for(p=_e.length-1,x=Ne.length-1;1<=p&&0<=x&&_e[p]!==Ne[x];)x--;for(;1<=p&&0<=x;p--,x--)if(_e[p]!==Ne[x]){if(p!==1||x!==1)do if(p--,x--,0>x||_e[p]!==Ne[x]){var tt=`
`+_e[p].replace(" at new "," at ");return i.displayName&&tt.includes("<anonymous>")&&(tt=tt.replace("<anonymous>",i.displayName)),tt}while(1<=p&&0<=x);break}}}finally{mo=!1,Error.prepareStackTrace=u}return(u=i?i.displayName||i.name:"")?po(u):""}function go(i){switch(i.tag){case 26:case 27:case 5:return po(i.type);case 16:return po("Lazy");case 13:return po("Suspense");case 19:return po("SuspenseList");case 0:case 15:return nl(i.type,!1);case 11:return nl(i.type.render,!1);case 1:return nl(i.type,!0);case 31:return po("Activity");default:return""}}function cs(i){try{var s="";do s+=go(i),i=i.return;while(i);return s}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}function Vr(i){switch(typeof i){case"bigint":case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function zu(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Oh(i){var s=zu(i)?"checked":"value",u=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),p=""+i[s];if(!i.hasOwnProperty(s)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var x=u.get,S=u.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return x.call(this)},set:function(U){p=""+U,S.call(this,U)}}),Object.defineProperty(i,s,{enumerable:u.enumerable}),{getValue:function(){return p},setValue:function(U){p=""+U},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function us(i){i._valueTracker||(i._valueTracker=Oh(i))}function Ru(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var u=s.getValue(),p="";return i&&(p=zu(i)?i.checked?"true":"false":i.value),i=p,i!==u?(s.setValue(i),!0):!1}function Xl(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}var Yl=/[\n"\\]/g;function aa(i){return i.replace(Yl,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function Bc(i,s,u,p,x,S,U,W){i.name="",U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"?i.type=U:i.removeAttribute("type"),s!=null?U==="number"?(s===0&&i.value===""||i.value!=s)&&(i.value=""+Vr(s)):i.value!==""+Vr(s)&&(i.value=""+Vr(s)):U!=="submit"&&U!=="reset"||i.removeAttribute("value"),s!=null?Kl(i,U,Vr(s)):u!=null?Kl(i,U,Vr(u)):p!=null&&i.removeAttribute("value"),x==null&&S!=null&&(i.defaultChecked=!!S),x!=null&&(i.checked=x&&typeof x!="function"&&typeof x!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?i.name=""+Vr(W):i.removeAttribute("name")}function _o(i,s,u,p,x,S,U,W){if(S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(i.type=S),s!=null||u!=null){if(!(S!=="submit"&&S!=="reset"||s!=null))return;u=u!=null?""+Vr(u):"",s=s!=null?""+Vr(s):u,W||s===i.value||(i.value=s),i.defaultValue=s}p=p??x,p=typeof p!="function"&&typeof p!="symbol"&&!!p,i.checked=W?i.checked:!!p,i.defaultChecked=!!p,U!=null&&typeof U!="function"&&typeof U!="symbol"&&typeof U!="boolean"&&(i.name=U)}function Kl(i,s,u){s==="number"&&Xl(i.ownerDocument)===i||i.defaultValue===""+u||(i.defaultValue=""+u)}function ks(i,s,u,p){if(i=i.options,s){s={};for(var x=0;x<u.length;x++)s["$"+u[x]]=!0;for(u=0;u<i.length;u++)x=s.hasOwnProperty("$"+i[u].value),i[u].selected!==x&&(i[u].selected=x),x&&p&&(i[u].defaultSelected=!0)}else{for(u=""+Vr(u),s=null,x=0;x<i.length;x++){if(i[x].value===u){i[x].selected=!0,p&&(i[x].defaultSelected=!0);return}s!==null||i[x].disabled||(s=i[x])}s!==null&&(s.selected=!0)}}function Iu(i,s,u){if(s!=null&&(s=""+Vr(s),s!==i.value&&(i.value=s),u==null)){i.defaultValue!==s&&(i.defaultValue=s);return}i.defaultValue=u!=null?""+Vr(u):""}function Wl(i,s,u,p){if(s==null){if(p!=null){if(u!=null)throw Error(I(92));if(ki(p)){if(1<p.length)throw Error(I(93));p=p[0]}u=p}u==null&&(u=""),s=u}u=Vr(s),i.defaultValue=u,p=i.textContent,p===u&&p!==""&&p!==null&&(i.value=p)}function hs(i,s){if(s){var u=i.firstChild;if(u&&u===i.lastChild&&u.nodeType===3){u.nodeValue=s;return}}i.textContent=s}var Ua=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function ci(i,s,u){var p=s.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?p?i.setProperty(s,""):s==="float"?i.cssFloat="":i[s]="":p?i.setProperty(s,u):typeof u!="number"||u===0||Ua.has(s)?s==="float"?i.cssFloat=u:i[s]=(""+u).trim():i[s]=u+"px"}function Va(i,s,u){if(s!=null&&typeof s!="object")throw Error(I(62));if(i=i.style,u!=null){for(var p in u)!u.hasOwnProperty(p)||s!=null&&s.hasOwnProperty(p)||(p.indexOf("--")===0?i.setProperty(p,""):p==="float"?i.cssFloat="":i[p]="");for(var x in s)p=s[x],s.hasOwnProperty(x)&&u[x]!==p&&ci(i,x,p)}else for(var S in s)s.hasOwnProperty(S)&&ci(i,S,s[S])}function wa(i){if(i.indexOf("-")===-1)return!1;switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var yo=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Du=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function rl(i){return Du.test(""+i)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":i}var Ar=null;function Ta(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var ti=null,Ga=null;function Ql(i){var s=na(i);if(s&&(i=s.stateNode)){var u=i[ri]||null;e:switch(i=s.stateNode,s.type){case"input":if(Bc(i,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),s=u.name,u.type==="radio"&&s!=null){for(u=i;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+aa(""+s)+'"][type="radio"]'),s=0;s<u.length;s++){var p=u[s];if(p!==i&&p.form===i.form){var x=p[ri]||null;if(!x)throw Error(I(90));Bc(p,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(s=0;s<u.length;s++)p=u[s],p.form===i.form&&Ru(p)}break e;case"textarea":Iu(i,u.value,u.defaultValue);break e;case"select":s=u.value,s!=null&&ks(i,!!u.multiple,s,!1)}}}var Jl=!1;function nr(i,s,u){if(Jl)return i(s,u);Jl=!0;try{var p=i(s);return p}finally{if(Jl=!1,(ti!==null||Ga!==null)&&(Rn(),ti&&(s=ti,i=Ga,Ga=ti=null,Ql(s),i)))for(s=0;s<i.length;s++)Ql(i[s])}}function cn(i,s){var u=i.stateNode;if(u===null)return null;var p=u[ri]||null;if(p===null)return null;u=p[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(i=i.type,p=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!p;break e;default:i=!1}if(i)return null;if(u&&typeof u!="function")throw Error(I(231,s,typeof u));return u}var un=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),On=!1;if(un)try{var Bi={};Object.defineProperty(Bi,"passive",{get:function(){On=!0}}),window.addEventListener("test",Bi,Bi),window.removeEventListener("test",Bi,Bi)}catch{On=!1}var Sa=null,hi=null,rr=null;function Kt(){if(rr)return rr;var i,s=hi,u=s.length,p,x="value"in Sa?Sa.value:Sa.textContent,S=x.length;for(i=0;i<u&&s[i]===x[i];i++);var U=u-i;for(p=1;p<=U&&s[u-p]===x[S-p];p++);return rr=x.slice(i,1<p?1-p:void 0)}function Qt(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function Za(){return!0}function Vt(){return!1}function Bn(i){function s(u,p,x,S,U){this._reactName=u,this._targetInst=x,this.type=p,this.nativeEvent=S,this.target=U,this.currentTarget=null;for(var W in i)i.hasOwnProperty(W)&&(u=i[W],this[W]=u?u(S):S[W]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Za:Vt,this.isPropagationStopped=Vt,this}return X(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Za)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Za)},persist:function(){},isPersistent:Za}),s}var Mn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fs=Bn(Mn),Kn=X({},Mn,{view:0,detail:0}),Lu=Bn(Kn),sa,Nc,al,Os=X({},Kn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ar,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==al&&(al&&i.type==="mousemove"?(sa=i.screenX-al.screenX,Nc=i.screenY-al.screenY):Nc=sa=0,al=i),sa)},movementY:function(i){return"movementY"in i?i.movementY:Nc}}),sl=Bn(Os),Ma=X({},Os,{dataTransfer:0}),Wn=Bn(Ma),ol=X({},Kn,{relatedTarget:0}),vo=Bn(ol),ll=X({},Mn,{animationName:0,elapsedTime:0,pseudoElement:0}),Nn=Bn(ll),ec=X({},Mn,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),cl=Bn(ec),ul=X({},Mn,{data:0}),Bh=Bn(ul),Bs={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},tc={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ku={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function If(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=ku[i])?!!s[i]:!1}function ar(){return If}var hl=X({},Kn,{key:function(i){if(i.key){var s=Bs[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Qt(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?tc[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ar,charCode:function(i){return i.type==="keypress"?Qt(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Qt(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),Gr=Bn(hl),Pr=X({},Os,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fc=Bn(Pr),ic=X({},Kn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ar}),fl=Bn(ic),Ou=X({},Mn,{propertyName:0,elapsedTime:0,pseudoElement:0}),Df=Bn(Ou),Lf=X({},Os,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),kf=Bn(Lf),Of=X({},Mn,{newState:0,oldState:0}),jc=Bn(Of),Uc=[9,13,27,32],dl=un&&"CompositionEvent"in window,ds=null;un&&"documentMode"in document&&(ds=document.documentMode);var Bu=un&&"TextEvent"in window&&!ds,nc=un&&(!dl||ds&&8<ds&&11>=ds),Ea=" ",Nh=!1;function Vc(i,s){switch(i){case"keyup":return Uc.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pl(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var qa=!1;function Fh(i,s){switch(i){case"compositionend":return pl(s);case"keypress":return s.which!==32?null:(Nh=!0,Ea);case"textInput":return i=s.data,i===Ea&&Nh?null:i;default:return null}}function rc(i,s){if(qa)return i==="compositionend"||!dl&&Vc(i,s)?(i=Kt(),rr=hi=Sa=null,qa=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return nc&&s.locale!=="ko"?null:s.data;default:return null}}var jh={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xo(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!jh[i.type]:s==="textarea"}function Uh(i,s,u,p){ti?Ga?Ga.push(p):Ga=[p]:ti=p,s=Eh(s,"onChange"),0<s.length&&(u=new fs("onChange","change",null,u,p),i.push({event:u,listeners:s}))}var ml=null,ac=null;function Gc(i){yp(i,0)}function gl(i){var s=mt(i);if(Ru(s))return i}function Nu(i,s){if(i==="change")return s}var Fu=!1;if(un){var sc;if(un){var oc="oninput"in document;if(!oc){var Ns=document.createElement("div");Ns.setAttribute("oninput","return;"),oc=typeof Ns.oninput=="function"}sc=oc}else sc=!1;Fu=sc&&(!document.documentMode||9<document.documentMode)}function ju(){ml&&(ml.detachEvent("onpropertychange",Zc),ac=ml=null)}function Zc(i){if(i.propertyName==="value"&&gl(ac)){var s=[];Uh(s,ac,i,Ta(i)),nr(Gc,s)}}function _l(i,s,u){i==="focusin"?(ju(),ml=s,ac=u,ml.attachEvent("onpropertychange",Zc)):i==="focusout"&&ju()}function Bf(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return gl(ac)}function qc(i,s){if(i==="click")return gl(s)}function Nf(i,s){if(i==="input"||i==="change")return gl(s)}function Vh(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var zr=typeof Object.is=="function"?Object.is:Vh;function yl(i,s){if(zr(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var u=Object.keys(i),p=Object.keys(s);if(u.length!==p.length)return!1;for(p=0;p<u.length;p++){var x=u[p];if(!ho.call(s,x)||!zr(i[x],s[x]))return!1}return!0}function Uu(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function $c(i,s){var u=Uu(i);i=0;for(var p;u;){if(u.nodeType===3){if(p=i+u.textContent.length,i<=s&&p>=s)return{node:u,offset:s-i};i=p}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Uu(u)}}function bi(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?bi(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function lc(i){i=i!=null&&i.ownerDocument!=null&&i.ownerDocument.defaultView!=null?i.ownerDocument.defaultView:window;for(var s=Xl(i.document);s instanceof i.HTMLIFrameElement;){try{var u=typeof s.contentWindow.location.href=="string"}catch{u=!1}if(u)i=s.contentWindow;else break;s=Xl(i.document)}return s}function Ca(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}var Vu=un&&"documentMode"in document&&11>=document.documentMode,Fs=null,cc=null,vl=null,uc=!1;function js(i,s,u){var p=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;uc||Fs==null||Fs!==Xl(p)||(p=Fs,"selectionStart"in p&&Ca(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),vl&&yl(vl,p)||(vl=p,p=Eh(cc,"onSelect"),0<p.length&&(s=new fs("onSelect","select",null,s,u),i.push({event:s,listeners:p}),s.target=Fs)))}function ps(i,s){var u={};return u[i.toLowerCase()]=s.toLowerCase(),u["Webkit"+i]="webkit"+s,u["Moz"+i]="moz"+s,u}var xl={animationend:ps("Animation","AnimationEnd"),animationiteration:ps("Animation","AnimationIteration"),animationstart:ps("Animation","AnimationStart"),transitionrun:ps("Transition","TransitionRun"),transitionstart:ps("Transition","TransitionStart"),transitioncancel:ps("Transition","TransitionCancel"),transitionend:ps("Transition","TransitionEnd")},Gu={},Gh={};un&&(Gh=document.createElement("div").style,"AnimationEvent"in window||(delete xl.animationend.animation,delete xl.animationiteration.animation,delete xl.animationstart.animation),"TransitionEvent"in window||delete xl.transitionend.transition);function bo(i){if(Gu[i])return Gu[i];if(!xl[i])return i;var s=xl[i],u;for(u in s)if(s.hasOwnProperty(u)&&u in Gh)return Gu[i]=s[u];return i}var Zu=bo("animationend"),Zh=bo("animationiteration"),qu=bo("animationstart"),Hc=bo("transitionrun"),Xc=bo("transitionstart"),Yc=bo("transitioncancel"),Kc=bo("transitionend"),Us=new Map,wo="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");wo.push("scrollEnd");function hr(i,s){Us.set(i,s),ur(s,[i])}var Zr=new WeakMap;function qr(i,s){if(typeof i=="object"&&i!==null){var u=Zr.get(i);return u!==void 0?u:(s={value:i,source:s,stack:cs(s)},Zr.set(i,s),s)}return{value:i,source:s,stack:cs(s)}}var $r=[],Vs=0,ms=0;function To(){for(var i=Vs,s=ms=Vs=0;s<i;){var u=$r[s];$r[s++]=null;var p=$r[s];$r[s++]=null;var x=$r[s];$r[s++]=null;var S=$r[s];if($r[s++]=null,p!==null&&x!==null){var U=p.pending;U===null?x.next=x:(x.next=U.next,U.next=x),p.pending=x}S!==0&&$u(u,x,S)}}function So(i,s,u,p){$r[Vs++]=i,$r[Vs++]=s,$r[Vs++]=u,$r[Vs++]=p,ms|=p,i.lanes|=p,i=i.alternate,i!==null&&(i.lanes|=p)}function Mo(i,s,u,p){return So(i,s,u,p),gs(i)}function Aa(i,s){return So(i,null,null,s),gs(i)}function $u(i,s,u){i.lanes|=u;var p=i.alternate;p!==null&&(p.lanes|=u);for(var x=!1,S=i.return;S!==null;)S.childLanes|=u,p=S.alternate,p!==null&&(p.childLanes|=u),S.tag===22&&(i=S.stateNode,i===null||i._visibility&1||(x=!0)),i=S,S=S.return;return i.tag===3?(S=i.stateNode,x&&s!==null&&(x=31-ir(u),i=S.hiddenUpdates,p=i[x],p===null?i[x]=[s]:p.push(s),s.lane=u|536870912),S):null}function gs(i){if(50<vh)throw vh=0,cd=null,Error(I(185));for(var s=i.return;s!==null;)i=s,s=i.return;return i.tag===3?i.stateNode:null}var Pa={};function Hu(i,s,u,p){this.tag=i,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xr(i,s,u,p){return new Hu(i,s,u,p)}function si(i){return i=i.prototype,!(!i||!i.isReactComponent)}function br(i,s){var u=i.alternate;return u===null?(u=xr(i.tag,s,i.key,i.mode),u.elementType=i.elementType,u.type=i.type,u.stateNode=i.stateNode,u.alternate=i,i.alternate=u):(u.pendingProps=s,u.type=i.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=i.flags&65011712,u.childLanes=i.childLanes,u.lanes=i.lanes,u.child=i.child,u.memoizedProps=i.memoizedProps,u.memoizedState=i.memoizedState,u.updateQueue=i.updateQueue,s=i.dependencies,u.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},u.sibling=i.sibling,u.index=i.index,u.ref=i.ref,u.refCleanup=i.refCleanup,u}function Xu(i,s){i.flags&=65011714;var u=i.alternate;return u===null?(i.childLanes=0,i.lanes=s,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=u.childLanes,i.lanes=u.lanes,i.child=u.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=u.memoizedProps,i.memoizedState=u.memoizedState,i.updateQueue=u.updateQueue,i.type=u.type,s=u.dependencies,i.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),i}function hc(i,s,u,p,x,S){var U=0;if(p=i,typeof i=="function")si(i)&&(U=1);else if(typeof i=="string")U=_(i,u,At.current)?26:i==="html"||i==="head"||i==="body"?27:5;else e:switch(i){case Jt:return i=xr(31,u,s,x),i.elementType=Jt,i.lanes=S,i;case Ie:return za(u.children,x,S,s);case Qe:U=8,x|=24;break;case St:return i=xr(12,u,s,x|2),i.elementType=St,i.lanes=S,i;case nt:return i=xr(13,u,s,x),i.elementType=nt,i.lanes=S,i;case Ye:return i=xr(19,u,s,x),i.elementType=Ye,i.lanes=S,i;default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case at:case Xe:U=10;break e;case Ct:U=9;break e;case Je:U=11;break e;case vt:U=14;break e;case Nt:U=16,p=null;break e}U=29,u=Error(I(130,i===null?"null":typeof i,"")),p=null}return s=xr(U,u,s,x),s.elementType=i,s.type=p,s.lanes=S,s}function za(i,s,u,p){return i=xr(7,i,p,s),i.lanes=u,i}function Yu(i,s,u){return i=xr(6,i,null,s),i.lanes=u,i}function Ku(i,s,u){return s=xr(4,i.children!==null?i.children:[],i.key,s),s.lanes=u,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}var Eo=[],Co=0,Ao=null,Po=0,wr=[],fr=0,$a=null,Ra=1,Hr="";function oa(i,s){Eo[Co++]=Po,Eo[Co++]=Ao,Ao=i,Po=s}function zo(i,s,u){wr[fr++]=Ra,wr[fr++]=Hr,wr[fr++]=$a,$a=i;var p=Ra;i=Hr;var x=32-ir(p)-1;p&=~(1<<x),u+=1;var S=32-ir(s)+x;if(30<S){var U=x-x%5;S=(p&(1<<U)-1).toString(32),p>>=U,x-=U,Ra=1<<32-ir(s)+x|u<<x|p,Hr=S+i}else Ra=1<<S|u<<x|p,Hr=i}function Ro(i){i.return!==null&&(oa(i,1),zo(i,1,0))}function fc(i){for(;i===Ao;)Ao=Eo[--Co],Eo[Co]=null,Po=Eo[--Co],Eo[Co]=null;for(;i===$a;)$a=wr[--fr],wr[fr]=null,Hr=wr[--fr],wr[fr]=null,Ra=wr[--fr],wr[fr]=null}var bn=null,wn=null,Si=!1,Ha=null,la=!1,Wc=Error(I(519));function Gs(i){var s=Error(I(418,""));throw ca(qr(s,i)),Wc}function bl(i){var s=i.stateNode,u=i.type,p=i.memoizedProps;switch(s[ai]=i,s[ri]=p,u){case"dialog":xi("cancel",s),xi("close",s);break;case"iframe":case"object":case"embed":xi("load",s);break;case"video":case"audio":for(u=0;u<Mh.length;u++)xi(Mh[u],s);break;case"source":xi("error",s);break;case"img":case"image":case"link":xi("error",s),xi("load",s);break;case"details":xi("toggle",s);break;case"input":xi("invalid",s),_o(s,p.value,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name,!0),us(s);break;case"select":xi("invalid",s);break;case"textarea":xi("invalid",s),Wl(s,p.value,p.defaultValue,p.children),us(s)}u=p.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||s.textContent===""+u||p.suppressHydrationWarning===!0||Su(s.textContent,u)?(p.popover!=null&&(xi("beforetoggle",s),xi("toggle",s)),p.onScroll!=null&&xi("scroll",s),p.onScrollEnd!=null&&xi("scrollend",s),p.onClick!=null&&(s.onclick=Ch),s=!0):s=!1,s||Gs(i)}function dc(i){for(bn=i.return;bn;)switch(bn.tag){case 5:case 13:la=!1;return;case 27:case 3:la=!0;return;default:bn=bn.return}}function Zs(i){if(i!==bn)return!1;if(!Si)return dc(i),Si=!0,!1;var s=i.tag,u;if((u=s!==3&&s!==27)&&((u=s===5)&&(u=i.type,u=!(u!=="form"&&u!=="button")||Id(i.type,i.memoizedProps)),u=!u),u&&wn&&Gs(i),dc(i),s===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(I(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8)if(u=i.data,u==="/$"){if(s===0){wn=ga(i.nextSibling);break e}s--}else u!=="$"&&u!=="$!"&&u!=="$?"||s++;i=i.nextSibling}wn=null}}else s===27?(s=wn,Bl(i.type)?(i=Od,Od=null,wn=i):wn=s):wn=bn?ga(i.stateNode.nextSibling):null;return!0}function wl(){wn=bn=null,Si=!1}function hn(){var i=Ha;return i!==null&&(pa===null?pa=i:pa.push.apply(pa,i),Ha=null),i}function ca(i){Ha===null?Ha=[i]:Ha.push(i)}var Rr=He(null),Xa=null,Xr=null;function Yr(i,s,u){dt(Rr,s._currentValue),s._currentValue=u}function Ir(i){i._currentValue=Rr.current,ot(Rr)}function pc(i,s,u){for(;i!==null;){var p=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,p!==null&&(p.childLanes|=s)):p!==null&&(p.childLanes&s)!==s&&(p.childLanes|=s),i===u)break;i=i.return}}function Io(i,s,u,p){var x=i.child;for(x!==null&&(x.return=i);x!==null;){var S=x.dependencies;if(S!==null){var U=x.child;S=S.firstContext;e:for(;S!==null;){var W=S;S=x;for(var _e=0;_e<s.length;_e++)if(W.context===s[_e]){S.lanes|=u,W=S.alternate,W!==null&&(W.lanes|=u),pc(S.return,u,i),p||(U=null);break e}S=W.next}}else if(x.tag===18){if(U=x.return,U===null)throw Error(I(341));U.lanes|=u,S=U.alternate,S!==null&&(S.lanes|=u),pc(U,u,i),U=null}else U=x.child;if(U!==null)U.return=x;else for(U=x;U!==null;){if(U===i){U=null;break}if(x=U.sibling,x!==null){x.return=U.return,U=x;break}U=U.return}x=U}}function Do(i,s,u,p){i=null;for(var x=s,S=!1;x!==null;){if(!S){if((x.flags&524288)!==0)S=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var U=x.alternate;if(U===null)throw Error(I(387));if(U=U.memoizedProps,U!==null){var W=x.type;zr(x.pendingProps.value,U.value)||(i!==null?i.push(W):i=[W])}}else if(x===Yi.current){if(U=x.alternate,U===null)throw Error(I(387));U.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(i!==null?i.push(ee):i=[ee])}x=x.return}i!==null&&Io(s,i,u,p),s.flags|=262144}function mc(i){for(i=i.firstContext;i!==null;){if(!zr(i.context._currentValue,i.memoizedValue))return!0;i=i.next}return!1}function qs(i){Xa=i,Xr=null,i=i.dependencies,i!==null&&(i.firstContext=null)}function En(i){return Tr(Xa,i)}function _s(i,s){return Xa===null&&qs(i),Tr(i,s)}function Tr(i,s){var u=s._currentValue;if(s={context:s,memoizedValue:u,next:null},Xr===null){if(i===null)throw Error(I(308));Xr=s,i.dependencies={lanes:0,firstContext:s},i.flags|=524288}else Xr=Xr.next=s;return u}var Ia=typeof AbortController<"u"?AbortController:function(){var i=[],s=this.signal={aborted:!1,addEventListener:function(u,p){i.push(p)}};this.abort=function(){s.aborted=!0,i.forEach(function(u){return u()})}},Wu=C.unstable_scheduleCallback,qh=C.unstable_NormalPriority,Fn={$$typeof:Xe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $s(){return{controller:new Ia,data:new Map,refCount:0}}function Lo(i){i.refCount--,i.refCount===0&&Wu(qh,function(){i.controller.abort()})}var Hs=null,Qc=0,ys=0,vs=null;function Tl(i,s){if(Hs===null){var u=Hs=[];Qc=0,ys=kl(),vs={status:"pending",value:void 0,then:function(p){u.push(p)}}}return Qc++,s.then(Kr,Kr),s}function Kr(){if(--Qc===0&&Hs!==null){vs!==null&&(vs.status="fulfilled");var i=Hs;Hs=null,ys=0,vs=null;for(var s=0;s<i.length;s++)(0,i[s])()}}function Da(i,s){var u=[],p={status:"pending",value:null,reason:null,then:function(x){u.push(x)}};return i.then(function(){p.status="fulfilled",p.value=s;for(var x=0;x<u.length;x++)(0,u[x])(s)},function(x){for(p.status="rejected",p.reason=x,x=0;x<u.length;x++)(0,u[x])(void 0)}),p}var Qu=We.S;We.S=function(i,s){typeof s=="object"&&s!==null&&typeof s.then=="function"&&Tl(i,s),Qu!==null&&Qu(i,s)};var Cn=He(null);function Xs(){var i=Cn.current;return i!==null?i:Fi.pooledCache}function Jc(i,s){s===null?dt(Cn,Cn.current):dt(Cn,s.pool)}function gc(){var i=Xs();return i===null?null:{parent:Fn._currentValue,pool:i}}var _c=Error(I(460)),eu=Error(I(474)),Ys=Error(I(542)),Ks={then:function(){}};function La(i){return i=i.status,i==="fulfilled"||i==="rejected"}function xt(){}function tu(i,s,u){switch(u=i[u],u===void 0?i.push(s):u!==s&&(s.then(xt,xt),s=u),s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Sl(i),i;default:if(typeof s.status=="string")s.then(xt,xt);else{if(i=Fi,i!==null&&100<i.shellSuspendCounter)throw Error(I(482));i=s,i.status="pending",i.then(function(p){if(s.status==="pending"){var x=s;x.status="fulfilled",x.value=p}},function(p){if(s.status==="pending"){var x=s;x.status="rejected",x.reason=p}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw i=s.reason,Sl(i),i}throw xs=s,_c}}var xs=null;function iu(){if(xs===null)throw Error(I(459));var i=xs;return xs=null,i}function Sl(i){if(i===_c||i===Ys)throw Error(I(483))}var Wr=!1;function yc(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function oi(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,callbacks:null})}function Ya(i){return{lane:i,tag:0,payload:null,callback:null,next:null}}function bs(i,s,u){var p=i.updateQueue;if(p===null)return null;if(p=p.shared,(Ni&2)!==0){var x=p.pending;return x===null?s.next=s:(s.next=x.next,x.next=s),p.pending=s,s=gs(i),$u(i,null,u),s}return So(i,p,s,u),gs(i)}function Ws(i,s,u){if(s=s.updateQueue,s!==null&&(s=s.shared,(u&4194048)!==0)){var p=s.lanes;p&=i.pendingLanes,u|=p,s.lanes=u,xe(i,u)}}function Ju(i,s){var u=i.updateQueue,p=i.alternate;if(p!==null&&(p=p.updateQueue,u===p)){var x=null,S=null;if(u=u.firstBaseUpdate,u!==null){do{var U={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};S===null?x=S=U:S=S.next=U,u=u.next}while(u!==null);S===null?x=S=s:S=S.next=s}else x=S=s;u={baseState:p.baseState,firstBaseUpdate:x,lastBaseUpdate:S,shared:p.shared,callbacks:p.callbacks},i.updateQueue=u;return}i=u.lastBaseUpdate,i===null?u.firstBaseUpdate=s:i.next=s,u.lastBaseUpdate=s}var eh=!1;function ko(){if(eh){var i=vs;if(i!==null)throw i}}function Qs(i,s,u,p){eh=!1;var x=i.updateQueue;Wr=!1;var S=x.firstBaseUpdate,U=x.lastBaseUpdate,W=x.shared.pending;if(W!==null){x.shared.pending=null;var _e=W,Ne=_e.next;_e.next=null,U===null?S=Ne:U.next=Ne,U=_e;var tt=i.alternate;tt!==null&&(tt=tt.updateQueue,W=tt.lastBaseUpdate,W!==U&&(W===null?tt.firstBaseUpdate=Ne:W.next=Ne,tt.lastBaseUpdate=_e))}if(S!==null){var lt=x.baseState;U=0,tt=Ne=_e=null,W=S;do{var Ve=W.lane&-536870913,Ge=Ve!==W.lane;if(Ge?(wi&Ve)===Ve:(p&Ve)===Ve){Ve!==0&&Ve===ys&&(eh=!0),tt!==null&&(tt=tt.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var Zt=i,$t=W;Ve=s;var Xi=u;switch($t.tag){case 1:if(Zt=$t.payload,typeof Zt=="function"){lt=Zt.call(Xi,lt,Ve);break e}lt=Zt;break e;case 3:Zt.flags=Zt.flags&-65537|128;case 0:if(Zt=$t.payload,Ve=typeof Zt=="function"?Zt.call(Xi,lt,Ve):Zt,Ve==null)break e;lt=X({},lt,Ve);break e;case 2:Wr=!0}}Ve=W.callback,Ve!==null&&(i.flags|=64,Ge&&(i.flags|=8192),Ge=x.callbacks,Ge===null?x.callbacks=[Ve]:Ge.push(Ve))}else Ge={lane:Ve,tag:W.tag,payload:W.payload,callback:W.callback,next:null},tt===null?(Ne=tt=Ge,_e=lt):tt=tt.next=Ge,U|=Ve;if(W=W.next,W===null){if(W=x.shared.pending,W===null)break;Ge=W,W=Ge.next,Ge.next=null,x.lastBaseUpdate=Ge,x.shared.pending=null}}while(!0);tt===null&&(_e=lt),x.baseState=_e,x.firstBaseUpdate=Ne,x.lastBaseUpdate=tt,S===null&&(x.shared.lanes=0),Dl|=U,i.lanes=U,i.memoizedState=lt}}function nu(i,s){if(typeof i!="function")throw Error(I(191,i));i.call(s)}function th(i,s){var u=i.callbacks;if(u!==null)for(i.callbacks=null,i=0;i<u.length;i++)nu(u[i],s)}var Ka=He(null),ru=He(0);function au(i,s){i=ao,dt(ru,i),dt(Ka,s),ao=i|s.baseLanes}function Wa(){dt(ru,ao),dt(Ka,Ka.current)}function Ui(){ao=ru.current,ot(Ka),ot(ru)}var ua=0,li=null,Ai=null,An=null,vc=!1,Ml=!1,dr=!1,Oo=0,wt=0,It=null,su=0;function pn(){throw Error(I(321))}function Bo(i,s){if(s===null)return!1;for(var u=0;u<s.length&&u<i.length;u++)if(!zr(i[u],s[u]))return!1;return!0}function sr(i,s,u,p,x,S){return ua=S,li=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,We.H=i===null||i.memoizedState===null?da:Ms,dr=!1,S=u(p,x),dr=!1,Ml&&(S=Qn(s,u,p,x)),ih(i),S}function ih(i){We.H=lr;var s=Ai!==null&&Ai.next!==null;if(ua=0,An=Ai=li=null,vc=!1,wt=0,It=null,s)throw Error(I(300));i===null||mr||(i=i.dependencies,i!==null&&mc(i)&&(mr=!0))}function Qn(i,s,u,p){li=i;var x=0;do{if(Ml&&(It=null),wt=0,Ml=!1,25<=x)throw Error(I(301));if(x+=1,An=Ai=null,i.updateQueue!=null){var S=i.updateQueue;S.lastEffect=null,S.events=null,S.stores=null,S.memoCache!=null&&(S.memoCache.index=0)}We.H=Uo,S=s(u,p)}while(Ml);return S}function $h(){var i=We.H,s=i.useState()[0];return s=typeof s.then=="function"?No(s):s,i=i.useState()[0],(Ai!==null?Ai.memoizedState:null)!==i&&(li.flags|=1024),s}function ws(){var i=Oo!==0;return Oo=0,i}function Ji(i,s,u){s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~u}function on(i){if(vc){for(i=i.memoizedState;i!==null;){var s=i.queue;s!==null&&(s.pending=null),i=i.next}vc=!1}ua=0,An=Ai=li=null,Ml=!1,wt=Oo=0,It=null}function Sr(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return An===null?li.memoizedState=An=i:An=An.next=i,An}function Vi(){if(Ai===null){var i=li.alternate;i=i!==null?i.memoizedState:null}else i=Ai.next;var s=An===null?li.memoizedState:An.next;if(s!==null)An=s,Ai=i;else{if(i===null)throw li.alternate===null?Error(I(467)):Error(I(310));Ai=i,i={memoizedState:Ai.memoizedState,baseState:Ai.baseState,baseQueue:Ai.baseQueue,queue:Ai.queue,next:null},An===null?li.memoizedState=An=i:An=An.next=i}return An}function Qa(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function No(i){var s=wt;return wt+=1,It===null&&(It=[]),i=tu(It,i,s),s=li,(An===null?s.memoizedState:An.next)===null&&(s=s.alternate,We.H=s===null||s.memoizedState===null?da:Ms),i}function Fo(i){if(i!==null&&typeof i=="object"){if(typeof i.then=="function")return No(i);if(i.$$typeof===Xe)return En(i)}throw Error(I(438,String(i)))}function Ts(i){var s=null,u=li.updateQueue;if(u!==null&&(s=u.memoCache),s==null){var p=li.alternate;p!==null&&(p=p.updateQueue,p!==null&&(p=p.memoCache,p!=null&&(s={data:p.data.map(function(x){return x.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),u===null&&(u=Qa(),li.updateQueue=u),u.memoCache=s,u=s.data[s.index],u===void 0)for(u=s.data[s.index]=Array(i),p=0;p<i;p++)u[p]=Lt;return s.index++,u}function Qr(i,s){return typeof s=="function"?s(i):s}function El(i){var s=Vi();return Cl(s,Ai,i)}function Cl(i,s,u){var p=i.queue;if(p===null)throw Error(I(311));p.lastRenderedReducer=u;var x=i.baseQueue,S=p.pending;if(S!==null){if(x!==null){var U=x.next;x.next=S.next,S.next=U}s.baseQueue=x=S,p.pending=null}if(S=i.baseState,x===null)i.memoizedState=S;else{s=x.next;var W=U=null,_e=null,Ne=s,tt=!1;do{var lt=Ne.lane&-536870913;if(lt!==Ne.lane?(wi&lt)===lt:(ua&lt)===lt){var Ve=Ne.revertLane;if(Ve===0)_e!==null&&(_e=_e.next={lane:0,revertLane:0,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null}),lt===ys&&(tt=!0);else if((ua&Ve)===Ve){Ne=Ne.next,Ve===ys&&(tt=!0);continue}else lt={lane:0,revertLane:Ne.revertLane,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null},_e===null?(W=_e=lt,U=S):_e=_e.next=lt,li.lanes|=Ve,Dl|=Ve;lt=Ne.action,dr&&u(S,lt),S=Ne.hasEagerState?Ne.eagerState:u(S,lt)}else Ve={lane:lt,revertLane:Ne.revertLane,action:Ne.action,hasEagerState:Ne.hasEagerState,eagerState:Ne.eagerState,next:null},_e===null?(W=_e=Ve,U=S):_e=_e.next=Ve,li.lanes|=lt,Dl|=lt;Ne=Ne.next}while(Ne!==null&&Ne!==s);if(_e===null?U=S:_e.next=W,!zr(S,i.memoizedState)&&(mr=!0,tt&&(u=vs,u!==null)))throw u;i.memoizedState=S,i.baseState=U,i.baseQueue=_e,p.lastRenderedState=S}return x===null&&(p.lanes=0),[i.memoizedState,p.dispatch]}function xc(i){var s=Vi(),u=s.queue;if(u===null)throw Error(I(311));u.lastRenderedReducer=i;var p=u.dispatch,x=u.pending,S=s.memoizedState;if(x!==null){u.pending=null;var U=x=x.next;do S=i(S,U.action),U=U.next;while(U!==x);zr(S,s.memoizedState)||(mr=!0),s.memoizedState=S,s.baseQueue===null&&(s.baseState=S),u.lastRenderedState=S}return[S,p]}function d(i,s,u){var p=li,x=Vi(),S=Si;if(S){if(u===void 0)throw Error(I(407));u=u()}else u=s();var U=!zr((Ai||x).memoizedState,u);U&&(x.memoizedState=u,mr=!0),x=x.queue;var W=l.bind(null,p,x,i);if(Te(2048,8,W,[i]),x.getSnapshot!==s||U||An!==null&&An.memoizedState.tag&1){if(p.flags|=2048,le(9,ge(),n.bind(null,p,x,u,s),null),Fi===null)throw Error(I(349));S||(ua&124)!==0||e(p,s,u)}return u}function e(i,s,u){i.flags|=16384,i={getSnapshot:s,value:u},s=li.updateQueue,s===null?(s=Qa(),li.updateQueue=s,s.stores=[i]):(u=s.stores,u===null?s.stores=[i]:u.push(i))}function n(i,s,u,p){s.value=u,s.getSnapshot=p,h(s)&&m(i)}function l(i,s,u){return u(function(){h(s)&&m(i)})}function h(i){var s=i.getSnapshot;i=i.value;try{var u=s();return!zr(i,u)}catch{return!0}}function m(i){var s=Aa(i,2);s!==null&&Na(s,i,2)}function y(i){var s=Sr();if(typeof i=="function"){var u=i;if(i=u(),dr){tr(!0);try{u()}finally{tr(!1)}}}return s.memoizedState=s.baseState=i,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qr,lastRenderedState:i},s}function b(i,s,u,p){return i.baseState=u,Cl(i,Ai,typeof p=="function"?p:Qr)}function T(i,s,u,p,x){if(eo(i))throw Error(I(485));if(i=s.action,i!==null){var S={payload:x,action:i,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(U){S.listeners.push(U)}};We.T!==null?u(!0):S.isTransition=!1,p(S),u=s.pending,u===null?(S.next=s.pending=S,A(s,S)):(S.next=u.next,s.pending=u.next=S)}}function A(i,s){var u=s.action,p=s.payload,x=i.state;if(s.isTransition){var S=We.T,U={};We.T=U;try{var W=u(x,p),_e=We.S;_e!==null&&_e(U,W),z(i,s,W)}catch(Ne){L(i,s,Ne)}finally{We.T=S}}else try{S=u(x,p),z(i,s,S)}catch(Ne){L(i,s,Ne)}}function z(i,s,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(p){O(i,s,p)},function(p){return L(i,s,p)}):O(i,s,u)}function O(i,s,u){s.status="fulfilled",s.value=u,N(s),i.state=u,s=i.pending,s!==null&&(u=s.next,u===s?i.pending=null:(u=u.next,s.next=u,A(i,u)))}function L(i,s,u){var p=i.pending;if(i.pending=null,p!==null){p=p.next;do s.status="rejected",s.reason=u,N(s),s=s.next;while(s!==p)}i.action=null}function N(i){i=i.listeners;for(var s=0;s<i.length;s++)(0,i[s])()}function Z(i,s){return s}function ne(i,s){if(Si){var u=Fi.formState;if(u!==null){e:{var p=li;if(Si){if(wn){t:{for(var x=wn,S=la;x.nodeType!==8;){if(!S){x=null;break t}if(x=ga(x.nextSibling),x===null){x=null;break t}}S=x.data,x=S==="F!"||S==="F"?x:null}if(x){wn=ga(x.nextSibling),p=x.data==="F!";break e}}Gs(p)}p=!1}p&&(s=u[0])}}return u=Sr(),u.memoizedState=u.baseState=s,p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Z,lastRenderedState:s},u.queue=p,u=Ss.bind(null,li,p),p.dispatch=u,p=y(!1),S=fa.bind(null,li,!1,p.queue),p=Sr(),x={state:s,dispatch:null,action:i,pending:null},p.queue=x,u=T.bind(null,li,x,S,u),x.dispatch=u,p.memoizedState=i,[s,u,!1]}function ie(i){var s=Vi();return re(s,Ai,i)}function re(i,s,u){if(s=Cl(i,s,Z)[0],i=El(Qr)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var p=No(s)}catch(U){throw U===_c?Ys:U}else p=s;s=Vi();var x=s.queue,S=x.dispatch;return u!==s.memoizedState&&(li.flags|=2048,le(9,ge(),oe.bind(null,x,u),null)),[p,S,i]}function oe(i,s){i.action=s}function fe(i){var s=Vi(),u=Ai;if(u!==null)return re(s,u,i);Vi(),s=s.memoizedState,u=Vi();var p=u.queue.dispatch;return u.memoizedState=i,[s,p,!1]}function le(i,s,u,p){return i={tag:i,create:u,deps:p,inst:s,next:null},s=li.updateQueue,s===null&&(s=Qa(),li.updateQueue=s),u=s.lastEffect,u===null?s.lastEffect=i.next=i:(p=u.next,u.next=i,i.next=p,s.lastEffect=i),i}function ge(){return{destroy:void 0,resource:void 0}}function ve(){return Vi().memoizedState}function ue(i,s,u,p){var x=Sr();p=p===void 0?null:p,li.flags|=i,x.memoizedState=le(1|s,ge(),u,p)}function Te(i,s,u,p){var x=Vi();p=p===void 0?null:p;var S=x.memoizedState.inst;Ai!==null&&p!==null&&Bo(p,Ai.memoizedState.deps)?x.memoizedState=le(s,S,u,p):(li.flags|=i,x.memoizedState=le(1|s,S,u,p))}function Oe(i,s){ue(8390656,8,i,s)}function ze(i,s){Te(2048,8,i,s)}function Re(i,s){return Te(4,2,i,s)}function Be(i,s){return Te(4,4,i,s)}function gt(i,s){if(typeof s=="function"){i=i();var u=s(i);return function(){typeof u=="function"?u():s(null)}}if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function pt(i,s,u){u=u!=null?u.concat([i]):null,Te(4,4,gt.bind(null,s,i),u)}function it(){}function Mt(i,s){var u=Vi();s=s===void 0?null:s;var p=u.memoizedState;return s!==null&&Bo(s,p[1])?p[0]:(u.memoizedState=[i,s],i)}function ii(i,s){var u=Vi();s=s===void 0?null:s;var p=u.memoizedState;if(s!==null&&Bo(s,p[1]))return p[0];if(p=i(),dr){tr(!0);try{i()}finally{tr(!1)}}return u.memoizedState=[p,s],p}function yi(i,s,u){return u===void 0||(ua&1073741824)!==0?i.memoizedState=s:(i.memoizedState=u,i=lp(),li.lanes|=i,Dl|=i,u)}function ln(i,s,u,p){return zr(u,s)?u:Ka.current!==null?(i=yi(i,u,p),zr(i,s)||(mr=!0),i):(ua&42)===0?(mr=!0,i.memoizedState=u):(i=lp(),li.lanes|=i,Dl|=i,s)}function Pi(i,s,u,p,x){var S=je.p;je.p=S!==0&&8>S?S:8;var U=We.T,W={};We.T=W,fa(i,!1,s,u);try{var _e=x(),Ne=We.S;if(Ne!==null&&Ne(W,_e),_e!==null&&typeof _e=="object"&&typeof _e.then=="function"){var tt=Da(_e,p);ha(i,s,tt,ma(i))}else ha(i,s,p,ma(i))}catch(lt){ha(i,s,{then:function(){},status:"rejected",reason:lt},ma())}finally{je.p=S,We.T=U}}function fn(){}function zi(i,s,u,p){if(i.tag!==5)throw Error(I(476));var x=Ri(i).queue;Pi(i,x,s,_t,u===null?fn:function(){return Oi(i),u(p)})}function Ri(i){var s=i.memoizedState;if(s!==null)return s;s={memoizedState:_t,baseState:_t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qr,lastRenderedState:_t},next:null};var u={};return s.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qr,lastRenderedState:u},next:null},i.memoizedState=s,i=i.alternate,i!==null&&(i.memoizedState=s),s}function Oi(i){var s=Ri(i).next.queue;ha(i,s,{},ma())}function Zn(){return En(ee)}function pi(){return Vi().memoizedState}function qn(){return Vi().memoizedState}function or(i){for(var s=i.return;s!==null;){switch(s.tag){case 24:case 3:var u=ma();i=Ya(u);var p=bs(s,i,u);p!==null&&(Na(p,s,u),Ws(p,s,u)),s={cache:$s()},i.payload=s;return}s=s.return}}function Js(i,s,u){var p=ma();u={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null},eo(i)?Al(s,u):(u=Mo(i,s,u,p),u!==null&&(Na(u,i,p),jo(u,s,p)))}function Ss(i,s,u){var p=ma();ha(i,s,u,p)}function ha(i,s,u,p){var x={lane:p,revertLane:0,action:u,hasEagerState:!1,eagerState:null,next:null};if(eo(i))Al(s,x);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=s.lastRenderedReducer,S!==null))try{var U=s.lastRenderedState,W=S(U,u);if(x.hasEagerState=!0,x.eagerState=W,zr(W,U))return So(i,s,x,0),Fi===null&&To(),!1}catch{}finally{}if(u=Mo(i,s,x,p),u!==null)return Na(u,i,p),jo(u,s,p),!0}return!1}function fa(i,s,u,p){if(p={lane:2,revertLane:kl(),action:p,hasEagerState:!1,eagerState:null,next:null},eo(i)){if(s)throw Error(I(479))}else s=Mo(i,u,p,2),s!==null&&Na(s,i,2)}function eo(i){var s=i.alternate;return i===li||s!==null&&s===li}function Al(i,s){Ml=vc=!0;var u=i.pending;u===null?s.next=s:(s.next=u.next,u.next=s),i.pending=s}function jo(i,s,u){if((u&4194048)!==0){var p=s.lanes;p&=i.pendingLanes,u|=p,s.lanes=u,xe(i,u)}}var lr={readContext:En,use:Fo,useCallback:pn,useContext:pn,useEffect:pn,useImperativeHandle:pn,useLayoutEffect:pn,useInsertionEffect:pn,useMemo:pn,useReducer:pn,useRef:pn,useState:pn,useDebugValue:pn,useDeferredValue:pn,useTransition:pn,useSyncExternalStore:pn,useId:pn,useHostTransitionStatus:pn,useFormState:pn,useActionState:pn,useOptimistic:pn,useMemoCache:pn,useCacheRefresh:pn},da={readContext:En,use:Fo,useCallback:function(i,s){return Sr().memoizedState=[i,s===void 0?null:s],i},useContext:En,useEffect:Oe,useImperativeHandle:function(i,s,u){u=u!=null?u.concat([i]):null,ue(4194308,4,gt.bind(null,s,i),u)},useLayoutEffect:function(i,s){return ue(4194308,4,i,s)},useInsertionEffect:function(i,s){ue(4,2,i,s)},useMemo:function(i,s){var u=Sr();s=s===void 0?null:s;var p=i();if(dr){tr(!0);try{i()}finally{tr(!1)}}return u.memoizedState=[p,s],p},useReducer:function(i,s,u){var p=Sr();if(u!==void 0){var x=u(s);if(dr){tr(!0);try{u(s)}finally{tr(!1)}}}else x=s;return p.memoizedState=p.baseState=x,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:x},p.queue=i,i=i.dispatch=Js.bind(null,li,i),[p.memoizedState,i]},useRef:function(i){var s=Sr();return i={current:i},s.memoizedState=i},useState:function(i){i=y(i);var s=i.queue,u=Ss.bind(null,li,s);return s.dispatch=u,[i.memoizedState,u]},useDebugValue:it,useDeferredValue:function(i,s){var u=Sr();return yi(u,i,s)},useTransition:function(){var i=y(!1);return i=Pi.bind(null,li,i.queue,!0,!1),Sr().memoizedState=i,[!1,i]},useSyncExternalStore:function(i,s,u){var p=li,x=Sr();if(Si){if(u===void 0)throw Error(I(407));u=u()}else{if(u=s(),Fi===null)throw Error(I(349));(wi&124)!==0||e(p,s,u)}x.memoizedState=u;var S={value:u,getSnapshot:s};return x.queue=S,Oe(l.bind(null,p,S,i),[i]),p.flags|=2048,le(9,ge(),n.bind(null,p,S,u,s),null),u},useId:function(){var i=Sr(),s=Fi.identifierPrefix;if(Si){var u=Hr,p=Ra;u=(p&~(1<<32-ir(p)-1)).toString(32)+u,s=""+s+"R"+u,u=Oo++,0<u&&(s+="H"+u.toString(32)),s+=""}else u=su++,s=""+s+"r"+u.toString(32)+"";return i.memoizedState=s},useHostTransitionStatus:Zn,useFormState:ne,useActionState:ne,useOptimistic:function(i){var s=Sr();s.memoizedState=s.baseState=i;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=u,s=fa.bind(null,li,!0,u),u.dispatch=s,[i,s]},useMemoCache:Ts,useCacheRefresh:function(){return Sr().memoizedState=or.bind(null,li)}},Ms={readContext:En,use:Fo,useCallback:Mt,useContext:En,useEffect:ze,useImperativeHandle:pt,useInsertionEffect:Re,useLayoutEffect:Be,useMemo:ii,useReducer:El,useRef:ve,useState:function(){return El(Qr)},useDebugValue:it,useDeferredValue:function(i,s){var u=Vi();return ln(u,Ai.memoizedState,i,s)},useTransition:function(){var i=El(Qr)[0],s=Vi().memoizedState;return[typeof i=="boolean"?i:No(i),s]},useSyncExternalStore:d,useId:pi,useHostTransitionStatus:Zn,useFormState:ie,useActionState:ie,useOptimistic:function(i,s){var u=Vi();return b(u,Ai,i,s)},useMemoCache:Ts,useCacheRefresh:qn},Uo={readContext:En,use:Fo,useCallback:Mt,useContext:En,useEffect:ze,useImperativeHandle:pt,useInsertionEffect:Re,useLayoutEffect:Be,useMemo:ii,useReducer:xc,useRef:ve,useState:function(){return xc(Qr)},useDebugValue:it,useDeferredValue:function(i,s){var u=Vi();return Ai===null?yi(u,i,s):ln(u,Ai.memoizedState,i,s)},useTransition:function(){var i=xc(Qr)[0],s=Vi().memoizedState;return[typeof i=="boolean"?i:No(i),s]},useSyncExternalStore:d,useId:pi,useHostTransitionStatus:Zn,useFormState:fe,useActionState:fe,useOptimistic:function(i,s){var u=Vi();return Ai!==null?b(u,Ai,i,s):(u.baseState=i,[i,u.queue.dispatch])},useMemoCache:Ts,useCacheRefresh:qn},Gi=null,Ii=0;function Jn(i){var s=Ii;return Ii+=1,Gi===null&&(Gi=[]),tu(Gi,i,s)}function mn(i,s){s=s.props.ref,i.ref=s!==void 0?s:null}function bc(i,s){throw s.$$typeof===ce?Error(I(525)):(i=Object.prototype.toString.call(s),Error(I(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i)))}function Hh(i){var s=i._init;return s(i._payload)}function ou(i){function s(Pe,Me){if(i){var ke=Pe.deletions;ke===null?(Pe.deletions=[Me],Pe.flags|=16):ke.push(Me)}}function u(Pe,Me){if(!i)return null;for(;Me!==null;)s(Pe,Me),Me=Me.sibling;return null}function p(Pe){for(var Me=new Map;Pe!==null;)Pe.key!==null?Me.set(Pe.key,Pe):Me.set(Pe.index,Pe),Pe=Pe.sibling;return Me}function x(Pe,Me){return Pe=br(Pe,Me),Pe.index=0,Pe.sibling=null,Pe}function S(Pe,Me,ke){return Pe.index=ke,i?(ke=Pe.alternate,ke!==null?(ke=ke.index,ke<Me?(Pe.flags|=67108866,Me):ke):(Pe.flags|=67108866,Me)):(Pe.flags|=1048576,Me)}function U(Pe){return i&&Pe.alternate===null&&(Pe.flags|=67108866),Pe}function W(Pe,Me,ke,st){return Me===null||Me.tag!==6?(Me=Yu(ke,Pe.mode,st),Me.return=Pe,Me):(Me=x(Me,ke),Me.return=Pe,Me)}function _e(Pe,Me,ke,st){var Dt=ke.type;return Dt===Ie?tt(Pe,Me,ke.props.children,st,ke.key):Me!==null&&(Me.elementType===Dt||typeof Dt=="object"&&Dt!==null&&Dt.$$typeof===Nt&&Hh(Dt)===Me.type)?(Me=x(Me,ke.props),mn(Me,ke),Me.return=Pe,Me):(Me=hc(ke.type,ke.key,ke.props,null,Pe.mode,st),mn(Me,ke),Me.return=Pe,Me)}function Ne(Pe,Me,ke,st){return Me===null||Me.tag!==4||Me.stateNode.containerInfo!==ke.containerInfo||Me.stateNode.implementation!==ke.implementation?(Me=Ku(ke,Pe.mode,st),Me.return=Pe,Me):(Me=x(Me,ke.children||[]),Me.return=Pe,Me)}function tt(Pe,Me,ke,st,Dt){return Me===null||Me.tag!==7?(Me=za(ke,Pe.mode,st,Dt),Me.return=Pe,Me):(Me=x(Me,ke),Me.return=Pe,Me)}function lt(Pe,Me,ke){if(typeof Me=="string"&&Me!==""||typeof Me=="number"||typeof Me=="bigint")return Me=Yu(""+Me,Pe.mode,ke),Me.return=Pe,Me;if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case K:return ke=hc(Me.type,Me.key,Me.props,null,Pe.mode,ke),mn(ke,Me),ke.return=Pe,ke;case Q:return Me=Ku(Me,Pe.mode,ke),Me.return=Pe,Me;case Nt:var st=Me._init;return Me=st(Me._payload),lt(Pe,Me,ke)}if(ki(Me)||ni(Me))return Me=za(Me,Pe.mode,ke,null),Me.return=Pe,Me;if(typeof Me.then=="function")return lt(Pe,Jn(Me),ke);if(Me.$$typeof===Xe)return lt(Pe,_s(Pe,Me),ke);bc(Pe,Me)}return null}function Ve(Pe,Me,ke,st){var Dt=Me!==null?Me.key:null;if(typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint")return Dt!==null?null:W(Pe,Me,""+ke,st);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case K:return ke.key===Dt?_e(Pe,Me,ke,st):null;case Q:return ke.key===Dt?Ne(Pe,Me,ke,st):null;case Nt:return Dt=ke._init,ke=Dt(ke._payload),Ve(Pe,Me,ke,st)}if(ki(ke)||ni(ke))return Dt!==null?null:tt(Pe,Me,ke,st,null);if(typeof ke.then=="function")return Ve(Pe,Me,Jn(ke),st);if(ke.$$typeof===Xe)return Ve(Pe,Me,_s(Pe,ke),st);bc(Pe,ke)}return null}function Ge(Pe,Me,ke,st,Dt){if(typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint")return Pe=Pe.get(ke)||null,W(Me,Pe,""+st,Dt);if(typeof st=="object"&&st!==null){switch(st.$$typeof){case K:return Pe=Pe.get(st.key===null?ke:st.key)||null,_e(Me,Pe,st,Dt);case Q:return Pe=Pe.get(st.key===null?ke:st.key)||null,Ne(Me,Pe,st,Dt);case Nt:var gi=st._init;return st=gi(st._payload),Ge(Pe,Me,ke,st,Dt)}if(ki(st)||ni(st))return Pe=Pe.get(ke)||null,tt(Me,Pe,st,Dt,null);if(typeof st.then=="function")return Ge(Pe,Me,ke,Jn(st),Dt);if(st.$$typeof===Xe)return Ge(Pe,Me,ke,_s(Me,st),Dt);bc(Me,st)}return null}function Zt(Pe,Me,ke,st){for(var Dt=null,gi=null,Gt=Me,Wt=Me=0,nn=null;Gt!==null&&Wt<ke.length;Wt++){Gt.index>Wt?(nn=Gt,Gt=null):nn=Gt.sibling;var Ti=Ve(Pe,Gt,ke[Wt],st);if(Ti===null){Gt===null&&(Gt=nn);break}i&&Gt&&Ti.alternate===null&&s(Pe,Gt),Me=S(Ti,Me,Wt),gi===null?Dt=Ti:gi.sibling=Ti,gi=Ti,Gt=nn}if(Wt===ke.length)return u(Pe,Gt),Si&&oa(Pe,Wt),Dt;if(Gt===null){for(;Wt<ke.length;Wt++)Gt=lt(Pe,ke[Wt],st),Gt!==null&&(Me=S(Gt,Me,Wt),gi===null?Dt=Gt:gi.sibling=Gt,gi=Gt);return Si&&oa(Pe,Wt),Dt}for(Gt=p(Gt);Wt<ke.length;Wt++)nn=Ge(Gt,Pe,Wt,ke[Wt],st),nn!==null&&(i&&nn.alternate!==null&&Gt.delete(nn.key===null?Wt:nn.key),Me=S(nn,Me,Wt),gi===null?Dt=nn:gi.sibling=nn,gi=nn);return i&&Gt.forEach(function(el){return s(Pe,el)}),Si&&oa(Pe,Wt),Dt}function $t(Pe,Me,ke,st){if(ke==null)throw Error(I(151));for(var Dt=null,gi=null,Gt=Me,Wt=Me=0,nn=null,Ti=ke.next();Gt!==null&&!Ti.done;Wt++,Ti=ke.next()){Gt.index>Wt?(nn=Gt,Gt=null):nn=Gt.sibling;var el=Ve(Pe,Gt,Ti.value,st);if(el===null){Gt===null&&(Gt=nn);break}i&&Gt&&el.alternate===null&&s(Pe,Gt),Me=S(el,Me,Wt),gi===null?Dt=el:gi.sibling=el,gi=el,Gt=nn}if(Ti.done)return u(Pe,Gt),Si&&oa(Pe,Wt),Dt;if(Gt===null){for(;!Ti.done;Wt++,Ti=ke.next())Ti=lt(Pe,Ti.value,st),Ti!==null&&(Me=S(Ti,Me,Wt),gi===null?Dt=Ti:gi.sibling=Ti,gi=Ti);return Si&&oa(Pe,Wt),Dt}for(Gt=p(Gt);!Ti.done;Wt++,Ti=ke.next())Ti=Ge(Gt,Pe,Wt,Ti.value,st),Ti!==null&&(i&&Ti.alternate!==null&&Gt.delete(Ti.key===null?Wt:Ti.key),Me=S(Ti,Me,Wt),gi===null?Dt=Ti:gi.sibling=Ti,gi=Ti);return i&&Gt.forEach(function(qp){return s(Pe,qp)}),Si&&oa(Pe,Wt),Dt}function Xi(Pe,Me,ke,st){if(typeof ke=="object"&&ke!==null&&ke.type===Ie&&ke.key===null&&(ke=ke.props.children),typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case K:e:{for(var Dt=ke.key;Me!==null;){if(Me.key===Dt){if(Dt=ke.type,Dt===Ie){if(Me.tag===7){u(Pe,Me.sibling),st=x(Me,ke.props.children),st.return=Pe,Pe=st;break e}}else if(Me.elementType===Dt||typeof Dt=="object"&&Dt!==null&&Dt.$$typeof===Nt&&Hh(Dt)===Me.type){u(Pe,Me.sibling),st=x(Me,ke.props),mn(st,ke),st.return=Pe,Pe=st;break e}u(Pe,Me);break}else s(Pe,Me);Me=Me.sibling}ke.type===Ie?(st=za(ke.props.children,Pe.mode,st,ke.key),st.return=Pe,Pe=st):(st=hc(ke.type,ke.key,ke.props,null,Pe.mode,st),mn(st,ke),st.return=Pe,Pe=st)}return U(Pe);case Q:e:{for(Dt=ke.key;Me!==null;){if(Me.key===Dt)if(Me.tag===4&&Me.stateNode.containerInfo===ke.containerInfo&&Me.stateNode.implementation===ke.implementation){u(Pe,Me.sibling),st=x(Me,ke.children||[]),st.return=Pe,Pe=st;break e}else{u(Pe,Me);break}else s(Pe,Me);Me=Me.sibling}st=Ku(ke,Pe.mode,st),st.return=Pe,Pe=st}return U(Pe);case Nt:return Dt=ke._init,ke=Dt(ke._payload),Xi(Pe,Me,ke,st)}if(ki(ke))return Zt(Pe,Me,ke,st);if(ni(ke)){if(Dt=ni(ke),typeof Dt!="function")throw Error(I(150));return ke=Dt.call(ke),$t(Pe,Me,ke,st)}if(typeof ke.then=="function")return Xi(Pe,Me,Jn(ke),st);if(ke.$$typeof===Xe)return Xi(Pe,Me,_s(Pe,ke),st);bc(Pe,ke)}return typeof ke=="string"&&ke!==""||typeof ke=="number"||typeof ke=="bigint"?(ke=""+ke,Me!==null&&Me.tag===6?(u(Pe,Me.sibling),st=x(Me,ke),st.return=Pe,Pe=st):(u(Pe,Me),st=Yu(ke,Pe.mode,st),st.return=Pe,Pe=st),U(Pe)):u(Pe,Me)}return function(Pe,Me,ke,st){try{Ii=0;var Dt=Xi(Pe,Me,ke,st);return Gi=null,Dt}catch(Gt){if(Gt===_c||Gt===Ys)throw Gt;var gi=xr(29,Gt,null,Pe.mode);return gi.lanes=st,gi.return=Pe,gi}finally{}}}var Ja=ou(!0),Vo=ou(!1),jn=He(null),en=null;function pr(i){var s=i.alternate;dt(Pn,Pn.current&1),dt(jn,i),en===null&&(s===null||Ka.current!==null||s.memoizedState!==null)&&(en=i)}function lu(i){if(i.tag===22){if(dt(Pn,Pn.current),dt(jn,i),en===null){var s=i.alternate;s!==null&&s.memoizedState!==null&&(en=i)}}else Mr()}function Mr(){dt(Pn,Pn.current),dt(jn,jn.current)}function ka(i){ot(jn),en===i&&(en=null),ot(Pn)}var Pn=He(0);function to(i){for(var s=i;s!==null;){if(s.tag===13){var u=s.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||Eu(u)))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}function Xh(i,s,u,p){s=i.memoizedState,u=u(p,s),u=u==null?s:X({},s,u),i.memoizedState=u,i.lanes===0&&(i.updateQueue.baseState=u)}var Go={enqueueSetState:function(i,s,u){i=i._reactInternals;var p=ma(),x=Ya(p);x.payload=s,u!=null&&(x.callback=u),s=bs(i,x,p),s!==null&&(Na(s,i,p),Ws(s,i,p))},enqueueReplaceState:function(i,s,u){i=i._reactInternals;var p=ma(),x=Ya(p);x.tag=1,x.payload=s,u!=null&&(x.callback=u),s=bs(i,x,p),s!==null&&(Na(s,i,p),Ws(s,i,p))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var u=ma(),p=Ya(u);p.tag=2,s!=null&&(p.callback=s),s=bs(i,p,u),s!==null&&(Na(s,i,u),Ws(s,i,u))}};function Pl(i,s,u,p,x,S,U){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(p,S,U):s.prototype&&s.prototype.isPureReactComponent?!yl(u,p)||!yl(x,S):!0}function Ff(i,s,u,p){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(u,p),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(u,p),s.state!==i&&Go.enqueueReplaceState(s,s.state,null)}function wc(i,s){var u=s;if("ref"in s){u={};for(var p in s)p!=="ref"&&(u[p]=s[p])}if(i=i.defaultProps){u===s&&(u=X({},u));for(var x in i)u[x]===void 0&&(u[x]=i[x])}return u}var cu=typeof reportError=="function"?reportError:function(i){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof i=="object"&&i!==null&&typeof i.message=="string"?String(i.message):String(i),error:i});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",i);return}console.error(i)};function jf(i){cu(i)}function Xd(i){console.error(i)}function Uf(i){cu(i)}function Yh(i,s){try{var u=i.onUncaughtError;u(s.value,{componentStack:s.stack})}catch(p){setTimeout(function(){throw p})}}function Kh(i,s,u){try{var p=i.onCaughtError;p(u.value,{componentStack:u.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function Vf(i,s,u){return u=Ya(u),u.tag=3,u.payload={element:null},u.callback=function(){Yh(i,s)},u}function Wh(i){return i=Ya(i),i.tag=3,i}function Gf(i,s,u,p){var x=u.type.getDerivedStateFromError;if(typeof x=="function"){var S=p.value;i.payload=function(){return x(S)},i.callback=function(){Kh(s,u,p)}}var U=u.stateNode;U!==null&&typeof U.componentDidCatch=="function"&&(i.callback=function(){Kh(s,u,p),typeof x!="function"&&(Xo===null?Xo=new Set([this]):Xo.add(this));var W=p.stack;this.componentDidCatch(p.value,{componentStack:W!==null?W:""})})}function Yd(i,s,u,p,x){if(u.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){if(s=u.alternate,s!==null&&Do(s,u,x,!0),u=jn.current,u!==null){switch(u.tag){case 13:return en===null?dd():u.alternate===null&&Un===0&&(Un=3),u.flags&=-257,u.flags|=65536,u.lanes=x,p===Ks?u.flags|=16384:(s=u.updateQueue,s===null?u.updateQueue=new Set([p]):s.add(p),xd(i,p,x)),!1;case 22:return u.flags|=65536,p===Ks?u.flags|=16384:(s=u.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([p])},u.updateQueue=s):(u=s.retryQueue,u===null?s.retryQueue=new Set([p]):u.add(p)),xd(i,p,x)),!1}throw Error(I(435,u.tag))}return xd(i,p,x),dd(),!1}if(Si)return s=jn.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=x,p!==Wc&&(i=Error(I(422),{cause:p}),ca(qr(i,u)))):(p!==Wc&&(s=Error(I(423),{cause:p}),ca(qr(s,u))),i=i.current.alternate,i.flags|=65536,x&=-x,i.lanes|=x,p=qr(p,u),x=Vf(i.stateNode,p,x),Ju(i,x),Un!==4&&(Un=2)),!1;var S=Error(I(520),{cause:p});if(S=qr(S,u),_h===null?_h=[S]:_h.push(S),Un!==4&&(Un=2),s===null)return!0;p=qr(p,u),u=s;do{switch(u.tag){case 3:return u.flags|=65536,i=x&-x,u.lanes|=i,i=Vf(u.stateNode,p,i),Ju(u,i),!1;case 1:if(s=u.type,S=u.stateNode,(u.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||S!==null&&typeof S.componentDidCatch=="function"&&(Xo===null||!Xo.has(S))))return u.flags|=65536,x&=-x,u.lanes|=x,x=Wh(x),Gf(x,i,u,p),Ju(u,x),!1}u=u.return}while(u!==null);return!1}var Tc=Error(I(461)),mr=!1;function $n(i,s,u,p){s.child=i===null?Vo(s,null,u,p):Ja(s,i.child,u,p)}function nh(i,s,u,p,x){u=u.render;var S=s.ref;if("ref"in p){var U={};for(var W in p)W!=="ref"&&(U[W]=p[W])}else U=p;return qs(s),p=sr(i,s,u,U,S,x),W=ws(),i!==null&&!mr?(Ji(i,s,x),Zo(i,s,x)):(Si&&W&&Ro(s),s.flags|=1,$n(i,s,p,x),s.child)}function rh(i,s,u,p,x){if(i===null){var S=u.type;return typeof S=="function"&&!si(S)&&S.defaultProps===void 0&&u.compare===null?(s.tag=15,s.type=S,Zf(i,s,S,p,x)):(i=hc(u.type,null,p,s,s.mode,x),i.ref=s.ref,i.return=s,s.child=i)}if(S=i.child,!nf(i,x)){var U=S.memoizedProps;if(u=u.compare,u=u!==null?u:yl,u(U,p)&&i.ref===s.ref)return Zo(i,s,x)}return s.flags|=1,i=br(S,p),i.ref=s.ref,i.return=s,s.child=i}function Zf(i,s,u,p,x){if(i!==null){var S=i.memoizedProps;if(yl(S,p)&&i.ref===s.ref)if(mr=!1,s.pendingProps=p=S,nf(i,x))(i.flags&131072)!==0&&(mr=!0);else return s.lanes=i.lanes,Zo(i,s,x)}return Jh(i,s,u,p,x)}function qf(i,s,u){var p=s.pendingProps,x=p.children,S=i!==null?i.memoizedState:null;if(p.mode==="hidden"){if((s.flags&128)!==0){if(p=S!==null?S.baseLanes|u:u,i!==null){for(x=s.child=i.child,S=0;x!==null;)S=S|x.lanes|x.childLanes,x=x.sibling;s.childLanes=S&~p}else s.childLanes=0,s.child=null;return Kd(i,s,p,u)}if((u&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},i!==null&&Jc(s,S!==null?S.cachePool:null),S!==null?au(s,S):Wa(),lu(s);else return s.lanes=s.childLanes=536870912,Kd(i,s,S!==null?S.baseLanes|u:u,u)}else S!==null?(Jc(s,S.cachePool),au(s,S),Mr(),s.memoizedState=null):(i!==null&&Jc(s,null),Wa(),Mr());return $n(i,s,x,u),s.child}function Kd(i,s,u,p){var x=Xs();return x=x===null?null:{parent:Fn._currentValue,pool:x},s.memoizedState={baseLanes:u,cachePool:x},i!==null&&Jc(s,null),Wa(),lu(s),i!==null&&Do(i,s,p,!0),null}function Qh(i,s){var u=s.ref;if(u===null)i!==null&&i.ref!==null&&(s.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(I(284));(i===null||i.ref!==u)&&(s.flags|=4194816)}}function Jh(i,s,u,p,x){return qs(s),u=sr(i,s,u,p,void 0,x),p=ws(),i!==null&&!mr?(Ji(i,s,x),Zo(i,s,x)):(Si&&p&&Ro(s),s.flags|=1,$n(i,s,u,x),s.child)}function $f(i,s,u,p,x,S){return qs(s),s.updateQueue=null,u=Qn(s,p,u,x),ih(i),p=ws(),i!==null&&!mr?(Ji(i,s,S),Zo(i,s,S)):(Si&&p&&Ro(s),s.flags|=1,$n(i,s,u,S),s.child)}function Hf(i,s,u,p,x){if(qs(s),s.stateNode===null){var S=Pa,U=u.contextType;typeof U=="object"&&U!==null&&(S=En(U)),S=new u(p,S),s.memoizedState=S.state!==null&&S.state!==void 0?S.state:null,S.updater=Go,s.stateNode=S,S._reactInternals=s,S=s.stateNode,S.props=p,S.state=s.memoizedState,S.refs={},yc(s),U=u.contextType,S.context=typeof U=="object"&&U!==null?En(U):Pa,S.state=s.memoizedState,U=u.getDerivedStateFromProps,typeof U=="function"&&(Xh(s,u,U,p),S.state=s.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof S.getSnapshotBeforeUpdate=="function"||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(U=S.state,typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount(),U!==S.state&&Go.enqueueReplaceState(S,S.state,null),Qs(s,p,S,x),ko(),S.state=s.memoizedState),typeof S.componentDidMount=="function"&&(s.flags|=4194308),p=!0}else if(i===null){S=s.stateNode;var W=s.memoizedProps,_e=wc(u,W);S.props=_e;var Ne=S.context,tt=u.contextType;U=Pa,typeof tt=="object"&&tt!==null&&(U=En(tt));var lt=u.getDerivedStateFromProps;tt=typeof lt=="function"||typeof S.getSnapshotBeforeUpdate=="function",W=s.pendingProps!==W,tt||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(W||Ne!==U)&&Ff(s,S,p,U),Wr=!1;var Ve=s.memoizedState;S.state=Ve,Qs(s,p,S,x),ko(),Ne=s.memoizedState,W||Ve!==Ne||Wr?(typeof lt=="function"&&(Xh(s,u,lt,p),Ne=s.memoizedState),(_e=Wr||Pl(s,u,_e,p,Ve,Ne,U))?(tt||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(s.flags|=4194308)):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=p,s.memoizedState=Ne),S.props=p,S.state=Ne,S.context=U,p=_e):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),p=!1)}else{S=s.stateNode,oi(i,s),U=s.memoizedProps,tt=wc(u,U),S.props=tt,lt=s.pendingProps,Ve=S.context,Ne=u.contextType,_e=Pa,typeof Ne=="object"&&Ne!==null&&(_e=En(Ne)),W=u.getDerivedStateFromProps,(Ne=typeof W=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(U!==lt||Ve!==_e)&&Ff(s,S,p,_e),Wr=!1,Ve=s.memoizedState,S.state=Ve,Qs(s,p,S,x),ko();var Ge=s.memoizedState;U!==lt||Ve!==Ge||Wr||i!==null&&i.dependencies!==null&&mc(i.dependencies)?(typeof W=="function"&&(Xh(s,u,W,p),Ge=s.memoizedState),(tt=Wr||Pl(s,u,tt,p,Ve,Ge,_e)||i!==null&&i.dependencies!==null&&mc(i.dependencies))?(Ne||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(p,Ge,_e),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(p,Ge,_e)),typeof S.componentDidUpdate=="function"&&(s.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof S.componentDidUpdate!="function"||U===i.memoizedProps&&Ve===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||U===i.memoizedProps&&Ve===i.memoizedState||(s.flags|=1024),s.memoizedProps=p,s.memoizedState=Ge),S.props=p,S.state=Ge,S.context=_e,p=tt):(typeof S.componentDidUpdate!="function"||U===i.memoizedProps&&Ve===i.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||U===i.memoizedProps&&Ve===i.memoizedState||(s.flags|=1024),p=!1)}return S=p,Qh(i,s),p=(s.flags&128)!==0,S||p?(S=s.stateNode,u=p&&typeof u.getDerivedStateFromError!="function"?null:S.render(),s.flags|=1,i!==null&&p?(s.child=Ja(s,i.child,null,x),s.child=Ja(s,null,u,x)):$n(i,s,u,x),s.memoizedState=S.state,i=s.child):i=Zo(i,s,x),i}function Wd(i,s,u,p){return wl(),s.flags|=256,$n(i,s,u,p),s.child}var ah={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ef(i){return{baseLanes:i,cachePool:gc()}}function sh(i,s,u){return i=i!==null?i.childLanes&~u:0,s&&(i|=ns),i}function uu(i,s,u){var p=s.pendingProps,x=!1,S=(s.flags&128)!==0,U;if((U=S)||(U=i!==null&&i.memoizedState===null?!1:(Pn.current&2)!==0),U&&(x=!0,s.flags&=-129),U=(s.flags&32)!==0,s.flags&=-33,i===null){if(Si){if(x?pr(s):Mr(),Si){var W=wn,_e;if(_e=W){e:{for(_e=W,W=la;_e.nodeType!==8;){if(!W){W=null;break e}if(_e=ga(_e.nextSibling),_e===null){W=null;break e}}W=_e}W!==null?(s.memoizedState={dehydrated:W,treeContext:$a!==null?{id:Ra,overflow:Hr}:null,retryLane:536870912,hydrationErrors:null},_e=xr(18,null,null,0),_e.stateNode=W,_e.return=s,s.child=_e,bn=s,wn=null,_e=!0):_e=!1}_e||Gs(s)}if(W=s.memoizedState,W!==null&&(W=W.dehydrated,W!==null))return Eu(W)?s.lanes=32:s.lanes=536870912,null;ka(s)}return W=p.children,p=p.fallback,x?(Mr(),x=s.mode,W=oh({mode:"hidden",children:W},x),p=za(p,x,u,null),W.return=s,p.return=s,W.sibling=p,s.child=W,x=s.child,x.memoizedState=ef(u),x.childLanes=sh(i,U,u),s.memoizedState=ah,p):(pr(s),Er(s,W))}if(_e=i.memoizedState,_e!==null&&(W=_e.dehydrated,W!==null)){if(S)s.flags&256?(pr(s),s.flags&=-257,s=lh(i,s,u)):s.memoizedState!==null?(Mr(),s.child=i.child,s.flags|=128,s=null):(Mr(),x=p.fallback,W=s.mode,p=oh({mode:"visible",children:p.children},W),x=za(x,W,u,null),x.flags|=2,p.return=s,x.return=s,p.sibling=x,s.child=p,Ja(s,i.child,null,u),p=s.child,p.memoizedState=ef(u),p.childLanes=sh(i,U,u),s.memoizedState=ah,s=x);else if(pr(s),Eu(W)){if(U=W.nextSibling&&W.nextSibling.dataset,U)var Ne=U.dgst;U=Ne,p=Error(I(419)),p.stack="",p.digest=U,ca({value:p,source:null,stack:null}),s=lh(i,s,u)}else if(mr||Do(i,s,u,!1),U=(u&i.childLanes)!==0,mr||U){if(U=Fi,U!==null&&(p=u&-u,p=(p&42)!==0?1:yt(p),p=(p&(U.suspendedLanes|u))!==0?0:p,p!==0&&p!==_e.retryLane))throw _e.retryLane=p,Aa(i,p),Na(U,i,p),Tc;W.data==="$?"||dd(),s=lh(i,s,u)}else W.data==="$?"?(s.flags|=192,s.child=i.child,s=null):(i=_e.treeContext,wn=ga(W.nextSibling),bn=s,Si=!0,Ha=null,la=!1,i!==null&&(wr[fr++]=Ra,wr[fr++]=Hr,wr[fr++]=$a,Ra=i.id,Hr=i.overflow,$a=s),s=Er(s,p.children),s.flags|=4096);return s}return x?(Mr(),x=p.fallback,W=s.mode,_e=i.child,Ne=_e.sibling,p=br(_e,{mode:"hidden",children:p.children}),p.subtreeFlags=_e.subtreeFlags&65011712,Ne!==null?x=br(Ne,x):(x=za(x,W,u,null),x.flags|=2),x.return=s,p.return=s,p.sibling=x,s.child=p,p=x,x=s.child,W=i.child.memoizedState,W===null?W=ef(u):(_e=W.cachePool,_e!==null?(Ne=Fn._currentValue,_e=_e.parent!==Ne?{parent:Ne,pool:Ne}:_e):_e=gc(),W={baseLanes:W.baseLanes|u,cachePool:_e}),x.memoizedState=W,x.childLanes=sh(i,U,u),s.memoizedState=ah,p):(pr(s),u=i.child,i=u.sibling,u=br(u,{mode:"visible",children:p.children}),u.return=s,u.sibling=null,i!==null&&(U=s.deletions,U===null?(s.deletions=[i],s.flags|=16):U.push(i)),s.child=u,s.memoizedState=null,u)}function Er(i,s){return s=oh({mode:"visible",children:s},i.mode),s.return=i,i.child=s}function oh(i,s){return i=xr(22,i,null,s),i.lanes=0,i.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},i}function lh(i,s,u){return Ja(s,i.child,null,u),i=Er(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function Qd(i,s,u){i.lanes|=s;var p=i.alternate;p!==null&&(p.lanes|=s),pc(i.return,s,u)}function tf(i,s,u,p,x){var S=i.memoizedState;S===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:p,tail:u,tailMode:x}:(S.isBackwards=s,S.rendering=null,S.renderingStartTime=0,S.last=p,S.tail=u,S.tailMode=x)}function Jd(i,s,u){var p=s.pendingProps,x=p.revealOrder,S=p.tail;if($n(i,s,p.children,u),p=Pn.current,(p&2)!==0)p=p&1|2,s.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Qd(i,u,s);else if(i.tag===19)Qd(i,u,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}p&=1}switch(dt(Pn,p),x){case"forwards":for(u=s.child,x=null;u!==null;)i=u.alternate,i!==null&&to(i)===null&&(x=u),u=u.sibling;u=x,u===null?(x=s.child,s.child=null):(x=u.sibling,u.sibling=null),tf(s,!1,x,u,S);break;case"backwards":for(u=null,x=s.child,s.child=null;x!==null;){if(i=x.alternate,i!==null&&to(i)===null){s.child=x;break}i=x.sibling,x.sibling=u,u=x,x=i}tf(s,!0,u,null,S);break;case"together":tf(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Zo(i,s,u){if(i!==null&&(s.dependencies=i.dependencies),Dl|=s.lanes,(u&s.childLanes)===0)if(i!==null){if(Do(i,s,u,!1),(u&s.childLanes)===0)return null}else return null;if(i!==null&&s.child!==i.child)throw Error(I(153));if(s.child!==null){for(i=s.child,u=br(i,i.pendingProps),s.child=u,u.return=s;i.sibling!==null;)i=i.sibling,u=u.sibling=br(i,i.pendingProps),u.return=s;u.sibling=null}return s.child}function nf(i,s){return(i.lanes&s)!==0?!0:(i=i.dependencies,!!(i!==null&&mc(i)))}function kp(i,s,u){switch(s.tag){case 3:Mi(s,s.stateNode.containerInfo),Yr(s,Fn,i.memoizedState.cache),wl();break;case 27:case 5:uo(s);break;case 4:Mi(s,s.stateNode.containerInfo);break;case 10:Yr(s,s.type,s.memoizedProps.value);break;case 13:var p=s.memoizedState;if(p!==null)return p.dehydrated!==null?(pr(s),s.flags|=128,null):(u&s.child.childLanes)!==0?uu(i,s,u):(pr(s),i=Zo(i,s,u),i!==null?i.sibling:null);pr(s);break;case 19:var x=(i.flags&128)!==0;if(p=(u&s.childLanes)!==0,p||(Do(i,s,u,!1),p=(u&s.childLanes)!==0),x){if(p)return Jd(i,s,u);s.flags|=128}if(x=s.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),dt(Pn,Pn.current),p)break;return null;case 22:case 23:return s.lanes=0,qf(i,s,u);case 24:Yr(s,Fn,i.memoizedState.cache)}return Zo(i,s,u)}function rf(i,s,u){if(i!==null)if(i.memoizedProps!==s.pendingProps)mr=!0;else{if(!nf(i,u)&&(s.flags&128)===0)return mr=!1,kp(i,s,u);mr=(i.flags&131072)!==0}else mr=!1,Si&&(s.flags&1048576)!==0&&zo(s,Po,s.index);switch(s.lanes=0,s.tag){case 16:e:{i=s.pendingProps;var p=s.elementType,x=p._init;if(p=x(p._payload),s.type=p,typeof p=="function")si(p)?(i=wc(p,i),s.tag=1,s=Hf(null,s,p,i,u)):(s.tag=0,s=Jh(null,s,p,i,u));else{if(p!=null){if(x=p.$$typeof,x===Je){s.tag=11,s=nh(null,s,p,i,u);break e}else if(x===vt){s.tag=14,s=rh(null,s,p,i,u);break e}}throw s=Tn(p)||p,Error(I(306,s,""))}}return s;case 0:return Jh(i,s,s.type,s.pendingProps,u);case 1:return p=s.type,x=wc(p,s.pendingProps),Hf(i,s,p,x,u);case 3:e:{if(Mi(s,s.stateNode.containerInfo),i===null)throw Error(I(387));p=s.pendingProps;var S=s.memoizedState;x=S.element,oi(i,s),Qs(s,p,null,u);var U=s.memoizedState;if(p=U.cache,Yr(s,Fn,p),p!==S.cache&&Io(s,[Fn],u,!0),ko(),p=U.element,S.isDehydrated)if(S={element:p,isDehydrated:!1,cache:U.cache},s.updateQueue.baseState=S,s.memoizedState=S,s.flags&256){s=Wd(i,s,p,u);break e}else if(p!==x){x=qr(Error(I(424)),s),ca(x),s=Wd(i,s,p,u);break e}else{switch(i=s.stateNode.containerInfo,i.nodeType){case 9:i=i.body;break;default:i=i.nodeName==="HTML"?i.ownerDocument.body:i}for(wn=ga(i.firstChild),bn=s,Si=!0,Ha=null,la=!0,u=Vo(s,null,p,u),s.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(wl(),p===x){s=Zo(i,s,u);break e}$n(i,s,p,u)}s=s.child}return s;case 26:return Qh(i,s),i===null?(u=Vd(s.type,null,s.pendingProps,null))?s.memoizedState=u:Si||(u=s.type,i=s.pendingProps,p=Ah(Ft.current).createElement(u),p[ai]=s,p[ri]=i,qi(p,u,i),Ot(p),s.stateNode=p):s.memoizedState=Vd(s.type,i.memoizedProps,s.pendingProps,i.memoizedState),null;case 27:return uo(s),i===null&&Si&&(p=s.stateNode=Sp(s.type,s.pendingProps,Ft.current),bn=s,la=!0,x=wn,Bl(s.type)?(Od=x,wn=ga(p.firstChild)):wn=x),$n(i,s,s.pendingProps.children,u),Qh(i,s),i===null&&(s.flags|=4194304),s.child;case 5:return i===null&&Si&&((x=p=wn)&&(p=Mf(p,s.type,s.pendingProps,la),p!==null?(s.stateNode=p,bn=s,wn=ga(p.firstChild),la=!1,x=!0):x=!1),x||Gs(s)),uo(s),x=s.type,S=s.pendingProps,U=i!==null?i.memoizedProps:null,p=S.children,Id(x,S)?p=null:U!==null&&Id(x,U)&&(s.flags|=32),s.memoizedState!==null&&(x=sr(i,s,$h,null,null,u),ee._currentValue=x),Qh(i,s),$n(i,s,p,u),s.child;case 6:return i===null&&Si&&((i=u=wn)&&(u=wp(u,s.pendingProps,la),u!==null?(s.stateNode=u,bn=s,wn=null,i=!0):i=!1),i||Gs(s)),null;case 13:return uu(i,s,u);case 4:return Mi(s,s.stateNode.containerInfo),p=s.pendingProps,i===null?s.child=Ja(s,null,p,u):$n(i,s,p,u),s.child;case 11:return nh(i,s,s.type,s.pendingProps,u);case 7:return $n(i,s,s.pendingProps,u),s.child;case 8:return $n(i,s,s.pendingProps.children,u),s.child;case 12:return $n(i,s,s.pendingProps.children,u),s.child;case 10:return p=s.pendingProps,Yr(s,s.type,p.value),$n(i,s,p.children,u),s.child;case 9:return x=s.type._context,p=s.pendingProps.children,qs(s),x=En(x),p=p(x),s.flags|=1,$n(i,s,p,u),s.child;case 14:return rh(i,s,s.type,s.pendingProps,u);case 15:return Zf(i,s,s.type,s.pendingProps,u);case 19:return Jd(i,s,u);case 31:return p=s.pendingProps,u=s.mode,p={mode:p.mode,children:p.children},i===null?(u=oh(p,u),u.ref=s.ref,s.child=u,u.return=s,s=u):(u=br(i.child,p),u.ref=s.ref,s.child=u,u.return=s,s=u),s;case 22:return qf(i,s,u);case 24:return qs(s),p=En(Fn),i===null?(x=Xs(),x===null&&(x=Fi,S=$s(),x.pooledCache=S,S.refCount++,S!==null&&(x.pooledCacheLanes|=u),x=S),s.memoizedState={parent:p,cache:x},yc(s),Yr(s,Fn,x)):((i.lanes&u)!==0&&(oi(i,s),Qs(s,null,null,u),ko()),x=i.memoizedState,S=s.memoizedState,x.parent!==p?(x={parent:p,cache:p},s.memoizedState=x,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=x),Yr(s,Fn,p)):(p=S.cache,Yr(s,Fn,p),p!==x.cache&&Io(s,[Fn],u,!0))),$n(i,s,s.pendingProps.children,u),s.child;case 29:throw s.pendingProps}throw Error(I(156,s.tag))}function io(i){i.flags|=4}function Xf(i,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)i.flags&=-16777217;else if(i.flags|=16777216,!v(s)){if(s=jn.current,s!==null&&((wi&4194048)===wi?en!==null:(wi&62914560)!==wi&&(wi&536870912)===0||s!==en))throw xs=Ks,eu;i.flags|=8192}}function af(i,s){s!==null&&(i.flags|=4),i.flags&16384&&(s=i.tag!==22?Se():536870912,i.lanes|=s,gu|=s)}function ch(i,s){if(!Si)switch(i.tailMode){case"hidden":s=i.tail;for(var u=null;s!==null;)s.alternate!==null&&(u=s),s=s.sibling;u===null?i.tail=null:u.sibling=null;break;case"collapsed":u=i.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:p.sibling=null}}function zn(i){var s=i.alternate!==null&&i.alternate.child===i.child,u=0,p=0;if(s)for(var x=i.child;x!==null;)u|=x.lanes|x.childLanes,p|=x.subtreeFlags&65011712,p|=x.flags&65011712,x.return=i,x=x.sibling;else for(x=i.child;x!==null;)u|=x.lanes|x.childLanes,p|=x.subtreeFlags,p|=x.flags,x.return=i,x=x.sibling;return i.subtreeFlags|=p,i.childLanes=u,s}function Yf(i,s,u){var p=s.pendingProps;switch(fc(s),s.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return zn(s),null;case 1:return zn(s),null;case 3:return u=s.stateNode,p=null,i!==null&&(p=i.memoizedState.cache),s.memoizedState.cache!==p&&(s.flags|=2048),Ir(Fn),Ki(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(i===null||i.child===null)&&(Zs(s)?io(s):i===null||i.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,hn())),zn(s),null;case 26:return u=s.memoizedState,i===null?(io(s),u!==null?(zn(s),Xf(s,u)):(zn(s),s.flags&=-16777217)):u?u!==i.memoizedState?(io(s),zn(s),Xf(s,u)):(zn(s),s.flags&=-16777217):(i.memoizedProps!==p&&io(s),zn(s),s.flags&=-16777217),null;case 27:cr(s),u=Ft.current;var x=s.type;if(i!==null&&s.stateNode!=null)i.memoizedProps!==p&&io(s);else{if(!p){if(s.stateNode===null)throw Error(I(166));return zn(s),null}i=At.current,Zs(s)?bl(s):(i=Sp(x,p,u),s.stateNode=i,io(s))}return zn(s),null;case 5:if(cr(s),u=s.type,i!==null&&s.stateNode!=null)i.memoizedProps!==p&&io(s);else{if(!p){if(s.stateNode===null)throw Error(I(166));return zn(s),null}if(i=At.current,Zs(s))bl(s);else{switch(x=Ah(Ft.current),i){case 1:i=x.createElementNS("http://www.w3.org/2000/svg",u);break;case 2:i=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;default:switch(u){case"svg":i=x.createElementNS("http://www.w3.org/2000/svg",u);break;case"math":i=x.createElementNS("http://www.w3.org/1998/Math/MathML",u);break;case"script":i=x.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild);break;case"select":i=typeof p.is=="string"?x.createElement("select",{is:p.is}):x.createElement("select"),p.multiple?i.multiple=!0:p.size&&(i.size=p.size);break;default:i=typeof p.is=="string"?x.createElement(u,{is:p.is}):x.createElement(u)}}i[ai]=s,i[ri]=p;e:for(x=s.child;x!==null;){if(x.tag===5||x.tag===6)i.appendChild(x.stateNode);else if(x.tag!==4&&x.tag!==27&&x.child!==null){x.child.return=x,x=x.child;continue}if(x===s)break e;for(;x.sibling===null;){if(x.return===null||x.return===s)break e;x=x.return}x.sibling.return=x.return,x=x.sibling}s.stateNode=i;e:switch(qi(i,u,p),u){case"button":case"input":case"select":case"textarea":i=!!p.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&io(s)}}return zn(s),s.flags&=-16777217,null;case 6:if(i&&s.stateNode!=null)i.memoizedProps!==p&&io(s);else{if(typeof p!="string"&&s.stateNode===null)throw Error(I(166));if(i=Ft.current,Zs(s)){if(i=s.stateNode,u=s.memoizedProps,p=null,x=bn,x!==null)switch(x.tag){case 27:case 5:p=x.memoizedProps}i[ai]=s,i=!!(i.nodeValue===u||p!==null&&p.suppressHydrationWarning===!0||Su(i.nodeValue,u)),i||Gs(s)}else i=Ah(i).createTextNode(p),i[ai]=s,s.stateNode=i}return zn(s),null;case 13:if(p=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(x=Zs(s),p!==null&&p.dehydrated!==null){if(i===null){if(!x)throw Error(I(318));if(x=s.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(I(317));x[ai]=s}else wl(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;zn(s),x=!1}else x=hn(),i!==null&&i.memoizedState!==null&&(i.memoizedState.hydrationErrors=x),x=!0;if(!x)return s.flags&256?(ka(s),s):(ka(s),null)}if(ka(s),(s.flags&128)!==0)return s.lanes=u,s;if(u=p!==null,i=i!==null&&i.memoizedState!==null,u){p=s.child,x=null,p.alternate!==null&&p.alternate.memoizedState!==null&&p.alternate.memoizedState.cachePool!==null&&(x=p.alternate.memoizedState.cachePool.pool);var S=null;p.memoizedState!==null&&p.memoizedState.cachePool!==null&&(S=p.memoizedState.cachePool.pool),S!==x&&(p.flags|=2048)}return u!==i&&u&&(s.child.flags|=8192),af(s,s.updateQueue),zn(s),null;case 4:return Ki(),i===null&&Ed(s.stateNode.containerInfo),zn(s),null;case 10:return Ir(s.type),zn(s),null;case 19:if(ot(Pn),x=s.memoizedState,x===null)return zn(s),null;if(p=(s.flags&128)!==0,S=x.rendering,S===null)if(p)ch(x,!1);else{if(Un!==0||i!==null&&(i.flags&128)!==0)for(i=s.child;i!==null;){if(S=to(i),S!==null){for(s.flags|=128,ch(x,!1),i=S.updateQueue,s.updateQueue=i,af(s,i),s.subtreeFlags=0,i=u,u=s.child;u!==null;)Xu(u,i),u=u.sibling;return dt(Pn,Pn.current&1|2),s.child}i=i.sibling}x.tail!==null&&Wi()>yh&&(s.flags|=128,p=!0,ch(x,!1),s.lanes=4194304)}else{if(!p)if(i=to(S),i!==null){if(s.flags|=128,p=!0,i=i.updateQueue,s.updateQueue=i,af(s,i),ch(x,!0),x.tail===null&&x.tailMode==="hidden"&&!S.alternate&&!Si)return zn(s),null}else 2*Wi()-x.renderingStartTime>yh&&u!==536870912&&(s.flags|=128,p=!0,ch(x,!1),s.lanes=4194304);x.isBackwards?(S.sibling=s.child,s.child=S):(i=x.last,i!==null?i.sibling=S:s.child=S,x.last=S)}return x.tail!==null?(s=x.tail,x.rendering=s,x.tail=s.sibling,x.renderingStartTime=Wi(),s.sibling=null,i=Pn.current,dt(Pn,p?i&1|2:i&1),s):(zn(s),null);case 22:case 23:return ka(s),Ui(),p=s.memoizedState!==null,i!==null?i.memoizedState!==null!==p&&(s.flags|=8192):p&&(s.flags|=8192),p?(u&536870912)!==0&&(s.flags&128)===0&&(zn(s),s.subtreeFlags&6&&(s.flags|=8192)):zn(s),u=s.updateQueue,u!==null&&af(s,u.retryQueue),u=null,i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),p=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(p=s.memoizedState.cachePool.pool),p!==u&&(s.flags|=2048),i!==null&&ot(Cn),null;case 24:return u=null,i!==null&&(u=i.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),Ir(Fn),zn(s),null;case 25:return null;case 30:return null}throw Error(I(156,s.tag))}function Kf(i,s){switch(fc(s),s.tag){case 1:return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Ir(Fn),Ki(),i=s.flags,(i&65536)!==0&&(i&128)===0?(s.flags=i&-65537|128,s):null;case 26:case 27:case 5:return cr(s),null;case 13:if(ka(s),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(I(340));wl()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return ot(Pn),null;case 4:return Ki(),null;case 10:return Ir(s.type),null;case 22:case 23:return ka(s),Ui(),i!==null&&ot(Cn),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 24:return Ir(Fn),null;case 25:return null;default:return null}}function Wf(i,s){switch(fc(s),s.tag){case 3:Ir(Fn),Ki();break;case 26:case 27:case 5:cr(s);break;case 4:Ki();break;case 13:ka(s);break;case 19:ot(Pn);break;case 10:Ir(s.type);break;case 22:case 23:ka(s),Ui(),i!==null&&ot(Cn);break;case 24:Ir(Fn)}}function Es(i,s){try{var u=s.updateQueue,p=u!==null?u.lastEffect:null;if(p!==null){var x=p.next;u=x;do{if((u.tag&i)===i){p=void 0;var S=u.create,U=u.inst;p=S(),U.destroy=p}u=u.next}while(u!==x)}}catch(W){Zi(s,s.return,W)}}function es(i,s,u){try{var p=s.updateQueue,x=p!==null?p.lastEffect:null;if(x!==null){var S=x.next;p=S;do{if((p.tag&i)===i){var U=p.inst,W=U.destroy;if(W!==void 0){U.destroy=void 0,x=s;var _e=u,Ne=W;try{Ne()}catch(tt){Zi(x,_e,tt)}}}p=p.next}while(p!==S)}}catch(tt){Zi(s,s.return,tt)}}function ep(i){var s=i.updateQueue;if(s!==null){var u=i.stateNode;try{th(s,u)}catch(p){Zi(i,i.return,p)}}}function tp(i,s,u){u.props=wc(i.type,i.memoizedProps),u.state=i.memoizedState;try{u.componentWillUnmount()}catch(p){Zi(i,s,p)}}function uh(i,s){try{var u=i.ref;if(u!==null){switch(i.tag){case 26:case 27:case 5:var p=i.stateNode;break;case 30:p=i.stateNode;break;default:p=i.stateNode}typeof u=="function"?i.refCleanup=u(p):u.current=p}}catch(x){Zi(i,s,x)}}function no(i,s){var u=i.ref,p=i.refCleanup;if(u!==null)if(typeof p=="function")try{p()}catch(x){Zi(i,s,x)}finally{i.refCleanup=null,i=i.alternate,i!=null&&(i.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(x){Zi(i,s,x)}else u.current=null}function ip(i){var s=i.type,u=i.memoizedProps,p=i.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":u.autoFocus&&p.focus();break e;case"img":u.src?p.src=u.src:u.srcSet&&(p.srcset=u.srcSet)}}catch(x){Zi(i,i.return,x)}}function Qf(i,s,u){try{var p=i.stateNode;Mu(p,i.type,u,s),p[ri]=s}catch(x){Zi(i,i.return,x)}}function np(i){return i.tag===5||i.tag===3||i.tag===26||i.tag===27&&Bl(i.type)||i.tag===4}function hh(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||np(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.tag===27&&Bl(i.type)||i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Jf(i,s,u){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(i,s):(s=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,s.appendChild(i),u=u._reactRootContainer,u!=null||s.onclick!==null||(s.onclick=Ch));else if(p!==4&&(p===27&&Bl(i.type)&&(u=i.stateNode,s=null),i=i.child,i!==null))for(Jf(i,s,u),i=i.sibling;i!==null;)Jf(i,s,u),i=i.sibling}function fh(i,s,u){var p=i.tag;if(p===5||p===6)i=i.stateNode,s?u.insertBefore(i,s):u.appendChild(i);else if(p!==4&&(p===27&&Bl(i.type)&&(u=i.stateNode),i=i.child,i!==null))for(fh(i,s,u),i=i.sibling;i!==null;)fh(i,s,u),i=i.sibling}function hu(i){var s=i.stateNode,u=i.memoizedProps;try{for(var p=i.type,x=s.attributes;x.length;)s.removeAttributeNode(x[0]);qi(s,p,u),s[ai]=i,s[ri]=u}catch(S){Zi(i,i.return,S)}}var qo=!1,ui=!1,zl=!1,ed=typeof WeakSet=="function"?WeakSet:Set,Hn=null;function sf(i,s){if(i=i.containerInfo,Jo=et,i=lc(i),Ca(i)){if("selectionStart"in i)var u={start:i.selectionStart,end:i.selectionEnd};else e:{u=(u=i.ownerDocument)&&u.defaultView||window;var p=u.getSelection&&u.getSelection();if(p&&p.rangeCount!==0){u=p.anchorNode;var x=p.anchorOffset,S=p.focusNode;p=p.focusOffset;try{u.nodeType,S.nodeType}catch{u=null;break e}var U=0,W=-1,_e=-1,Ne=0,tt=0,lt=i,Ve=null;t:for(;;){for(var Ge;lt!==u||x!==0&&lt.nodeType!==3||(W=U+x),lt!==S||p!==0&&lt.nodeType!==3||(_e=U+p),lt.nodeType===3&&(U+=lt.nodeValue.length),(Ge=lt.firstChild)!==null;)Ve=lt,lt=Ge;for(;;){if(lt===i)break t;if(Ve===u&&++Ne===x&&(W=U),Ve===S&&++tt===p&&(_e=U),(Ge=lt.nextSibling)!==null)break;lt=Ve,Ve=lt.parentNode}lt=Ge}u=W===-1||_e===-1?null:{start:W,end:_e}}else u=null}u=u||{start:0,end:0}}else u=null;for(wf={focusedElem:i,selectionRange:u},et=!1,Hn=s;Hn!==null;)if(s=Hn,i=s.child,(s.subtreeFlags&1024)!==0&&i!==null)i.return=s,Hn=i;else for(;Hn!==null;){switch(s=Hn,S=s.alternate,i=s.flags,s.tag){case 0:break;case 11:case 15:break;case 1:if((i&1024)!==0&&S!==null){i=void 0,u=s,x=S.memoizedProps,S=S.memoizedState,p=u.stateNode;try{var Zt=wc(u.type,x,u.elementType===u.type);i=p.getSnapshotBeforeUpdate(Zt,S),p.__reactInternalSnapshotBeforeUpdate=i}catch($t){Zi(u,u.return,$t)}}break;case 3:if((i&1024)!==0){if(i=s.stateNode.containerInfo,u=i.nodeType,u===9)Sf(i);else if(u===1)switch(i.nodeName){case"HEAD":case"HTML":case"BODY":Sf(i);break;default:i.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((i&1024)!==0)throw Error(I(163))}if(i=s.sibling,i!==null){i.return=s.return,Hn=i;break}Hn=s.return}}function fu(i,s,u){var p=u.flags;switch(u.tag){case 0:case 11:case 15:is(i,u),p&4&&Es(5,u);break;case 1:if(is(i,u),p&4)if(i=u.stateNode,s===null)try{i.componentDidMount()}catch(U){Zi(u,u.return,U)}else{var x=wc(u.type,s.memoizedProps);s=s.memoizedState;try{i.componentDidUpdate(x,s,i.__reactInternalSnapshotBeforeUpdate)}catch(U){Zi(u,u.return,U)}}p&64&&ep(u),p&512&&uh(u,u.return);break;case 3:if(is(i,u),p&64&&(i=u.updateQueue,i!==null)){if(s=null,u.child!==null)switch(u.child.tag){case 27:case 5:s=u.child.stateNode;break;case 1:s=u.child.stateNode}try{th(i,s)}catch(U){Zi(u,u.return,U)}}break;case 27:s===null&&p&4&&hu(u);case 26:case 5:is(i,u),s===null&&p&4&&ip(u),p&512&&uh(u,u.return);break;case 12:is(i,u);break;case 13:is(i,u),p&4&&dh(i,u),p&64&&(i=u.memoizedState,i!==null&&(i=i.dehydrated,i!==null&&(u=Bp.bind(null,u),Ef(i,u))));break;case 22:if(p=u.memoizedState!==null||qo,!p){s=s!==null&&s.memoizedState!==null||ui,x=qo;var S=ui;qo=p,(ui=s)&&!S?Ho(i,u,(u.subtreeFlags&8772)!==0):is(i,u),qo=x,ui=S}break;case 30:break;default:is(i,u)}}function td(i){var s=i.alternate;s!==null&&(i.alternate=null,td(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&Qi(s)),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}var gn=null,gr=!1;function Cs(i,s,u){for(u=u.child;u!==null;)Sc(i,s,u),u=u.sibling}function Sc(i,s,u){if(an&&typeof an.onCommitFiberUnmount=="function")try{an.onCommitFiberUnmount(Fr,u)}catch{}switch(u.tag){case 26:ui||no(u,s),Cs(i,s,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:ui||no(u,s);var p=gn,x=gr;Bl(u.type)&&(gn=u.stateNode,gr=!1),Cs(i,s,u),lo(u.stateNode),gn=p,gr=x;break;case 5:ui||no(u,s);case 6:if(p=gn,x=gr,gn=null,Cs(i,s,u),gn=p,gr=x,gn!==null)if(gr)try{(gn.nodeType===9?gn.body:gn.nodeName==="HTML"?gn.ownerDocument.body:gn).removeChild(u.stateNode)}catch(S){Zi(u,s,S)}else try{gn.removeChild(u.stateNode)}catch(S){Zi(u,s,S)}break;case 18:gn!==null&&(gr?(i=gn,kd(i.nodeType===9?i.body:i.nodeName==="HTML"?i.ownerDocument.body:i,u.stateNode),vn(i)):kd(gn,u.stateNode));break;case 4:p=gn,x=gr,gn=u.stateNode.containerInfo,gr=!0,Cs(i,s,u),gn=p,gr=x;break;case 0:case 11:case 14:case 15:ui||es(2,u,s),ui||es(4,u,s),Cs(i,s,u);break;case 1:ui||(no(u,s),p=u.stateNode,typeof p.componentWillUnmount=="function"&&tp(u,s,p)),Cs(i,s,u);break;case 21:Cs(i,s,u);break;case 22:ui=(p=ui)||u.memoizedState!==null,Cs(i,s,u),ui=p;break;default:Cs(i,s,u)}}function dh(i,s){if(s.memoizedState===null&&(i=s.alternate,i!==null&&(i=i.memoizedState,i!==null&&(i=i.dehydrated,i!==null))))try{vn(i)}catch(u){Zi(s,s.return,u)}}function du(i){switch(i.tag){case 13:case 19:var s=i.stateNode;return s===null&&(s=i.stateNode=new ed),s;case 22:return i=i.stateNode,s=i._retryCache,s===null&&(s=i._retryCache=new ed),s;default:throw Error(I(435,i.tag))}}function Mc(i,s){var u=du(i);s.forEach(function(p){var x=Np.bind(null,i,p);u.has(p)||(u.add(p),p.then(x,x))})}function Oa(i,s){var u=s.deletions;if(u!==null)for(var p=0;p<u.length;p++){var x=u[p],S=i,U=s,W=U;e:for(;W!==null;){switch(W.tag){case 27:if(Bl(W.type)){gn=W.stateNode,gr=!1;break e}break;case 5:gn=W.stateNode,gr=!1;break e;case 3:case 4:gn=W.stateNode.containerInfo,gr=!0;break e}W=W.return}if(gn===null)throw Error(I(160));Sc(S,U,x),gn=null,gr=!1,S=x.alternate,S!==null&&(S.return=null),x.return=null}if(s.subtreeFlags&13878)for(s=s.child;s!==null;)Rl(s,i),s=s.sibling}var ts=null;function Rl(i,s){var u=i.alternate,p=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:Oa(s,i),Ba(i),p&4&&(es(3,i,i.return),Es(3,i),es(5,i,i.return));break;case 1:Oa(s,i),Ba(i),p&512&&(ui||u===null||no(u,u.return)),p&64&&qo&&(i=i.updateQueue,i!==null&&(p=i.callbacks,p!==null&&(u=i.shared.hiddenCallbacks,i.shared.hiddenCallbacks=u===null?p:u.concat(p))));break;case 26:var x=ts;if(Oa(s,i),Ba(i),p&512&&(ui||u===null||no(u,u.return)),p&4){var S=u!==null?u.memoizedState:null;if(p=i.memoizedState,u===null)if(p===null)if(i.stateNode===null){e:{p=i.type,u=i.memoizedProps,x=x.ownerDocument||x;t:switch(p){case"title":S=x.getElementsByTagName("title")[0],(!S||S[Sn]||S[ai]||S.namespaceURI==="http://www.w3.org/2000/svg"||S.hasAttribute("itemprop"))&&(S=x.createElement(p),x.head.insertBefore(S,x.querySelector("head > title"))),qi(S,p,u),S[ai]=i,Ot(S),p=S;break e;case"link":var U=f("link","href",x).get(p+(u.href||""));if(U){for(var W=0;W<U.length;W++)if(S=U[W],S.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&S.getAttribute("rel")===(u.rel==null?null:u.rel)&&S.getAttribute("title")===(u.title==null?null:u.title)&&S.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){U.splice(W,1);break t}}S=x.createElement(p),qi(S,p,u),x.head.appendChild(S);break;case"meta":if(U=f("meta","content",x).get(p+(u.content||""))){for(W=0;W<U.length;W++)if(S=U[W],S.getAttribute("content")===(u.content==null?null:""+u.content)&&S.getAttribute("name")===(u.name==null?null:u.name)&&S.getAttribute("property")===(u.property==null?null:u.property)&&S.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&S.getAttribute("charset")===(u.charSet==null?null:u.charSet)){U.splice(W,1);break t}}S=x.createElement(p),qi(S,p,u),x.head.appendChild(S);break;default:throw Error(I(468,p))}S[ai]=i,Ot(S),p=S}i.stateNode=p}else g(x,i.type,i.stateNode);else i.stateNode=Cp(x,p,i.memoizedProps);else S!==p?(S===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):S.count--,p===null?g(x,i.type,i.stateNode):Cp(x,p,i.memoizedProps)):p===null&&i.stateNode!==null&&Qf(i,i.memoizedProps,u.memoizedProps)}break;case 27:Oa(s,i),Ba(i),p&512&&(ui||u===null||no(u,u.return)),u!==null&&p&4&&Qf(i,i.memoizedProps,u.memoizedProps);break;case 5:if(Oa(s,i),Ba(i),p&512&&(ui||u===null||no(u,u.return)),i.flags&32){x=i.stateNode;try{hs(x,"")}catch(Ge){Zi(i,i.return,Ge)}}p&4&&i.stateNode!=null&&(x=i.memoizedProps,Qf(i,x,u!==null?u.memoizedProps:x)),p&1024&&(zl=!0);break;case 6:if(Oa(s,i),Ba(i),p&4){if(i.stateNode===null)throw Error(I(162));p=i.memoizedProps,u=i.stateNode;try{u.nodeValue=p}catch(Ge){Zi(i,i.return,Ge)}}break;case 3:if(o=null,x=ts,ts=Ph(s.containerInfo),Oa(s,i),ts=x,Ba(i),p&4&&u!==null&&u.memoizedState.isDehydrated)try{vn(s.containerInfo)}catch(Ge){Zi(i,i.return,Ge)}zl&&(zl=!1,id(i));break;case 4:p=ts,ts=Ph(i.stateNode.containerInfo),Oa(s,i),Ba(i),ts=p;break;case 12:Oa(s,i),Ba(i);break;case 13:Oa(s,i),Ba(i),i.child.flags&8192&&i.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(od=Wi()),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,Mc(i,p)));break;case 22:x=i.memoizedState!==null;var _e=u!==null&&u.memoizedState!==null,Ne=qo,tt=ui;if(qo=Ne||x,ui=tt||_e,Oa(s,i),ui=tt,qo=Ne,Ba(i),p&8192)e:for(s=i.stateNode,s._visibility=x?s._visibility&-2:s._visibility|1,x&&(u===null||_e||qo||ui||$o(i)),u=null,s=i;;){if(s.tag===5||s.tag===26){if(u===null){_e=u=s;try{if(S=_e.stateNode,x)U=S.style,typeof U.setProperty=="function"?U.setProperty("display","none","important"):U.display="none";else{W=_e.stateNode;var lt=_e.memoizedProps.style,Ve=lt!=null&&lt.hasOwnProperty("display")?lt.display:null;W.style.display=Ve==null||typeof Ve=="boolean"?"":(""+Ve).trim()}}catch(Ge){Zi(_e,_e.return,Ge)}}}else if(s.tag===6){if(u===null){_e=s;try{_e.stateNode.nodeValue=x?"":_e.memoizedProps}catch(Ge){Zi(_e,_e.return,Ge)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===i)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;u===s&&(u=null),s=s.return}u===s&&(u=null),s.sibling.return=s.return,s=s.sibling}p&4&&(p=i.updateQueue,p!==null&&(u=p.retryQueue,u!==null&&(p.retryQueue=null,Mc(i,u))));break;case 19:Oa(s,i),Ba(i),p&4&&(p=i.updateQueue,p!==null&&(i.updateQueue=null,Mc(i,p)));break;case 30:break;case 21:break;default:Oa(s,i),Ba(i)}}function Ba(i){var s=i.flags;if(s&2){try{for(var u,p=i.return;p!==null;){if(np(p)){u=p;break}p=p.return}if(u==null)throw Error(I(160));switch(u.tag){case 27:var x=u.stateNode,S=hh(i);fh(i,S,x);break;case 5:var U=u.stateNode;u.flags&32&&(hs(U,""),u.flags&=-33);var W=hh(i);fh(i,W,U);break;case 3:case 4:var _e=u.stateNode.containerInfo,Ne=hh(i);Jf(i,Ne,_e);break;default:throw Error(I(161))}}catch(tt){Zi(i,i.return,tt)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function id(i){if(i.subtreeFlags&1024)for(i=i.child;i!==null;){var s=i;id(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),i=i.sibling}}function is(i,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)fu(i,s.alternate,s),s=s.sibling}function $o(i){for(i=i.child;i!==null;){var s=i;switch(s.tag){case 0:case 11:case 14:case 15:es(4,s,s.return),$o(s);break;case 1:no(s,s.return);var u=s.stateNode;typeof u.componentWillUnmount=="function"&&tp(s,s.return,u),$o(s);break;case 27:lo(s.stateNode);case 26:case 5:no(s,s.return),$o(s);break;case 22:s.memoizedState===null&&$o(s);break;case 30:$o(s);break;default:$o(s)}i=i.sibling}}function Ho(i,s,u){for(u=u&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var p=s.alternate,x=i,S=s,U=S.flags;switch(S.tag){case 0:case 11:case 15:Ho(x,S,u),Es(4,S);break;case 1:if(Ho(x,S,u),p=S,x=p.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(Ne){Zi(p,p.return,Ne)}if(p=S,x=p.updateQueue,x!==null){var W=p.stateNode;try{var _e=x.shared.hiddenCallbacks;if(_e!==null)for(x.shared.hiddenCallbacks=null,x=0;x<_e.length;x++)nu(_e[x],W)}catch(Ne){Zi(p,p.return,Ne)}}u&&U&64&&ep(S),uh(S,S.return);break;case 27:hu(S);case 26:case 5:Ho(x,S,u),u&&p===null&&U&4&&ip(S),uh(S,S.return);break;case 12:Ho(x,S,u);break;case 13:Ho(x,S,u),u&&U&4&&dh(x,S);break;case 22:S.memoizedState===null&&Ho(x,S,u),uh(S,S.return);break;case 30:break;default:Ho(x,S,u)}s=s.sibling}}function of(i,s){var u=null;i!==null&&i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(u=i.memoizedState.cachePool.pool),i=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(i=s.memoizedState.cachePool.pool),i!==u&&(i!=null&&i.refCount++,u!=null&&Lo(u))}function nd(i,s){i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Lo(i))}function ro(i,s,u,p){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)rp(i,s,u,p),s=s.sibling}function rp(i,s,u,p){var x=s.flags;switch(s.tag){case 0:case 11:case 15:ro(i,s,u,p),x&2048&&Es(9,s);break;case 1:ro(i,s,u,p);break;case 3:ro(i,s,u,p),x&2048&&(i=null,s.alternate!==null&&(i=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==i&&(s.refCount++,i!=null&&Lo(i)));break;case 12:if(x&2048){ro(i,s,u,p),i=s.stateNode;try{var S=s.memoizedProps,U=S.id,W=S.onPostCommit;typeof W=="function"&&W(U,s.alternate===null?"mount":"update",i.passiveEffectDuration,-0)}catch(_e){Zi(s,s.return,_e)}}else ro(i,s,u,p);break;case 13:ro(i,s,u,p);break;case 23:break;case 22:S=s.stateNode,U=s.alternate,s.memoizedState!==null?S._visibility&2?ro(i,s,u,p):ph(i,s):S._visibility&2?ro(i,s,u,p):(S._visibility|=2,pu(i,s,u,p,(s.subtreeFlags&10256)!==0)),x&2048&&of(U,s);break;case 24:ro(i,s,u,p),x&2048&&nd(s.alternate,s);break;default:ro(i,s,u,p)}}function pu(i,s,u,p,x){for(x=x&&(s.subtreeFlags&10256)!==0,s=s.child;s!==null;){var S=i,U=s,W=u,_e=p,Ne=U.flags;switch(U.tag){case 0:case 11:case 15:pu(S,U,W,_e,x),Es(8,U);break;case 23:break;case 22:var tt=U.stateNode;U.memoizedState!==null?tt._visibility&2?pu(S,U,W,_e,x):ph(S,U):(tt._visibility|=2,pu(S,U,W,_e,x)),x&&Ne&2048&&of(U.alternate,U);break;case 24:pu(S,U,W,_e,x),x&&Ne&2048&&nd(U.alternate,U);break;default:pu(S,U,W,_e,x)}s=s.sibling}}function ph(i,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var u=i,p=s,x=p.flags;switch(p.tag){case 22:ph(u,p),x&2048&&of(p.alternate,p);break;case 24:ph(u,p),x&2048&&nd(p.alternate,p);break;default:ph(u,p)}s=s.sibling}}var Ec=8192;function Cc(i){if(i.subtreeFlags&Ec)for(i=i.child;i!==null;)lf(i),i=i.sibling}function lf(i){switch(i.tag){case 26:Cc(i),i.flags&Ec&&i.memoizedState!==null&&P(ts,i.memoizedState,i.memoizedProps);break;case 5:Cc(i);break;case 3:case 4:var s=ts;ts=Ph(i.stateNode.containerInfo),Cc(i),ts=s;break;case 22:i.memoizedState===null&&(s=i.alternate,s!==null&&s.memoizedState!==null?(s=Ec,Ec=16777216,Cc(i),Ec=s):Cc(i));break;default:Cc(i)}}function rd(i){var s=i.alternate;if(s!==null&&(i=s.child,i!==null)){s.child=null;do s=i.sibling,i.sibling=null,i=s;while(i!==null)}}function Ac(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var p=s[u];Hn=p,gh(p,i)}rd(i)}if(i.subtreeFlags&10256)for(i=i.child;i!==null;)ad(i),i=i.sibling}function ad(i){switch(i.tag){case 0:case 11:case 15:Ac(i),i.flags&2048&&es(9,i,i.return);break;case 3:Ac(i);break;case 12:Ac(i);break;case 22:var s=i.stateNode;i.memoizedState!==null&&s._visibility&2&&(i.return===null||i.return.tag!==13)?(s._visibility&=-3,mh(i)):Ac(i);break;default:Ac(i)}}function mh(i){var s=i.deletions;if((i.flags&16)!==0){if(s!==null)for(var u=0;u<s.length;u++){var p=s[u];Hn=p,gh(p,i)}rd(i)}for(i=i.child;i!==null;){switch(s=i,s.tag){case 0:case 11:case 15:es(8,s,s.return),mh(s);break;case 22:u=s.stateNode,u._visibility&2&&(u._visibility&=-3,mh(s));break;default:mh(s)}i=i.sibling}}function gh(i,s){for(;Hn!==null;){var u=Hn;switch(u.tag){case 0:case 11:case 15:es(8,u,s);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var p=u.memoizedState.cachePool.pool;p!=null&&p.refCount++}break;case 24:Lo(u.memoizedState.cache)}if(p=u.child,p!==null)p.return=u,Hn=p;else e:for(u=i;Hn!==null;){p=Hn;var x=p.sibling,S=p.return;if(td(p),p===u){Hn=null;break e}if(x!==null){x.return=S,Hn=x;break e}Hn=S}}}var ap={getCacheForType:function(i){var s=En(Fn),u=s.data.get(i);return u===void 0&&(u=i(),s.data.set(i,u)),u}},sp=typeof WeakMap=="function"?WeakMap:Map,Ni=0,Fi=null,vi=null,wi=0,Ei=0,Jr=null,Il=!1,mu=!1,cf=!1,ao=0,Un=0,Dl=0,As=0,uf=0,ns=0,gu=0,_h=null,pa=null,sd=!1,od=0,yh=1/0,_u=null,Xo=null,_r=0,Yo=null,yu=null,Ko=0,ld=0,hf=null,op=null,vh=0,cd=null;function ma(){if((Ni&2)!==0&&wi!==0)return wi&-wi;if(We.T!==null){var i=ys;return i!==0?i:kl()}return bt()}function lp(){ns===0&&(ns=(wi&536870912)===0||Si?Le():536870912);var i=jn.current;return i!==null&&(i.flags|=32),ns}function Na(i,s,u){(i===Fi&&(Ei===2||Ei===9)||i.cancelPendingCommit!==null)&&(xu(i,0),Wo(i,wi,ns,!1)),Ue(i,u),((Ni&2)===0||i!==Fi)&&(i===Fi&&((Ni&2)===0&&(As|=u),Un===4&&Wo(i,wi,ns,!1)),as(i))}function vu(i,s,u){if((Ni&6)!==0)throw Error(I(327));var p=!u&&(s&124)===0&&(s&i.expiredLanes)===0||be(i,s),x=p?cp(i,s):pd(i,s,!0),S=p;do{if(x===0){mu&&!p&&Wo(i,s,0,!1);break}else{if(u=i.current.alternate,S&&!hd(u)){x=pd(i,s,!1),S=!1;continue}if(x===2){if(S=s,i.errorRecoveryDisabledLanes&S)var U=0;else U=i.pendingLanes&-536870913,U=U!==0?U:U&536870912?536870912:0;if(U!==0){s=U;e:{var W=i;x=_h;var _e=W.current.memoizedState.isDehydrated;if(_e&&(xu(W,U).flags|=256),U=pd(W,U,!1),U!==2){if(cf&&!_e){W.errorRecoveryDisabledLanes|=S,As|=S,x=4;break e}S=pa,pa=x,S!==null&&(pa===null?pa=S:pa.push.apply(pa,S))}x=U}if(S=!1,x!==2)continue}}if(x===1){xu(i,0),Wo(i,s,0,!0);break}e:{switch(p=i,S=x,S){case 0:case 1:throw Error(I(345));case 4:if((s&4194048)!==s)break;case 6:Wo(p,s,ns,!Il);break e;case 2:pa=null;break;case 3:case 5:break;default:throw Error(I(329))}if((s&62914560)===s&&(x=od+300-Wi(),10<x)){if(Wo(p,s,ns,!Il),he(p,0,!0)!==0)break e;p.timeoutHandle=Dd(ud.bind(null,p,u,pa,_u,sd,s,ns,As,gu,Il,S,2,-0,0),x);break e}ud(p,u,pa,_u,sd,s,ns,As,gu,Il,S,0,-0,0)}}break}while(!0);as(i)}function ud(i,s,u,p,x,S,U,W,_e,Ne,tt,lt,Ve,Ge){if(i.timeoutHandle=-1,lt=s.subtreeFlags,(lt&8192||(lt&16785408)===16785408)&&(w={stylesheets:null,count:0,unsuspend:M},lf(s),lt=D(),lt!==null)){i.cancelPendingCommit=lt(up.bind(null,i,s,S,u,p,x,U,W,_e,tt,1,Ve,Ge)),Wo(i,S,U,!Ne);return}up(i,s,S,u,p,x,U,W,_e)}function hd(i){for(var s=i;;){var u=s.tag;if((u===0||u===11||u===15)&&s.flags&16384&&(u=s.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var p=0;p<u.length;p++){var x=u[p],S=x.getSnapshot;x=x.value;try{if(!zr(S(),x))return!1}catch{return!1}}if(u=s.child,s.subtreeFlags&16384&&u!==null)u.return=s,s=u;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Wo(i,s,u,p){s&=~uf,s&=~As,i.suspendedLanes|=s,i.pingedLanes&=~s,p&&(i.warmLanes|=s),p=i.expirationTimes;for(var x=s;0<x;){var S=31-ir(x),U=1<<S;p[S]=-1,x&=~U}u!==0&&Ke(i,u,s)}function Rn(){return(Ni&6)===0?(Th(0),!1):!0}function xh(){if(vi!==null){if(Ei===0)var i=vi.return;else i=vi,Xr=Xa=null,on(i),Gi=null,Ii=0,i=vi;for(;i!==null;)Wf(i.alternate,i),i=i.return;vi=null}}function xu(i,s){var u=i.timeoutHandle;u!==-1&&(i.timeoutHandle=-1,xp(u)),u=i.cancelPendingCommit,u!==null&&(i.cancelPendingCommit=null,u()),xh(),Fi=i,vi=u=br(i.current,null),wi=s,Ei=0,Jr=null,Il=!1,mu=be(i,s),cf=!1,gu=ns=uf=As=Dl=Un=0,pa=_h=null,sd=!1,(s&8)!==0&&(s|=s&32);var p=i.entangledLanes;if(p!==0)for(i=i.entanglements,p&=s;0<p;){var x=31-ir(p),S=1<<x;s|=i[x],p&=~S}return ao=s,To(),u}function fd(i,s){li=null,We.H=lr,s===_c||s===Ys?(s=iu(),Ei=3):s===eu?(s=iu(),Ei=4):Ei=s===Tc?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,Jr=s,vi===null&&(Un=1,Yh(i,qr(s,i.current)))}function Qo(){var i=We.H;return We.H=lr,i===null?lr:i}function ff(){var i=We.A;return We.A=ap,i}function dd(){Un=4,Il||(wi&4194048)!==wi&&jn.current!==null||(mu=!0),(Dl&134217727)===0&&(As&134217727)===0||Fi===null||Wo(Fi,wi,ns,!1)}function pd(i,s,u){var p=Ni;Ni|=2;var x=Qo(),S=ff();(Fi!==i||wi!==s)&&(_u=null,xu(i,s)),s=!1;var U=Un;e:do try{if(Ei!==0&&vi!==null){var W=vi,_e=Jr;switch(Ei){case 8:xh(),U=6;break e;case 3:case 2:case 9:case 6:jn.current===null&&(s=!0);var Ne=Ei;if(Ei=0,Jr=null,Ps(i,W,_e,Ne),u&&mu){U=0;break e}break;default:Ne=Ei,Ei=0,Jr=null,Ps(i,W,_e,Ne)}}Op(),U=Un;break}catch(tt){fd(i,tt)}while(!0);return s&&i.shellSuspendCounter++,Xr=Xa=null,Ni=p,We.H=x,We.A=S,vi===null&&(Fi=null,wi=0,To()),U}function Op(){for(;vi!==null;)gd(vi)}function cp(i,s){var u=Ni;Ni|=2;var p=Qo(),x=ff();Fi!==i||wi!==s?(_u=null,yh=Wi()+500,xu(i,s)):mu=be(i,s);e:do try{if(Ei!==0&&vi!==null){s=vi;var S=Jr;t:switch(Ei){case 1:Ei=0,Jr=null,Ps(i,s,S,1);break;case 2:case 9:if(La(S)){Ei=0,Jr=null,bu(s);break}s=function(){Ei!==2&&Ei!==9||Fi!==i||(Ei=7),as(i)},S.then(s,s);break e;case 3:Ei=7;break e;case 4:Ei=5;break e;case 7:La(S)?(Ei=0,Jr=null,bu(s)):(Ei=0,Jr=null,Ps(i,s,S,7));break;case 5:var U=null;switch(vi.tag){case 26:U=vi.memoizedState;case 5:case 27:var W=vi;if(!U||v(U)){Ei=0,Jr=null;var _e=W.sibling;if(_e!==null)vi=_e;else{var Ne=W.return;Ne!==null?(vi=Ne,Pc(Ne)):vi=null}break t}}Ei=0,Jr=null,Ps(i,s,S,5);break;case 6:Ei=0,Jr=null,Ps(i,s,S,6);break;case 8:xh(),Un=6;break e;default:throw Error(I(462))}}md();break}catch(tt){fd(i,tt)}while(!0);return Xr=Xa=null,We.H=p,We.A=x,Ni=u,vi!==null?0:(Fi=null,wi=0,To(),Un)}function md(){for(;vi!==null&&!ia();)gd(vi)}function gd(i){var s=rf(i.alternate,i,ao);i.memoizedProps=i.pendingProps,s===null?Pc(i):vi=s}function bu(i){var s=i,u=s.alternate;switch(s.tag){case 15:case 0:s=$f(u,s,s.pendingProps,s.type,void 0,wi);break;case 11:s=$f(u,s,s.pendingProps,s.type.render,s.ref,wi);break;case 5:on(s);default:Wf(u,s),s=vi=Xu(s,ao),s=rf(u,s,ao)}i.memoizedProps=i.pendingProps,s===null?Pc(i):vi=s}function Ps(i,s,u,p){Xr=Xa=null,on(s),Gi=null,Ii=0;var x=s.return;try{if(Yd(i,x,s,u,wi)){Un=1,Yh(i,qr(u,i.current)),vi=null;return}}catch(S){if(x!==null)throw vi=x,S;Un=1,Yh(i,qr(u,i.current)),vi=null;return}s.flags&32768?(Si||p===1?i=!0:mu||(wi&536870912)!==0?i=!1:(Il=i=!0,(p===2||p===9||p===3||p===6)&&(p=jn.current,p!==null&&p.tag===13&&(p.flags|=16384))),bh(s,i)):Pc(s)}function Pc(i){var s=i;do{if((s.flags&32768)!==0){bh(s,Il);return}i=s.return;var u=Yf(s.alternate,s,ao);if(u!==null){vi=u;return}if(s=s.sibling,s!==null){vi=s;return}vi=s=i}while(s!==null);Un===0&&(Un=5)}function bh(i,s){do{var u=Kf(i.alternate,i);if(u!==null){u.flags&=32767,vi=u;return}if(u=i.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!s&&(i=i.sibling,i!==null)){vi=i;return}vi=i=u}while(i!==null);Un=6,vi=null}function up(i,s,u,p,x,S,U,W,_e){i.cancelPendingCommit=null;do wh();while(_r!==0);if((Ni&6)!==0)throw Error(I(327));if(s!==null){if(s===i.current)throw Error(I(177));if(S=s.lanes|s.childLanes,S|=ms,Ae(i,u,S,U,W,_e),i===Fi&&(vi=Fi=null,wi=0),yu=s,Yo=i,Ko=u,ld=S,hf=x,op=p,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(i.callbackNode=null,i.callbackPriority=0,Fp(ba,function(){return vd(),null})):(i.callbackNode=null,i.callbackPriority=0),p=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||p){p=We.T,We.T=null,x=je.p,je.p=2,U=Ni,Ni|=4;try{sf(i,s,u)}finally{Ni=U,je.p=x,We.T=p}}_r=1,hp(),_d(),yd()}}function hp(){if(_r===1){_r=0;var i=Yo,s=yu,u=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||u){u=We.T,We.T=null;var p=je.p;je.p=2;var x=Ni;Ni|=4;try{Rl(s,i);var S=wf,U=lc(i.containerInfo),W=S.focusedElem,_e=S.selectionRange;if(U!==W&&W&&W.ownerDocument&&bi(W.ownerDocument.documentElement,W)){if(_e!==null&&Ca(W)){var Ne=_e.start,tt=_e.end;if(tt===void 0&&(tt=Ne),"selectionStart"in W)W.selectionStart=Ne,W.selectionEnd=Math.min(tt,W.value.length);else{var lt=W.ownerDocument||document,Ve=lt&&lt.defaultView||window;if(Ve.getSelection){var Ge=Ve.getSelection(),Zt=W.textContent.length,$t=Math.min(_e.start,Zt),Xi=_e.end===void 0?$t:Math.min(_e.end,Zt);!Ge.extend&&$t>Xi&&(U=Xi,Xi=$t,$t=U);var Pe=$c(W,$t),Me=$c(W,Xi);if(Pe&&Me&&(Ge.rangeCount!==1||Ge.anchorNode!==Pe.node||Ge.anchorOffset!==Pe.offset||Ge.focusNode!==Me.node||Ge.focusOffset!==Me.offset)){var ke=lt.createRange();ke.setStart(Pe.node,Pe.offset),Ge.removeAllRanges(),$t>Xi?(Ge.addRange(ke),Ge.extend(Me.node,Me.offset)):(ke.setEnd(Me.node,Me.offset),Ge.addRange(ke))}}}}for(lt=[],Ge=W;Ge=Ge.parentNode;)Ge.nodeType===1&&lt.push({element:Ge,left:Ge.scrollLeft,top:Ge.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<lt.length;W++){var st=lt[W];st.element.scrollLeft=st.left,st.element.scrollTop=st.top}}et=!!Jo,wf=Jo=null}finally{Ni=x,je.p=p,We.T=u}}i.current=s,_r=2}}function _d(){if(_r===2){_r=0;var i=Yo,s=yu,u=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||u){u=We.T,We.T=null;var p=je.p;je.p=2;var x=Ni;Ni|=4;try{fu(i,s.alternate,s)}finally{Ni=x,je.p=p,We.T=u}}_r=3}}function yd(){if(_r===4||_r===3){_r=0,il();var i=Yo,s=yu,u=Ko,p=op;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?_r=5:(_r=0,yu=Yo=null,fp(i,i.pendingLanes));var x=i.pendingLanes;if(x===0&&(Xo=null),jt(u),s=s.stateNode,an&&typeof an.onCommitFiberRoot=="function")try{an.onCommitFiberRoot(Fr,s,void 0,(s.current.flags&128)===128)}catch{}if(p!==null){s=We.T,x=je.p,je.p=2,We.T=null;try{for(var S=i.onRecoverableError,U=0;U<p.length;U++){var W=p[U];S(W.value,{componentStack:W.stack})}}finally{We.T=s,je.p=x}}(Ko&3)!==0&&wh(),as(i),x=i.pendingLanes,(u&4194090)!==0&&(x&42)!==0?i===cd?vh++:(vh=0,cd=i):vh=0,Th(0)}}function fp(i,s){(i.pooledCacheLanes&=s)===0&&(s=i.pooledCache,s!=null&&(i.pooledCache=null,Lo(s)))}function wh(i){return hp(),_d(),yd(),vd()}function vd(){if(_r!==5)return!1;var i=Yo,s=ld;ld=0;var u=jt(Ko),p=We.T,x=je.p;try{je.p=32>u?32:u,We.T=null,u=hf,hf=null;var S=Yo,U=Ko;if(_r=0,yu=Yo=null,Ko=0,(Ni&6)!==0)throw Error(I(331));var W=Ni;if(Ni|=4,ad(S.current),rp(S,S.current,U,u),Ni=W,Th(0,!1),an&&typeof an.onPostCommitFiberRoot=="function")try{an.onPostCommitFiberRoot(Fr,S)}catch{}return!0}finally{je.p=x,We.T=p,fp(i,s)}}function df(i,s,u){s=qr(u,s),s=Vf(i.stateNode,s,2),i=bs(i,s,2),i!==null&&(Ue(i,2),as(i))}function Zi(i,s,u){if(i.tag===3)df(i,i,u);else for(;s!==null;){if(s.tag===3){df(s,i,u);break}else if(s.tag===1){var p=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(Xo===null||!Xo.has(p))){i=qr(u,i),u=Wh(2),p=bs(s,u,2),p!==null&&(Gf(u,p,s,i),Ue(p,2),as(p));break}}s=s.return}}function xd(i,s,u){var p=i.pingCache;if(p===null){p=i.pingCache=new sp;var x=new Set;p.set(s,x)}else x=p.get(s),x===void 0&&(x=new Set,p.set(s,x));x.has(u)||(cf=!0,x.add(u),i=dp.bind(null,i,s,u),s.then(i,i))}function dp(i,s,u){var p=i.pingCache;p!==null&&p.delete(s),i.pingedLanes|=i.suspendedLanes&u,i.warmLanes&=~u,Fi===i&&(wi&u)===u&&(Un===4||Un===3&&(wi&62914560)===wi&&300>Wi()-od?(Ni&2)===0&&xu(i,0):uf|=u,gu===wi&&(gu=0)),as(i)}function pp(i,s){s===0&&(s=Se()),i=Aa(i,s),i!==null&&(Ue(i,s),as(i))}function Bp(i){var s=i.memoizedState,u=0;s!==null&&(u=s.retryLane),pp(i,u)}function Np(i,s){var u=0;switch(i.tag){case 13:var p=i.stateNode,x=i.memoizedState;x!==null&&(u=x.retryLane);break;case 19:p=i.stateNode;break;case 22:p=i.stateNode._retryCache;break;default:throw Error(I(314))}p!==null&&p.delete(s),pp(i,u)}function Fp(i,s){return rn(i,s)}var pf=null,zc=null,mf=!1,rs=!1,so=!1,Ll=0;function as(i){i!==zc&&i.next===null&&(zc===null?pf=zc=i:zc=zc.next=i),rs=!0,mf||(mf=!0,bd())}function Th(i,s){if(!so&&rs){so=!0;do for(var u=!1,p=pf;p!==null;){if(i!==0){var x=p.pendingLanes;if(x===0)var S=0;else{var U=p.suspendedLanes,W=p.pingedLanes;S=(1<<31-ir(42|i)+1)-1,S&=x&~(U&~W),S=S&201326741?S&201326741|1:S?S|2:0}S!==0&&(u=!0,_f(p,S))}else S=wi,S=he(p,p===Fi?S:0,p.cancelPendingCommit!==null||p.timeoutHandle!==-1),(S&3)===0||be(p,S)||(u=!0,_f(p,S));p=p.next}while(u);so=!1}}function jp(){Sh()}function Sh(){rs=mf=!1;var i=0;Ll!==0&&(Ol()&&(i=Ll),Ll=0);for(var s=Wi(),u=null,p=pf;p!==null;){var x=p.next,S=gf(p,s);S===0?(p.next=null,u===null?pf=x:u.next=x,x===null&&(zc=u)):(u=p,(i!==0||(S&3)!==0)&&(rs=!0)),p=x}Th(i)}function gf(i,s){for(var u=i.suspendedLanes,p=i.pingedLanes,x=i.expirationTimes,S=i.pendingLanes&-62914561;0<S;){var U=31-ir(S),W=1<<U,_e=x[U];_e===-1?((W&u)===0||(W&p)!==0)&&(x[U]=Ee(W,s)):_e<=s&&(i.expiredLanes|=W),S&=~W}if(s=Fi,u=wi,u=he(i,i===s?u:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p=i.callbackNode,u===0||i===s&&(Ei===2||Ei===9)||i.cancelPendingCommit!==null)return p!==null&&p!==null&&ta(p),i.callbackNode=null,i.callbackPriority=0;if((u&3)===0||be(i,u)){if(s=u&-u,s===i.callbackPriority)return s;switch(p!==null&&ta(p),jt(u)){case 2:case 8:u=Rs;break;case 32:u=ba;break;case 268435456:u=Is;break;default:u=ba}return p=mp.bind(null,i),u=rn(u,p),i.callbackPriority=s,i.callbackNode=u,s}return p!==null&&p!==null&&ta(p),i.callbackPriority=2,i.callbackNode=null,2}function mp(i,s){if(_r!==0&&_r!==5)return i.callbackNode=null,i.callbackPriority=0,null;var u=i.callbackNode;if(wh()&&i.callbackNode!==u)return null;var p=wi;return p=he(i,i===Fi?p:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),p===0?null:(vu(i,p,s),gf(i,Wi()),i.callbackNode!=null&&i.callbackNode===u?mp.bind(null,i):null)}function _f(i,s){if(wh())return null;vu(i,s,!0)}function bd(){bp(function(){(Ni&6)!==0?rn(yr,jp):Sh()})}function kl(){return Ll===0&&(Ll=Le()),Ll}function wd(i){return i==null||typeof i=="symbol"||typeof i=="boolean"?null:typeof i=="function"?i:rl(""+i)}function Td(i,s){var u=s.ownerDocument.createElement("input");return u.name=s.name,u.value=s.value,i.id&&u.setAttribute("form",i.id),s.parentNode.insertBefore(u,s),i=new FormData(i),u.parentNode.removeChild(u),i}function Sd(i,s,u,p,x){if(s==="submit"&&u&&u.stateNode===x){var S=wd((x[ri]||null).action),U=p.submitter;U&&(s=(s=U[ri]||null)?wd(s.formAction):U.getAttribute("formAction"),s!==null&&(S=s,U=null));var W=new fs("action","action",null,p,x);i.push({event:W,listeners:[{instance:null,listener:function(){if(p.defaultPrevented){if(Ll!==0){var _e=U?Td(x,U):new FormData(x);zi(u,{pending:!0,data:_e,method:x.method,action:S},null,_e)}}else typeof S=="function"&&(W.preventDefault(),_e=U?Td(x,U):new FormData(x),zi(u,{pending:!0,data:_e,method:x.method,action:S},S,_e))},currentTarget:x}]})}}for(var yf=0;yf<wo.length;yf++){var wu=wo[yf],gp=wu.toLowerCase(),Up=wu[0].toUpperCase()+wu.slice(1);hr(gp,"on"+Up)}hr(Zu,"onAnimationEnd"),hr(Zh,"onAnimationIteration"),hr(qu,"onAnimationStart"),hr("dblclick","onDoubleClick"),hr("focusin","onFocus"),hr("focusout","onBlur"),hr(Hc,"onTransitionRun"),hr(Xc,"onTransitionStart"),hr(Yc,"onTransitionCancel"),hr(Kc,"onTransitionEnd"),Yt("onMouseEnter",["mouseout","mouseover"]),Yt("onMouseLeave",["mouseout","mouseover"]),Yt("onPointerEnter",["pointerout","pointerover"]),Yt("onPointerLeave",["pointerout","pointerover"]),ur("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ur("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ur("onBeforeInput",["compositionend","keypress","textInput","paste"]),ur("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ur("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ur("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_p=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Mh));function yp(i,s){s=(s&4)!==0;for(var u=0;u<i.length;u++){var p=i[u],x=p.event;p=p.listeners;e:{var S=void 0;if(s)for(var U=p.length-1;0<=U;U--){var W=p[U],_e=W.instance,Ne=W.currentTarget;if(W=W.listener,_e!==S&&x.isPropagationStopped())break e;S=W,x.currentTarget=Ne;try{S(x)}catch(tt){cu(tt)}x.currentTarget=null,S=_e}else for(U=0;U<p.length;U++){if(W=p[U],_e=W.instance,Ne=W.currentTarget,W=W.listener,_e!==S&&x.isPropagationStopped())break e;S=W,x.currentTarget=Ne;try{S(x)}catch(tt){cu(tt)}x.currentTarget=null,S=_e}}}}function xi(i,s){var u=s[Ut];u===void 0&&(u=s[Ut]=new Set);var p=i+"__bubble";u.has(p)||(xf(s,i,2,!1),u.add(p))}function Md(i,s,u){var p=0;s&&(p|=4),xf(u,i,p,s)}var vf="_reactListening"+Math.random().toString(36).slice(2);function Ed(i){if(!i[vf]){i[vf]=!0,Cr.forEach(function(u){u!=="selectionchange"&&(_p.has(u)||Md(u,!1,i),Md(u,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[vf]||(s[vf]=!0,Md("selectionchange",!1,s))}}function xf(i,s,u,p){switch(Et(s)){case 2:var x=Fe;break;case 8:x=Ze;break;default:x=ct}u=x.bind(null,s,u,i),x=void 0,!On||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(x=!0),p?x!==void 0?i.addEventListener(s,u,{capture:!0,passive:x}):i.addEventListener(s,u,!0):x!==void 0?i.addEventListener(s,u,{passive:x}):i.addEventListener(s,u,!1)}function oo(i,s,u,p,x){var S=p;if((s&1)===0&&(s&2)===0&&p!==null)e:for(;;){if(p===null)return;var U=p.tag;if(U===3||U===4){var W=p.stateNode.containerInfo;if(W===x)break;if(U===4)for(U=p.return;U!==null;){var _e=U.tag;if((_e===3||_e===4)&&U.stateNode.containerInfo===x)return;U=U.return}for(;W!==null;){if(U=jr(W),U===null)return;if(_e=U.tag,_e===5||_e===6||_e===26||_e===27){p=S=U;continue e}W=W.parentNode}}p=p.return}nr(function(){var Ne=S,tt=Ta(u),lt=[];e:{var Ve=Us.get(i);if(Ve!==void 0){var Ge=fs,Zt=i;switch(i){case"keypress":if(Qt(u)===0)break e;case"keydown":case"keyup":Ge=Gr;break;case"focusin":Zt="focus",Ge=vo;break;case"focusout":Zt="blur",Ge=vo;break;case"beforeblur":case"afterblur":Ge=vo;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ge=sl;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ge=Wn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ge=fl;break;case Zu:case Zh:case qu:Ge=Nn;break;case Kc:Ge=Df;break;case"scroll":case"scrollend":Ge=Lu;break;case"wheel":Ge=kf;break;case"copy":case"cut":case"paste":Ge=cl;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ge=Fc;break;case"toggle":case"beforetoggle":Ge=jc}var $t=(s&4)!==0,Xi=!$t&&(i==="scroll"||i==="scrollend"),Pe=$t?Ve!==null?Ve+"Capture":null:Ve;$t=[];for(var Me=Ne,ke;Me!==null;){var st=Me;if(ke=st.stateNode,st=st.tag,st!==5&&st!==26&&st!==27||ke===null||Pe===null||(st=cn(Me,Pe),st!=null&&$t.push(Tu(Me,st,ke))),Xi)break;Me=Me.return}0<$t.length&&(Ve=new Ge(Ve,Zt,null,u,tt),lt.push({event:Ve,listeners:$t}))}}if((s&7)===0){e:{if(Ve=i==="mouseover"||i==="pointerover",Ge=i==="mouseout"||i==="pointerout",Ve&&u!==Ar&&(Zt=u.relatedTarget||u.fromElement)&&(jr(Zt)||Zt[fi]))break e;if((Ge||Ve)&&(Ve=tt.window===tt?tt:(Ve=tt.ownerDocument)?Ve.defaultView||Ve.parentWindow:window,Ge?(Zt=u.relatedTarget||u.toElement,Ge=Ne,Zt=Zt?jr(Zt):null,Zt!==null&&(Xi=q(Zt),$t=Zt.tag,Zt!==Xi||$t!==5&&$t!==27&&$t!==6)&&(Zt=null)):(Ge=null,Zt=Ne),Ge!==Zt)){if($t=sl,st="onMouseLeave",Pe="onMouseEnter",Me="mouse",(i==="pointerout"||i==="pointerover")&&($t=Fc,st="onPointerLeave",Pe="onPointerEnter",Me="pointer"),Xi=Ge==null?Ve:mt(Ge),ke=Zt==null?Ve:mt(Zt),Ve=new $t(st,Me+"leave",Ge,u,tt),Ve.target=Xi,Ve.relatedTarget=ke,st=null,jr(tt)===Ne&&($t=new $t(Pe,Me+"enter",Zt,u,tt),$t.target=ke,$t.relatedTarget=Xi,st=$t),Xi=st,Ge&&Zt)t:{for($t=Ge,Pe=Zt,Me=0,ke=$t;ke;ke=Rc(ke))Me++;for(ke=0,st=Pe;st;st=Rc(st))ke++;for(;0<Me-ke;)$t=Rc($t),Me--;for(;0<ke-Me;)Pe=Rc(Pe),ke--;for(;Me--;){if($t===Pe||Pe!==null&&$t===Pe.alternate)break t;$t=Rc($t),Pe=Rc(Pe)}$t=null}else $t=null;Ge!==null&&Cd(lt,Ve,Ge,$t,!1),Zt!==null&&Xi!==null&&Cd(lt,Xi,Zt,$t,!0)}}e:{if(Ve=Ne?mt(Ne):window,Ge=Ve.nodeName&&Ve.nodeName.toLowerCase(),Ge==="select"||Ge==="input"&&Ve.type==="file")var Dt=Nu;else if(xo(Ve))if(Fu)Dt=Nf;else{Dt=Bf;var gi=_l}else Ge=Ve.nodeName,!Ge||Ge.toLowerCase()!=="input"||Ve.type!=="checkbox"&&Ve.type!=="radio"?Ne&&wa(Ne.elementType)&&(Dt=Nu):Dt=qc;if(Dt&&(Dt=Dt(i,Ne))){Uh(lt,Dt,u,tt);break e}gi&&gi(i,Ve,Ne),i==="focusout"&&Ne&&Ve.type==="number"&&Ne.memoizedProps.value!=null&&Kl(Ve,"number",Ve.value)}switch(gi=Ne?mt(Ne):window,i){case"focusin":(xo(gi)||gi.contentEditable==="true")&&(Fs=gi,cc=Ne,vl=null);break;case"focusout":vl=cc=Fs=null;break;case"mousedown":uc=!0;break;case"contextmenu":case"mouseup":case"dragend":uc=!1,js(lt,u,tt);break;case"selectionchange":if(Vu)break;case"keydown":case"keyup":js(lt,u,tt)}var Gt;if(dl)e:{switch(i){case"compositionstart":var Wt="onCompositionStart";break e;case"compositionend":Wt="onCompositionEnd";break e;case"compositionupdate":Wt="onCompositionUpdate";break e}Wt=void 0}else qa?Vc(i,u)&&(Wt="onCompositionEnd"):i==="keydown"&&u.keyCode===229&&(Wt="onCompositionStart");Wt&&(nc&&u.locale!=="ko"&&(qa||Wt!=="onCompositionStart"?Wt==="onCompositionEnd"&&qa&&(Gt=Kt()):(Sa=tt,hi="value"in Sa?Sa.value:Sa.textContent,qa=!0)),gi=Eh(Ne,Wt),0<gi.length&&(Wt=new Bh(Wt,i,null,u,tt),lt.push({event:Wt,listeners:gi}),Gt?Wt.data=Gt:(Gt=pl(u),Gt!==null&&(Wt.data=Gt)))),(Gt=Bu?Fh(i,u):rc(i,u))&&(Wt=Eh(Ne,"onBeforeInput"),0<Wt.length&&(gi=new Bh("onBeforeInput","beforeinput",null,u,tt),lt.push({event:gi,listeners:Wt}),gi.data=Gt)),Sd(lt,i,Ne,u,tt)}yp(lt,s)})}function Tu(i,s,u){return{instance:i,listener:s,currentTarget:u}}function Eh(i,s){for(var u=s+"Capture",p=[];i!==null;){var x=i,S=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||S===null||(x=cn(i,u),x!=null&&p.unshift(Tu(i,x,S)),x=cn(i,s),x!=null&&p.push(Tu(i,x,S))),i.tag===3)return p;i=i.return}return[]}function Rc(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5&&i.tag!==27);return i||null}function Cd(i,s,u,p,x){for(var S=s._reactName,U=[];u!==null&&u!==p;){var W=u,_e=W.alternate,Ne=W.stateNode;if(W=W.tag,_e!==null&&_e===p)break;W!==5&&W!==26&&W!==27||Ne===null||(_e=Ne,x?(Ne=cn(u,S),Ne!=null&&U.unshift(Tu(u,Ne,_e))):x||(Ne=cn(u,S),Ne!=null&&U.push(Tu(u,Ne,_e)))),u=u.return}U.length!==0&&i.push({event:s,listeners:U})}var vp=/\r\n?/g,Ad=/\u0000|\uFFFD/g;function Pd(i){return(typeof i=="string"?i:""+i).replace(vp,`
`).replace(Ad,"")}function Su(i,s){return s=Pd(s),Pd(i)===s}function Ch(){}function ji(i,s,u,p,x,S){switch(u){case"children":typeof p=="string"?s==="body"||s==="textarea"&&p===""||hs(i,p):(typeof p=="number"||typeof p=="bigint")&&s!=="body"&&hs(i,""+p);break;case"className":ra(i,"class",p);break;case"tabIndex":ra(i,"tabindex",p);break;case"dir":case"role":case"viewBox":case"width":case"height":ra(i,u,p);break;case"style":Va(i,p,S);break;case"data":if(s!=="object"){ra(i,"data",p);break}case"src":case"href":if(p===""&&(s!=="a"||u!=="href")){i.removeAttribute(u);break}if(p==null||typeof p=="function"||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(u);break}p=rl(""+p),i.setAttribute(u,p);break;case"action":case"formAction":if(typeof p=="function"){i.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof S=="function"&&(u==="formAction"?(s!=="input"&&ji(i,s,"name",x.name,x,null),ji(i,s,"formEncType",x.formEncType,x,null),ji(i,s,"formMethod",x.formMethod,x,null),ji(i,s,"formTarget",x.formTarget,x,null)):(ji(i,s,"encType",x.encType,x,null),ji(i,s,"method",x.method,x,null),ji(i,s,"target",x.target,x,null)));if(p==null||typeof p=="symbol"||typeof p=="boolean"){i.removeAttribute(u);break}p=rl(""+p),i.setAttribute(u,p);break;case"onClick":p!=null&&(i.onclick=Ch);break;case"onScroll":p!=null&&xi("scroll",i);break;case"onScrollEnd":p!=null&&xi("scrollend",i);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(I(61));if(u=p.__html,u!=null){if(x.children!=null)throw Error(I(60));i.innerHTML=u}}break;case"multiple":i.multiple=p&&typeof p!="function"&&typeof p!="symbol";break;case"muted":i.muted=p&&typeof p!="function"&&typeof p!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(p==null||typeof p=="function"||typeof p=="boolean"||typeof p=="symbol"){i.removeAttribute("xlink:href");break}u=rl(""+p),i.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(u,""+p):i.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":p&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(u,""):i.removeAttribute(u);break;case"capture":case"download":p===!0?i.setAttribute(u,""):p!==!1&&p!=null&&typeof p!="function"&&typeof p!="symbol"?i.setAttribute(u,p):i.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":p!=null&&typeof p!="function"&&typeof p!="symbol"&&!isNaN(p)&&1<=p?i.setAttribute(u,p):i.removeAttribute(u);break;case"rowSpan":case"start":p==null||typeof p=="function"||typeof p=="symbol"||isNaN(p)?i.removeAttribute(u):i.setAttribute(u,p);break;case"popover":xi("beforetoggle",i),xi("toggle",i),Ls(i,"popover",p);break;case"xlinkActuate":Ur(i,"http://www.w3.org/1999/xlink","xlink:actuate",p);break;case"xlinkArcrole":Ur(i,"http://www.w3.org/1999/xlink","xlink:arcrole",p);break;case"xlinkRole":Ur(i,"http://www.w3.org/1999/xlink","xlink:role",p);break;case"xlinkShow":Ur(i,"http://www.w3.org/1999/xlink","xlink:show",p);break;case"xlinkTitle":Ur(i,"http://www.w3.org/1999/xlink","xlink:title",p);break;case"xlinkType":Ur(i,"http://www.w3.org/1999/xlink","xlink:type",p);break;case"xmlBase":Ur(i,"http://www.w3.org/XML/1998/namespace","xml:base",p);break;case"xmlLang":Ur(i,"http://www.w3.org/XML/1998/namespace","xml:lang",p);break;case"xmlSpace":Ur(i,"http://www.w3.org/XML/1998/namespace","xml:space",p);break;case"is":Ls(i,"is",p);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=yo.get(u)||u,Ls(i,u,p))}}function bf(i,s,u,p,x,S){switch(u){case"style":Va(i,p,S);break;case"dangerouslySetInnerHTML":if(p!=null){if(typeof p!="object"||!("__html"in p))throw Error(I(61));if(u=p.__html,u!=null){if(x.children!=null)throw Error(I(60));i.innerHTML=u}}break;case"children":typeof p=="string"?hs(i,p):(typeof p=="number"||typeof p=="bigint")&&hs(i,""+p);break;case"onScroll":p!=null&&xi("scroll",i);break;case"onScrollEnd":p!=null&&xi("scrollend",i);break;case"onClick":p!=null&&(i.onclick=Ch);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$l.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(x=u.endsWith("Capture"),s=u.slice(2,x?u.length-7:void 0),S=i[ri]||null,S=S!=null?S[u]:null,typeof S=="function"&&i.removeEventListener(s,S,x),typeof p=="function")){typeof S!="function"&&S!==null&&(u in i?i[u]=null:i.hasAttribute(u)&&i.removeAttribute(u)),i.addEventListener(s,p,x);break e}u in i?i[u]=p:p===!0?i.setAttribute(u,""):Ls(i,u,p)}}}function qi(i,s,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":xi("error",i),xi("load",i);var p=!1,x=!1,S;for(S in u)if(u.hasOwnProperty(S)){var U=u[S];if(U!=null)switch(S){case"src":p=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(I(137,s));default:ji(i,s,S,U,u,null)}}x&&ji(i,s,"srcSet",u.srcSet,u,null),p&&ji(i,s,"src",u.src,u,null);return;case"input":xi("invalid",i);var W=S=U=x=null,_e=null,Ne=null;for(p in u)if(u.hasOwnProperty(p)){var tt=u[p];if(tt!=null)switch(p){case"name":x=tt;break;case"type":U=tt;break;case"checked":_e=tt;break;case"defaultChecked":Ne=tt;break;case"value":S=tt;break;case"defaultValue":W=tt;break;case"children":case"dangerouslySetInnerHTML":if(tt!=null)throw Error(I(137,s));break;default:ji(i,s,p,tt,u,null)}}_o(i,S,W,_e,Ne,U,x,!1),us(i);return;case"select":xi("invalid",i),p=U=S=null;for(x in u)if(u.hasOwnProperty(x)&&(W=u[x],W!=null))switch(x){case"value":S=W;break;case"defaultValue":U=W;break;case"multiple":p=W;default:ji(i,s,x,W,u,null)}s=S,u=U,i.multiple=!!p,s!=null?ks(i,!!p,s,!1):u!=null&&ks(i,!!p,u,!0);return;case"textarea":xi("invalid",i),S=x=p=null;for(U in u)if(u.hasOwnProperty(U)&&(W=u[U],W!=null))switch(U){case"value":p=W;break;case"defaultValue":x=W;break;case"children":S=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(I(91));break;default:ji(i,s,U,W,u,null)}Wl(i,p,x,S),us(i);return;case"option":for(_e in u)if(u.hasOwnProperty(_e)&&(p=u[_e],p!=null))switch(_e){case"selected":i.selected=p&&typeof p!="function"&&typeof p!="symbol";break;default:ji(i,s,_e,p,u,null)}return;case"dialog":xi("beforetoggle",i),xi("toggle",i),xi("cancel",i),xi("close",i);break;case"iframe":case"object":xi("load",i);break;case"video":case"audio":for(p=0;p<Mh.length;p++)xi(Mh[p],i);break;case"image":xi("error",i),xi("load",i);break;case"details":xi("toggle",i);break;case"embed":case"source":case"link":xi("error",i),xi("load",i);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ne in u)if(u.hasOwnProperty(Ne)&&(p=u[Ne],p!=null))switch(Ne){case"children":case"dangerouslySetInnerHTML":throw Error(I(137,s));default:ji(i,s,Ne,p,u,null)}return;default:if(wa(s)){for(tt in u)u.hasOwnProperty(tt)&&(p=u[tt],p!==void 0&&bf(i,s,tt,p,u,void 0));return}}for(W in u)u.hasOwnProperty(W)&&(p=u[W],p!=null&&ji(i,s,W,p,u,null))}function Mu(i,s,u,p){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,S=null,U=null,W=null,_e=null,Ne=null,tt=null;for(Ge in u){var lt=u[Ge];if(u.hasOwnProperty(Ge)&&lt!=null)switch(Ge){case"checked":break;case"value":break;case"defaultValue":_e=lt;default:p.hasOwnProperty(Ge)||ji(i,s,Ge,null,p,lt)}}for(var Ve in p){var Ge=p[Ve];if(lt=u[Ve],p.hasOwnProperty(Ve)&&(Ge!=null||lt!=null))switch(Ve){case"type":S=Ge;break;case"name":x=Ge;break;case"checked":Ne=Ge;break;case"defaultChecked":tt=Ge;break;case"value":U=Ge;break;case"defaultValue":W=Ge;break;case"children":case"dangerouslySetInnerHTML":if(Ge!=null)throw Error(I(137,s));break;default:Ge!==lt&&ji(i,s,Ve,Ge,p,lt)}}Bc(i,U,W,_e,Ne,tt,S,x);return;case"select":Ge=U=W=Ve=null;for(S in u)if(_e=u[S],u.hasOwnProperty(S)&&_e!=null)switch(S){case"value":break;case"multiple":Ge=_e;default:p.hasOwnProperty(S)||ji(i,s,S,null,p,_e)}for(x in p)if(S=p[x],_e=u[x],p.hasOwnProperty(x)&&(S!=null||_e!=null))switch(x){case"value":Ve=S;break;case"defaultValue":W=S;break;case"multiple":U=S;default:S!==_e&&ji(i,s,x,S,p,_e)}s=W,u=U,p=Ge,Ve!=null?ks(i,!!u,Ve,!1):!!p!=!!u&&(s!=null?ks(i,!!u,s,!0):ks(i,!!u,u?[]:"",!1));return;case"textarea":Ge=Ve=null;for(W in u)if(x=u[W],u.hasOwnProperty(W)&&x!=null&&!p.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:ji(i,s,W,null,p,x)}for(U in p)if(x=p[U],S=u[U],p.hasOwnProperty(U)&&(x!=null||S!=null))switch(U){case"value":Ve=x;break;case"defaultValue":Ge=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(I(91));break;default:x!==S&&ji(i,s,U,x,p,S)}Iu(i,Ve,Ge);return;case"option":for(var Zt in u)if(Ve=u[Zt],u.hasOwnProperty(Zt)&&Ve!=null&&!p.hasOwnProperty(Zt))switch(Zt){case"selected":i.selected=!1;break;default:ji(i,s,Zt,null,p,Ve)}for(_e in p)if(Ve=p[_e],Ge=u[_e],p.hasOwnProperty(_e)&&Ve!==Ge&&(Ve!=null||Ge!=null))switch(_e){case"selected":i.selected=Ve&&typeof Ve!="function"&&typeof Ve!="symbol";break;default:ji(i,s,_e,Ve,p,Ge)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var $t in u)Ve=u[$t],u.hasOwnProperty($t)&&Ve!=null&&!p.hasOwnProperty($t)&&ji(i,s,$t,null,p,Ve);for(Ne in p)if(Ve=p[Ne],Ge=u[Ne],p.hasOwnProperty(Ne)&&Ve!==Ge&&(Ve!=null||Ge!=null))switch(Ne){case"children":case"dangerouslySetInnerHTML":if(Ve!=null)throw Error(I(137,s));break;default:ji(i,s,Ne,Ve,p,Ge)}return;default:if(wa(s)){for(var Xi in u)Ve=u[Xi],u.hasOwnProperty(Xi)&&Ve!==void 0&&!p.hasOwnProperty(Xi)&&bf(i,s,Xi,void 0,p,Ve);for(tt in p)Ve=p[tt],Ge=u[tt],!p.hasOwnProperty(tt)||Ve===Ge||Ve===void 0&&Ge===void 0||bf(i,s,tt,Ve,p,Ge);return}}for(var Pe in u)Ve=u[Pe],u.hasOwnProperty(Pe)&&Ve!=null&&!p.hasOwnProperty(Pe)&&ji(i,s,Pe,null,p,Ve);for(lt in p)Ve=p[lt],Ge=u[lt],!p.hasOwnProperty(lt)||Ve===Ge||Ve==null&&Ge==null||ji(i,s,lt,Ve,p,Ge)}var Jo=null,wf=null;function Ah(i){return i.nodeType===9?i:i.ownerDocument}function zd(i){switch(i){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Rd(i,s){if(i===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return i===1&&s==="foreignObject"?0:i}function Id(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Tf=null;function Ol(){var i=window.event;return i&&i.type==="popstate"?i===Tf?!1:(Tf=i,!0):(Tf=null,!1)}var Dd=typeof setTimeout=="function"?setTimeout:void 0,xp=typeof clearTimeout=="function"?clearTimeout:void 0,Ld=typeof Promise=="function"?Promise:void 0,bp=typeof queueMicrotask=="function"?queueMicrotask:typeof Ld<"u"?function(i){return Ld.resolve(null).then(i).catch(Vp)}:Dd;function Vp(i){setTimeout(function(){throw i})}function Bl(i){return i==="head"}function kd(i,s){var u=s,p=0,x=0;do{var S=u.nextSibling;if(i.removeChild(u),S&&S.nodeType===8)if(u=S.data,u==="/$"){if(0<p&&8>p){u=p;var U=i.ownerDocument;if(u&1&&lo(U.documentElement),u&2&&lo(U.body),u&4)for(u=U.head,lo(u),U=u.firstChild;U;){var W=U.nextSibling,_e=U.nodeName;U[Sn]||_e==="SCRIPT"||_e==="STYLE"||_e==="LINK"&&U.rel.toLowerCase()==="stylesheet"||u.removeChild(U),U=W}}if(x===0){i.removeChild(S),vn(s);return}x--}else u==="$"||u==="$?"||u==="$!"?x++:p=u.charCodeAt(0)-48;else p=0;u=S}while(u);vn(s)}function Sf(i){var s=i.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var u=s;switch(s=s.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":Sf(u),Qi(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}i.removeChild(u)}}function Mf(i,s,u,p){for(;i.nodeType===1;){var x=u;if(i.nodeName.toLowerCase()!==s.toLowerCase()){if(!p&&(i.nodeName!=="INPUT"||i.type!=="hidden"))break}else if(p){if(!i[Sn])switch(s){case"meta":if(!i.hasAttribute("itemprop"))break;return i;case"link":if(S=i.getAttribute("rel"),S==="stylesheet"&&i.hasAttribute("data-precedence"))break;if(S!==x.rel||i.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||i.getAttribute("title")!==(x.title==null?null:x.title))break;return i;case"style":if(i.hasAttribute("data-precedence"))break;return i;case"script":if(S=i.getAttribute("src"),(S!==(x.src==null?null:x.src)||i.getAttribute("type")!==(x.type==null?null:x.type)||i.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&S&&i.hasAttribute("async")&&!i.hasAttribute("itemprop"))break;return i;default:return i}}else if(s==="input"&&i.type==="hidden"){var S=x.name==null?null:""+x.name;if(x.type==="hidden"&&i.getAttribute("name")===S)return i}else return i;if(i=ga(i.nextSibling),i===null)break}return null}function wp(i,s,u){if(s==="")return null;for(;i.nodeType!==3;)if((i.nodeType!==1||i.nodeName!=="INPUT"||i.type!=="hidden")&&!u||(i=ga(i.nextSibling),i===null))return null;return i}function Eu(i){return i.data==="$!"||i.data==="$?"&&i.ownerDocument.readyState==="complete"}function Ef(i,s){var u=i.ownerDocument;if(i.data!=="$?"||u.readyState==="complete")s();else{var p=function(){s(),u.removeEventListener("DOMContentLoaded",p)};u.addEventListener("DOMContentLoaded",p),i._reactRetry=p}}function ga(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?"||s==="F!"||s==="F")break;if(s==="/$")return null}}return i}var Od=null;function Tp(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var u=i.data;if(u==="$"||u==="$!"||u==="$?"){if(s===0)return i;s--}else u==="/$"&&s++}i=i.previousSibling}return null}function Sp(i,s,u){switch(s=Ah(u),i){case"html":if(i=s.documentElement,!i)throw Error(I(452));return i;case"head":if(i=s.head,!i)throw Error(I(453));return i;case"body":if(i=s.body,!i)throw Error(I(454));return i;default:throw Error(I(451))}}function lo(i){for(var s=i.attributes;s.length;)i.removeAttributeNode(s[0]);Qi(i)}var $i=new Map,Cf=new Set;function Ph(i){return typeof i.getRootNode=="function"?i.getRootNode():i.nodeType===9?i:i.ownerDocument}var co=je.d;je.d={f:Bd,r:Gp,D:Zp,C:Mp,L:Fd,m:jd,X:zh,S:Ep,M:Ud};function Bd(){var i=co.f(),s=Rn();return i||s}function Gp(i){var s=na(i);s!==null&&s.tag===5&&s.type==="form"?Oi(s):co.r(i)}var Ic=typeof document>"u"?null:document;function Nd(i,s,u){var p=Ic;if(p&&typeof s=="string"&&s){var x=aa(s);x='link[rel="'+i+'"][href="'+x+'"]',typeof u=="string"&&(x+='[crossorigin="'+u+'"]'),Cf.has(x)||(Cf.add(x),i={rel:i,crossOrigin:u,href:s},p.querySelector(x)===null&&(s=p.createElement("link"),qi(s,"link",i),Ot(s),p.head.appendChild(s)))}}function Zp(i){co.D(i),Nd("dns-prefetch",i,null)}function Mp(i,s){co.C(i,s),Nd("preconnect",i,s)}function Fd(i,s,u){co.L(i,s,u);var p=Ic;if(p&&i&&s){var x='link[rel="preload"][as="'+aa(s)+'"]';s==="image"&&u&&u.imageSrcSet?(x+='[imagesrcset="'+aa(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(x+='[imagesizes="'+aa(u.imageSizes)+'"]')):x+='[href="'+aa(i)+'"]';var S=x;switch(s){case"style":S=Nl(i);break;case"script":S=jl(i)}$i.has(S)||(i=X({rel:"preload",href:s==="image"&&u&&u.imageSrcSet?void 0:i,as:s},u),$i.set(S,i),p.querySelector(x)!==null||s==="style"&&p.querySelector(Fl(S))||s==="script"&&p.querySelector(Dc(S))||(s=p.createElement("link"),qi(s,"link",i),Ot(s),p.head.appendChild(s)))}}function jd(i,s){co.m(i,s);var u=Ic;if(u&&i){var p=s&&typeof s.as=="string"?s.as:"script",x='link[rel="modulepreload"][as="'+aa(p)+'"][href="'+aa(i)+'"]',S=x;switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":S=jl(i)}if(!$i.has(S)&&(i=X({rel:"modulepreload",href:i},s),$i.set(S,i),u.querySelector(x)===null)){switch(p){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(Dc(S)))return}p=u.createElement("link"),qi(p,"link",i),Ot(p),u.head.appendChild(p)}}}function Ep(i,s,u){co.S(i,s,u);var p=Ic;if(p&&i){var x=Xt(p).hoistableStyles,S=Nl(i);s=s||"default";var U=x.get(S);if(!U){var W={loading:0,preload:null};if(U=p.querySelector(Fl(S)))W.loading=5;else{i=X({rel:"stylesheet",href:i,"data-precedence":s},u),(u=$i.get(S))&&t(i,u);var _e=U=p.createElement("link");Ot(_e),qi(_e,"link",i),_e._p=new Promise(function(Ne,tt){_e.onload=Ne,_e.onerror=tt}),_e.addEventListener("load",function(){W.loading|=1}),_e.addEventListener("error",function(){W.loading|=2}),W.loading|=4,a(U,s,p)}U={type:"stylesheet",instance:U,count:1,state:W},x.set(S,U)}}}function zh(i,s){co.X(i,s);var u=Ic;if(u&&i){var p=Xt(u).hoistableScripts,x=jl(i),S=p.get(x);S||(S=u.querySelector(Dc(x)),S||(i=X({src:i,async:!0},s),(s=$i.get(x))&&r(i,s),S=u.createElement("script"),Ot(S),qi(S,"link",i),u.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},p.set(x,S))}}function Ud(i,s){co.M(i,s);var u=Ic;if(u&&i){var p=Xt(u).hoistableScripts,x=jl(i),S=p.get(x);S||(S=u.querySelector(Dc(x)),S||(i=X({src:i,async:!0,type:"module"},s),(s=$i.get(x))&&r(i,s),S=u.createElement("script"),Ot(S),qi(S,"link",i),u.head.appendChild(S)),S={type:"script",instance:S,count:1,state:null},p.set(x,S))}}function Vd(i,s,u,p){var x=(x=Ft.current)?Ph(x):null;if(!x)throw Error(I(446));switch(i){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(s=Nl(u.href),u=Xt(x).hoistableStyles,p=u.get(s),p||(p={type:"style",instance:null,count:0,state:null},u.set(s,p)),p):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){i=Nl(u.href);var S=Xt(x).hoistableStyles,U=S.get(i);if(U||(x=x.ownerDocument||x,U={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},S.set(i,U),(S=x.querySelector(Fl(i)))&&!S._p&&(U.instance=S,U.state.loading=5),$i.has(i)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},$i.set(i,u),S||Gd(x,i,u,U.state))),s&&p===null)throw Error(I(528,""));return U}if(s&&p!==null)throw Error(I(529,""));return null;case"script":return s=u.async,u=u.src,typeof u=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=jl(u),u=Xt(x).hoistableScripts,p=u.get(s),p||(p={type:"script",instance:null,count:0,state:null},u.set(s,p)),p):{type:"void",instance:null,count:0,state:null};default:throw Error(I(444,i))}}function Nl(i){return'href="'+aa(i)+'"'}function Fl(i){return'link[rel="stylesheet"]['+i+"]"}function Cu(i){return X({},i,{"data-precedence":i.precedence,precedence:null})}function Gd(i,s,u,p){i.querySelector('link[rel="preload"][as="style"]['+s+"]")?p.loading=1:(s=i.createElement("link"),p.preload=s,s.addEventListener("load",function(){return p.loading|=1}),s.addEventListener("error",function(){return p.loading|=2}),qi(s,"link",u),Ot(s),i.head.appendChild(s))}function jl(i){return'[src="'+aa(i)+'"]'}function Dc(i){return"script[async]"+i}function Cp(i,s,u){if(s.count++,s.instance===null)switch(s.type){case"style":var p=i.querySelector('style[data-href~="'+aa(u.href)+'"]');if(p)return s.instance=p,Ot(p),p;var x=X({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return p=(i.ownerDocument||i).createElement("style"),Ot(p),qi(p,"style",x),a(p,u.precedence,i),s.instance=p;case"stylesheet":x=Nl(u.href);var S=i.querySelector(Fl(x));if(S)return s.state.loading|=4,s.instance=S,Ot(S),S;p=Cu(u),(x=$i.get(x))&&t(p,x),S=(i.ownerDocument||i).createElement("link"),Ot(S);var U=S;return U._p=new Promise(function(W,_e){U.onload=W,U.onerror=_e}),qi(S,"link",p),s.state.loading|=4,a(S,u.precedence,i),s.instance=S;case"script":return S=jl(u.src),(x=i.querySelector(Dc(S)))?(s.instance=x,Ot(x),x):(p=u,(x=$i.get(S))&&(p=X({},u),r(p,x)),i=i.ownerDocument||i,x=i.createElement("script"),Ot(x),qi(x,"link",p),i.head.appendChild(x),s.instance=x);case"void":return null;default:throw Error(I(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(p=s.instance,s.state.loading|=4,a(p,u.precedence,i));return s.instance}function a(i,s,u){for(var p=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=p.length?p[p.length-1]:null,S=x,U=0;U<p.length;U++){var W=p[U];if(W.dataset.precedence===s)S=W;else if(S!==x)break}S?S.parentNode.insertBefore(i,S.nextSibling):(s=u.nodeType===9?u.head:u,s.insertBefore(i,s.firstChild))}function t(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.title==null&&(i.title=s.title)}function r(i,s){i.crossOrigin==null&&(i.crossOrigin=s.crossOrigin),i.referrerPolicy==null&&(i.referrerPolicy=s.referrerPolicy),i.integrity==null&&(i.integrity=s.integrity)}var o=null;function f(i,s,u){if(o===null){var p=new Map,x=o=new Map;x.set(u,p)}else x=o,p=x.get(u),p||(p=new Map,x.set(u,p));if(p.has(i))return p;for(p.set(i,null),u=u.getElementsByTagName(i),x=0;x<u.length;x++){var S=u[x];if(!(S[Sn]||S[ai]||i==="link"&&S.getAttribute("rel")==="stylesheet")&&S.namespaceURI!=="http://www.w3.org/2000/svg"){var U=S.getAttribute(s)||"";U=i+U;var W=p.get(U);W?W.push(S):p.set(U,[S])}}return p}function g(i,s,u){i=i.ownerDocument||i,i.head.insertBefore(u,s==="title"?i.querySelector("head > title"):null)}function _(i,s,u){if(u===1||s.itemProp!=null)return!1;switch(i){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return i=s.disabled,typeof s.precedence=="string"&&i==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function v(i){return!(i.type==="stylesheet"&&(i.state.loading&3)===0)}var w=null;function M(){}function P(i,s,u){if(w===null)throw Error(I(475));var p=w;if(s.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(s.state.loading&4)===0){if(s.instance===null){var x=Nl(u.href),S=i.querySelector(Fl(x));if(S){i=S._p,i!==null&&typeof i=="object"&&typeof i.then=="function"&&(p.count++,p=B.bind(p),i.then(p,p)),s.state.loading|=4,s.instance=S,Ot(S);return}S=i.ownerDocument||i,u=Cu(u),(x=$i.get(x))&&t(u,x),S=S.createElement("link"),Ot(S);var U=S;U._p=new Promise(function(W,_e){U.onload=W,U.onerror=_e}),qi(S,"link",u),s.instance=S}p.stylesheets===null&&(p.stylesheets=new Map),p.stylesheets.set(s,i),(i=s.state.preload)&&(s.state.loading&3)===0&&(p.count++,s=B.bind(p),i.addEventListener("load",s),i.addEventListener("error",s))}}function D(){if(w===null)throw Error(I(475));var i=w;return i.stylesheets&&i.count===0&&G(i,i.stylesheets),0<i.count?function(s){var u=setTimeout(function(){if(i.stylesheets&&G(i,i.stylesheets),i.unsuspend){var p=i.unsuspend;i.unsuspend=null,p()}},6e4);return i.unsuspend=s,function(){i.unsuspend=null,clearTimeout(u)}}:null}function B(){if(this.count--,this.count===0){if(this.stylesheets)G(this,this.stylesheets);else if(this.unsuspend){var i=this.unsuspend;this.unsuspend=null,i()}}}var j=null;function G(i,s){i.stylesheets=null,i.unsuspend!==null&&(i.count++,j=new Map,s.forEach($,i),j=null,B.call(i))}function $(i,s){if(!(s.state.loading&4)){var u=j.get(i);if(u)var p=u.get(null);else{u=new Map,j.set(i,u);for(var x=i.querySelectorAll("link[data-precedence],style[data-precedence]"),S=0;S<x.length;S++){var U=x[S];(U.nodeName==="LINK"||U.getAttribute("media")!=="not all")&&(u.set(U.dataset.precedence,U),p=U)}p&&u.set(null,p)}x=s.instance,U=x.getAttribute("data-precedence"),S=u.get(U)||p,S===p&&u.set(null,x),u.set(U,x),this.count++,p=B.bind(this),x.addEventListener("load",p),x.addEventListener("error",p),S?S.parentNode.insertBefore(x,S.nextSibling):(i=i.nodeType===9?i.head:i,i.insertBefore(x,i.firstChild)),s.state.loading|=4}}var ee={$$typeof:Xe,Provider:null,Consumer:null,_currentValue:_t,_currentValue2:_t,_threadCount:0};function ae(i,s,u,p,x,S,U,W){this.tag=1,this.containerInfo=i,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=qe(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=qe(0),this.hiddenUpdates=qe(null),this.identifierPrefix=p,this.onUncaughtError=x,this.onCaughtError=S,this.onRecoverableError=U,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function we(i,s,u,p,x,S,U,W,_e,Ne,tt,lt){return i=new ae(i,s,u,U,W,_e,Ne,lt),s=1,S===!0&&(s|=24),S=xr(3,null,null,s),i.current=S,S.stateNode=i,s=$s(),s.refCount++,i.pooledCache=s,s.refCount++,S.memoizedState={element:p,isDehydrated:u,cache:s},yc(S),i}function de(i){return i?(i=Pa,i):Pa}function F(i,s,u,p,x,S){x=de(x),p.context===null?p.context=x:p.pendingContext=x,p=Ya(s),p.payload={element:u},S=S===void 0?null:S,S!==null&&(p.callback=S),u=bs(i,p,s),u!==null&&(Na(u,i,s),Ws(u,i,s))}function J(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var u=i.retryLane;i.retryLane=u!==0&&u<s?u:s}}function me(i,s){J(i,s),(i=i.alternate)&&J(i,s)}function De(i){if(i.tag===13){var s=Aa(i,67108864);s!==null&&Na(s,i,67108864),me(i,67108864)}}var et=!0;function Fe(i,s,u,p){var x=We.T;We.T=null;var S=je.p;try{je.p=2,ct(i,s,u,p)}finally{je.p=S,We.T=x}}function Ze(i,s,u,p){var x=We.T;We.T=null;var S=je.p;try{je.p=8,ct(i,s,u,p)}finally{je.p=S,We.T=x}}function ct(i,s,u,p){if(et){var x=rt(p);if(x===null)oo(i,s,p,ht,u),Dr(i,p);else if(dn(x,i,s,u,p))p.stopPropagation();else if(Dr(i,p),s&4&&-1<Fa.indexOf(i)){for(;x!==null;){var S=na(x);if(S!==null)switch(S.tag){case 3:if(S=S.stateNode,S.current.memoizedState.isDehydrated){var U=te(S.pendingLanes);if(U!==0){var W=S;for(W.pendingLanes|=2,W.entangledLanes|=2;U;){var _e=1<<31-ir(U);W.entanglements[1]|=_e,U&=~_e}as(S),(Ni&6)===0&&(yh=Wi()+500,Th(0))}}break;case 13:W=Aa(S,2),W!==null&&Na(W,S,2),Rn(),me(S,2)}if(S=rt(p),S===null&&oo(i,s,p,ht,u),S===x)break;x=S}x!==null&&p.stopPropagation()}else oo(i,s,p,null,u)}}function rt(i){return i=Ta(i),$e(i)}var ht=null;function $e(i){if(ht=null,i=jr(i),i!==null){var s=q(i);if(s===null)i=null;else{var u=s.tag;if(u===13){if(i=E(s),i!==null)return i;i=null}else if(u===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null)}}return ht=i,null}function Et(i){switch(i){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Nr()){case yr:return 2;case Rs:return 8;case ba:case ql:return 32;case Is:return 268435456;default:return 32}default:return 32}}var kt=!1,zt=null,Tt=null,ei=null,Hi=new Map,_n=new Map,yn=[],Fa="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Dr(i,s){switch(i){case"focusin":case"focusout":zt=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":ei=null;break;case"pointerover":case"pointerout":Hi.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":_n.delete(s.pointerId)}}function In(i,s,u,p,x,S){return i===null||i.nativeEvent!==S?(i={blockedOn:s,domEventName:u,eventSystemFlags:p,nativeEvent:S,targetContainers:[x]},s!==null&&(s=na(s),s!==null&&De(s)),i):(i.eventSystemFlags|=p,s=i.targetContainers,x!==null&&s.indexOf(x)===-1&&s.push(x),i)}function dn(i,s,u,p,x){switch(s){case"focusin":return zt=In(zt,i,s,u,p,x),!0;case"dragenter":return Tt=In(Tt,i,s,u,p,x),!0;case"mouseover":return ei=In(ei,i,s,u,p,x),!0;case"pointerover":var S=x.pointerId;return Hi.set(S,In(Hi.get(S)||null,i,s,u,p,x)),!0;case"gotpointercapture":return S=x.pointerId,_n.set(S,In(_n.get(S)||null,i,s,u,p,x)),!0}return!1}function Xn(i){var s=jr(i.target);if(s!==null){var u=q(s);if(u!==null){if(s=u.tag,s===13){if(s=E(u),s!==null){i.blockedOn=s,Rt(i.priority,function(){if(u.tag===13){var p=ma();p=yt(p);var x=Aa(u,p);x!==null&&Na(x,u,p),me(u,p)}});return}}else if(s===3&&u.stateNode.current.memoizedState.isDehydrated){i.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Vn(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var u=rt(i.nativeEvent);if(u===null){u=i.nativeEvent;var p=new u.constructor(u.type,u);Ar=p,u.target.dispatchEvent(p),Ar=null}else return s=na(u),s!==null&&De(s),i.blockedOn=u,!1;s.shift()}return!0}function er(i,s,u){Vn(i)&&u.delete(s)}function Lr(){kt=!1,zt!==null&&Vn(zt)&&(zt=null),Tt!==null&&Vn(Tt)&&(Tt=null),ei!==null&&Vn(ei)&&(ei=null),Hi.forEach(er),_n.forEach(er)}function kr(i,s){i.blockedOn===s&&(i.blockedOn=null,kt||(kt=!0,C.unstable_scheduleCallback(C.unstable_NormalPriority,Lr)))}var Dn=null;function Or(i){Dn!==i&&(Dn=i,C.unstable_scheduleCallback(C.unstable_NormalPriority,function(){Dn===i&&(Dn=null);for(var s=0;s<i.length;s+=3){var u=i[s],p=i[s+1],x=i[s+2];if(typeof p!="function"){if($e(p||u)===null)continue;break}var S=na(u);S!==null&&(i.splice(s,3),s-=3,zi(S,{pending:!0,data:x,method:u.method,action:p},p,x))}}))}function vn(i){function s(_e){return kr(_e,i)}zt!==null&&kr(zt,i),Tt!==null&&kr(Tt,i),ei!==null&&kr(ei,i),Hi.forEach(s),_n.forEach(s);for(var u=0;u<yn.length;u++){var p=yn[u];p.blockedOn===i&&(p.blockedOn=null)}for(;0<yn.length&&(u=yn[0],u.blockedOn===null);)Xn(u),u.blockedOn===null&&yn.shift();if(u=(i.ownerDocument||i).$$reactFormReplay,u!=null)for(p=0;p<u.length;p+=3){var x=u[p],S=u[p+1],U=x[ri]||null;if(typeof S=="function")U||Or(u);else if(U){var W=null;if(S&&S.hasAttribute("formAction")){if(x=S,U=S[ri]||null)W=U.formAction;else if($e(x)!==null)continue}else W=U.action;typeof W=="function"?u[p+1]=W:(u.splice(p,3),p-=3),Or(u)}}}function Gn(i){this._internalRoot=i}Ln.prototype.render=Gn.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(I(409));var u=s.current,p=ma();F(u,p,i,s,null,null)},Ln.prototype.unmount=Gn.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;F(i.current,2,null,i,null,null),Rn(),s[fi]=null}};function Ln(i){this._internalRoot=i}Ln.prototype.unstable_scheduleHydration=function(i){if(i){var s=bt();i={blockedOn:null,target:i,priority:s};for(var u=0;u<yn.length&&s!==0&&s<yn[u].priority;u++);yn.splice(u,0,i),u===0&&Xn(i)}};var kn=R.version;if(kn!=="19.1.0")throw Error(I(527,kn,"19.1.0"));je.findDOMNode=function(i){var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(I(188)):(i=Object.keys(i).join(","),Error(I(268,i)));return i=pe(s),i=i!==null?se(i):null,i=i===null?null:i.stateNode,i};var tn={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:We,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _a=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_a.isDisabled&&_a.supportsFiber)try{Fr=_a.inject(tn),an=_a}catch{}}return qd.createRoot=function(i,s){if(!V(i))throw Error(I(299));var u=!1,p="",x=jf,S=Xd,U=Uf,W=null;return s!=null&&(s.unstable_strictMode===!0&&(u=!0),s.identifierPrefix!==void 0&&(p=s.identifierPrefix),s.onUncaughtError!==void 0&&(x=s.onUncaughtError),s.onCaughtError!==void 0&&(S=s.onCaughtError),s.onRecoverableError!==void 0&&(U=s.onRecoverableError),s.unstable_transitionCallbacks!==void 0&&(W=s.unstable_transitionCallbacks)),s=we(i,1,!1,null,null,u,p,x,S,U,W,null),i[fi]=s.current,Ed(i),new Gn(s)},qd.hydrateRoot=function(i,s,u){if(!V(i))throw Error(I(299));var p=!1,x="",S=jf,U=Xd,W=Uf,_e=null,Ne=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(x=u.identifierPrefix),u.onUncaughtError!==void 0&&(S=u.onUncaughtError),u.onCaughtError!==void 0&&(U=u.onCaughtError),u.onRecoverableError!==void 0&&(W=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(_e=u.unstable_transitionCallbacks),u.formState!==void 0&&(Ne=u.formState)),s=we(i,1,!0,s,u??null,p,x,S,U,W,_e,Ne),s.context=de(null),u=s.current,p=ma(),p=yt(p),x=Ya(p),x.callback=null,bs(u,x,p),u=p,s.current.lanes=u,Ue(s,u),as(s),i[fi]=s.current,Ed(i),new Ln(s)},qd.version="19.1.0",qd}var _m;function Tg(){if(_m)return Xp.exports;_m=1;function C(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(C)}catch(R){console.error(R)}}return C(),Xp.exports=wg(),Xp.exports}var Sg=Tg();const Mg="modulepreload",Eg=function(C,R){return new URL(C,R).href},ym={},Cg=function(R,k,I){let V=Promise.resolve();if(k&&k.length>0){let se=function(X){return Promise.all(X.map(ce=>Promise.resolve(ce).then(K=>({status:"fulfilled",value:K}),K=>({status:"rejected",reason:K}))))};const E=document.getElementsByTagName("link"),c=document.querySelector("meta[property=csp-nonce]"),pe=c?.nonce||c?.getAttribute("nonce");V=se(k.map(X=>{if(X=Eg(X,I),X in ym)return;ym[X]=!0;const ce=X.endsWith(".css"),K=ce?'[rel="stylesheet"]':"";if(!!I)for(let Qe=E.length-1;Qe>=0;Qe--){const St=E[Qe];if(St.href===X&&(!ce||St.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${X}"]${K}`))return;const Ie=document.createElement("link");if(Ie.rel=ce?"stylesheet":Mg,ce||(Ie.as="script"),Ie.crossOrigin="",Ie.href=X,pe&&Ie.setAttribute("nonce",pe),document.head.appendChild(Ie),ce)return new Promise((Qe,St)=>{Ie.addEventListener("load",Qe),Ie.addEventListener("error",()=>St(new Error(`Unable to preload CSS for ${X}`)))})}))}function q(E){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=E,window.dispatchEvent(c),!c.defaultPrevented)throw E}return V.then(E=>{for(const c of E||[])c.status==="rejected"&&q(c.reason);return R().catch(q)})},Ag=ut.createContext(null);function Pg(C,R){const k=Array.isArray(C)?C[0]:C?C.x:0,I=Array.isArray(C)?C[1]:C?C.y:0,V=Array.isArray(R)?R[0]:R?R.x:0,q=Array.isArray(R)?R[1]:R?R.y:0;return k===V&&I===q}function Gl(C,R){if(C===R)return!0;if(!C||!R)return!1;if(Array.isArray(C)){if(!Array.isArray(R)||C.length!==R.length)return!1;for(let k=0;k<C.length;k++)if(!Gl(C[k],R[k]))return!1;return!0}else if(Array.isArray(R))return!1;if(typeof C=="object"&&typeof R=="object"){const k=Object.keys(C),I=Object.keys(R);if(k.length!==I.length)return!1;for(const V of k)if(!R.hasOwnProperty(V)||!Gl(C[V],R[V]))return!1;return!0}return!1}function vm(C){return{longitude:C.center.lng,latitude:C.center.lat,zoom:C.zoom,pitch:C.pitch,bearing:C.bearing,padding:C.padding}}function xm(C,R){const k=R.viewState||R,I={};if("longitude"in k&&"latitude"in k&&(k.longitude!==C.center.lng||k.latitude!==C.center.lat)){const V=C.center.constructor;I.center=new V(k.longitude,k.latitude)}return"zoom"in k&&k.zoom!==C.zoom&&(I.zoom=k.zoom),"bearing"in k&&k.bearing!==C.bearing&&(I.bearing=k.bearing),"pitch"in k&&k.pitch!==C.pitch&&(I.pitch=k.pitch),k.padding&&C.padding&&!Gl(k.padding,C.padding)&&(I.padding=k.padding),I}const zg=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function bm(C){if(!C)return null;if(typeof C=="string"||("toJS"in C&&(C=C.toJS()),!C.layers))return C;const R={};for(const I of C.layers)R[I.id]=I;const k=C.layers.map(I=>{let V=null;"interactive"in I&&(V=Object.assign({},I),delete V.interactive);const q=R[I.ref];if(q){V=V||Object.assign({},I),delete V.ref;for(const E of zg)E in q&&(V[E]=q[E])}return V||I});return{...C,layers:k}}const wm={version:8,sources:{},layers:[]},Tm={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Sm={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Mm={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Rg=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],Ig=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class zf{constructor(R,k,I){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=V=>{const q=this.props[Mm[V.type]];q?q(V):V.type==="error"&&console.error(V.error)},this._onCameraEvent=V=>{if(this._internalUpdate)return;V.viewState=this._propsedCameraUpdate||vm(this._map.transform);const q=this.props[Sm[V.type]];q&&q(V)},this._onCameraUpdate=V=>this._internalUpdate?V:(this._propsedCameraUpdate=vm(V),xm(V,this.props)),this._onPointerEvent=V=>{(V.type==="mousemove"||V.type==="mouseout")&&this._updateHover(V);const q=this.props[Tm[V.type]];q&&(this.props.interactiveLayerIds&&V.type!=="mouseover"&&V.type!=="mouseout"&&(V.features=this._hoveredFeatures||this._queryRenderedFeatures(V.point)),q(V),delete V.features)},this._MapClass=R,this.props=k,this._initialize(I)}get map(){return this._map}setProps(R){const k=this.props;this.props=R;const I=this._updateSettings(R,k),V=this._updateSize(R),q=this._updateViewState(R);this._updateStyle(R,k),this._updateStyleComponents(R),this._updateHandlers(R,k),(I||V||q&&!this._map.isMoving())&&this.redraw()}static reuse(R,k){const I=zf.savedMaps.pop();if(!I)return null;const V=I.map,q=V.getContainer();for(k.className=q.className;q.childNodes.length>0;)k.appendChild(q.childNodes[0]);V._container=k;const E=V._resizeObserver;E&&(E.disconnect(),E.observe(k)),I.setProps({...R,styleDiffing:!1}),V.resize();const{initialViewState:c}=R;return c&&(c.bounds?V.fitBounds(c.bounds,{...c.fitBoundsOptions,duration:0}):I._updateViewState(c)),V.isStyleLoaded()?V.fire("load"):V.once("style.load",()=>V.fire("load")),V._update(),I}_initialize(R){const{props:k}=this,{mapStyle:I=wm}=k,V={...k,...k.initialViewState,container:R,style:bm(I)},q=V.initialViewState||V.viewState||V;if(Object.assign(V,{center:[q.longitude||0,q.latitude||0],zoom:q.zoom||0,pitch:q.pitch||0,bearing:q.bearing||0}),k.gl){const c=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=c,k.gl)}const E=new this._MapClass(V);q.padding&&E.setPadding(q.padding),k.cursor&&(E.getCanvas().style.cursor=k.cursor),E.transformCameraUpdate=this._onCameraUpdate,E.on("style.load",()=>{this._styleComponents={light:E.getLight(),sky:E.getSky(),projection:E.getProjection?.(),terrain:E.getTerrain()},this._updateStyleComponents(this.props)}),E.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const c in Tm)E.on(c,this._onPointerEvent);for(const c in Sm)E.on(c,this._onCameraEvent);for(const c in Mm)E.on(c,this._onEvent);this._map=E}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),zf.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const R=this._map;R.style&&(R._frame&&(R._frame.cancel(),R._frame=null),R._render())}_updateSize(R){const{viewState:k}=R;if(k){const I=this._map;if(k.width!==I.transform.width||k.height!==I.transform.height)return I.resize(),!0}return!1}_updateViewState(R){const k=this._map,I=k.transform;if(!k.isMoving()){const q=xm(I,R);if(Object.keys(q).length>0)return this._internalUpdate=!0,k.jumpTo(q),this._internalUpdate=!1,!0}return!1}_updateSettings(R,k){const I=this._map;let V=!1;for(const q of Rg)q in R&&!Gl(R[q],k[q])&&(V=!0,I[`set${q[0].toUpperCase()}${q.slice(1)}`]?.call(I,R[q]));return V}_updateStyle(R,k){if(R.cursor!==k.cursor&&(this._map.getCanvas().style.cursor=R.cursor||""),R.mapStyle!==k.mapStyle){const{mapStyle:I=wm,styleDiffing:V=!0}=R,q={diff:V};"localIdeographFontFamily"in R&&(q.localIdeographFontFamily=R.localIdeographFontFamily),this._map.setStyle(bm(I),q)}}_updateStyleComponents({light:R,projection:k,sky:I,terrain:V}){const q=this._map,E=this._styleComponents;q.style._loaded&&(R&&!Gl(R,E.light)&&(E.light=R,q.setLight(R)),k&&!Gl(k,E.projection)&&k!==E.projection?.type&&(E.projection=typeof k=="string"?{type:k}:k,q.setProjection?.(E.projection)),I&&!Gl(I,E.sky)&&(E.sky=I,q.setSky(I)),V!==void 0&&!Gl(V,E.terrain)&&(!V||q.getSource(V.source))&&(E.terrain=V,q.setTerrain(V)))}_updateHandlers(R,k){const I=this._map;for(const V of Ig){const q=R[V]??!0,E=k[V]??!0;Gl(q,E)||(q?I[V].enable(q):I[V].disable())}}_queryRenderedFeatures(R){const k=this._map,{interactiveLayerIds:I=[]}=this.props;try{return k.queryRenderedFeatures(R,{layers:I.filter(k.getLayer.bind(k))})}catch{return[]}}_updateHover(R){const{props:k}=this;if(k.interactiveLayerIds&&(k.onMouseMove||k.onMouseEnter||k.onMouseLeave)){const V=R.type,q=this._hoveredFeatures?.length>0,E=this._queryRenderedFeatures(R.point),c=E.length>0;!c&&q&&(R.type="mouseleave",this._onPointerEvent(R)),this._hoveredFeatures=E,c&&!q&&(R.type="mouseenter",this._onPointerEvent(R)),R.type=V}else this._hoveredFeatures=null}}zf.savedMaps=[];const Dg=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Lg(C){if(!C)return null;const R=C.map,k={getMap:()=>R};for(const I of kg(R))!(I in k)&&!Dg.includes(I)&&(k[I]=R[I].bind(R));return k}function kg(C){const R=new Set;let k=C;for(;k;){for(const I of Object.getOwnPropertyNames(k))I[0]!=="_"&&typeof C[I]=="function"&&I!=="fire"&&I!=="setEventedParent"&&R.add(I);k=Object.getPrototypeOf(k)}return Array.from(R)}const Og=typeof document<"u"?ut.useLayoutEffect:ut.useEffect;function Bg(C,R){const{RTLTextPlugin:k,maxParallelImageRequests:I,workerCount:V,workerUrl:q}=R;if(k&&C.getRTLTextPluginStatus&&C.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:E,lazy:c=!0}=typeof k=="string"?{pluginUrl:k}:k;C.setRTLTextPlugin(E,pe=>{pe&&console.error(pe)},c)}I!==void 0&&C.setMaxParallelImageRequests(I),V!==void 0&&C.setWorkerCount(V),q!==void 0&&C.setWorkerUrl(q)}const Lp=ut.createContext(null);function Ng(C,R){const k=ut.useContext(Ag),[I,V]=ut.useState(null),q=ut.useRef(),{current:E}=ut.useRef({mapLib:null,map:null});ut.useEffect(()=>{const se=C.mapLib;let X=!0,ce;return Promise.resolve(se||Cg(()=>Promise.resolve().then(()=>cy),void 0,import.meta.url)).then(K=>{if(!X)return;if(!K)throw new Error("Invalid mapLib");const Q="Map"in K?K:K.default;if(!Q.Map)throw new Error("Invalid mapLib");Bg(Q,C),C.reuseMaps&&(ce=zf.reuse(C,q.current)),ce||(ce=new zf(Q.Map,C,q.current)),E.map=Lg(ce),E.mapLib=Q,V(ce),k?.onMapMount(E.map,C.id)}).catch(K=>{const{onError:Q}=C;Q?Q({type:"error",target:null,originalEvent:null,error:K}):console.error(K)}),()=>{X=!1,ce&&(k?.onMapUnmount(C.id),C.reuseMaps?ce.recycle():ce.destroy())}},[]),Og(()=>{I&&I.setProps(C)}),ut.useImperativeHandle(R,()=>E.map,[I]);const c=ut.useMemo(()=>({position:"relative",width:"100%",height:"100%",...C.style}),[C.style]),pe={height:"100%"};return ut.createElement("div",{id:C.id,ref:q,style:c},I&&ut.createElement(Lp.Provider,{value:E},ut.createElement("div",{"mapboxgl-children":"",style:pe},C.children)))}const Fg=ut.forwardRef(Ng);var Ym=Xm();const jg=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function kc(C,R){if(!C||!R)return;const k=C.style;for(const I in R){const V=R[I];Number.isFinite(V)&&!jg.test(I)?k[I]=`${V}px`:k[I]=V}}function Km(C,R){if(C===R)return null;const k=Em(C),I=Em(R),V=[];for(const q of I)k.has(q)||V.push(q);for(const q of k)I.has(q)||V.push(q);return V.length===0?null:V}function Em(C){return new Set(C?C.trim().split(/\s+/):[])}ut.memo(ut.forwardRef((C,R)=>{const{map:k,mapLib:I}=ut.useContext(Lp),V=ut.useRef({props:C}),q=ut.useMemo(()=>{let at=!1;ut.Children.forEach(C.children,Je=>{Je&&(at=!0)});const Ct={...C,element:at?document.createElement("div"):void 0},Xe=new I.Marker(Ct);return Xe.setLngLat([C.longitude,C.latitude]),Xe.getElement().addEventListener("click",Je=>{V.current.props.onClick?.({type:"click",target:Xe,originalEvent:Je})}),Xe.on("dragstart",Je=>{const nt=Je;nt.lngLat=q.getLngLat(),V.current.props.onDragStart?.(nt)}),Xe.on("drag",Je=>{const nt=Je;nt.lngLat=q.getLngLat(),V.current.props.onDrag?.(nt)}),Xe.on("dragend",Je=>{const nt=Je;nt.lngLat=q.getLngLat(),V.current.props.onDragEnd?.(nt)}),Xe},[]);ut.useEffect(()=>(q.addTo(k.getMap()),()=>{q.remove()}),[]);const{longitude:E,latitude:c,offset:pe,style:se,draggable:X=!1,popup:ce=null,rotation:K=0,rotationAlignment:Q="auto",pitchAlignment:Ie="auto"}=C;ut.useEffect(()=>{kc(q.getElement(),se)},[se]),ut.useImperativeHandle(R,()=>q,[]);const Qe=V.current.props;(q.getLngLat().lng!==E||q.getLngLat().lat!==c)&&q.setLngLat([E,c]),pe&&!Pg(q.getOffset(),pe)&&q.setOffset(pe),q.isDraggable()!==X&&q.setDraggable(X),q.getRotation()!==K&&q.setRotation(K),q.getRotationAlignment()!==Q&&q.setRotationAlignment(Q),q.getPitchAlignment()!==Ie&&q.setPitchAlignment(Ie),q.getPopup()!==ce&&q.setPopup(ce);const St=Km(Qe.className,C.className);if(St)for(const at of St)q.toggleClassName(at);return V.current.props=C,Ym.createPortal(C.children,q.getElement())}));ut.memo(ut.forwardRef((C,R)=>{const{map:k,mapLib:I}=ut.useContext(Lp),V=ut.useMemo(()=>document.createElement("div"),[]),q=ut.useRef({props:C}),E=ut.useMemo(()=>{const c={...C},pe=new I.Popup(c);return pe.setLngLat([C.longitude,C.latitude]),pe.once("open",se=>{q.current.props.onOpen?.(se)}),pe},[]);if(ut.useEffect(()=>{const c=pe=>{q.current.props.onClose?.(pe)};return E.on("close",c),E.setDOMContent(V).addTo(k.getMap()),()=>{E.off("close",c),E.isOpen()&&E.remove()}},[]),ut.useEffect(()=>{kc(E.getElement(),C.style)},[C.style]),ut.useImperativeHandle(R,()=>E,[]),E.isOpen()){const c=q.current.props;(E.getLngLat().lng!==C.longitude||E.getLngLat().lat!==C.latitude)&&E.setLngLat([C.longitude,C.latitude]),C.offset&&!Gl(c.offset,C.offset)&&E.setOffset(C.offset),(c.anchor!==C.anchor||c.maxWidth!==C.maxWidth)&&(E.options.anchor=C.anchor,E.setMaxWidth(C.maxWidth));const pe=Km(c.className,C.className);if(pe)for(const se of pe)E.toggleClassName(se);q.current.props=C}return Ym.createPortal(C.children,V)}));function kh(C,R,k,I){const V=ut.useContext(Lp),q=ut.useMemo(()=>C(V),[]);return ut.useEffect(()=>{const E=R,c=null,pe=typeof R=="function"?R:null,{map:se}=V;return se.hasControl(q)||(se.addControl(q,E?.position),c&&c(V)),()=>{pe&&pe(V),se.hasControl(q)&&se.removeControl(q)}},[]),q}function Ug(C){const R=kh(({mapLib:k})=>new k.AttributionControl(C),{position:C.position});return ut.useEffect(()=>{kc(R._container,C.style)},[C.style]),null}ut.memo(Ug);function Vg(C){const R=kh(({mapLib:k})=>new k.FullscreenControl({container:C.containerId&&document.getElementById(C.containerId)}),{position:C.position});return ut.useEffect(()=>{kc(R._controlContainer,C.style)},[C.style]),null}ut.memo(Vg);function Gg(C,R){const k=ut.useRef({props:C}),I=kh(({mapLib:V})=>{const q=new V.GeolocateControl(C),E=q._setupUI;return q._setupUI=()=>{q._container.hasChildNodes()||E()},q.on("geolocate",c=>{k.current.props.onGeolocate?.(c)}),q.on("error",c=>{k.current.props.onError?.(c)}),q.on("outofmaxbounds",c=>{k.current.props.onOutOfMaxBounds?.(c)}),q.on("trackuserlocationstart",c=>{k.current.props.onTrackUserLocationStart?.(c)}),q.on("trackuserlocationend",c=>{k.current.props.onTrackUserLocationEnd?.(c)}),q},{position:C.position});return k.current.props=C,ut.useImperativeHandle(R,()=>I,[]),ut.useEffect(()=>{kc(I._container,C.style)},[C.style]),null}ut.memo(ut.forwardRef(Gg));function Zg(C){const R=kh(({mapLib:k})=>new k.NavigationControl(C),{position:C.position});return ut.useEffect(()=>{kc(R._container,C.style)},[C.style]),null}const qg=ut.memo(Zg);function $g(C){const R=kh(({mapLib:q})=>new q.ScaleControl(C),{position:C.position}),k=ut.useRef(C),I=k.current;k.current=C;const{style:V}=C;return C.maxWidth!==void 0&&C.maxWidth!==I.maxWidth&&(R.options.maxWidth=C.maxWidth),C.unit!==void 0&&C.unit!==I.unit&&R.setUnit(C.unit),ut.useEffect(()=>{kc(R._container,V)},[V]),null}const Hg=ut.memo($g);function Xg(C){const R=kh(({mapLib:k})=>new k.TerrainControl(C),{position:C.position});return ut.useEffect(()=>{kc(R._container,C.style)},[C.style]),null}ut.memo(Xg);function Yg(C){const R=kh(({mapLib:k})=>new k.LogoControl(C),{position:C.position});return ut.useEffect(()=>{kc(R._container,C.style)},[C.style]),null}ut.memo(Yg);const xa={GEOJSON:"geojson",KML:"kml",COORDINATES:"coordinates",WKT:"wkt",POLYLINE:"polyline"},Zl={BLUE:"",GREEN:"",RED:"",YELLOW:"",PURPLE:"",ORANGE:""},Cm=()=>{const C=Date.now(),R=Math.floor(Math.random()*1e3);return`layer_${C}_${R}`},Kg=(C,R)=>!R.some(k=>k.id===C),Wg=C=>{let R=Cm(),k=0;const I=100;for(;!Kg(R,C)&&k<I;)R=Cm(),k++;if(k>=I)throw new Error("Unable to generate unique layer ID after maximum attempts");return R},Qg=C=>{const R=Object.values(Zl),k=C.map(I=>I.color);for(const I of R)if(!k.includes(I))return I;return R[C.length%R.length]},Jg=(C,R)=>`${{[xa.GEOJSON]:"GeoJSON",[xa.KML]:"KML",[xa.COORDINATES]:"Coordinates",[xa.WKT]:"WKT",[xa.POLYLINE]:"Polyline"}[C]} Layer ${R+1}`,e_=(C,R)=>{switch(R.type){case"ADD_LAYER":{const k={id:Wg(C.layers),...R.payload,createdAt:new Date,updatedAt:new Date};return{...C,layers:[...C.layers,k],layerCount:C.layerCount+1}}case"REMOVE_LAYER":{const k=C.layers.filter(I=>I.id!==R.payload.id);return{...C,layers:k,activeLayerId:C.activeLayerId===R.payload.id?null:C.activeLayerId}}case"UPDATE_LAYER":return{...C,layers:C.layers.map(k=>k.id===R.payload.id?{...k,...R.payload.updates,updatedAt:new Date}:k)};case"TOGGLE_VISIBILITY":return{...C,layers:C.layers.map(k=>k.id===R.payload.id?{...k,visibility:!k.visibility,updatedAt:new Date}:k)};case"UPDATE_COLOR":return{...C,layers:C.layers.map(k=>k.id===R.payload.id?{...k,color:R.payload.color,updatedAt:new Date}:k)};case"UPDATE_OPTIONS":return{...C,layers:C.layers.map(k=>k.id===R.payload.id?{...k,options:{...k.options,...R.payload.options},updatedAt:new Date}:k)};case"SET_ACTIVE_LAYER":return{...C,activeLayerId:R.payload.id};case"CLEAR_LAYERS":return{layers:[],activeLayerId:null,layerCount:0};default:return C}},t_={layers:[],activeLayerId:null,layerCount:0},Br={addLayer:(C,R,k={},I,V=[],q)=>{const E=Qg(V),c=I||Jg(R,V.length);return{data:C,originalContent:q,color:E,visibility:!0,type:R,options:{strokeWidth:2,strokeOpacity:1,fillOpacity:.3,pointRadius:5,showLabels:!1,...k},name:c}},validateLayerId:(C,R)=>R.some(k=>k.id===C),getLayerById:(C,R)=>R.find(k=>k.id===C),getVisibleLayers:C=>C.filter(R=>R.visibility),getLayersByType:(C,R)=>R.filter(k=>k.type===C),updateLayerName:(C,R)=>({id:C,updates:{name:R}}),validateColor:C=>Object.values(Zl).includes(C),getAvailableColors:C=>{const R=C.map(k=>k.color);return Object.values(Zl).filter(k=>!R.includes(k))},exportLayers:C=>JSON.stringify(C,null,2),importLayers:C=>{try{const R=JSON.parse(C);if(!Array.isArray(R))throw new Error("Invalid layer data format");return R.map(k=>({...k,createdAt:new Date(k.createdAt),updatedAt:new Date(k.updatedAt)}))}catch(R){throw new Error(`Failed to import layers: ${R instanceof Error?R.message:"Unknown error"}`)}}},sm="geohelper-layers",i_=C=>{try{const R={layers:C.layers.map(k=>({id:k.id,data:k.data,originalContent:k.originalContent,color:k.color,visibility:k.visibility,type:k.type,options:k.options,name:k.name,createdAt:k.createdAt.toISOString(),updatedAt:k.updatedAt.toISOString()})),activeLayerId:C.activeLayerId,layerCount:C.layerCount,version:1};localStorage.setItem(sm,JSON.stringify(R))}catch(R){console.error("Failed to save layers to localStorage:",R)}},n_=()=>{try{const C=localStorage.getItem(sm);if(!C)return null;const R=JSON.parse(C);return!R.version||R.version<1?null:{layers:R.layers.map(I=>({id:I.id,data:I.data,originalContent:I.originalContent,color:I.color,visibility:I.visibility,type:I.type,options:I.options,name:I.name,createdAt:new Date(I.createdAt),updatedAt:new Date(I.updatedAt)})),activeLayerId:R.activeLayerId,layerCount:R.layerCount}}catch(C){return console.error("Failed to load layers from localStorage:",C),null}},r_=()=>{try{localStorage.removeItem(sm)}catch(C){console.error("Failed to clear layers from localStorage:",C)}},a_=()=>{const C=()=>n_()||t_,[R,k]=ut.useReducer(e_,C()),[I,V]=ut.useState(!1);ut.useEffect(()=>{V(!0)},[]),ut.useEffect(()=>{I&&i_(R)},[R,I]);const q=ut.useCallback((at,Ct,Xe,Je,nt)=>{const Ye=Br.addLayer(at,Ct,Xe,Je,R.layers,nt);k({type:"ADD_LAYER",payload:Ye})},[R.layers]),E=ut.useCallback(at=>{Br.validateLayerId(at,R.layers)?k({type:"REMOVE_LAYER",payload:{id:at}}):console.warn(`Layer with id ${at} not found`)},[R.layers]),c=ut.useCallback((at,Ct)=>{Br.validateLayerId(at,R.layers)?k({type:"UPDATE_LAYER",payload:{id:at,updates:Ct}}):console.warn(`Layer with id ${at} not found`)},[R.layers]),pe=ut.useCallback(at=>{Br.validateLayerId(at,R.layers)?k({type:"TOGGLE_VISIBILITY",payload:{id:at}}):console.warn(`Layer with id ${at} not found`)},[R.layers]),se=ut.useCallback((at,Ct)=>{Br.validateLayerId(at,R.layers)?Br.validateColor(Ct)?k({type:"UPDATE_COLOR",payload:{id:at,color:Ct}}):console.warn(`Invalid color: ${Ct}`):console.warn(`Layer with id ${at} not found`)},[R.layers]),X=ut.useCallback((at,Ct)=>{Br.validateLayerId(at,R.layers)?k({type:"UPDATE_OPTIONS",payload:{id:at,options:Ct}}):console.warn(`Layer with id ${at} not found`)},[R.layers]),ce=ut.useCallback(at=>{at===null||Br.validateLayerId(at,R.layers)?k({type:"SET_ACTIVE_LAYER",payload:{id:at}}):console.warn(`Layer with id ${at} not found`)},[R.layers]),K=ut.useCallback(()=>{k({type:"CLEAR_LAYERS"}),r_()},[]),Q=ut.useCallback((at,Ct)=>{if(Br.validateLayerId(at,R.layers)){const Xe=Br.updateLayerName(at,Ct);k({type:"UPDATE_LAYER",payload:Xe})}else console.warn(`Layer with id ${at} not found`)},[R.layers]),Ie=ut.useMemo(()=>({addLayer:q,removeLayer:E,updateLayer:c,updateLayerName:Q,toggleVisibility:pe,updateColor:se,updateOptions:X,setActiveLayer:ce,clearLayers:K}),[q,E,c,Q,pe,se,X,ce,K]),Qe=ut.useMemo(()=>({visibleLayers:Br.getVisibleLayers(R.layers),activeLayer:R.activeLayerId?Br.getLayerById(R.activeLayerId,R.layers):null,availableColors:Br.getAvailableColors(R.layers),hasLayers:R.layers.length>0,layersByType:at=>Br.getLayersByType(at,R.layers)}),[R.layers,R.activeLayerId]),St=ut.useMemo(()=>({exportLayers:()=>Br.exportLayers(R.layers),importLayers:at=>{try{const Ct=Br.importLayers(at);k({type:"CLEAR_LAYERS"}),Ct.forEach(Xe=>{const{id:Je,createdAt:nt,updatedAt:Ye,...vt}=Xe;k({type:"ADD_LAYER",payload:vt})})}catch(Ct){throw console.error("Failed to import layers:",Ct),Ct}},getLayerById:at=>Br.getLayerById(at,R.layers),validateLayerId:at=>Br.validateLayerId(at,R.layers)}),[R.layers]);return{state:R,actions:Ie,computed:Qe,utils:St}},Wm=ut.createContext(void 0),s_=({children:C})=>{const R=a_();return Pt.jsx(Wm.Provider,{value:R,children:C})},Qm=()=>{const C=ut.useContext(Wm);if(C===void 0)throw new Error("useLayerContext must be used within a LayerProvider");return C};var Qp={},Am;function o_(){return Am||(Am=1,function(C){const R={};function k(X){return typeof X=="function"}function I(X){return X===Object(X)}function V(X,ce){let K=!1;return typeof ce=="string"?ce=[ce]:Object.prototype.toString.call(ce)==="[object Array]"?ce.length===0&&(K=!0):K=!0,X?ce:K}function q(X,ce){let K;if(k(R[X])){try{K=R[X](ce)}catch(Q){K=["Problem with custom definition for "+X+": "+Q]}if(typeof result=="string"&&(K=[K]),Object.prototype.toString.call(K)==="[object Array]")return K}return[]}C.define=(X,ce)=>X in se&&k(ce)?(R[X]=ce,!0):!1,C.isPosition=(X,ce=!1)=>{let K=[];return Array.isArray(X)?(X.length<=1&&K.push("Position must be at least two elements"),X.forEach((Q,Ie)=>{typeof Q!="number"&&K.push("Position must only contain numbers. Item "+Q+" at index "+Ie+" is invalid.")})):K.push("Position must be an array"),K=K.concat(q("Position",X)),V(ce,K)},C.isGeoJSONObject=C.valid=(X,ce=!1)=>{if(I(X)){let K=[];if("type"in X){if(c[X.type])return c[X.type](X,ce);if(pe[X.type])return pe[X.type](X,ce);K.push('type must be one of: "Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon", "GeometryCollection", "Feature", or "FeatureCollection"')}else K.push('must have a member with the name "type"');return K=K.concat(q("GeoJSONObject",X)),V(ce,K)}else return V(ce,["must be a JSON Object"])},C.isGeometryObject=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("type"in X){if(pe[X.type])return pe[X.type](X,ce);K.push('type must be one of: "Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon" or "GeometryCollection"')}else K.push('must have a member with the name "type"');return K=K.concat(q("GeometryObject",X)),V(ce,K)},C.isPoint=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}if("type"in X?X.type!=="Point"&&K.push('type must be "Point"'):K.push('must have a member with the name "type"'),"coordinates"in X){const Q=C.isPosition(X.coordinates,!0);Q.length&&(K=K.concat(Q))}else K.push('must have a member with the name "coordinates"');return K=K.concat(q("Point",X)),V(ce,K)},C.isMultiPointCoor=(X,ce=!1)=>{let K=[];return Array.isArray(X)?X.forEach((Q,Ie)=>{const Qe=C.isPosition(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}):K.push("coordinates must be an array"),V(ce,K)},C.isMultiPoint=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}if("type"in X?X.type!=="MultiPoint"&&K.push('type must be "MultiPoint"'):K.push('must have a member with the name "type"'),"coordinates"in X){const Q=C.isMultiPointCoor(X.coordinates,!0);Q.length&&(K=K.concat(Q))}else K.push('must have a member with the name "coordinates"');return K=K.concat(q("MultiPoint",X)),V(ce,K)},C.isLineStringCoor=(X,ce=!1)=>{let K=[];return Array.isArray(X)?X.length>1?X.forEach((Q,Ie)=>{const Qe=C.isPosition(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}):K.push("coordinates must have at least two elements"):K.push("coordinates must be an array"),V(ce,K)},C.isLineString=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}if("type"in X?X.type!=="LineString"&&K.push('type must be "LineString"'):K.push('must have a member with the name "type"'),"coordinates"in X){const Q=C.isLineStringCoor(X.coordinates,!0);Q.length&&(K=K.concat(Q))}else K.push('must have a member with the name "coordinates"');return K=K.concat(q("LineString",X)),V(ce,K)},C.isMultiLineStringCoor=(X,ce=!1)=>{let K=[];return Array.isArray(X)?X.forEach((Q,Ie)=>{const Qe=C.isLineStringCoor(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}):K.push("coordinates must be an array"),V(ce,K)},C.isMultiLineString=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}if("type"in X?X.type!=="MultiLineString"&&K.push('type must be "MultiLineString"'):K.push('must have a member with the name "type"'),"coordinates"in X){const Q=C.isMultiLineStringCoor(X.coordinates,!0);Q.length&&(K=K.concat(Q))}else K.push('must have a member with the name "coordinates"');return K=K.concat(q("MultiPoint",X)),V(ce,K)};function E(X,ce){let K=[];return Array.isArray(X)?(X.forEach((Q,Ie)=>{const Qe=C.isPosition(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}),X[0].toString()!==X[X.length-1].toString()&&K.push("The first and last positions must be equivalent"),X.length<4&&K.push("coordinates must have at least four positions")):K.push("coordinates must be an array"),V(ce,K)}C.isPolygonCoor=(X,ce=!1)=>{let K=[];return Array.isArray(X)?X.forEach((Q,Ie)=>{const Qe=E(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}):K.push("coordinates must be an array"),V(ce,K)},C.isPolygon=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}if("type"in X?X.type!=="Polygon"&&K.push('type must be "Polygon"'):K.push('must have a member with the name "type"'),"coordinates"in X){const Q=C.isPolygonCoor(X.coordinates,!0);Q.length&&(K=K.concat(Q))}else K.push('must have a member with the name "coordinates"');return K=K.concat(q("Polygon",X)),V(ce,K)},C.isMultiPolygonCoor=(X,ce=!1)=>{let K=[];return Array.isArray(X)?X.forEach((Q,Ie)=>{const Qe=C.isPolygonCoor(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}):K.push("coordinates must be an array"),V(ce,K)},C.isMultiPolygon=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}if("type"in X?X.type!=="MultiPolygon"&&K.push('type must be "MultiPolygon"'):K.push('must have a member with the name "type"'),"coordinates"in X){const Q=C.isMultiPolygonCoor(X.coordinates,!0);Q.length&&(K=K.concat(Q))}else K.push('must have a member with the name "coordinates"');return K=K.concat(q("MultiPolygon",X)),V(ce,K)},C.isGeometryCollection=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}return"type"in X?X.type!=="GeometryCollection"&&K.push('type must be "GeometryCollection"'):K.push('must have a member with the name "type"'),"geometries"in X?Array.isArray(X.geometries)?X.geometries.forEach((Q,Ie)=>{const Qe=C.isGeometryObject(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}):K.push('"geometries" must be an array'):K.push('must have a member with the name "geometries"'),K=K.concat(q("GeometryCollection",X)),V(ce,K)},C.isFeature=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=K.concat(Q))}if("type"in X?X.type!=="Feature"&&K.push('type must be "Feature"'):K.push('must have a member with the name "type"'),"properties"in X||K.push('must have a member with the name "properties"'),"geometry"in X){if(X.geometry!==null){const Q=C.isGeometryObject(X.geometry,!0);Q.length&&(K=K.concat(Q))}}else K.push('must have a member with the name "geometry"');return K=K.concat(q("Feature",X)),V(ce,K)},C.isFeatureCollection=(X,ce=!1)=>{if(!I(X))return V(ce,["must be a JSON Object"]);let K=[];if("bbox"in X){const Q=C.isBbox(X.bbox,!0);Q.length&&(K=Q)}return"type"in X?X.type!=="FeatureCollection"&&K.push('type must be "FeatureCollection"'):K.push('must have a member with the name "type"'),"features"in X?Array.isArray(X.features)?X.features.forEach((Q,Ie)=>{const Qe=C.isFeature(Q,!0);Qe.length&&(Qe[0]="at "+Ie+": ".concat(Qe[0]),K=K.concat(Qe))}):K.push('"Features" must be an array'):K.push('must have a member with the name "Features"'),K=K.concat(q("FeatureCollection",X)),V(ce,K)},C.isBbox=(X,ce=!1)=>{let K=[];return Array.isArray(X)?X.length%2!==0&&K.push("bbox, must be a 2*n array"):K.push("bbox must be an array"),K=K.concat(q("Bbox",X)),V(ce,K)};const c={Feature:C.isFeature,FeatureCollection:C.isFeatureCollection},pe={Point:C.isPoint,MultiPoint:C.isMultiPoint,LineString:C.isLineString,MultiLineString:C.isMultiLineString,Polygon:C.isPolygon,MultiPolygon:C.isMultiPolygon,GeometryCollection:C.isGeometryCollection},se={Feature:C.isFeature,FeatureCollection:C.isFeatureCollection,Point:C.isPoint,MultiPoint:C.isMultiPoint,LineString:C.isLineString,MultiLineString:C.isMultiLineString,Polygon:C.isPolygon,MultiPolygon:C.isMultiPolygon,GeometryCollection:C.isGeometryCollection,Bbox:C.isBbox,Position:C.isPosition,GeoJSON:C.isGeoJSONObject,GeometryObject:C.isGeometryObject};C.allTypes=se}(Qp)),Qp}var l_=o_();function Pu(C,R,k={}){const I={type:"Feature"};return(k.id===0||k.id)&&(I.id=k.id),k.bbox&&(I.bbox=k.bbox),I.properties=R||{},I.geometry=C,I}function Jm(C,R,k={}){if(!C)throw new Error("coordinates is required");if(!Array.isArray(C))throw new Error("coordinates must be an Array");if(C.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pm(C[0])||!Pm(C[1]))throw new Error("coordinates must contain numbers");return Pu({type:"Point",coordinates:C},R,k)}function Pf(C,R,k={}){for(const V of C){if(V.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(V[V.length-1].length!==V[0].length)throw new Error("First and last Position are not equivalent.");for(let q=0;q<V[V.length-1].length;q++)if(V[V.length-1][q]!==V[0][q])throw new Error("First and last Position are not equivalent.")}return Pu({type:"Polygon",coordinates:C},R,k)}function om(C,R,k={}){if(C.length<2)throw new Error("coordinates must be an array of two or more positions");return Pu({type:"LineString",coordinates:C},R,k)}function nm(C,R={}){const k={type:"FeatureCollection"};return R.id&&(k.id=R.id),R.bbox&&(k.bbox=R.bbox),k.features=C,k}function c_(C,R,k={}){return Pu({type:"MultiLineString",coordinates:C},R,k)}function Pm(C){return!isNaN(C)&&C!==null&&!Array.isArray(C)}function eg(C){if(!C)throw new Error("coord is required");if(!Array.isArray(C)){if(C.type==="Feature"&&C.geometry!==null&&C.geometry.type==="Point")return[...C.geometry.coordinates];if(C.type==="Point")return[...C.coordinates]}if(Array.isArray(C)&&C.length>=2&&!Array.isArray(C[0])&&!Array.isArray(C[1]))return[...C];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function u_(C){if(Array.isArray(C))return C;if(C.type==="Feature"){if(C.geometry!==null)return C.geometry.coordinates}else if(C.coordinates)return C.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Dh(C){return C.type==="Feature"?C.geometry:C}const Lc=11102230246251565e-32,va=134217729,h_=(3+8*Lc)*Lc;function Jp(C,R,k,I,V){let q,E,c,pe,se=R[0],X=I[0],ce=0,K=0;X>se==X>-se?(q=se,se=R[++ce]):(q=X,X=I[++K]);let Q=0;if(ce<C&&K<k)for(X>se==X>-se?(E=se+q,c=q-(E-se),se=R[++ce]):(E=X+q,c=q-(E-X),X=I[++K]),q=E,c!==0&&(V[Q++]=c);ce<C&&K<k;)X>se==X>-se?(E=q+se,pe=E-q,c=q-(E-pe)+(se-pe),se=R[++ce]):(E=q+X,pe=E-q,c=q-(E-pe)+(X-pe),X=I[++K]),q=E,c!==0&&(V[Q++]=c);for(;ce<C;)E=q+se,pe=E-q,c=q-(E-pe)+(se-pe),se=R[++ce],q=E,c!==0&&(V[Q++]=c);for(;K<k;)E=q+X,pe=E-q,c=q-(E-pe)+(X-pe),X=I[++K],q=E,c!==0&&(V[Q++]=c);return(q!==0||Q===0)&&(V[Q++]=q),Q}function f_(C,R){let k=R[0];for(let I=1;I<C;I++)k+=R[I];return k}function Hd(C){return new Float64Array(C)}const d_=(3+16*Lc)*Lc,p_=(2+12*Lc)*Lc,m_=(9+64*Lc)*Lc*Lc,Af=Hd(4),zm=Hd(8),Rm=Hd(12),Im=Hd(16),ja=Hd(4);function g_(C,R,k,I,V,q,E){let c,pe,se,X,ce,K,Q,Ie,Qe,St,at,Ct,Xe,Je,nt,Ye,vt,Nt;const Jt=C-V,Lt=k-V,_i=R-q,ni=I-q;Je=Jt*ni,K=va*Jt,Q=K-(K-Jt),Ie=Jt-Q,K=va*ni,Qe=K-(K-ni),St=ni-Qe,nt=Ie*St-(Je-Q*Qe-Ie*Qe-Q*St),Ye=_i*Lt,K=va*_i,Q=K-(K-_i),Ie=_i-Q,K=va*Lt,Qe=K-(K-Lt),St=Lt-Qe,vt=Ie*St-(Ye-Q*Qe-Ie*Qe-Q*St),at=nt-vt,ce=nt-at,Af[0]=nt-(at+ce)+(ce-vt),Ct=Je+at,ce=Ct-Je,Xe=Je-(Ct-ce)+(at-ce),at=Xe-Ye,ce=Xe-at,Af[1]=Xe-(at+ce)+(ce-Ye),Nt=Ct+at,ce=Nt-Ct,Af[2]=Ct-(Nt-ce)+(at-ce),Af[3]=Nt;let Ci=f_(4,Af),Tn=p_*E;if(Ci>=Tn||-Ci>=Tn||(ce=C-Jt,c=C-(Jt+ce)+(ce-V),ce=k-Lt,se=k-(Lt+ce)+(ce-V),ce=R-_i,pe=R-(_i+ce)+(ce-q),ce=I-ni,X=I-(ni+ce)+(ce-q),c===0&&pe===0&&se===0&&X===0)||(Tn=m_*E+h_*Math.abs(Ci),Ci+=Jt*X+ni*c-(_i*se+Lt*pe),Ci>=Tn||-Ci>=Tn))return Ci;Je=c*ni,K=va*c,Q=K-(K-c),Ie=c-Q,K=va*ni,Qe=K-(K-ni),St=ni-Qe,nt=Ie*St-(Je-Q*Qe-Ie*Qe-Q*St),Ye=pe*Lt,K=va*pe,Q=K-(K-pe),Ie=pe-Q,K=va*Lt,Qe=K-(K-Lt),St=Lt-Qe,vt=Ie*St-(Ye-Q*Qe-Ie*Qe-Q*St),at=nt-vt,ce=nt-at,ja[0]=nt-(at+ce)+(ce-vt),Ct=Je+at,ce=Ct-Je,Xe=Je-(Ct-ce)+(at-ce),at=Xe-Ye,ce=Xe-at,ja[1]=Xe-(at+ce)+(ce-Ye),Nt=Ct+at,ce=Nt-Ct,ja[2]=Ct-(Nt-ce)+(at-ce),ja[3]=Nt;const ki=Jp(4,Af,4,ja,zm);Je=Jt*X,K=va*Jt,Q=K-(K-Jt),Ie=Jt-Q,K=va*X,Qe=K-(K-X),St=X-Qe,nt=Ie*St-(Je-Q*Qe-Ie*Qe-Q*St),Ye=_i*se,K=va*_i,Q=K-(K-_i),Ie=_i-Q,K=va*se,Qe=K-(K-se),St=se-Qe,vt=Ie*St-(Ye-Q*Qe-Ie*Qe-Q*St),at=nt-vt,ce=nt-at,ja[0]=nt-(at+ce)+(ce-vt),Ct=Je+at,ce=Ct-Je,Xe=Je-(Ct-ce)+(at-ce),at=Xe-Ye,ce=Xe-at,ja[1]=Xe-(at+ce)+(ce-Ye),Nt=Ct+at,ce=Nt-Ct,ja[2]=Ct-(Nt-ce)+(at-ce),ja[3]=Nt;const We=Jp(ki,zm,4,ja,Rm);Je=c*X,K=va*c,Q=K-(K-c),Ie=c-Q,K=va*X,Qe=K-(K-X),St=X-Qe,nt=Ie*St-(Je-Q*Qe-Ie*Qe-Q*St),Ye=pe*se,K=va*pe,Q=K-(K-pe),Ie=pe-Q,K=va*se,Qe=K-(K-se),St=se-Qe,vt=Ie*St-(Ye-Q*Qe-Ie*Qe-Q*St),at=nt-vt,ce=nt-at,ja[0]=nt-(at+ce)+(ce-vt),Ct=Je+at,ce=Ct-Je,Xe=Je-(Ct-ce)+(at-ce),at=Xe-Ye,ce=Xe-at,ja[1]=Xe-(at+ce)+(ce-Ye),Nt=Ct+at,ce=Nt-Ct,ja[2]=Ct-(Nt-ce)+(at-ce),ja[3]=Nt;const je=Jp(We,Rm,4,ja,Im);return Im[je-1]}function __(C,R,k,I,V,q){const E=(R-q)*(k-V),c=(C-V)*(I-q),pe=E-c,se=Math.abs(E+c);return Math.abs(pe)>=d_*se?pe:-g_(C,R,k,I,V,q,se)}function y_(C,R){var k,I,V=0,q,E,c,pe,se,X,ce,K=C[0],Q=C[1],Ie=R.length;for(k=0;k<Ie;k++){I=0;var Qe=R[k],St=Qe.length-1;if(X=Qe[0],X[0]!==Qe[St][0]&&X[1]!==Qe[St][1])throw new Error("First and last coordinates in a ring must be the same");for(E=X[0]-K,c=X[1]-Q,I;I<St;I++){if(ce=Qe[I+1],pe=ce[0]-K,se=ce[1]-Q,c===0&&se===0){if(pe<=0&&E>=0||E<=0&&pe>=0)return 0}else if(se>=0&&c<=0||se<=0&&c>=0){if(q=__(E,pe,c,se,0,0),q===0)return 0;(q>0&&se>0&&c<=0||q<0&&se<=0&&c>0)&&V++}X=ce,c=se,E=pe}}return V%2!==0}function Rf(C,R,k={}){if(!C)throw new Error("point is required");if(!R)throw new Error("polygon is required");const I=eg(C),V=Dh(R),q=V.type,E=R.bbox;let c=V.coordinates;if(E&&v_(I,E)===!1)return!1;q==="Polygon"&&(c=[c]);let pe=!1;for(var se=0;se<c.length;++se){const X=y_(I,c[se]);if(X===0)return!k.ignoreBoundary;X&&(pe=!0)}return pe}function v_(C,R){return R[0]<=C[0]&&R[1]<=C[1]&&R[2]>=C[0]&&R[3]>=C[1]}class tg{constructor(R=[],k=x_){if(this.data=R,this.length=this.data.length,this.compare=k,this.length>0)for(let I=(this.length>>1)-1;I>=0;I--)this._down(I)}push(R){this.data.push(R),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const R=this.data[0],k=this.data.pop();return this.length--,this.length>0&&(this.data[0]=k,this._down(0)),R}peek(){return this.data[0]}_up(R){const{data:k,compare:I}=this,V=k[R];for(;R>0;){const q=R-1>>1,E=k[q];if(I(V,E)>=0)break;k[R]=E,R=q}k[R]=V}_down(R){const{data:k,compare:I}=this,V=this.length>>1,q=k[R];for(;R<V;){let E=(R<<1)+1,c=k[E];const pe=E+1;if(pe<this.length&&I(k[pe],c)<0&&(E=pe,c=k[pe]),I(c,q)>=0)break;k[R]=c,R=E}k[R]=q}}function x_(C,R){return C<R?-1:C>R?1:0}function ig(C,R){return C.p.x>R.p.x?1:C.p.x<R.p.x?-1:C.p.y!==R.p.y?C.p.y>R.p.y?1:-1:1}function b_(C,R){return C.rightSweepEvent.p.x>R.rightSweepEvent.p.x?1:C.rightSweepEvent.p.x<R.rightSweepEvent.p.x?-1:C.rightSweepEvent.p.y!==R.rightSweepEvent.p.y?C.rightSweepEvent.p.y<R.rightSweepEvent.p.y?1:-1:1}let Dm=class{constructor(R,k,I,V){this.p={x:R[0],y:R[1]},this.featureId=k,this.ringId=I,this.eventId=V,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(R){return this.p.x===R.p.x&&this.p.y===R.p.y}};function w_(C,R){if(C.type==="FeatureCollection"){const k=C.features;for(let I=0;I<k.length;I++)Lm(k[I],R)}else Lm(C,R)}let Ap=0,Pp=0,zp=0;function Lm(C,R){const k=C.type==="Feature"?C.geometry:C;let I=k.coordinates;(k.type==="Polygon"||k.type==="MultiLineString")&&(I=[I]),k.type==="LineString"&&(I=[[I]]);for(let V=0;V<I.length;V++)for(let q=0;q<I[V].length;q++){let E=I[V][q][0],c=null;Pp=Pp+1;for(let pe=0;pe<I[V][q].length-1;pe++){c=I[V][q][pe+1];const se=new Dm(E,Ap,Pp,zp),X=new Dm(c,Ap,Pp,zp+1);se.otherEvent=X,X.otherEvent=se,ig(se,X)>0?(X.isLeftEndpoint=!0,se.isLeftEndpoint=!1):(se.isLeftEndpoint=!0,X.isLeftEndpoint=!1),R.push(se),R.push(X),E=c,zp=zp+1}}Ap=Ap+1}class T_{constructor(R){this.leftSweepEvent=R,this.rightSweepEvent=R.otherEvent}}function S_(C,R){if(C===null||R===null||C.leftSweepEvent.ringId===R.leftSweepEvent.ringId&&(C.rightSweepEvent.isSamePoint(R.leftSweepEvent)||C.rightSweepEvent.isSamePoint(R.leftSweepEvent)||C.rightSweepEvent.isSamePoint(R.rightSweepEvent)||C.leftSweepEvent.isSamePoint(R.leftSweepEvent)||C.leftSweepEvent.isSamePoint(R.rightSweepEvent)))return!1;const k=C.leftSweepEvent.p.x,I=C.leftSweepEvent.p.y,V=C.rightSweepEvent.p.x,q=C.rightSweepEvent.p.y,E=R.leftSweepEvent.p.x,c=R.leftSweepEvent.p.y,pe=R.rightSweepEvent.p.x,se=R.rightSweepEvent.p.y,X=(se-c)*(V-k)-(pe-E)*(q-I),ce=(pe-E)*(I-c)-(se-c)*(k-E),K=(V-k)*(I-c)-(q-I)*(k-E);if(X===0)return!1;const Q=ce/X,Ie=K/X;if(Q>=0&&Q<=1&&Ie>=0&&Ie<=1){const Qe=k+Q*(V-k),St=I+Q*(q-I);return[Qe,St]}return!1}function M_(C,R){R=R||!1;const k=[],I=new tg([],b_);for(;C.length;){const V=C.pop();if(V.isLeftEndpoint){const q=new T_(V);for(let E=0;E<I.data.length;E++){const c=I.data[E];if(R&&c.leftSweepEvent.featureId===V.featureId)continue;const pe=S_(q,c);pe!==!1&&k.push(pe)}I.push(q)}else V.isLeftEndpoint===!1&&I.pop()}return k}function E_(C,R){const k=new tg([],ig);return w_(C,k),M_(k,R)}var C_=E_;function Lh(C,R,k={}){const{removeDuplicates:I=!0,ignoreSelfIntersections:V=!0}=k;let q=[];C.type==="FeatureCollection"?q=q.concat(C.features):C.type==="Feature"?q.push(C):(C.type==="LineString"||C.type==="Polygon"||C.type==="MultiLineString"||C.type==="MultiPolygon")&&q.push(Pu(C)),R.type==="FeatureCollection"?q=q.concat(R.features):R.type==="Feature"?q.push(R):(R.type==="LineString"||R.type==="Polygon"||R.type==="MultiLineString"||R.type==="MultiPolygon")&&q.push(Pu(R));const E=C_(nm(q),V);let c=[];if(I){const pe={};E.forEach(se=>{const X=se.join(",");pe[X]||(pe[X]=!0,c.push(se))})}else c=E;return nm(c.map(pe=>Jm(pe)))}function ng(C,R,k){if(C!==null)for(var I,V,q,E,c,pe,se,X=0,ce=0,K,Q=C.type,Ie=Q==="FeatureCollection",Qe=Q==="Feature",St=Ie?C.features.length:1,at=0;at<St;at++){se=Ie?C.features[at].geometry:Qe?C.geometry:C,K=se?se.type==="GeometryCollection":!1,c=K?se.geometries.length:1;for(var Ct=0;Ct<c;Ct++){var Xe=0,Je=0;if(E=K?se.geometries[Ct]:se,E!==null){pe=E.coordinates;var nt=E.type;switch(X=0,nt){case null:break;case"Point":if(R(pe,ce,at,Xe,Je)===!1)return!1;ce++,Xe++;break;case"LineString":case"MultiPoint":for(I=0;I<pe.length;I++){if(R(pe[I],ce,at,Xe,Je)===!1)return!1;ce++,nt==="MultiPoint"&&Xe++}nt==="LineString"&&Xe++;break;case"Polygon":case"MultiLineString":for(I=0;I<pe.length;I++){for(V=0;V<pe[I].length-X;V++){if(R(pe[I][V],ce,at,Xe,Je)===!1)return!1;ce++}nt==="MultiLineString"&&Xe++,nt==="Polygon"&&Je++}nt==="Polygon"&&Xe++;break;case"MultiPolygon":for(I=0;I<pe.length;I++){for(Je=0,V=0;V<pe[I].length;V++){for(q=0;q<pe[I][V].length-X;q++){if(R(pe[I][V][q],ce,at,Xe,Je)===!1)return!1;ce++}Je++}Xe++}break;case"GeometryCollection":for(I=0;I<E.geometries.length;I++)if(ng(E.geometries[I],R)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function A_(C,R){var k,I,V,q,E,c,pe,se,X,ce,K=0,Q=C.type==="FeatureCollection",Ie=C.type==="Feature",Qe=Q?C.features.length:1;for(k=0;k<Qe;k++){for(c=Q?C.features[k].geometry:Ie?C.geometry:C,se=Q?C.features[k].properties:Ie?C.properties:{},X=Q?C.features[k].bbox:Ie?C.bbox:void 0,ce=Q?C.features[k].id:Ie?C.id:void 0,pe=c?c.type==="GeometryCollection":!1,E=pe?c.geometries.length:1,V=0;V<E;V++){if(q=pe?c.geometries[V]:c,q===null){if(R(null,K,se,X,ce)===!1)return!1;continue}switch(q.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(R(q,K,se,X,ce)===!1)return!1;break}case"GeometryCollection":{for(I=0;I<q.geometries.length;I++)if(R(q.geometries[I],K,se,X,ce)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}K++}}function km(C,R){A_(C,function(k,I,V,q,E){var c=k===null?null:k.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return R(Pu(k,V,{bbox:q,id:E}),I,0)===!1?!1:void 0}var pe;switch(c){case"MultiPoint":pe="Point";break;case"MultiLineString":pe="LineString";break;case"MultiPolygon":pe="Polygon";break}for(var se=0;se<k.coordinates.length;se++){var X=k.coordinates[se],ce={type:pe,coordinates:X};if(R(Pu(ce,V),I,se)===!1)return!1}})}function Dp(C,R={}){const k=Dh(C);switch(!R.properties&&C.type==="Feature"&&(R.properties=C.properties),k.type){case"Polygon":return P_(k,R);case"MultiPolygon":return z_(k,R);default:throw new Error("invalid poly")}}function P_(C,R={}){const I=Dh(C).coordinates,V=R.properties?R.properties:C.type==="Feature"?C.properties:{};return rg(I,V)}function z_(C,R={}){const I=Dh(C).coordinates,V=R.properties?R.properties:C.type==="Feature"?C.properties:{},q=[];return I.forEach(E=>{q.push(rg(E,V))}),nm(q)}function rg(C,R){return C.length>1?c_(C,R):om(C[0],R)}function R_(C,R,{ignoreSelfIntersections:k=!0}={ignoreSelfIntersections:!0}){let I=!0;return km(C,V=>{km(R,q=>{if(I===!1)return!1;I=I_(V.geometry,q.geometry,k)})}),I}function I_(C,R,k){switch(C.type){case"Point":switch(R.type){case"Point":return!O_(C.coordinates,R.coordinates);case"LineString":return!Om(R,C);case"Polygon":return!Rf(C,R)}break;case"LineString":switch(R.type){case"Point":return!Om(C,R);case"LineString":return!D_(C,R,k);case"Polygon":return!Bm(R,C,k)}break;case"Polygon":switch(R.type){case"Point":return!Rf(R,C);case"LineString":return!Bm(C,R,k);case"Polygon":return!L_(R,C,k)}}return!1}function Om(C,R){for(let k=0;k<C.coordinates.length-1;k++)if(k_(C.coordinates[k],C.coordinates[k+1],R.coordinates))return!0;return!1}function D_(C,R,k){return Lh(C,R,{ignoreSelfIntersections:k}).features.length>0}function Bm(C,R,k){for(const V of R.coordinates)if(Rf(V,C))return!0;return Lh(R,Dp(C),{ignoreSelfIntersections:k}).features.length>0}function L_(C,R,k){for(const V of C.coordinates[0])if(Rf(V,R))return!0;for(const V of R.coordinates[0])if(Rf(V,C))return!0;return Lh(Dp(C),Dp(R),{ignoreSelfIntersections:k}).features.length>0}function k_(C,R,k){const I=k[0]-C[0],V=k[1]-C[1],q=R[0]-C[0],E=R[1]-C[1];return I*E-V*q!==0?!1:Math.abs(q)>=Math.abs(E)?q>0?C[0]<=k[0]&&k[0]<=R[0]:R[0]<=k[0]&&k[0]<=C[0]:E>0?C[1]<=k[1]&&k[1]<=R[1]:R[1]<=k[1]&&k[1]<=C[1]}function O_(C,R){return C[0]===R[0]&&C[1]===R[1]}function B_(C,R){var k=Dh(C),I=Dh(R),V=k.type,q=I.type;switch(V){case"MultiPoint":switch(q){case"LineString":return Nm(k,I);case"Polygon":return jm(k,I);default:throw new Error("feature2 "+q+" geometry not supported")}case"LineString":switch(q){case"MultiPoint":return Nm(I,k);case"LineString":return N_(k,I);case"Polygon":return Fm(k,I);default:throw new Error("feature2 "+q+" geometry not supported")}case"Polygon":switch(q){case"MultiPoint":return jm(I,k);case"LineString":return Fm(I,k);default:throw new Error("feature2 "+q+" geometry not supported")}default:throw new Error("feature1 "+V+" geometry not supported")}}function Nm(C,R){for(var k=!1,I=!1,V=C.coordinates.length,q=0;q<V&&!k&&!I;){for(var E=0;E<R.coordinates.length-1;E++){var c=!0;(E===0||E===R.coordinates.length-2)&&(c=!1),ag(R.coordinates[E],R.coordinates[E+1],C.coordinates[q],c)?k=!0:I=!0}q++}return k&&I}function N_(C,R){var k=Lh(C,R);if(k.features.length>0)for(var I=0;I<C.coordinates.length-1;I++)for(var V=0;V<R.coordinates.length-1;V++){var q=!0;if((V===0||V===R.coordinates.length-2)&&(q=!1),ag(C.coordinates[I],C.coordinates[I+1],R.coordinates[V],q))return!0}return!1}function Fm(C,R){const k=Dp(R);return Lh(C,k).features.length>0}function jm(C,R){var k=!1,I=!1,V=C.coordinates.length;for(let q=0;q<V&&(!k||!I);q++)Rf(Jm(C.coordinates[q]),R)?k=!0:I=!0;return I&&k}function ag(C,R,k,I){var V=k[0]-C[0],q=k[1]-C[1],E=R[0]-C[0],c=R[1]-C[1],pe=V*c-q*E;return pe!==0?!1:I?Math.abs(E)>=Math.abs(c)?E>0?C[0]<=k[0]&&k[0]<=R[0]:R[0]<=k[0]&&k[0]<=C[0]:c>0?C[1]<=k[1]&&k[1]<=R[1]:R[1]<=k[1]&&k[1]<=C[1]:Math.abs(E)>=Math.abs(c)?E>0?C[0]<k[0]&&k[0]<R[0]:R[0]<k[0]&&k[0]<C[0]:c>0?C[1]<k[1]&&k[1]<R[1]:R[1]<k[1]&&k[1]<C[1]}function F_(C,R,k={}){const I=eg(C),V=u_(R);for(let q=0;q<V.length-1;q++){let E=!1;if(k.ignoreEndVertices&&(q===0&&(E="start"),q===V.length-2&&(E="end"),q===0&&q+1===V.length-1&&(E="both")),j_(V[q],V[q+1],I,E,typeof k.epsilon>"u"?null:k.epsilon))return!0}return!1}function j_(C,R,k,I,V){const q=k[0],E=k[1],c=C[0],pe=C[1],se=R[0],X=R[1],ce=k[0]-c,K=k[1]-pe,Q=se-c,Ie=X-pe,Qe=ce*Ie-K*Q;if(V!==null){if(Math.abs(Qe)>V)return!1}else if(Qe!==0)return!1;if(Math.abs(Q)===Math.abs(Ie)&&Math.abs(Q)===0)return I?!1:k[0]===C[0]&&k[1]===C[1];if(I){if(I==="start")return Math.abs(Q)>=Math.abs(Ie)?Q>0?c<q&&q<=se:se<=q&&q<c:Ie>0?pe<E&&E<=X:X<=E&&E<pe;if(I==="end")return Math.abs(Q)>=Math.abs(Ie)?Q>0?c<=q&&q<se:se<q&&q<=c:Ie>0?pe<=E&&E<X:X<E&&E<=pe;if(I==="both")return Math.abs(Q)>=Math.abs(Ie)?Q>0?c<q&&q<se:se<q&&q<c:Ie>0?pe<E&&E<X:X<E&&E<pe}else return Math.abs(Q)>=Math.abs(Ie)?Q>0?c<=q&&q<=se:se<=q&&q<=c:Ie>0?pe<=E&&E<=X:X<=E&&E<=pe;return!1}function $d(C){if(!C.type)return!1;const R=Dh(C),k=R.type,I=R.coordinates;switch(k){case"Point":return I.length>1;case"MultiPoint":for(var V=0;V<I.length;V++)if(I[V].length<2)return!1;return!0;case"LineString":if(I.length<2)return!1;for(var V=0;V<I.length;V++)if(I[V].length<2)return!1;return!0;case"MultiLineString":if(I.length<2)return!1;for(var V=0;V<I.length;V++)if(I[V].length<2)return!1;return!0;case"Polygon":for(var V=0;V<R.coordinates.length;V++)if(I[V].length<4||!Um(I[V])||Vm(I[V])||V>0&&Lh(Pf([I[0]]),Pf([I[V]])).features.length>1)return!1;return!0;case"MultiPolygon":for(var V=0;V<R.coordinates.length;V++)for(var q=R.coordinates[V],E=0;E<q.length;E++)if(q[E].length<4||!Um(q[E])||Vm(q[E])||E===0&&!U_(q,R.coordinates,V)||E>0&&Lh(Pf([q[0]]),Pf([q[E]])).features.length>1)return!1;return!0;default:return!1}}function Um(C){return C[0][0]===C[C.length-1][0]&&C[0][1]===C[C.length-1][1]}function Vm(C){for(var R=0;R<C.length-1;R++)for(var k=C[R],I=R+1;I<C.length-2;I++){var V=[C[I],C[I+1]];if(F_(k,om(V)))return!0}return!1}function U_(C,R,k){for(var I=Pf(C),V=k+1;V<R.length;V++)if(!R_(I,Pf(R[V]))&&B_(I,om(R[V][0])))return!1;return!0}var em={exports:{}},Gm;function V_(){return Gm||(Gm=1,function(C){var R={};function k(q){return Math.floor(Math.abs(q)+.5)*(q>=0?1:-1)}function I(q,E,c){q=k(q*c),E=k(E*c);var pe=(q-E)*2;pe<0&&(pe=-pe-1);for(var se="";pe>=32;)se+=String.fromCharCode((32|pe&31)+63),pe/=32;return se+=String.fromCharCode((pe|0)+63),se}R.decode=function(q,E){for(var c=0,pe=0,se=0,X=[],ce=0,K=0,Q=null,Ie,Qe,St=Math.pow(10,Number.isInteger(E)?E:5);c<q.length;){Q=null,ce=1,K=0;do Q=q.charCodeAt(c++)-63,K+=(Q&31)*ce,ce*=32;while(Q>=32);Ie=K&1?(-K-1)/2:K/2,ce=1,K=0;do Q=q.charCodeAt(c++)-63,K+=(Q&31)*ce,ce*=32;while(Q>=32);Qe=K&1?(-K-1)/2:K/2,pe+=Ie,se+=Qe,X.push([pe/St,se/St])}return X},R.encode=function(q,E){if(!q.length)return"";for(var c=Math.pow(10,Number.isInteger(E)?E:5),pe=I(q[0][0],0,c)+I(q[0][1],0,c),se=1;se<q.length;se++){var X=q[se],ce=q[se-1];pe+=I(X[0],ce[0],c),pe+=I(X[1],ce[1],c)}return pe};function V(q){for(var E=[],c=0;c<q.length;c++){var pe=q[c].slice();E.push([pe[1],pe[0]])}return E}R.fromGeoJSON=function(q,E){if(q&&q.type==="Feature"&&(q=q.geometry),!q||q.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return R.encode(V(q.coordinates),E)},R.toGeoJSON=function(q,E){var c=R.decode(q,E);return{type:"LineString",coordinates:V(c)}},C.exports&&(C.exports=R)}(em)),em.exports}var G_=V_(),tm,Zm;function Z_(){if(Zm)return tm;Zm=1;let C=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,R=new RegExp("^"+C.source+"(\\s"+C.source+"){1,}");const k=V=>{let q=V.split(";"),E=q.pop(),c=(q.shift()||"").split("=").pop(),pe=0;function se(Ye){let vt=E.substring(pe).match(Ye);return vt?(pe+=vt[0].length,vt[0]):null}function X(Ye){return Ye&&c.match(/\d+/)&&(Ye.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+c}}),Ye}function ce(){se(/^\s*/)}function K(){ce();let Ye=0,vt=[],Nt=[vt],Jt=vt,Lt;for(;Lt=se(/^(\()/)||se(/^(\))/)||se(/^(,)/)||se(R);){if(Lt==="(")Nt.push(Jt),Jt=[],Nt[Nt.length-1].push(Jt),Ye++;else if(Lt===")"){if(Jt.length===0||(Jt=Nt.pop(),!Jt))return null;if(Ye--,Ye===0)break}else if(Lt===",")Jt=[],Nt[Nt.length-1].push(Jt);else if(!Lt.split(/\s/g).some(isNaN))Array.prototype.push.apply(Jt,Lt.split(/\s/g).map(parseFloat));else return null;ce()}return Ye!==0?null:vt}function Q(){let Ye=[],vt,Nt;for(;Nt=se(R)||se(/^(,)/);)Nt===","?(Ye.push(vt),vt=[]):Nt.split(/\s/g).some(isNaN)||(vt||(vt=[]),Array.prototype.push.apply(vt,Nt.split(/\s/g).map(parseFloat))),ce();if(vt)Ye.push(vt);else return null;return Ye.length?Ye:null}function Ie(){if(!se(/^(point(\sz)?)/i)||(ce(),!se(/^(\()/)))return null;let Ye=Q();return!Ye||(ce(),!se(/^(\))/))?null:{type:"Point",coordinates:Ye[0]}}function Qe(){if(!se(/^(multipoint(\sz)?)/i))return null;ce(),E="MULTIPOINT ("+E.substring(E.indexOf("(")+1,E.length-1).replace(/\(/g,"").replace(/\)/g,"")+")";let vt=K();return vt?(ce(),{type:"MultiPoint",coordinates:vt}):null}function St(){if(!se(/^(multilinestring(\sz)?)/i))return null;ce();let Ye=K();return Ye?(ce(),{type:"MultiLineString",coordinates:Ye}):null}function at(){if(!se(/^(linestring(\sz)?)/i)||(ce(),!se(/^(\()/)))return null;let Ye=Q();return!Ye||!se(/^(\))/)?null:{type:"LineString",coordinates:Ye}}function Ct(){if(!se(/^(polygon(\sz)?)/i))return null;ce();let Ye=K();return Ye?{type:"Polygon",coordinates:Ye}:null}function Xe(){if(!se(/^(multipolygon(\sz)?)/i))return null;ce();let Ye=K();return Ye?{type:"MultiPolygon",coordinates:Ye}:null}function Je(){let Ye=[],vt;if(!se(/^(geometrycollection)/i)||(ce(),!se(/^(\()/)))return null;for(;vt=nt();)Ye.push(vt),ce(),se(/^(,)/),ce();return se(/^(\))/)?{type:"GeometryCollection",geometries:Ye}:null}function nt(){return Ie()||at()||Ct()||Qe()||St()||Xe()||Je()}return X(nt())},I=V=>{V.type==="Feature"&&(V=V.geometry);function q(ce){return ce.join(" ")}function E(ce){return ce.map(q).join(", ")}function c(ce){return ce.map(E).map(se).join(", ")}function pe(ce){return ce.map(c).map(se).join(", ")}function se(ce){return"("+ce+")"}let X=V;switch(X.type){case"Point":return X.coordinates&&X.coordinates.length===3?"POINT Z ("+q(X.coordinates)+")":"POINT ("+q(X.coordinates)+")";case"LineString":return X.coordinates&&X.coordinates[0]&&X.coordinates[0].length===3?"LINESTRING Z ("+E(X.coordinates)+")":"LINESTRING ("+E(X.coordinates)+")";case"Polygon":return X.coordinates&&X.coordinates[0]&&X.coordinates[0][0]&&X.coordinates[0][0].length===3?"POLYGON Z ("+c(X.coordinates)+")":"POLYGON ("+c(X.coordinates)+")";case"MultiPoint":return X.coordinates&&X.coordinates[0]&&X.coordinates[0].length===3?"MULTIPOINT Z ("+E(X.coordinates)+")":"MULTIPOINT ("+E(X.coordinates)+")";case"MultiLineString":return X.coordinates&&X.coordinates[0]&&X.coordinates[0][0]&&X.coordinates[0][0].length===3?"MULTILINESTRING Z ("+c(X.coordinates)+")":"MULTILINESTRING ("+c(X.coordinates)+")";case"MultiPolygon":return X.coordinates&&X.coordinates[0]&&X.coordinates[0][0]&&X.coordinates[0][0]&&X.coordinates[0][0][0].length===3?"MULTIPOLYGON Z ("+pe(X.coordinates)+")":"MULTIPOLYGON ("+pe(X.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+X.geometries.map(I).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}};return tm={parse:k,stringify:I},tm}var q_=Z_();const Di={INVALID_JSON:"INVALID_JSON",INVALID_GEOJSON_SCHEMA:"INVALID_GEOJSON_SCHEMA",INVALID_GEOMETRY:"INVALID_GEOMETRY",UNSUPPORTED_TYPE:"UNSUPPORTED_TYPE",MISSING_COORDINATES:"MISSING_COORDINATES",MALFORMED_COORDINATES:"MALFORMED_COORDINATES",FEATURE_GEOMETRY_ERROR:"FEATURE_GEOMETRY_ERROR",VALIDATION_ERROR:"VALIDATION_ERROR",PARSING_ERROR:"PARSING_ERROR",POLYLINE_ERROR:"POLYLINE_ERROR",WKT_ERROR:"WKT_ERROR",LATLNG_LIST_ERROR:"LATLNG_LIST_ERROR",AUTO_DETECTION_ERROR:"AUTO_DETECTION_ERROR"};function Li(C,R,k){return{success:!1,error:C,errorCode:R,errorDetails:k}}function Au(C){switch(C){case"Point":return"Point coordinates should be [longitude, latitude] as numbers.";case"LineString":return"LineString coordinates should be an array of [longitude, latitude] positions.";case"Polygon":return"Polygon coordinates should be an array of linear ring arrays, with the first ring being the exterior boundary.";case"MultiPoint":return"MultiPoint coordinates should be an array of Point coordinates.";case"MultiLineString":return"MultiLineString coordinates should be an array of LineString coordinate arrays.";case"MultiPolygon":return"MultiPolygon coordinates should be an array of Polygon coordinate arrays.";default:return"Please check the GeoJSON specification for proper coordinate formatting."}}function $_(C){const R=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];return C!==null&&typeof C=="object"&&"type"in C&&R.indexOf(C.type)!==-1&&("coordinates"in C||C.type==="GeometryCollection")}function rm(C){if(!C||typeof C!="object")return{};const R={};if(typeof C.stroke=="string"&&(R.stroke=C.stroke),typeof C["stroke-width"]=="number"&&(R.strokeWidth=C["stroke-width"]),typeof C["stroke-opacity"]=="number"&&(R.strokeOpacity=C["stroke-opacity"]),typeof C.fill=="string"&&(R.fill=C.fill),typeof C["fill-opacity"]=="number"&&(R.fillOpacity=C["fill-opacity"]),typeof C.color=="string"&&(R.color=C.color),typeof C.weight=="number"&&(R.weight=C.weight),typeof C.opacity=="number"&&(R.opacity=C.opacity),typeof C.fillColor=="string"&&(R.fill=C.fillColor),typeof C.fillOpacity=="number"&&(R.fillOpacity=C.fillOpacity),typeof C.strokeColor=="string"&&(R.stroke=C.strokeColor),typeof C.strokeWeight=="number"&&(R.strokeWidth=C.strokeWeight),typeof C.lineColor=="string"&&(R.stroke=C.lineColor),typeof C.lineWidth=="number"&&(R.strokeWidth=C.lineWidth),C.style&&typeof C.style=="object"){const I=C.style,V=rm(I);for(const q in V)Object.prototype.hasOwnProperty.call(V,q)&&(R[q]=V[q])}const k=["marker-color","marker-size","marker-symbol"];for(let I=0;I<k.length;I++){const V=k[I];C[V]&&(R[V]=C[V])}return R}function sg(C){const R=[];if(C.type==="FeatureCollection"){const k=C;for(let I=0;I<k.features.length;I++){const V=k.features[I];V.properties&&R.push(rm(V.properties))}}else if(C.type==="Feature"){const k=C;k.properties&&R.push(rm(k.properties))}return R}function H_(C,R={unescape:!0}){try{let k=C.trim();if(!k)return Li("Empty polyline string",Di.POLYLINE_ERROR,"Polyline string cannot be empty");if(/^[\d\s,.-]+$/.test(k))return Li("Input appears to be coordinate list, not encoded polyline",Di.POLYLINE_ERROR,"Polyline strings should be encoded, not raw coordinates");R.unescape&&(k=decodeURI(k));const I=G_.decode(k);return!I||I.length===0?Li("Failed to decode polyline",Di.POLYLINE_ERROR,"Polyline string appears to be invalid or corrupted"):{success:!0,data:{type:"Feature",geometry:{type:"LineString",coordinates:I.map((E,c)=>{const pe=E[0],se=E[1];if(pe<-90||pe>90)throw new Error(`Invalid latitude at coordinate ${c}: ${pe}. Must be between -90 and 90.`);if(se<-180||se>180)throw new Error(`Invalid longitude at coordinate ${c}: ${se}. Must be between -180 and 180.`);return[se,pe]})},properties:{}},type:"Feature",format:xa.POLYLINE,geometryCount:1,styleProperties:[]}}catch(k){return Li(`Polyline parsing failed: ${k}`,Di.POLYLINE_ERROR,"Failed to parse encoded polyline string. Please verify the polyline format.")}}function X_(C){try{const R=C.trim();if(!R)return Li("Empty WKT string",Di.WKT_ERROR,"WKT string cannot be empty");const k=q_.parse(R);if(!k)return Li("Failed to parse WKT",Di.WKT_ERROR,"WKT string appears to be invalid or unsupported");const I={type:"Feature",geometry:k,properties:{}};try{if(!$d(I.geometry))return Li("Invalid geometry from WKT",Di.WKT_ERROR,"WKT parsed successfully but resulted in invalid geometry")}catch(V){return Li(`WKT geometry validation failed: ${V}`,Di.WKT_ERROR,"Failed to validate geometry parsed from WKT")}return{success:!0,data:I,type:"Feature",format:xa.WKT,geometryCount:1,styleProperties:[]}}catch(R){return Li(`WKT parsing failed: ${R}`,Di.WKT_ERROR,"Failed to parse WKT string. Please verify the WKT format.")}}function Y_(C){try{const R=C.trim();if(!R)return Li("Empty lat/lng list",Di.LATLNG_LIST_ERROR,"Lat/lng list cannot be empty");const k=R.match(/-?\d+(?:\.\d+)?(?:[eE][+-]?\d+)?/g);if(!k||k.length===0)return Li("No valid numbers found",Di.LATLNG_LIST_ERROR,"Could not find any valid coordinate numbers in the input");if(k.length%2!==0)return Li("Odd number of coordinates",Di.LATLNG_LIST_ERROR,`Found ${k.length} numbers, but coordinates must come in pairs (latitude, longitude)`);const I=[];for(let E=0;E<k.length;E+=2){const c=parseFloat(k[E]),pe=parseFloat(k[E+1]);if(isNaN(c)||isNaN(pe))return Li("Invalid coordinate values",Di.LATLNG_LIST_ERROR,`Coordinate values must be valid numbers. Found: lat=${c}, lng=${pe}`);if(c<-90||c>90)return Li("Invalid latitude value",Di.LATLNG_LIST_ERROR,`Latitude must be between -90 and 90. Found: ${c}`);if(pe<-180||pe>180)return Li("Invalid longitude value",Di.LATLNG_LIST_ERROR,`Longitude must be between -180 and 180. Found: ${pe}`);I.push([pe,c])}return I.length===0?Li("No valid coordinates found",Di.LATLNG_LIST_ERROR,"No valid coordinate pairs could be parsed from the input"):{success:!0,data:{type:"FeatureCollection",features:I.map((E,c)=>({type:"Feature",geometry:{type:"Point",coordinates:E},properties:{index:c+1}}))},type:"FeatureCollection",format:xa.COORDINATES,geometryCount:I.length,styleProperties:[]}}catch(R){return Li(`Lat/lng list parsing failed: ${R}`,Di.LATLNG_LIST_ERROR,"Failed to parse lat/lng list. Please verify the format.")}}function og(C,R){try{const k=C.trim();if(!k)return Li("Empty input",Di.AUTO_DETECTION_ERROR,"Input cannot be empty");const I=[{name:"GeoJSON",parser:()=>W_(k)},{name:"WKT",parser:()=>X_(k)},{name:"Polyline",parser:()=>H_(k,{unescape:R?.unescape})},{name:"Lat/Lng List",parser:()=>Y_(k)}],V=[];for(const q of I){console.log(`DEBUG parseMultiFormat: Trying ${q.name} parser...`);const E=q.parser();if(console.log(`DEBUG parseMultiFormat: ${q.name} result:`,{success:E.success,format:E.format}),E.success)return console.log(`DEBUG parseMultiFormat: ${q.name} succeeded, returning result`),E;V.push(`${q.name}: ${E.error}`)}return Li("Unable to parse input",Di.AUTO_DETECTION_ERROR,`Unable to parse input as any supported format. Tried: ${V.join("; ")}`)}catch(k){return Li(`Multi-format parsing failed: ${k}`,Di.AUTO_DETECTION_ERROR,"An unexpected error occurred during parsing")}}function K_(C){try{let R;if(typeof C=="string")try{R=JSON.parse(C)}catch(k){return Li("Invalid JSON format",Di.INVALID_JSON,`JSON parsing failed. Please check for syntax errors such as missing quotes, commas, or brackets. Error: ${k}`)}else R=C;if($_(R)){try{if(!$d(R)){const V=Au(R.type);return Li("Invalid geometry: coordinates are not valid",Di.INVALID_GEOMETRY,`The ${R.type} geometry has invalid coordinates. ${V}`)}}catch(V){const q=Au(R.type);return Li(`Geometry validation failed: ${V}`,Di.VALIDATION_ERROR,`Failed to validate ${R.type} geometry. ${q}`)}const k={type:"Feature",geometry:R,properties:{}},I=sg(k);return{success:!0,data:k,type:"Feature",format:xa.GEOJSON,geometryCount:1,isPartialGeoJSON:!0,styleProperties:I}}return Li("Input is not a valid partial GeoJSON (standalone geometry)",Di.UNSUPPORTED_TYPE,"The input must be a valid geometry object (Point, LineString, Polygon, MultiPoint, MultiLineString, MultiPolygon, or GeometryCollection) with proper coordinates.")}catch(R){return Li(`Partial parsing failed: ${R}`,Di.PARSING_ERROR,"An unexpected error occurred during partial GeoJSON parsing. Please check your input format.")}}function W_(C){try{let R;if(typeof C=="string")try{R=JSON.parse(C)}catch(E){return Li("Invalid JSON format",Di.INVALID_JSON,`JSON parsing failed. Please check for syntax errors such as missing quotes, commas, or brackets. Error: ${E}`)}else R=C;if(!(E=>{if(!E||typeof E!="object")return!1;const c=E;if(!c.type||typeof c.type!="string")return!1;const pe=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection","Feature","FeatureCollection"];return pe.includes(c.type)?c.type==="FeatureCollection"?Array.isArray(c.features):c.type==="Feature"?!!(c.geometry&&typeof c.geometry=="object"&&c.geometry!==null&&typeof c.geometry.type=="string"&&pe.includes(c.geometry.type)):c.coordinates!==void 0||c.geometries!==void 0:!1})(R)){const E=l_.valid(R);if(!E.valid){const c=K_(R);if(c.success)return c;const pe=E.errors?.join(", ")||"Unknown validation error";return Li(`Invalid GeoJSON: ${pe}`,Di.INVALID_GEOJSON_SCHEMA,`The input does not conform to the GeoJSON specification. Common issues: missing 'type' property, invalid type value, or incorrect structure. Errors: ${pe}`)}}const I=R;if(I.type==="Point"||I.type==="LineString"||I.type==="Polygon"||I.type==="MultiPoint"||I.type==="MultiLineString"||I.type==="MultiPolygon"||I.type==="GeometryCollection")try{if(!$d(I)){const E=Au(I.type);return Li("Invalid geometry: coordinates are not valid",Di.INVALID_GEOMETRY,`The ${I.type} geometry has invalid coordinates. ${E}`)}}catch(E){const c=Au(I.type);return Li(`Geometry validation failed: ${E}`,Di.VALIDATION_ERROR,`Failed to validate ${I.type} geometry. ${c}`)}if(I.type==="Feature"){const E=I;if(E.geometry)try{if(!$d(E.geometry)){const c=Au(E.geometry.type);return Li("Invalid geometry in feature",Di.FEATURE_GEOMETRY_ERROR,`The Feature contains a ${E.geometry.type} geometry with invalid coordinates. ${c}`)}}catch(c){const pe=E.geometry?.type||"unknown",se=Au(pe);return Li(`Feature geometry validation failed: ${c}`,Di.FEATURE_GEOMETRY_ERROR,`Failed to validate the ${pe} geometry in Feature. ${se}`)}}if(I.type==="FeatureCollection"){const E=I;for(let c=0;c<E.features.length;c++){const pe=E.features[c];if(pe.geometry)try{if(!$d(pe.geometry)){const se=Au(pe.geometry.type);return Li(`Invalid geometry in feature ${c}`,Di.FEATURE_GEOMETRY_ERROR,`Feature ${c} contains a ${pe.geometry.type} geometry with invalid coordinates. ${se}`)}}catch(se){const X=pe.geometry?.type||"unknown",ce=Au(X);return Li(`Feature ${c} geometry validation failed: ${se}`,Di.FEATURE_GEOMETRY_ERROR,`Failed to validate the ${X} geometry in Feature ${c}. ${ce}`)}}}let V=0;I.type==="FeatureCollection"?V=I.features.length:I.type==="Feature"?V=1:I.type==="GeometryCollection"?V=I.geometries.length:V=1;const q=sg(I);return{success:!0,data:I,type:I.type,format:xa.GEOJSON,geometryCount:V,styleProperties:q}}catch(R){return Li(`Parsing failed: ${R}`,Di.PARSING_ERROR,"An unexpected error occurred during GeoJSON parsing. Please check your input format and try again.")}}function Rp(C){const R={},I=og(C,void 0),V=I.format||xa.GEOJSON;return V===xa.POLYLINE&&(R.unescape=!0),{layerType:V,layerOptions:R,parseOptions:void 0,parseResult:I}}const lg=Hm.createContext(void 0),cg=()=>{const C=Hm.useContext(lg);if(!C)throw new Error("useNotification must be used within a NotificationProvider");return C},Q_={[Zl.BLUE]:{emoji:"",hex:"#3B82F6",css:"rgb(59, 130, 246)",name:"Blue"},[Zl.GREEN]:{emoji:"",hex:"#10B981",css:"rgb(16, 185, 129)",name:"Green"},[Zl.RED]:{emoji:"",hex:"#EF4444",css:"rgb(239, 68, 68)",name:"Red"},[Zl.YELLOW]:{emoji:"",hex:"#F59E0B",css:"rgb(245, 158, 11)",name:"Yellow"},[Zl.PURPLE]:{emoji:"",hex:"#8B5CF6",css:"rgb(139, 92, 246)",name:"Purple"},[Zl.ORANGE]:{emoji:"",hex:"#F97316",css:"rgb(249, 115, 22)",name:"Orange"}},J_=C=>Q_[C],Vl=(C,R=1)=>{const k=J_(C),I=parseInt(k.hex.slice(1,3),16),V=parseInt(k.hex.slice(3,5),16),q=parseInt(k.hex.slice(5,7),16);return`rgba(${I}, ${V}, ${q}, ${R})`};class im{map;layerGroups=new Map;constructor(R){this.map=R}addSource(R,k){const I=`layer-source-${R}`;if(this.map.getSource(I))throw new Error(`Source ${I} already exists`);this.map.addSource(I,{type:"geojson",data:k}),this.layerGroups.set(R,{sourceId:I,layerIds:[],geometryTypes:[]})}removeSource(R){const k=this.layerGroups.get(R);k&&(k.layerIds.forEach(I=>{this.map.getLayer(I)&&this.map.removeLayer(I)}),this.map.getSource(k.sourceId)&&this.map.removeSource(k.sourceId),this.layerGroups.delete(R))}updateSource(R,k){const I=this.layerGroups.get(R);if(!I)throw new Error(`Layer group ${R} not found`);const V=this.map.getSource(I.sourceId);if(!V||V.type!=="geojson")throw new Error(`GeoJSON source ${I.sourceId} not found`);V.setData(k)}addLayers(R,k){const I=this.layerGroups.get(R);if(!I)throw new Error(`Layer group ${R} not found`);const V=this.getGeometryTypes(k.data),q=this.hasGeoJsonStyles(k.data);V.forEach(E=>{if(E==="Polygon"||E==="MultiPolygon"){const c=this.createLayerConfig(R,I.sourceId,E,k,q);this.map.getLayer(c.id)||(this.map.addLayer({id:c.id,type:"fill",source:I.sourceId,filter:c.filter,paint:c.paint,layout:c.layout}),I.layerIds.push(c.id));const pe=this.createPolygonStrokeConfig(R,I.sourceId,k,q,E);this.map.getLayer(pe.id)||(this.map.addLayer({id:pe.id,type:"line",source:I.sourceId,filter:pe.filter,paint:pe.paint,layout:pe.layout}),I.layerIds.push(pe.id))}else{const c=this.createLayerConfig(R,I.sourceId,E,k,q);this.map.getLayer(c.id)||(c.type==="circle"?this.map.addLayer({id:c.id,type:"circle",source:I.sourceId,filter:c.filter,paint:c.paint,layout:c.layout}):c.type==="line"&&this.map.addLayer({id:c.id,type:"line",source:I.sourceId,filter:c.filter,paint:c.paint,layout:c.layout}),I.layerIds.push(c.id))}}),I.geometryTypes=V}removeLayers(R){const k=this.layerGroups.get(R);k&&(k.layerIds.forEach(I=>{this.map.getLayer(I)&&this.map.removeLayer(I)}),k.layerIds=[],k.geometryTypes=[])}updateLayerVisibility(R,k){const I=this.layerGroups.get(R);if(!I)return;const V=k?"visible":"none";I.layerIds.forEach(q=>{this.map.getLayer(q)&&this.map.setLayoutProperty(q,"visibility",V)})}updateLayerStyle(R,k){this.removeLayers(R),this.addLayers(R,k)}moveLayer(R,k){const I=this.layerGroups.get(R);I&&I.layerIds.forEach(V=>{this.map.getLayer(V)&&this.map.moveLayer(V,k)})}getSources(){return Array.from(this.layerGroups.keys())}getLayerGroup(R){return this.layerGroups.get(R)}hasSource(R){return this.layerGroups.has(R)}cleanup(){Array.from(this.layerGroups.keys()).forEach(R=>{this.removeSource(R)})}getGeometryTypes(R){const k=new Set;return R.features.forEach(I=>{I.geometry&&k.add(I.geometry.type)}),Array.from(k)}hasGeoJsonStyles(R){return R.features.some(k=>k.properties&&(k.properties.fill||k.properties.stroke||k.properties["fill-color"]||k.properties["stroke-color"]))}createLayerConfig(R,k,I,V,q){const E=`layer-${R}`;switch(I){case"Point":return{id:`${E}-points`,sourceId:k,type:"circle",geometryType:"Point",filter:["==","$type","Point"],paint:{"circle-radius":V.options.pointRadius||6,"circle-color":q?["case",["has","fill"],["get","fill"],["has","fill-color"],["get","fill-color"],Vl(V.color)]:Vl(V.color),"circle-stroke-color":q?["case",["has","stroke"],["get","stroke"],["has","stroke-color"],["get","stroke-color"],Vl(V.color)]:Vl(V.color),"circle-stroke-width":V.options.strokeWidth||1,"circle-opacity":V.options.fillOpacity||.8},layout:{visibility:V.visibility?"visible":"none"}};case"LineString":return{id:`${E}-lines`,sourceId:k,type:"line",geometryType:"LineString",filter:["==","$type","LineString"],paint:{"line-color":q?["case",["has","stroke"],["get","stroke"],["has","stroke-color"],["get","stroke-color"],Vl(V.color)]:Vl(V.color),"line-width":V.options.strokeWidth||2,"line-opacity":V.options.strokeOpacity||1},layout:{visibility:V.visibility?"visible":"none"}};case"Polygon":case"MultiPolygon":return{id:`${E}-fills`,sourceId:k,type:"fill",geometryType:I,filter:["==","$type","Polygon"],paint:{"fill-color":q?["case",["has","fill"],["get","fill"],["has","fill-color"],["get","fill-color"],Vl(V.color,.3)]:Vl(V.color,.3),"fill-opacity":V.options.fillOpacity||.3},layout:{visibility:V.visibility?"visible":"none"}};default:throw new Error(`Unsupported geometry type: ${I}`)}}createPolygonStrokeConfig(R,k,I,V,q="Polygon"){return{id:`${`layer-${R}`}-strokes`,sourceId:k,type:"line",geometryType:q,filter:["==","$type","Polygon"],paint:{"line-color":V?["case",["has","stroke"],["get","stroke"],["has","stroke-color"],["get","stroke-color"],Vl(I.color)]:Vl(I.color),"line-width":I.options.strokeWidth||2,"line-opacity":I.options.strokeOpacity||1},layout:{visibility:I.visibility?"visible":"none"}}}}function ey(C,R={}){if(C.bbox!=null&&R.recompute!==!0)return C.bbox;const k=[1/0,1/0,-1/0,-1/0];return ng(C,I=>{k[0]>I[0]&&(k[0]=I[0]),k[1]>I[1]&&(k[1]=I[1]),k[2]<I[0]&&(k[2]=I[0]),k[3]<I[1]&&(k[3]=I[1])}),k}var ty=ey;const ug=ut.forwardRef(({initialViewState:C={latitude:45.5017,longitude:-73.5673,zoom:10},sidebarVisible:R=!0,sidebarWidth:k=320},I)=>{const V=ut.useRef(null),q=ut.useRef(null),E=ut.useRef(null),[c,pe]=ut.useState(!1),{state:se,actions:X}=Qm(),{showSuccess:ce,showError:K}=cg(),Q=ut.useCallback(()=>{const Xe=V.current?.getMap();if(!(!Xe||se.layers.length===0))try{const Je=[];if(se.layers.forEach(ni=>{ni.data&&ni.data.features&&Je.push(...ni.data.features)}),Je.length===0)return;const nt={type:"FeatureCollection",features:Je},[Ye,vt,Nt,Jt]=ty(nt);if(vt<-90||vt>90||Jt<-90||Jt>90)throw new Error(`Invalid latitude values: minLat=${vt}, maxLat=${Jt}. Latitude must be between -90 and 90.`);if(Ye<-180||Ye>180||Nt<-180||Nt>180)throw new Error(`Invalid longitude values: minLng=${Ye}, maxLng=${Nt}. Longitude must be between -180 and 180.`);const Lt=50,_i=R?k+Lt:Lt;Xe.fitBounds([[Ye,vt],[Nt,Jt]],{padding:{top:Lt,bottom:Lt,left:Lt,right:_i},duration:1e3,maxZoom:16})}catch(Je){console.error("Error fitting map to layers:",Je),K("Error fitting map to layers",`${Je}`)}},[se.layers,R,k,K]);ut.useImperativeHandle(I,()=>({fitMapToLayers:Q}));const Ie=Xe=>Xe.type==="FeatureCollection"?Xe:Xe.type==="Feature"?{type:"FeatureCollection",features:[Xe]}:{type:"FeatureCollection",features:[{type:"Feature",geometry:Xe,properties:{}}]},Qe=ut.useCallback(Xe=>{const Je=E.current,nt=V.current?.getMap();if(!(!Je&&!nt)){if(!Je&&nt){St(Xe);return}try{Je.hasSource(Xe.id)||Je.addSource(Xe.id,Xe.data),Je.addLayers(Xe.id,Xe)}catch(Ye){console.error("Error adding layer to map:",Ye)}}},[]),St=Xe=>{const Je=V.current?.getMap();if(!Je)return;const nt=`layer-source-${Xe.id}`,Ye=`layer-${Xe.id}`;try{Je.getSource(nt)||Je.addSource(nt,{type:"geojson",data:Xe.data});const vt=Xe.data.features.some(Lt=>Lt.geometry.type==="Point"),Nt=Xe.data.features.some(Lt=>Lt.geometry.type==="LineString"),Jt=Xe.data.features.some(Lt=>Lt.geometry.type==="Polygon");if(vt){const Lt=`${Ye}-points`;Je.getLayer(Lt)||Je.addLayer({id:Lt,type:"circle",source:nt,filter:["==","$type","Point"],paint:{"circle-radius":Xe.options.pointRadius||6,"circle-color":"#3388ff","circle-stroke-color":"#3388ff","circle-stroke-width":Xe.options.strokeWidth||1,"circle-opacity":Xe.options.fillOpacity||.8},layout:{visibility:Xe.visibility?"visible":"none"}})}if(Nt){const Lt=`${Ye}-lines`;Je.getLayer(Lt)||Je.addLayer({id:Lt,type:"line",source:nt,filter:["==","$type","LineString"],paint:{"line-color":"#3388ff","line-width":Xe.options.strokeWidth||2,"line-opacity":Xe.options.strokeOpacity||1},layout:{visibility:Xe.visibility?"visible":"none"}})}if(Jt){const Lt=`${Ye}-fills`,_i=`${Ye}-strokes`;Je.getLayer(Lt)||Je.addLayer({id:Lt,type:"fill",source:nt,filter:["==","$type","Polygon"],paint:{"fill-color":"#3388ff","fill-opacity":Xe.options.fillOpacity||.3},layout:{visibility:Xe.visibility?"visible":"none"}}),Je.getLayer(_i)||Je.addLayer({id:_i,type:"line",source:nt,filter:["==","$type","Polygon"],paint:{"line-color":"#3388ff","line-width":Xe.options.strokeWidth||2,"line-opacity":Xe.options.strokeOpacity||1},layout:{visibility:Xe.visibility?"visible":"none"}})}}catch(vt){console.error("Error adding layer to map (fallback):",vt)}},at=Xe=>{const Je=E.current;if(Je)try{Je.removeSource(Xe)}catch(nt){console.error("Error removing layer from map:",nt)}},Ct=ut.useCallback((Xe,Je)=>{const nt=E.current;if(nt)try{nt.updateLayerVisibility(Xe,Je)}catch(Ye){console.error("Error updating layer visibility:",Ye)}},[]);return ut.useEffect(()=>{const Xe=Je=>{const nt=Je.target;if(nt&&(nt.tagName==="INPUT"||nt.tagName==="TEXTAREA"))return;const Ye=Je.clipboardData;if(!Ye)return;const vt=Ye.getData("text/plain");if(!vt.trim())return;Je.preventDefault();const{layerType:Nt,layerOptions:Jt,parseResult:Lt}=Rp(vt);if(Lt.success&&Lt.data){const _i="Pasted Layer",ni=Ie(Lt.data);X.addLayer(ni,Nt,Jt,_i,vt),ce("Layer Added Successfully","Pasted data has been added to the map")}else console.error("Failed to parse pasted data:",Lt.error),K("Failed to Parse Data",Lt.error||"Unknown error occurred while parsing the pasted data")};return document.addEventListener("paste",Xe),()=>{document.removeEventListener("paste",Xe)}},[X,K,ce]),ut.useEffect(()=>{const Xe=()=>{const Ye=V.current?.getMap();if(!Ye)return!1;const vt=()=>{E.current=new im(Ye),pe(!0)};return Ye.loaded()?(vt(),!0):(Ye.on("load",vt),!0)};if(Xe()){const Ye=V.current;return()=>{Ye?.getMap()&&E.current?.cleanup(),pe(!1)}}const Je=setInterval(()=>{Xe()&&clearInterval(Je)},100),nt=setTimeout(()=>{clearInterval(Je);const Ye=V.current?.getMap();Ye&&!E.current&&(Ye.loaded()?(E.current=new im(Ye),pe(!0)):Ye.on("load",()=>{E.current=new im(Ye),pe(!0)}))},2e3);return()=>{clearInterval(Je),clearTimeout(nt),E.current?.cleanup(),pe(!1)}},[]),ut.useEffect(()=>{const Xe=E.current,Je=V.current?.getMap();if(console.log("Layer sync effect triggered:",{layersCount:se.layers.length,isMapReady:c,hasLayerManager:!!Xe,hasMap:!!Je}),!Xe&&!Je){console.log("No layer manager or map available, skipping sync");return}if(!Xe&&Je){console.log("Using fallback direct map operations for",se.layers.length,"layers"),se.layers.forEach(Ye=>{const vt=`layer-source-${Ye.id}`;Je.getSource(vt)||(console.log("Adding layer via fallback:",Ye.id),Qe(Ye))});return}console.log("Using layer manager to sync",se.layers.length,"layers"),se.layers.forEach(Ye=>{Xe.hasSource(Ye.id)||(console.log("Adding layer via layer manager:",Ye.id),Qe(Ye))}),Xe.getSources().forEach(Ye=>{se.layers.find(vt=>vt.id===Ye)||at(Ye)})},[se.layers,c,Qe]),ut.useEffect(()=>{E.current&&se.layers.forEach(Xe=>{Ct(Xe.id,Xe.visibility)})},[se.layers,c,Ct]),ut.useEffect(()=>{const Xe=E.current;Xe&&se.layers.forEach(Je=>{Xe.hasSource(Je.id)&&Xe.updateLayerStyle(Je.id,Je)})},[se.layers,c]),ut.useEffect(()=>{const Xe=E.current;Xe&&se.layers.forEach(Je=>{Xe.hasSource(Je.id)&&Xe.updateSource(Je.id,Je.data)})},[se.layers,c]),ut.useEffect(()=>{if(se.layers.length>0){const Xe=setTimeout(()=>{Q()},100);return()=>clearTimeout(Xe)}},[se.layers.length,Q]),Pt.jsx("div",{ref:q,className:"map-container",children:Pt.jsxs(Fg,{ref:V,initialViewState:C,style:{width:"100%",height:"100%"},mapStyle:"https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",children:[Pt.jsx(qg,{position:"top-right",style:{zIndex:1e3}}),Pt.jsx(Hg,{position:"bottom-left"})]})})});ug.displayName="MapComponent";const iy=({isVisible:C=!0,onFitToLayers:R,onWidthChange:k})=>{const{state:I,actions:V}=Qm(),{showSuccess:q,showError:E}=cg(),c=ut.useRef(null),pe=ut.useRef(null),[se,X]=ut.useState(!1),[ce,K]=ut.useState(320),[Q,Ie]=ut.useState(!1),[Qe,St]=ut.useState(null),[at,Ct]=ut.useState(""),[Xe,Je]=ut.useState(null),nt=je=>je.type==="FeatureCollection"?je:je.type==="Feature"?{type:"FeatureCollection",features:[je]}:{type:"FeatureCollection",features:[{type:"Feature",geometry:je,properties:{}}]},Ye=je=>{je.preventDefault(),Ie(!0)};ut.useEffect(()=>{const je=qt=>{if(!Q)return;const ye=window.innerWidth-qt.clientX,He=250,ot=window.innerWidth*.6,dt=Math.max(He,Math.min(ot,ye));K(dt),k?.(dt)},_t=()=>{Ie(!1)};return Q&&(document.addEventListener("mousemove",je),document.addEventListener("mouseup",_t),document.body.style.cursor="ew-resize",document.body.style.userSelect="none"),()=>{document.removeEventListener("mousemove",je),document.removeEventListener("mouseup",_t),document.body.style.cursor="",document.body.style.userSelect=""}},[Q,k]);const vt=je=>{je.preventDefault(),X(!0)},Nt=je=>{je.preventDefault(),c.current?.contains(je.relatedTarget)||X(!1)},Jt=je=>{je.preventDefault(),je.dataTransfer.dropEffect="copy"},Lt=je=>{je.preventDefault(),X(!1);const _t=je.dataTransfer.files,qt=je.dataTransfer.getData("text/plain");if(_t&&_t.length>0)Array.from(_t).forEach(ye=>{const He=new FileReader;He.onload=ot=>{const dt=ot.target?.result;if(dt){const At=`${ye.name} ${new Date().toLocaleTimeString()}`,{layerType:Ht,layerOptions:Ft,parseResult:Yi}=Rp(dt);if(Yi.success&&Yi.data){const Mi=nt(Yi.data);V.addLayer(Mi,Ht,Ft,At,dt),q("Layer Added Successfully",`File "${ye.name}" has been added to the map`)}else{const Mi={type:"FeatureCollection",features:[]};V.addLayer(Mi,xa.GEOJSON,{},At,dt),E("Layer Added with Errors",`File "${ye.name}" was added but contains errors: ${Yi.error}`)}}},He.readAsText(ye)});else if(qt){const ye=`Dropped Layer ${new Date().toLocaleTimeString()}`,{layerType:He,layerOptions:ot,parseResult:dt}=Rp(qt);if(dt.success&&dt.data){const At=nt(dt.data);V.addLayer(At,He,ot,ye,qt),q("Layer Added Successfully","Dropped data has been added to the map")}else{const At={type:"FeatureCollection",features:[]};V.addLayer(At,xa.GEOJSON,{},ye,qt),E("Layer Added with Errors",`Dropped data was added but contains errors: ${dt.error}`)}}},_i=(je,_t)=>{St(je),Ct(_t)},ni=je=>{at.trim()&&V.updateLayerName(je,at.trim()),St(null),Ct("")},Ci=()=>{St(null),Ct("")},Tn=(je,_t)=>{je.key==="Enter"?ni(_t):je.key==="Escape"&&Ci()},ki=(je,_t)=>{V.updateColor(je,_t),Je(null)},We=()=>Object.entries(Zl).map(([je,_t])=>({key:je,value:_t,emoji:_t}));return ut.useEffect(()=>{const je=_t=>{Xe&&!_t.target.closest(".color-pill-container")&&Je(null)};return document.addEventListener("mousedown",je),()=>document.removeEventListener("mousedown",je)},[Xe]),Pt.jsxs("div",{ref:pe,className:`sidebar ${C?"sidebar-visible":"sidebar-hidden"}`,style:{width:`${ce}px`},children:[Pt.jsx("div",{className:"resize-handle",onMouseDown:Ye,style:{cursor:"ew-resize"}}),Pt.jsxs("div",{className:"sidebar-content",children:[Pt.jsxs("div",{className:"sidebar-header",children:[Pt.jsx("h2",{className:"sidebar-title",children:"GeoHelper Tool"}),Pt.jsx("p",{className:"sidebar-subtitle",children:"Display GeoJSON, encoded polyline, KML, anything that looks like a coordoinates on the map"})]}),Pt.jsxs("div",{className:"sidebar-section",children:[Pt.jsx("h3",{className:"section-title",children:"Add data"}),Pt.jsxs("div",{className:"instruction-block",children:[Pt.jsxs("div",{ref:c,className:`instruction-item drop-zone ${se?"drag-over":""}`,onDragEnter:vt,onDragLeave:Nt,onDragOver:Jt,onDrop:Lt,children:[Pt.jsx("span",{className:"instruction-icon",children:""}),Pt.jsxs("div",{className:"instruction-text",children:[Pt.jsx("strong",{children:"Drag & Drop"}),Pt.jsx("p",{children:se?"Drop files here!":"Drag files here"})]})]}),Pt.jsxs("div",{className:"instruction-item",children:[Pt.jsx("span",{className:"instruction-icon",children:""}),Pt.jsxs("div",{className:"instruction-text",children:[Pt.jsx("strong",{children:"Paste Data"}),Pt.jsx("p",{children:"Paste Data anywhere to add stuff"})]})]})]})]}),Pt.jsxs("div",{className:"sidebar-section",children:[Pt.jsxs("div",{className:"section-header",children:[Pt.jsx("h3",{className:"section-title",children:"Layers"}),I.layers.length>0&&Pt.jsxs("div",{className:"layer-actions-header",children:[R&&Pt.jsx("button",{onClick:R,className:"fit-layers-btn",title:"Fit map to show all layers",children:""}),Pt.jsx("button",{onClick:()=>V.clearLayers(),className:"remove-all-layers-btn",title:"Remove all layers",children:""})]})]}),Pt.jsx("div",{className:`layers-container ${I.layers.length===0?"empty":"has-layers"}`,children:I.layers.length===0?Pt.jsx("p",{className:"empty-state",children:"No layers added yet"}):Pt.jsx("div",{className:"layers-list",children:I.layers.map(je=>Pt.jsxs("div",{className:"layer-item",children:[Pt.jsxs("div",{className:"layer-header",children:[Pt.jsxs("div",{className:"layer-info",children:[Qe===je.id?Pt.jsx("input",{type:"text",value:at,onChange:_t=>Ct(_t.target.value),onBlur:()=>ni(je.id),onKeyDown:_t=>Tn(_t,je.id),className:"layer-name-input",autoFocus:!0}):Pt.jsx("h4",{className:"layer-name",onClick:()=>_i(je.id,je.name||"Unnamed Layer"),children:je.name||"Unnamed Layer"}),Pt.jsx("p",{className:"layer-type",children:je.type})]}),Pt.jsxs("div",{className:"layer-actions",children:[Pt.jsxs("div",{className:"color-pill-container",children:[Pt.jsx("button",{onClick:()=>Je(Xe===je.id?null:je.id),className:"color-pill-btn",title:"Change layer color",children:je.color}),Xe===je.id&&Pt.jsx("div",{className:"color-dropdown",children:We().map(({key:_t,value:qt,emoji:ye})=>Pt.jsx("button",{onClick:()=>ki(je.id,qt),className:`color-option ${je.color===qt?"selected":""}`,title:`${_t.toLowerCase()} color`,children:ye},_t))})]}),Pt.jsx("button",{onClick:()=>V.toggleVisibility(je.id),className:`visibility-btn ${je.visibility?"visible":"hidden"}`,children:je.visibility?"":""}),Pt.jsx("button",{onClick:()=>V.removeLayer(je.id),className:"remove-btn",children:""})]})]}),Pt.jsx("div",{className:"layer-content",children:Pt.jsx("textarea",{value:je.originalContent||(je.data.features.length>0?JSON.stringify(je.data,null,2):""),onChange:_t=>{const qt=_t.target.value;V.updateLayer(je.id,{originalContent:qt})},onBlur:_t=>{const qt=_t.target.value;if(qt.trim()){const{layerType:ye,layerOptions:He,parseResult:ot}=Rp(qt),dt={...je.options,...He};if(ot.success&&ot.data){const At=nt(ot.data);V.updateLayer(je.id,{data:At,type:ye,options:dt,originalContent:qt})}else E("Parse Error",ot.error||"Failed to parse updated content")}},placeholder:"Enter GeoJSON, WKT, or other supported format...",className:"layer-content-editor inline",rows:4})}),je.type===xa.COORDINATES&&Pt.jsx("div",{className:"layer-options",children:Pt.jsx("div",{className:"option-item",children:Pt.jsxs("label",{className:"option-label",children:[Pt.jsx("input",{type:"checkbox",checked:je.options.reverseCoordinates||!1,onChange:_t=>{const qt={...je.options,reverseCoordinates:_t.target.checked};V.updateLayer(je.id,{options:qt});const ye=je.originalContent;if(ye&&ye.trim()){const He=ye.match(/-?\d+\.?\d*/g);if(He&&He.length>=2&&He.length%2===0){const ot=[];for(let Ht=0;Ht<He.length;Ht+=2){const Ft=parseFloat(He[Ht]),Yi=parseFloat(He[Ht+1]);_t.target.checked?ot.push([Ft,Yi]):ot.push([Yi,Ft])}const At={type:"FeatureCollection",features:ot.map((Ht,Ft)=>({type:"Feature",geometry:{type:"Point",coordinates:Ht},properties:{index:Ft+1}}))};V.updateLayer(je.id,{data:At}),q("Coordinates Updated","Coordinate order has been "+(_t.target.checked?"reversed":"restored")),R&&setTimeout(()=>{R()},100)}}}}),Pt.jsx("span",{className:"option-text",children:"Reverse Lat/Lng Order"})]})})}),je.type===xa.POLYLINE&&Pt.jsx("div",{className:"layer-options",children:Pt.jsx("div",{className:"option-item",children:Pt.jsxs("label",{className:"option-label",children:[Pt.jsx("input",{type:"checkbox",checked:je.options.unescape||!1,onChange:_t=>{const qt={...je.options,unescape:_t.target.checked};V.updateLayer(je.id,{options:qt});const ye=je.originalContent;if(ye&&ye.trim()){const He=og(ye,{unescape:_t.target.checked});if(He.success&&He.data){const ot=nt(He.data);V.updateLayer(je.id,{data:ot}),q("Polyline Updated","Forward slash escaping has been "+(_t.target.checked?"removed":"preserved")),R&&setTimeout(()=>{R()},100)}else E("Parse Error",He.error||"Failed to parse updated polyline")}}}),Pt.jsx("span",{className:"option-text",children:"Remove '\\` escapes"})]})})})]},je.id))})})]})]})]})},ny=({notification:C,onDismiss:R})=>{const[k,I]=ut.useState(!1);ut.useEffect(()=>{I(!0);const q=C.duration||5e3,E=setTimeout(()=>{I(!1),setTimeout(()=>R(C.id),300)},q);return()=>clearTimeout(E)},[C,R]);const V=()=>{switch(C.type){case"success":return"";case"error":return"";case"warning":return"";default:return""}};return Pt.jsx("div",{className:`notification notification-${C.type} ${k?"notification-visible":""}`,children:Pt.jsxs("div",{className:"notification-content",children:[Pt.jsxs("div",{className:"notification-header",children:[Pt.jsx("span",{className:"notification-icon",children:V()}),Pt.jsx("h4",{className:"notification-title",children:C.title}),Pt.jsx("button",{className:"notification-close",onClick:()=>{I(!1),setTimeout(()=>R(C.id),300)},children:""})]}),C.message&&Pt.jsx("p",{className:"notification-message",children:C.message})]})})},ry=({children:C})=>{const[R,k]=ut.useState([]),I=ut.useCallback(X=>{const ce=Date.now().toString()+Math.random().toString(36).substr(2,9),K={...X,id:ce};k(Q=>[...Q,K])},[]),V=ut.useCallback((X,ce)=>{I({type:"success",title:X,message:ce})},[I]),q=ut.useCallback((X,ce)=>{I({type:"error",title:X,message:ce})},[I]),E=ut.useCallback((X,ce)=>{I({type:"warning",title:X,message:ce})},[I]),c=ut.useCallback((X,ce)=>{I({type:"info",title:X,message:ce})},[I]),pe=ut.useCallback(X=>{k(ce=>ce.filter(K=>K.id!==X))},[]),se={showNotification:I,showSuccess:V,showError:q,showWarning:E,showInfo:c};return Pt.jsxs(lg.Provider,{value:se,children:[C,Pt.jsx("div",{className:"notification-container",children:R.map(X=>Pt.jsx(ny,{notification:X,onDismiss:pe},X.id))})]})};function ay(){const C=ut.useRef(null),[R,k]=ut.useState(320),I=()=>{C.current?.fitMapToLayers()};return Pt.jsx(ry,{children:Pt.jsx(s_,{children:Pt.jsxs("div",{style:{width:"100vw",height:"100vh",margin:0,padding:0},children:[Pt.jsx(ug,{ref:C,sidebarVisible:!0,sidebarWidth:R}),Pt.jsx(iy,{onFitToLayers:I,onWidthChange:k})]})})})}Sg.createRoot(document.getElementById("root")).render(Pt.jsx(ut.StrictMode,{children:Pt.jsx(ay,{})}));var Ip={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.1/LICENSE.txt
 */var sy=Ip.exports,qm;function oy(){return qm||(qm=1,function(C,R){(function(k,I){C.exports=I()})(sy,function(){var k={},I={};function V(E,c,pe){if(I[E]=pe,E==="index"){var se="var sharedModule = {}; ("+I.shared+")(sharedModule); ("+I.worker+")(sharedModule);",X={};return I.shared(X),I.index(k,X),typeof window<"u"&&k.setWorkerUrl(window.URL.createObjectURL(new Blob([se],{type:"text/javascript"}))),k}}V("shared",["exports"],function(E){function c(a,t,r,o){return new(r||(r=Promise))(function(f,g){function _(M){try{w(o.next(M))}catch(P){g(P)}}function v(M){try{w(o.throw(M))}catch(P){g(P)}}function w(M){var P;M.done?f(M.value):(P=M.value,P instanceof r?P:new r(function(D){D(P)})).then(_,v)}w((o=o.apply(a,t||[])).next())})}function pe(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var se,X;function ce(){if(X)return se;function a(t,r){this.x=t,this.y=r}return X=1,se=a,a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,r){return this.clone()._rotateAround(t,r)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var r=t.x-this.x,o=t.y-this.y;return r*r+o*o},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,r){return Math.atan2(this.x*r-this.y*t,this.x*t+this.y*r)},_matMult:function(t){var r=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var r=Math.cos(t),o=Math.sin(t),f=o*this.x+r*this.y;return this.x=r*this.x-o*this.y,this.y=f,this},_rotateAround:function(t,r){var o=Math.cos(t),f=Math.sin(t),g=r.y+f*(this.x-r.x)+o*(this.y-r.y);return this.x=r.x+o*(this.x-r.x)-f*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t},se}typeof SuppressedError=="function"&&SuppressedError;var K,Q,Ie=pe(ce()),Qe=function(){if(Q)return K;function a(t,r,o,f){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=f}return Q=1,K=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,f=0;f<8;f++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<r)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var v=0,w=1;for(o=t,f=0;f<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<r));f++)t>g?v=o:w=o,o=.5*(w-v)+v;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},K}(),St=pe(Qe);let at,Ct;function Xe(){return at==null&&(at=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),at}function Je(){if(Ct==null&&(Ct=!1,Xe())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const f=4*o;t.fillStyle=`rgb(${f},${f+1},${f+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&r[o]!==o){Ct=!0;break}}}return Ct||!1}var nt=1e-6,Ye=typeof Float32Array<"u"?Float32Array:Array;function vt(){var a=new Ye(9);return Ye!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Nt(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Jt(){var a=new Ye(3);return Ye!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Lt(a){return Math.hypot(a[0],a[1],a[2])}function _i(a,t,r){var o=new Ye(3);return o[0]=a,o[1]=t,o[2]=r,o}function ni(a,t,r){return a[0]=t[0]+r[0],a[1]=t[1]+r[1],a[2]=t[2]+r[2],a}function Ci(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a}function Tn(a,t,r){var o=t[0],f=t[1],g=t[2],_=r[0],v=r[1],w=r[2];return a[0]=f*w-g*v,a[1]=g*_-o*w,a[2]=o*v-f*_,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var ki,We=Lt;function je(a,t,r){var o=t[0],f=t[1],g=t[2],_=t[3];return a[0]=r[0]*o+r[4]*f+r[8]*g+r[12]*_,a[1]=r[1]*o+r[5]*f+r[9]*g+r[13]*_,a[2]=r[2]*o+r[6]*f+r[10]*g+r[14]*_,a[3]=r[3]*o+r[7]*f+r[11]*g+r[15]*_,a}function _t(){var a=new Ye(4);return Ye!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function qt(a,t,r,o){var f=.5*Math.PI/180;t*=f,r*=f,o*=f;var g=Math.sin(t),_=Math.cos(t),v=Math.sin(r),w=Math.cos(r),M=Math.sin(o),P=Math.cos(o);return a[0]=g*w*P-_*v*M,a[1]=_*v*P+g*w*M,a[2]=_*w*M-g*v*P,a[3]=_*w*P+g*v*M,a}function ye(){var a=new Ye(2);return Ye!=Float32Array&&(a[0]=0,a[1]=0),a}function He(a,t){var r=new Ye(2);return r[0]=a,r[1]=t,r}Jt(),ki=new Ye(4),Ye!=Float32Array&&(ki[0]=0,ki[1]=0,ki[2]=0,ki[3]=0),Jt(),_i(1,0,0),_i(0,1,0),_t(),_t(),vt(),ye();const ot=8192;function dt(a,t,r){return t*(ot/(a.tileSize*Math.pow(2,r-a.tileID.overscaledZ)))}function At(a,t){return(a%t+t)%t}function Ht(a,t,r){return a*(1-r)+t*r}function Ft(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,r=t*a;return 4*(a<.5?r:3*(a-t)+r-.75)}function Yi(a,t,r,o){const f=new St(a,t,r,o);return g=>f.solve(g)}const Mi=Yi(.25,.1,.25,1);function Ki(a,t,r){return Math.min(r,Math.max(t,a))}function uo(a,t,r){const o=r-t,f=((a-t)%o+o)%o+t;return f===t?r:f}function cr(a,...t){for(const r of t)for(const o in r)a[o]=r[o];return a}let ho=1;function rn(a,t,r){const o={};for(const f in a)o[f]=t.call(this,a[f],f,a);return o}function ta(a,t,r){const o={};for(const f in a)t.call(this,a[f],f,a)&&(o[f]=a[f]);return o}function ia(a){return Array.isArray(a)?a.map(ia):typeof a=="object"&&a?rn(a,ia):a}const il={};function Wi(a){il[a]||(typeof console<"u"&&console.warn(a),il[a]=!0)}function Nr(a,t,r){return(r.y-a.y)*(t.x-a.x)>(t.y-a.y)*(r.x-a.x)}function yr(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let Rs=null;function ba(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const ql="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Is(a,t,r,o,f){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(a,{timestamp:0});try{const _=g?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),w=new Uint8ClampedArray(o*f*4);if(yield g.copyTo(w,function(M,P,D,B,j){const G=4*Math.max(-P,0),$=(Math.max(0,D)-D)*B*4+G,ee=4*B,ae=Math.max(0,P),we=Math.max(0,D);return{rect:{x:ae,y:we,width:Math.min(M.width,P+B)-ae,height:Math.min(M.height,D+j)-we},layout:[{offset:$,stride:ee}]}}(a,t,r,o,f)),v)for(let M=0;M<w.length;M+=4){const P=w[M];w[M]=w[M+2],w[M+2]=P}return w}finally{g.close()}})}let ss,fo;function Fr(a,t,r,o){return a.addEventListener(t,r,o),{unsubscribe:()=>{a.removeEventListener(t,r,o)}}}function an(a){return a*Math.PI/180}function tr(a){return a/Math.PI*180}const ir={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Oc={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},os="AbortError";function Ce(){return new Error(os)}const H={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Y(a){return H.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const te="global-dispatcher";class he extends Error{constructor(t,r,o,f){super(`AJAXError: ${r} (${t}): ${o}`),this.status=t,this.statusText=r,this.url=o,this.body=f}}const be=()=>yr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ee=function(a,t){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const o=Y(a.url);if(o)return o(a,t);if(yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,targetMapId:te},t)}if(!(/^file:/.test(r=a.url)||/^file:/.test(be())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,f){return c(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:be(),signal:f.signal});let _,v;o.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");try{_=yield fetch(g)}catch(M){throw new he(0,M.message,o.url,new Blob)}if(!_.ok){const M=yield _.blob();throw new he(_.status,_.statusText,o.url,M)}v=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const w=yield v;if(f.signal.aborted)throw Ce();return{data:w,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(a,t);if(yr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:a,mustQueue:!0,targetMapId:te},t)}var r;return function(o,f){return new Promise((g,_)=>{var v;const w=new XMLHttpRequest;w.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(w.responseType="arraybuffer");for(const M in o.headers)w.setRequestHeader(M,o.headers[M]);o.type==="json"&&(w.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=o.credentials==="include",w.onerror=()=>{_(new Error(w.statusText))},w.onload=()=>{if(!f.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let M=w.response;if(o.type==="json")try{M=JSON.parse(w.response)}catch(P){return void _(P)}g({data:M,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const M=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});_(new he(w.status,w.statusText,o.url,M))}},f.signal.addEventListener("abort",()=>{w.abort(),_(Ce())}),w.send(o.body)})}(a,t)};function Le(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const t=new URL(a),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function Se(a,t,r){r[a]&&r[a].indexOf(t)!==-1||(r[a]=r[a]||[],r[a].push(t))}function qe(a,t,r){if(r&&r[a]){const o=r[a].indexOf(t);o!==-1&&r[a].splice(o,1)}}class Ue{constructor(t,r={}){cr(this,r),this.type=t}}class Ae extends Ue{constructor(t,r={}){super("error",cr({error:t},r))}}class Ke{on(t,r){return this._listeners=this._listeners||{},Se(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return qe(t,r,this._listeners),qe(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Se(t,r,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,r){typeof t=="string"&&(t=new Ue(t,r||{}));const o=t.type;if(this.listens(o)){t.target=this;const f=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of f)v.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of g)qe(o,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(cr(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Ae&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const yt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function jt(a,t){const r={};for(const o in a)o!=="ref"&&(r[o]=a[o]);return yt.forEach(o=>{o in t&&(r[o]=t[o])}),r}function bt(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let r=0;r<a.length;r++)if(!bt(a[r],t[r]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const r in a)if(!bt(a[r],t[r]))return!1;return!0}return a===t}function Rt(a,t){a.push(t)}function Bt(a,t,r){Rt(r,{command:"addSource",args:[a,t[a]]})}function ai(a,t,r){Rt(t,{command:"removeSource",args:[a]}),r[a]=!0}function ri(a,t,r,o){ai(a,r,o),Bt(a,t,r)}function fi(a,t,r){let o;for(o in a[r])if(Object.prototype.hasOwnProperty.call(a[r],o)&&o!=="data"&&!bt(a[r][o],t[r][o]))return!1;for(o in t[r])if(Object.prototype.hasOwnProperty.call(t[r],o)&&o!=="data"&&!bt(a[r][o],t[r][o]))return!1;return!0}function Ut(a,t,r,o,f,g){a=a||{},t=t||{};for(const _ in a)Object.prototype.hasOwnProperty.call(a,_)&&(bt(a[_],t[_])||r.push({command:g,args:[o,_,t[_],f]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(a,_)&&(bt(a[_],t[_])||r.push({command:g,args:[o,_,t[_],f]}))}function di(a){return a.id}function Yn(a,t){return a[t.id]=t,a}class ft{constructor(t,r,o,f){this.message=(t?`${t}: `:"")+o,f&&(this.identifier=f),r!=null&&r.__line__&&(this.line=r.__line__)}}function Sn(a,...t){for(const r of t)for(const o in r)a[o]=r[o];return a}class Qi extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class jr{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[o,f]of r)this.bindings[o]=f}concat(t){return new jr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const na={kind:"null"},mt={kind:"number"},Xt={kind:"string"},Ot={kind:"boolean"},Cr={kind:"color"},$l={kind:"projectionDefinition"},ur={kind:"object"},Yt={kind:"value"},ls={kind:"collator"},Ds={kind:"formatted"},xn={kind:"padding"},Hl={kind:"colorArray"},Ls={kind:"numberArray"},ra={kind:"resolvedImage"},Ur={kind:"variableAnchorOffsetCollection"};function vr(a,t){return{kind:"array",itemType:a,N:t}}function sn(a){if(a.kind==="array"){const t=sn(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const po=[na,mt,Xt,Ot,Cr,$l,Ds,ur,vr(Yt),xn,Ls,Hl,ra,Ur];function mo(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!mo(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const r of po)if(!mo(r,t))return null}}return`Expected ${sn(a)} but found ${sn(t)} instead.`}function nl(a,t){return t.some(r=>r.kind===a.kind)}function go(a,t){return t.some(r=>r==="null"?a===null:r==="array"?Array.isArray(a):r==="object"?a&&!Array.isArray(a)&&typeof a=="object":r===typeof a)}function cs(a,t){return a.kind==="array"&&t.kind==="array"?a.itemType.kind===t.itemType.kind&&typeof a.N=="number":a.kind===t.kind}const Vr=.96422,zu=.82521,Oh=4/29,us=6/29,Ru=3*us*us,Xl=us*us*us,Yl=Math.PI/180,aa=180/Math.PI;function Bc(a){return(a%=360)<0&&(a+=360),a}function _o([a,t,r,o]){let f,g;const _=ks((.2225045*(a=Kl(a))+.7168786*(t=Kl(t))+.0606169*(r=Kl(r)))/1);a===t&&t===r?f=g=_:(f=ks((.4360747*a+.3850649*t+.1430804*r)/Vr),g=ks((.0139322*a+.0971045*t+.7141733*r)/zu));const v=116*_-16;return[v<0?0:v,500*(f-_),200*(_-g),o]}function Kl(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ks(a){return a>Xl?Math.pow(a,1/3):a/Ru+Oh}function Iu([a,t,r,o]){let f=(a+16)/116,g=isNaN(t)?f:f+t/500,_=isNaN(r)?f:f-r/200;return f=1*hs(f),g=Vr*hs(g),_=zu*hs(_),[Wl(3.1338561*g-1.6168667*f-.4906146*_),Wl(-.9787684*g+1.9161415*f+.033454*_),Wl(.0719453*g-.2289914*f+1.4052427*_),o]}function Wl(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function hs(a){return a>us?a*a*a:Ru*(a-Oh)}const Ua=Object.hasOwn||function(a,t){return Object.prototype.hasOwnProperty.call(a,t)};function ci(a,t){return Ua(a,t)?a[t]:void 0}function Va(a){return parseInt(a.padEnd(2,a),16)/255}function wa(a,t){return yo(t?a/100:a,0,1)}function yo(a,t,r){return Math.min(Math.max(t,a),r)}function Du(a){return!a.some(Number.isNaN)}const rl={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Ar(a,t,r){return a+r*(t-a)}function Ta(a,t,r){return a.map((o,f)=>Ar(o,t[f],r))}class ti{constructor(t,r,o,f=1,g=!0){this.r=t,this.g=r,this.b=o,this.a=f,g||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[t,r,o,f]))}static parse(t){if(t instanceof ti)return t;if(typeof t!="string")return;const r=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=ci(rl,o);if(f){const[_,v,w]=f;return[_/255,v/255,w/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let v=1;return[Va(o.slice(v,v+=_)),Va(o.slice(v,v+=_)),Va(o.slice(v,v+=_)),Va(o.slice(v,v+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,w,M,P,D,B,j,G,$,ee,ae,we]=_,de=[P||" ",j||" ",ee].join("");if(de==="  "||de==="  /"||de===",,"||de===",,,"){const F=[M,B,$].join(""),J=F==="%%%"?100:F===""?255:0;if(J){const me=[yo(+w/J,0,1),yo(+D/J,0,1),yo(+G/J,0,1),ae?wa(+ae,we):1];if(Du(me))return me}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,v,w,M,P,D,B,j,G]=g,$=[w||" ",P||" ",B].join("");if($==="  "||$==="  /"||$===",,"||$===",,,"){const ee=[+v,yo(+M,0,100),yo(+D,0,100),j?wa(+j,G):1];if(Du(ee))return function([ae,we,de,F]){function J(me){const De=(me+ae/30)%12,et=we*Math.min(de,1-de);return de-et*Math.max(-1,Math.min(De-3,9-De,1))}return ae=Bc(ae),we/=100,de/=100,[J(0),J(8),J(4),F]}(ee)}}}(t);return r?new ti(...r,!1):void 0}get rgb(){const{r:t,g:r,b:o,a:f}=this,g=f||1/0;return this.overwriteGetter("rgb",[t/g,r/g,o/g,f])}get hcl(){return this.overwriteGetter("hcl",function(t){const[r,o,f,g]=_o(t),_=Math.sqrt(o*o+f*f);return[Math.round(1e4*_)?Bc(Math.atan2(f,o)*aa):NaN,_,r,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",_o(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,o,f]=this.rgb;return`rgba(${[t,r,o].map(g=>Math.round(255*g)).join(",")},${f})`}static interpolate(t,r,o,f="rgb"){switch(f){case"rgb":{const[g,_,v,w]=Ta(t.rgb,r.rgb,o);return new ti(g,_,v,w,!1)}case"hcl":{const[g,_,v,w]=t.hcl,[M,P,D,B]=r.hcl;let j,G;if(isNaN(g)||isNaN(M))isNaN(g)?isNaN(M)?j=NaN:(j=M,v!==1&&v!==0||(G=P)):(j=g,D!==1&&D!==0||(G=_));else{let de=M-g;M>g&&de>180?de-=360:M<g&&g-M>180&&(de+=360),j=g+o*de}const[$,ee,ae,we]=function([de,F,J,me]){return de=isNaN(de)?0:de*Yl,Iu([J,Math.cos(de)*F,Math.sin(de)*F,me])}([j,G??Ar(_,P,o),Ar(v,D,o),Ar(w,B,o)]);return new ti($,ee,ae,we,!1)}case"lab":{const[g,_,v,w]=Iu(Ta(t.lab,r.lab,o));return new ti(g,_,v,w,!1)}}}}ti.black=new ti(0,0,0,1),ti.white=new ti(1,1,1,1),ti.transparent=new ti(0,0,0,0),ti.red=new ti(1,0,0,1);class Ga{constructor(t,r,o){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Ql=["bottom","center","top"];class Jl{constructor(t,r,o,f,g,_){this.text=t,this.image=r,this.scale=o,this.fontStack=f,this.textColor=g,this.verticalAlign=_}}class nr{constructor(t){this.sections=t}static fromString(t){return new nr([new Jl(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof nr?t:nr.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class cn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof cn)return t;if(typeof t=="number")return new cn([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new cn(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new cn(Ta(t.values,r.values,o))}}class un{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof un)return t;if(typeof t=="number")return new un([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new un(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){return new un(Ta(t.values,r.values,o))}}class On{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof On)return t;if(typeof t=="string"){const o=ti.parse(t);return o?new On([o]):void 0}if(!Array.isArray(t))return;const r=[];for(const o of t){if(typeof o!="string")return;const f=ti.parse(o);if(!f)return;r.push(f)}return new On(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o,f="rgb"){const g=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let _=0;_<t.values.length;_++)g.push(ti.interpolate(t.values[_],r.values[_],o,f));return new On(g)}}class Bi extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const Sa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class hi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof hi)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const o=t[r],f=t[r+1];if(typeof o!="string"||!Sa.has(o)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new hi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,o){const f=t.values,g=r.values;if(f.length!==g.length)throw new Bi(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const _=[];for(let v=0;v<f.length;v+=2){if(f[v]!==g[v])throw new Bi(`Cannot interpolate values containing mismatched anchors. from[${v}]: ${f[v]}, to[${v}]: ${g[v]}`);_.push(f[v]);const[w,M]=f[v+1],[P,D]=g[v+1];_.push([Ar(w,P,o),Ar(M,D,o)])}return new hi(_)}}class rr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new rr({name:t,available:!1}):null}}class Kt{constructor(t,r,o){this.from=t,this.to=r,this.transition=o}static interpolate(t,r,o){return new Kt(t,r,o)}static parse(t){return t instanceof Kt?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new Kt(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new Kt(t.from,t.to,t.transition):typeof t=="string"?new Kt(t,t,1):void 0}}function Qt(a,t,r,o){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[a,t,r,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[a,t,r,o]:[a,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Za(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Kt||a instanceof ti||a instanceof Ga||a instanceof nr||a instanceof cn||a instanceof un||a instanceof On||a instanceof hi||a instanceof rr)return!0;if(Array.isArray(a)){for(const t of a)if(!Za(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!Za(a[t]))return!1;return!0}return!1}function Vt(a){if(a===null)return na;if(typeof a=="string")return Xt;if(typeof a=="boolean")return Ot;if(typeof a=="number")return mt;if(a instanceof ti)return Cr;if(a instanceof Kt)return $l;if(a instanceof Ga)return ls;if(a instanceof nr)return Ds;if(a instanceof cn)return xn;if(a instanceof un)return Ls;if(a instanceof On)return Hl;if(a instanceof hi)return Ur;if(a instanceof rr)return ra;if(Array.isArray(a)){const t=a.length;let r;for(const o of a){const f=Vt(o);if(r){if(r===f)continue;r=Yt;break}r=f}return vr(r||Yt,t)}return ur}function Bn(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof ti||a instanceof Kt||a instanceof nr||a instanceof cn||a instanceof un||a instanceof On||a instanceof hi||a instanceof rr?a.toString():JSON.stringify(a)}class Mn{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Za(t[1]))return r.error("invalid value");const o=t[1];let f=Vt(o);const g=r.expectedType;return f.kind!=="array"||f.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(f=g),new Mn(f,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const fs={string:Xt,number:mt,boolean:Ot,object:ur};class Kn{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o,f=1;const g=t[0];if(g==="array"){let v,w;if(t.length>2){const M=t[1];if(typeof M!="string"||!(M in fs)||M==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);v=fs[M],f++}else v=Yt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);w=t[2],f++}o=vr(v,w)}else{if(!fs[g])throw new Error(`Types doesn't contain name = ${g}`);o=fs[g]}const _=[];for(;f<t.length;f++){const v=r.parse(t[f],f,Yt);if(!v)return null;_.push(v)}return new Kn(o,_)}evaluate(t){for(let r=0;r<this.args.length;r++){const o=this.args[r].evaluate(t);if(!mo(this.type,Vt(o)))return o;if(r===this.args.length-1)throw new Bi(`Expected value to be of type ${sn(this.type)}, but found ${sn(Vt(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Lu={"to-boolean":Ot,"to-color":Cr,"to-number":mt,"to-string":Xt};class sa{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[0];if(!Lu[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return r.error("Expected one argument.");const f=Lu[o],g=[];for(let _=1;_<t.length;_++){const v=r.parse(t[_],_,Yt);if(!v)return null;g.push(v)}return new sa(f,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,o;for(const f of this.args){if(r=f.evaluate(t),o=null,r instanceof ti)return r;if(typeof r=="string"){const g=t.parseColor(r);if(g)return g}else if(Array.isArray(r)&&(o=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:Qt(r[0],r[1],r[2],r[3]),!o))return new ti(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new Bi(o||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const o of this.args){r=o.evaluate(t);const f=cn.parse(r);if(f)return f}throw new Bi(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const o of this.args){r=o.evaluate(t);const f=un.parse(r);if(f)return f}throw new Bi(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const o of this.args){r=o.evaluate(t);const f=On.parse(r);if(f)return f}throw new Bi(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const o of this.args){r=o.evaluate(t);const f=hi.parse(r);if(f)return f}throw new Bi(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const o of this.args){if(r=o.evaluate(t),r===null)return 0;const f=Number(r);if(!isNaN(f))return f}throw new Bi(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return nr.fromString(Bn(this.args[0].evaluate(t)));case"resolvedImage":return rr.fromString(Bn(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return Bn(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Nc=["Unknown","Point","LineString","Polygon"];class al{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Nc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=ti.parse(t),this._parseColorCache.set(t,r)),r}}class Os{constructor(t,r,o=[],f,g=new jr,_=[]){this.registry=t,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=_,this.expectedType=f,this._isConstant=r}parse(t,r,o,f,g={}){return r?this.concat(r,o,f)._parse(t,g):this._parse(t,g)}_parse(t,r){function o(f,g,_){return _==="assert"?new Kn(g,[f]):_==="coerce"?new sa(g,[f]):f}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=t[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[f];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,w=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value"){if(v.kind==="projectionDefinition"&&["string","array"].includes(w.kind)||["color","formatted","resolvedImage"].includes(v.kind)&&["value","string"].includes(w.kind)||["padding","numberArray"].includes(v.kind)&&["value","number","array"].includes(w.kind)||v.kind==="colorArray"&&["value","string","array"].includes(w.kind)||v.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(w.kind))_=o(_,v,r.typeAnnotation||"coerce");else if(this.checkSubtype(v,w))return null}else _=o(_,v,r.typeAnnotation||"assert")}if(!(_ instanceof Mn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new al;try{_=new Mn(_.type,_.evaluate(v))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,o){const f=typeof t=="number"?this.path.concat(t):this.path,g=o?this.scope.concat(o):this.scope;return new Os(this.registry,this._isConstant,f,r||null,g,this.errors)}error(t,...r){const o=`${this.key}${r.map(f=>`[${f}]`).join("")}`;this.errors.push(new Qi(o,t))}checkSubtype(t,r){const o=mo(t,r);return o&&this.error(o),o}}class sl{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return r.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return r.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=r.parse(t[g+1],g+1);if(!v)return null;o.push([_,v])}const f=r.parse(t[t.length-1],t.length-1,r.expectedType,o);return f?new sl(o,f):null}outputDefined(){return this.result.outputDefined()}}class Ma{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const o=t[1];return r.scope.has(o)?new Ma(o,r.scope.get(o)):r.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Wn{constructor(t,r,o){this.type=t,this.index=r,this.input=o}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,mt),f=r.parse(t[2],2,vr(r.expectedType||Yt));return o&&f?new Wn(f.type.itemType,o,f):null}evaluate(t){const r=this.index.evaluate(t),o=this.input.evaluate(t);if(r<0)throw new Bi(`Array index out of bounds: ${r} < 0.`);if(r>=o.length)throw new Bi(`Array index out of bounds: ${r} > ${o.length-1}.`);if(r!==Math.floor(r))throw new Bi(`Array index must be an integer, but found ${r} instead.`);return o[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class ol{constructor(t,r){this.type=Ot,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Yt),f=r.parse(t[2],2,Yt);return o&&f?nl(o.type,[Ot,Xt,mt,na,Yt])?new ol(o,f):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(o.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!go(r,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${sn(Vt(r))} instead.`);if(!go(o,["string","array"]))throw new Bi(`Expected second argument to be of type array or string, but found ${sn(Vt(o))} instead.`);return o.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class vo{constructor(t,r,o){this.type=mt,this.needle=t,this.haystack=r,this.fromIndex=o}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Yt),f=r.parse(t[2],2,Yt);if(!o||!f)return null;if(!nl(o.type,[Ot,Xt,mt,na,Yt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${sn(o.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,mt);return g?new vo(o,f,g):null}return new vo(o,f)}evaluate(t){const r=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!go(r,["boolean","string","number","null"]))throw new Bi(`Expected first argument to be of type boolean, string, number or null, but found ${sn(Vt(r))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(t)),go(o,["string"])){const g=o.indexOf(r,f);return g===-1?-1:[...o.slice(0,g)].length}if(go(o,["array"]))return o.indexOf(r,f);throw new Bi(`Expected second argument to be of type array or string, but found ${sn(Vt(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class ll{constructor(t,r,o,f,g,_){this.inputType=t,this.type=r,this.input=o,this.cases=f,this.outputs=g,this.otherwise=_}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let o,f;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);const g={},_=[];for(let M=2;M<t.length-1;M+=2){let P=t[M];const D=t[M+1];Array.isArray(P)||(P=[P]);const B=r.concat(M);if(P.length===0)return B.error("Expected at least one branch label.");for(const G of P){if(typeof G!="number"&&typeof G!="string")return B.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return B.error("Numeric branch labels must be integer values.");if(o){if(B.checkSubtype(o,Vt(G)))return null}else o=Vt(G);if(g[String(G)]!==void 0)return B.error("Branch labels must be unique.");g[String(G)]=_.length}const j=r.parse(D,M,f);if(!j)return null;f=f||j.type,_.push(j)}const v=r.parse(t[1],1,Yt);if(!v)return null;const w=r.parse(t[t.length-1],t.length-1,f);return w?v.type.kind!=="value"&&r.concat(1).checkSubtype(o,v.type)?null:new ll(o,f,v,g,_,w):null}evaluate(t){const r=this.input.evaluate(t);return(Vt(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class Nn{constructor(t,r,o){this.type=t,this.branches=r,this.otherwise=o}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let o;r.expectedType&&r.expectedType.kind!=="value"&&(o=r.expectedType);const f=[];for(let _=1;_<t.length-1;_+=2){const v=r.parse(t[_],_,Ot);if(!v)return null;const w=r.parse(t[_+1],_+1,o);if(!w)return null;f.push([v,w]),o=o||w.type}const g=r.parse(t[t.length-1],t.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new Nn(o,f,g)}evaluate(t){for(const[r,o]of this.branches)if(r.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,o]of this.branches)t(r),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,r])=>r.outputDefined())&&this.otherwise.outputDefined()}}class ec{constructor(t,r,o,f){this.type=t,this.input=r,this.beginIndex=o,this.endIndex=f}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=r.parse(t[1],1,Yt),f=r.parse(t[2],2,mt);if(!o||!f)return null;if(!nl(o.type,[vr(Yt),Xt,Yt]))return r.error(`Expected first argument to be of type array or string, but found ${sn(o.type)} instead`);if(t.length===4){const g=r.parse(t[3],3,mt);return g?new ec(o.type,o,f,g):null}return new ec(o.type,o,f)}evaluate(t){const r=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let f;if(this.endIndex&&(f=this.endIndex.evaluate(t)),go(r,["string"]))return[...r].slice(o,f).join("");if(go(r,["array"]))return r.slice(o,f);throw new Bi(`Expected first argument to be of type array or string, but found ${sn(Vt(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function cl(a,t){const r=a.length-1;let o,f,g=0,_=r,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),o=a[v],f=a[v+1],o<=t){if(v===r||t<f)return v;g=v+1}else{if(!(o>t))throw new Bi("Input is not a number.");_=v-1}return 0}class ul{constructor(t,r,o){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[f,g]of o)this.labels.push(f),this.outputs.push(g)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const o=r.parse(t[1],1,mt);if(!o)return null;const f=[];let g=null;r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],w=t[_+1],M=_,P=_+1;if(typeof v!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(f.length&&f[f.length-1][0]>=v)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',M);const D=r.parse(w,P,g);if(!D)return null;g=g||D.type,f.push([v,D])}return new ul(g,o,f)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const f=this.input.evaluate(t);if(f<=r[0])return o[0].evaluate(t);const g=r.length;return f>=r[g-1]?o[g-1].evaluate(t):o[cl(r,f)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function Bh(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var Bs,tc,ku=function(){if(tc)return Bs;function a(t,r,o,f){this.cx=3*t,this.bx=3*(o-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(f-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=o,this.p2y=f}return tc=1,Bs=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var o=t,f=0;f<8;f++){var g=this.sampleCurveX(o)-t;if(Math.abs(g)<r)return o;var _=this.sampleCurveDerivativeX(o);if(Math.abs(_)<1e-6)break;o-=g/_}var v=0,w=1;for(o=t,f=0;f<20&&(g=this.sampleCurveX(o),!(Math.abs(g-t)<r));f++)t>g?v=o:w=o,o=.5*(w-v)+v;return o},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Bs}(),If=Bh(ku);class ar{constructor(t,r,o,f,g){this.type=t,this.operator=r,this.interpolation=o,this.input=f,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,r,o,f){let g=0;if(t.name==="exponential")g=hl(r,t.base,o,f);else if(t.name==="linear")g=hl(r,1,o,f);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new If(_[0],_[1],_[2],_[3]).solve(hl(r,1,o,f))}return g}static parse(t,r){let[o,f,g,..._]=t;if(!Array.isArray(f)||f.length===0)return r.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const M=f[1];if(typeof M!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:M}}else{if(f[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const M=f.slice(1);if(M.length!==4||M.some(P=>typeof P!="number"||P<0||P>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:M}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(g=r.parse(g,2,mt),!g)return null;const v=[];let w=null;o!=="interpolate-hcl"&&o!=="interpolate-lab"||r.expectedType==Hl?r.expectedType&&r.expectedType.kind!=="value"&&(w=r.expectedType):w=Cr;for(let M=0;M<_.length;M+=2){const P=_[M],D=_[M+1],B=M+3,j=M+4;if(typeof P!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(v.length&&v[v.length-1][0]>=P)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const G=r.parse(D,j,w);if(!G)return null;w=w||G.type,v.push([P,G])}return cs(w,mt)||cs(w,$l)||cs(w,Cr)||cs(w,xn)||cs(w,Ls)||cs(w,Hl)||cs(w,Ur)||cs(w,vr(mt))?new ar(w,o,f,g,v):r.error(`Type ${sn(w)} is not interpolatable.`)}evaluate(t){const r=this.labels,o=this.outputs;if(r.length===1)return o[0].evaluate(t);const f=this.input.evaluate(t);if(f<=r[0])return o[0].evaluate(t);const g=r.length;if(f>=r[g-1])return o[g-1].evaluate(t);const _=cl(r,f),v=ar.interpolationFactor(this.interpolation,f,r[_],r[_+1]),w=o[_].evaluate(t),M=o[_+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Ar(w,M,v);case"color":return ti.interpolate(w,M,v);case"padding":return cn.interpolate(w,M,v);case"colorArray":return On.interpolate(w,M,v);case"numberArray":return un.interpolate(w,M,v);case"variableAnchorOffsetCollection":return hi.interpolate(w,M,v);case"array":return Ta(w,M,v);case"projectionDefinition":return Kt.interpolate(w,M,v)}case"interpolate-hcl":switch(this.type.kind){case"color":return ti.interpolate(w,M,v,"hcl");case"colorArray":return On.interpolate(w,M,v,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return ti.interpolate(w,M,v,"lab");case"colorArray":return On.interpolate(w,M,v,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function hl(a,t,r,o){const f=o-r,g=a-r;return f===0?0:t===1?g/f:(Math.pow(t,g)-1)/(Math.pow(t,f)-1)}const Gr={color:ti.interpolate,number:Ar,padding:cn.interpolate,numberArray:un.interpolate,colorArray:On.interpolate,variableAnchorOffsetCollection:hi.interpolate,array:Ta};class Pr{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let o=null;const f=r.expectedType;f&&f.kind!=="value"&&(o=f);const g=[];for(const v of t.slice(1)){const w=r.parse(v,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,g.push(w)}if(!o)throw new Error("No output type");const _=f&&g.some(v=>mo(f,v.type));return new Pr(_?Yt:o,g)}evaluate(t){let r,o=null,f=0;for(const g of this.args)if(f++,o=g.evaluate(t),o&&o instanceof rr&&!o.available&&(r||(r=o.name),o=null,f===this.args.length&&(o=r)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function Fc(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function ic(a,t,r,o){return o.compare(t,r)===0}function fl(a,t,r){const o=a!=="=="&&a!=="!=";return class hg{constructor(g,_,v){this.type=Ot,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let w=_.parse(g[1],1,Yt);if(!w)return null;if(!Fc(v,w.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${sn(w.type)}'.`);let M=_.parse(g[2],2,Yt);if(!M)return null;if(!Fc(v,M.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${sn(M.type)}'.`);if(w.type.kind!==M.type.kind&&w.type.kind!=="value"&&M.type.kind!=="value")return _.error(`Cannot compare types '${sn(w.type)}' and '${sn(M.type)}'.`);o&&(w.type.kind==="value"&&M.type.kind!=="value"?w=new Kn(M.type,[w]):w.type.kind!=="value"&&M.type.kind==="value"&&(M=new Kn(w.type,[M])));let P=null;if(g.length===4){if(w.type.kind!=="string"&&M.type.kind!=="string"&&w.type.kind!=="value"&&M.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(P=_.parse(g[3],3,ls),!P)return null}return new hg(w,M,P)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const w=Vt(_),M=Vt(v);if(w.kind!==M.kind||w.kind!=="string"&&w.kind!=="number")throw new Bi(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${w.kind}, ${M.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=Vt(_),M=Vt(v);if(w.kind!=="string"||M.kind!=="string")return t(g,_,v)}return this.collator?r(g,_,v,this.collator.evaluate(g)):t(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Ou=fl("==",function(a,t,r){return t===r},ic),Df=fl("!=",function(a,t,r){return t!==r},function(a,t,r,o){return!ic(0,t,r,o)}),Lf=fl("<",function(a,t,r){return t<r},function(a,t,r,o){return o.compare(t,r)<0}),kf=fl(">",function(a,t,r){return t>r},function(a,t,r,o){return o.compare(t,r)>0}),Of=fl("<=",function(a,t,r){return t<=r},function(a,t,r,o){return o.compare(t,r)<=0}),jc=fl(">=",function(a,t,r){return t>=r},function(a,t,r,o){return o.compare(t,r)>=0});class Uc{constructor(t,r,o){this.type=ls,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return r.error("Collator options argument must be an object.");const f=r.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,Ot);if(!f)return null;const g=r.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,Ot);if(!g)return null;let _=null;return o.locale&&(_=r.parse(o.locale,1,Xt),!_)?null:new Uc(f,g,_)}evaluate(t){return new Ga(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class dl{constructor(t,r,o,f,g){this.type=Xt,this.number=t,this.locale=r,this.currency=o,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const o=r.parse(t[1],1,mt);if(!o)return null;const f=t[2];if(typeof f!="object"||Array.isArray(f))return r.error("NumberFormat options argument must be an object.");let g=null;if(f.locale&&(g=r.parse(f.locale,1,Xt),!g))return null;let _=null;if(f.currency&&(_=r.parse(f.currency,1,Xt),!_))return null;let v=null;if(f["min-fraction-digits"]&&(v=r.parse(f["min-fraction-digits"],1,mt),!v))return null;let w=null;return f["max-fraction-digits"]&&(w=r.parse(f["max-fraction-digits"],1,mt),!w)?null:new dl(o,g,_,v,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ds{constructor(t){this.type=Ds,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return r.error("First argument must be an image or text section.");const f=[];let g=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let w=null;if(v["font-scale"]&&(w=r.parse(v["font-scale"],1,mt),!w))return null;let M=null;if(v["text-font"]&&(M=r.parse(v["text-font"],1,vr(Xt)),!M))return null;let P=null;if(v["text-color"]&&(P=r.parse(v["text-color"],1,Cr),!P))return null;let D=null;if(v["vertical-align"]){if(typeof v["vertical-align"]=="string"&&!Ql.includes(v["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${v["vertical-align"]}' instead.`);if(D=r.parse(v["vertical-align"],1,Xt),!D)return null}const B=f[f.length-1];B.scale=w,B.font=M,B.textColor=P,B.verticalAlign=D}else{const w=r.parse(t[_],1,Yt);if(!w)return null;const M=w.type.kind;if(M!=="string"&&M!=="value"&&M!=="null"&&M!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,f.push({content:w,scale:null,font:null,textColor:null,verticalAlign:null})}}return new ds(f)}evaluate(t){return new nr(this.sections.map(r=>{const o=r.content.evaluate(t);return Vt(o)===ra?new Jl("",o,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new Jl(Bn(o),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)}))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Bu{constructor(t){this.type=ra,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const o=r.parse(t[1],1,Xt);return o?new Bu(o):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),o=rr.fromString(r);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(r)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class nc{constructor(t){this.type=mt,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=r.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${sn(o.type)} instead.`):new nc(o):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new Bi(`Expected value to be of type string or array, but found ${sn(Vt(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const Ea=8192;function Nh(a,t){const r=(180+a[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,f=Math.pow(2,t.z);return[Math.round(r*f*Ea),Math.round(o*f*Ea)]}function Vc(a,t){const r=Math.pow(2,t.z);return[(f=(a[0]/Ea+t.x)/r,360*f-180),(o=(a[1]/Ea+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,f}function pl(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function qa(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function Fh(a,t,r){const o=a[0]-t[0],f=a[1]-t[1],g=a[0]-r[0],_=a[1]-r[1];return o*_-g*f==0&&o*g<=0&&f*_<=0}function rc(a,t,r,o){return(f=[o[0]-r[0],o[1]-r[1]])[0]*(g=[t[0]-a[0],t[1]-a[1]])[1]-f[1]*g[0]!=0&&!(!Gc(a,t,r,o)||!Gc(r,o,a,t));var f,g}function jh(a,t,r){for(const o of r)for(let f=0;f<o.length-1;++f)if(rc(a,t,o[f],o[f+1]))return!0;return!1}function xo(a,t,r=!1){let o=!1;for(const v of t)for(let w=0;w<v.length-1;w++){if(Fh(a,v[w],v[w+1]))return r;(g=v[w])[1]>(f=a)[1]!=(_=v[w+1])[1]>f[1]&&f[0]<(_[0]-g[0])*(f[1]-g[1])/(_[1]-g[1])+g[0]&&(o=!o)}var f,g,_;return o}function Uh(a,t){for(const r of t)if(xo(a,r))return!0;return!1}function ml(a,t){for(const r of a)if(!xo(r,t))return!1;for(let r=0;r<a.length-1;++r)if(jh(a[r],a[r+1],t))return!1;return!0}function ac(a,t){for(const r of t)if(ml(a,r))return!0;return!1}function Gc(a,t,r,o){const f=o[0]-r[0],g=o[1]-r[1],_=(a[0]-r[0])*g-f*(a[1]-r[1]),v=(t[0]-r[0])*g-f*(t[1]-r[1]);return _>0&&v<0||_<0&&v>0}function gl(a,t,r){const o=[];for(let f=0;f<a.length;f++){const g=[];for(let _=0;_<a[f].length;_++){const v=Nh(a[f][_],r);pl(t,v),g.push(v)}o.push(g)}return o}function Nu(a,t,r){const o=[];for(let f=0;f<a.length;f++){const g=gl(a[f],t,r);o.push(g)}return o}function Fu(a,t,r,o){if(a[0]<r[0]||a[0]>r[2]){const f=.5*o;let g=a[0]-r[0]>f?-o:r[0]-a[0]>f?o:0;g===0&&(g=a[0]-r[2]>f?-o:r[2]-a[0]>f?o:0),a[0]+=g}pl(t,a)}function sc(a,t,r,o){const f=Math.pow(2,o.z)*Ea,g=[o.x*Ea,o.y*Ea],_=[];for(const v of a)for(const w of v){const M=[w.x+g[0],w.y+g[1]];Fu(M,t,r,f),_.push(M)}return _}function oc(a,t,r,o){const f=Math.pow(2,o.z)*Ea,g=[o.x*Ea,o.y*Ea],_=[];for(const w of a){const M=[];for(const P of w){const D=[P.x+g[0],P.y+g[1]];pl(t,D),M.push(D)}_.push(M)}if(t[2]-t[0]<=f/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of _)for(const M of w)Fu(M,t,r,f)}var v;return _}class Ns{constructor(t,r){this.type=Ot,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Za(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const f=[];for(const g of o.features){const{type:_,coordinates:v}=g.geometry;_==="Polygon"&&f.push(v),_==="MultiPolygon"&&f.push(...v)}if(f.length)return new Ns(o,{type:"MultiPolygon",coordinates:f})}else if(o.type==="Feature"){const f=o.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Ns(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Ns(o,o)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const v=gl(o.coordinates,g,_),w=sc(r.geometry(),f,g,_);if(!qa(f,g))return!1;for(const M of w)if(!xo(M,v))return!1}if(o.type==="MultiPolygon"){const v=Nu(o.coordinates,g,_),w=sc(r.geometry(),f,g,_);if(!qa(f,g))return!1;for(const M of w)if(!Uh(M,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const f=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=r.canonicalID();if(o.type==="Polygon"){const v=gl(o.coordinates,g,_),w=oc(r.geometry(),f,g,_);if(!qa(f,g))return!1;for(const M of w)if(!ml(M,v))return!1}if(o.type==="MultiPolygon"){const v=Nu(o.coordinates,g,_),w=oc(r.geometry(),f,g,_);if(!qa(f,g))return!1;for(const M of w)if(!ac(M,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let ju=class{constructor(a=[],t=(r,o)=>r<o?-1:r>o?1:0){if(this.data=a,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(a){this.data.push(a),this._up(this.length++)}pop(){if(this.length===0)return;const a=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:t,compare:r}=this,o=t[a];for(;a>0;){const f=a-1>>1,g=t[f];if(r(o,g)>=0)break;t[a]=g,a=f}t[a]=o}_down(a){const{data:t,compare:r}=this,o=this.length>>1,f=t[a];for(;a<o;){let g=1+(a<<1);const _=g+1;if(_<this.length&&r(t[_],t[g])<0&&(g=_),r(t[g],f)>=0)break;t[a]=t[g],a=g}t[a]=f}};function Zc(a,t,r=0,o=a.length-1,f=Bf){for(;o>r;){if(o-r>600){const w=o-r+1,M=t-r+1,P=Math.log(w),D=.5*Math.exp(2*P/3),B=.5*Math.sqrt(P*D*(w-D)/w)*(M-w/2<0?-1:1);Zc(a,t,Math.max(r,Math.floor(t-M*D/w+B)),Math.min(o,Math.floor(t+(w-M)*D/w+B)),f)}const g=a[t];let _=r,v=o;for(_l(a,r,t),f(a[o],g)>0&&_l(a,r,o);_<v;){for(_l(a,_,v),_++,v--;f(a[_],g)<0;)_++;for(;f(a[v],g)>0;)v--}f(a[r],g)===0?_l(a,r,v):(v++,_l(a,v,o)),v<=t&&(r=v+1),t<=v&&(o=v-1)}}function _l(a,t,r){const o=a[t];a[t]=a[r],a[r]=o}function Bf(a,t){return a<t?-1:a>t?1:0}function qc(a,t){if(a.length<=1)return[a];const r=[];let o,f;for(const g of a){const _=Vh(g);_!==0&&(g.area=Math.abs(_),f===void 0&&(f=_<0),f===_<0?(o&&r.push(o),o=[g]):o.push(g))}if(o&&r.push(o),t>1)for(let g=0;g<r.length;g++)r[g].length<=t||(Zc(r[g],t,1,r[g].length-1,Nf),r[g]=r[g].slice(0,t));return r}function Nf(a,t){return t.area-a.area}function Vh(a){let t=0;for(let r,o,f=0,g=a.length,_=g-1;f<g;_=f++)r=a[f],o=a[_],t+=(o.x-r.x)*(r.y+o.y);return t}const zr=1/298.257223563,yl=zr*(2-zr),Uu=Math.PI/180;class $c{constructor(t){const r=6378.137*Uu*1e3,o=Math.cos(t*Uu),f=1/(1-yl*(1-o*o)),g=Math.sqrt(f);this.kx=r*g*o,this.ky=r*g*f*(1-yl)}distance(t,r){const o=this.wrap(t[0]-r[0])*this.kx,f=(t[1]-r[1])*this.ky;return Math.sqrt(o*o+f*f)}pointOnLine(t,r){let o,f,g,_,v=1/0;for(let w=0;w<t.length-1;w++){let M=t[w][0],P=t[w][1],D=this.wrap(t[w+1][0]-M)*this.kx,B=(t[w+1][1]-P)*this.ky,j=0;D===0&&B===0||(j=(this.wrap(r[0]-M)*this.kx*D+(r[1]-P)*this.ky*B)/(D*D+B*B),j>1?(M=t[w+1][0],P=t[w+1][1]):j>0&&(M+=D/this.kx*j,P+=B/this.ky*j)),D=this.wrap(r[0]-M)*this.kx,B=(r[1]-P)*this.ky;const G=D*D+B*B;G<v&&(v=G,o=M,f=P,g=w,_=j)}return{point:[o,f],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function bi(a,t){return t[0]-a[0]}function lc(a){return a[1]-a[0]+1}function Ca(a,t){return a[1]>=a[0]&&a[1]<t}function Vu(a,t){if(a[0]>a[1])return[null,null];const r=lc(a);if(t){if(r===2)return[a,null];const f=Math.floor(r/2);return[[a[0],a[0]+f],[a[0]+f,a[1]]]}if(r===1)return[a,null];const o=Math.floor(r/2)-1;return[[a[0],a[0]+o],[a[0]+o+1,a[1]]]}function Fs(a,t){if(!Ca(t,a.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)pl(r,a[o]);return r}function cc(a){const t=[1/0,1/0,-1/0,-1/0];for(const r of a)for(const o of r)pl(t,o);return t}function vl(a){return a[0]!==-1/0&&a[1]!==-1/0&&a[2]!==1/0&&a[3]!==1/0}function uc(a,t,r){if(!vl(a)||!vl(t))return NaN;let o=0,f=0;return a[2]<t[0]&&(o=t[0]-a[2]),a[0]>t[2]&&(o=a[0]-t[2]),a[1]>t[3]&&(f=a[1]-t[3]),a[3]<t[1]&&(f=t[1]-a[3]),r.distance([0,0],[o,f])}function js(a,t,r){const o=r.pointOnLine(t,a);return r.distance(a,o.point)}function ps(a,t,r,o,f){const g=Math.min(js(a,[r,o],f),js(t,[r,o],f)),_=Math.min(js(r,[a,t],f),js(o,[a,t],f));return Math.min(g,_)}function xl(a,t,r,o,f){if(!Ca(t,a.length)||!Ca(o,r.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const v=a[_],w=a[_+1];for(let M=o[0];M<o[1];++M){const P=r[M],D=r[M+1];if(rc(v,w,P,D))return 0;g=Math.min(g,ps(v,w,P,D,f))}}return g}function Gu(a,t,r,o,f){if(!Ca(t,a.length)||!Ca(o,r.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let v=o[0];v<=o[1];++v)if(g=Math.min(g,f.distance(a[_],r[v])),g===0)return g;return g}function Gh(a,t,r){if(xo(a,t,!0))return 0;let o=1/0;for(const f of t){const g=f[0],_=f[f.length-1];if(g!==_&&(o=Math.min(o,js(a,[_,g],r)),o===0))return o;const v=r.pointOnLine(f,a);if(o=Math.min(o,r.distance(a,v.point)),o===0)return o}return o}function bo(a,t,r,o){if(!Ca(t,a.length))return NaN;for(let g=t[0];g<=t[1];++g)if(xo(a[g],r,!0))return 0;let f=1/0;for(let g=t[0];g<t[1];++g){const _=a[g],v=a[g+1];for(const w of r)for(let M=0,P=w.length,D=P-1;M<P;D=M++){const B=w[D],j=w[M];if(rc(_,v,B,j))return 0;f=Math.min(f,ps(_,v,B,j,o))}}return f}function Zu(a,t){for(const r of a)for(const o of r)if(xo(o,t,!0))return!0;return!1}function Zh(a,t,r,o=1/0){const f=cc(a),g=cc(t);if(o!==1/0&&uc(f,g,r)>=o)return o;if(qa(f,g)){if(Zu(a,t))return 0}else if(Zu(t,a))return 0;let _=1/0;for(const v of a)for(let w=0,M=v.length,P=M-1;w<M;P=w++){const D=v[P],B=v[w];for(const j of t)for(let G=0,$=j.length,ee=$-1;G<$;ee=G++){const ae=j[ee],we=j[G];if(rc(D,B,ae,we))return 0;_=Math.min(_,ps(D,B,ae,we,r))}}return _}function qu(a,t,r,o,f,g){if(!g)return;const _=uc(Fs(o,g),f,r);_<t&&a.push([_,g,[0,0]])}function Hc(a,t,r,o,f,g,_){if(!g||!_)return;const v=uc(Fs(o,g),Fs(f,_),r);v<t&&a.push([v,g,_])}function Xc(a,t,r,o,f=1/0){let g=Math.min(o.distance(a[0],r[0][0]),f);if(g===0)return g;const _=new ju([[0,[0,a.length-1],[0,0]]],bi),v=cc(r);for(;_.length>0;){const w=_.pop();if(w[0]>=g)continue;const M=w[1],P=t?50:100;if(lc(M)<=P){if(!Ca(M,a.length))return NaN;if(t){const D=bo(a,M,r,o);if(isNaN(D)||D===0)return D;g=Math.min(g,D)}else for(let D=M[0];D<=M[1];++D){const B=Gh(a[D],r,o);if(g=Math.min(g,B),g===0)return 0}}else{const D=Vu(M,t);qu(_,g,o,a,v,D[0]),qu(_,g,o,a,v,D[1])}}return g}function Yc(a,t,r,o,f,g=1/0){let _=Math.min(g,f.distance(a[0],r[0]));if(_===0)return _;const v=new ju([[0,[0,a.length-1],[0,r.length-1]]],bi);for(;v.length>0;){const w=v.pop();if(w[0]>=_)continue;const M=w[1],P=w[2],D=t?50:100,B=o?50:100;if(lc(M)<=D&&lc(P)<=B){if(!Ca(M,a.length)&&Ca(P,r.length))return NaN;let j;if(t&&o)j=xl(a,M,r,P,f),_=Math.min(_,j);else if(t&&!o){const G=a.slice(M[0],M[1]+1);for(let $=P[0];$<=P[1];++$)if(j=js(r[$],G,f),_=Math.min(_,j),_===0)return _}else if(!t&&o){const G=r.slice(P[0],P[1]+1);for(let $=M[0];$<=M[1];++$)if(j=js(a[$],G,f),_=Math.min(_,j),_===0)return _}else j=Gu(a,M,r,P,f),_=Math.min(_,j)}else{const j=Vu(M,t),G=Vu(P,o);Hc(v,_,f,a,r,j[0],G[0]),Hc(v,_,f,a,r,j[0],G[1]),Hc(v,_,f,a,r,j[1],G[0]),Hc(v,_,f,a,r,j[1],G[1])}}return _}function Kc(a){return a.type==="MultiPolygon"?a.coordinates.map(t=>({type:"Polygon",coordinates:t})):a.type==="MultiLineString"?a.coordinates.map(t=>({type:"LineString",coordinates:t})):a.type==="MultiPoint"?a.coordinates.map(t=>({type:"Point",coordinates:t})):[a]}class Us{constructor(t,r){this.type=mt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Za(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new Us(o,o.features.map(f=>Kc(f.geometry)).flat());if(o.type==="Feature")return new Us(o,Kc(o.geometry));if("type"in o&&"coordinates"in o)return new Us(o,Kc(o))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(r,o){const f=r.geometry(),g=f.flat().map(w=>Vc([w.x,w.y],r.canonical));if(f.length===0)return NaN;const _=new $c(g[0][1]);let v=1/0;for(const w of o){switch(w.type){case"Point":v=Math.min(v,Yc(g,!1,[w.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Yc(g,!1,w.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Xc(g,!1,w.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(r,o){const f=r.geometry(),g=f.flat().map(w=>Vc([w.x,w.y],r.canonical));if(f.length===0)return NaN;const _=new $c(g[0][1]);let v=1/0;for(const w of o){switch(w.type){case"Point":v=Math.min(v,Yc(g,!0,[w.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,Yc(g,!0,w.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Xc(g,!0,w.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(r,o){const f=r.geometry();if(f.length===0||f[0].length===0)return NaN;const g=qc(f,0).map(w=>w.map(M=>M.map(P=>Vc([P.x,P.y],r.canonical)))),_=new $c(g[0][0][0][1]);let v=1/0;for(const w of o)for(const M of g){switch(w.type){case"Point":v=Math.min(v,Xc([w.coordinates],!1,M,_,v));break;case"LineString":v=Math.min(v,Xc(w.coordinates,!0,M,_,v));break;case"Polygon":v=Math.min(v,Zh(M,w.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class wo{constructor(t){this.type=Yt,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=t[1];return o==null?r.error("Global state property must be defined."):typeof o!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new wo(o)}evaluate(t){var r;const o=(r=t.globals)===null||r===void 0?void 0:r.globalState;return o&&Object.keys(o).length!==0?ci(o,this.key):null}eachChild(){}outputDefined(){return!1}}const hr={"==":Ou,"!=":Df,">":kf,"<":Lf,">=":jc,"<=":Of,array:Kn,at:Wn,boolean:Kn,case:Nn,coalesce:Pr,collator:Uc,format:ds,image:Bu,in:ol,"index-of":vo,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:nc,let:sl,literal:Mn,match:ll,number:Kn,"number-format":dl,object:Kn,slice:ec,step:ul,string:Kn,"to-boolean":sa,"to-color":sa,"to-number":sa,"to-string":sa,var:Ma,within:Ns,distance:Us,"global-state":wo};class Zr{constructor(t,r,o,f){this.name=t,this.type=r,this._evaluate=o,this.args=f}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const o=t[0],f=Zr.definitions[o];if(!f)return r.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(f)?f[0]:f.type,_=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,v=_.filter(([M])=>!Array.isArray(M)||M.length===t.length-1);let w=null;for(const[M,P]of v){w=new Os(r.registry,To,r.path,null,r.scope);const D=[];let B=!1;for(let j=1;j<t.length;j++){const G=t[j],$=Array.isArray(M)?M[j-1]:M.type,ee=w.parse(G,1+D.length,$);if(!ee){B=!0;break}D.push(ee)}if(!B)if(Array.isArray(M)&&M.length!==D.length)w.error(`Expected ${M.length} arguments, but found ${D.length} instead.`);else{for(let j=0;j<D.length;j++){const G=Array.isArray(M)?M[j]:M.type,$=D[j];w.concat(j+1).checkSubtype(G,$.type)}if(w.errors.length===0)return new Zr(o,g,P,D)}}if(v.length===1)r.errors.push(...w.errors);else{const M=(v.length?v:_).map(([D])=>{return B=D,Array.isArray(B)?`(${B.map(sn).join(", ")})`:`(${sn(B.type)}...)`;var B}).join(" | "),P=[];for(let D=1;D<t.length;D++){const B=r.parse(t[D],1+P.length);if(!B)return null;P.push(sn(B.type))}r.error(`Expected arguments of type ${M}, but found (${P.join(", ")}) instead.`)}return null}static register(t,r){Zr.definitions=r;for(const o in r)t[o]=Zr}}function qr(a,[t,r,o,f]){t=t.evaluate(a),r=r.evaluate(a),o=o.evaluate(a);const g=f?f.evaluate(a):1,_=Qt(t,r,o,g);if(_)throw new Bi(_);return new ti(t/255,r/255,o/255,g,!1)}function $r(a,t){return a in t}function Vs(a,t){const r=t[a];return r===void 0?null:r}function ms(a){return{type:a}}function To(a){if(a instanceof Ma)return To(a.boundExpression);if(a instanceof Zr&&a.name==="error"||a instanceof Uc||a instanceof Ns||a instanceof Us||a instanceof wo)return!1;const t=a instanceof sa||a instanceof Kn;let r=!0;return a.eachChild(o=>{r=t?r&&To(o):r&&o instanceof Mn}),!!r&&So(a)&&Aa(a,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function So(a){if(a instanceof Zr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ns||a instanceof Us)return!1;let t=!0;return a.eachChild(r=>{t&&!So(r)&&(t=!1)}),t}function Mo(a){if(a instanceof Zr&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(r=>{t&&!Mo(r)&&(t=!1)}),t}function Aa(a,t){if(a instanceof Zr&&t.indexOf(a.name)>=0)return!1;let r=!0;return a.eachChild(o=>{r&&!Aa(o,t)&&(r=!1)}),r}function $u(a){return{result:"success",value:a}}function gs(a){return{result:"error",value:a}}function Pa(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function Hu(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function xr(a){return!!a.expression&&a.expression.interpolated}function si(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function br(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)&&Vt(a)===ur}function Xu(a){return a}function hc(a,t){const r=a.stops&&typeof a.stops[0][0]=="object",o=r||!(r||a.property!==void 0),f=a.type||(xr(t)?"exponential":"interval"),g=function(P){switch(P.type){case"color":return ti.parse;case"padding":return cn.parse;case"numberArray":return un.parse;case"colorArray":return On.parse;default:return null}}(t);if(g&&((a=Sn({},a)).stops&&(a.stops=a.stops.map(P=>[P[0],g(P[1])])),a.default=g(a.default?a.default:t.default)),a.colorSpace&&(_=a.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var _;const v=function(P){switch(P){case"exponential":return Eo;case"interval":return Ku;case"categorical":return Yu;case"identity":return Co;default:throw new Error(`Unknown function type "${P}"`)}}(f);let w,M;if(f==="categorical"){w=Object.create(null);for(const P of a.stops)w[P[0]]=P[1];M=typeof a.stops[0][0]}if(r){const P={},D=[];for(let G=0;G<a.stops.length;G++){const $=a.stops[G],ee=$[0].zoom;P[ee]===void 0&&(P[ee]={zoom:ee,type:a.type,property:a.property,default:a.default,stops:[]},D.push(ee)),P[ee].stops.push([$[0].value,$[1]])}const B=[];for(const G of D)B.push([P[G].zoom,hc(P[G],t)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:ar.interpolationFactor.bind(void 0,j),zoomStops:B.map(G=>G[0]),evaluate:({zoom:G},$)=>Eo({stops:B,base:a.base},t,G).evaluate(G,$)}}if(o){const P=f==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:P,interpolationFactor:ar.interpolationFactor.bind(void 0,P),zoomStops:a.stops.map(D=>D[0]),evaluate:({zoom:D})=>v(a,t,D,w,M)}}return{kind:"source",evaluate(P,D){const B=D&&D.properties?D.properties[a.property]:void 0;return B===void 0?za(a.default,t.default):v(a,t,B,w,M)}}}function za(a,t,r){return a!==void 0?a:t!==void 0?t:r!==void 0?r:void 0}function Yu(a,t,r,o,f){return za(typeof r===f?o[r]:void 0,a.default,t.default)}function Ku(a,t,r){if(si(r)!=="number")return za(a.default,t.default);const o=a.stops.length;if(o===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[o-1][0])return a.stops[o-1][1];const f=cl(a.stops.map(g=>g[0]),r);return a.stops[f][1]}function Eo(a,t,r){const o=a.base!==void 0?a.base:1;if(si(r)!=="number")return za(a.default,t.default);const f=a.stops.length;if(f===1||r<=a.stops[0][0])return a.stops[0][1];if(r>=a.stops[f-1][0])return a.stops[f-1][1];const g=cl(a.stops.map(P=>P[0]),r),_=function(P,D,B,j){const G=j-B,$=P-B;return G===0?0:D===1?$/G:(Math.pow(D,$)-1)/(Math.pow(D,G)-1)}(r,o,a.stops[g][0],a.stops[g+1][0]),v=a.stops[g][1],w=a.stops[g+1][1],M=Gr[t.type]||Xu;return typeof v.evaluate=="function"?{evaluate(...P){const D=v.evaluate.apply(void 0,P),B=w.evaluate.apply(void 0,P);if(D!==void 0&&B!==void 0)return M(D,B,_,a.colorSpace)}}:M(v,w,_,a.colorSpace)}function Co(a,t,r){switch(t.type){case"color":r=ti.parse(r);break;case"formatted":r=nr.fromString(r.toString());break;case"resolvedImage":r=rr.fromString(r.toString());break;case"padding":r=cn.parse(r);break;case"colorArray":r=On.parse(r);break;case"numberArray":r=un.parse(r);break;default:si(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return za(r,a.default,t.default)}Zr.register(hr,{error:[{kind:"error"},[Xt],(a,[t])=>{throw new Bi(t.evaluate(a))}],typeof:[Xt,[Yt],(a,[t])=>sn(Vt(t.evaluate(a)))],"to-rgba":[vr(mt,4),[Cr],(a,[t])=>{const[r,o,f,g]=t.evaluate(a).rgb;return[255*r,255*o,255*f,g]}],rgb:[Cr,[mt,mt,mt],qr],rgba:[Cr,[mt,mt,mt,mt],qr],has:{type:Ot,overloads:[[[Xt],(a,[t])=>$r(t.evaluate(a),a.properties())],[[Xt,ur],(a,[t,r])=>$r(t.evaluate(a),r.evaluate(a))]]},get:{type:Yt,overloads:[[[Xt],(a,[t])=>Vs(t.evaluate(a),a.properties())],[[Xt,ur],(a,[t,r])=>Vs(t.evaluate(a),r.evaluate(a))]]},"feature-state":[Yt,[Xt],(a,[t])=>Vs(t.evaluate(a),a.featureState||{})],properties:[ur,[],a=>a.properties()],"geometry-type":[Xt,[],a=>a.geometryType()],id:[Yt,[],a=>a.id()],zoom:[mt,[],a=>a.globals.zoom],"heatmap-density":[mt,[],a=>a.globals.heatmapDensity||0],elevation:[mt,[],a=>a.globals.elevation||0],"line-progress":[mt,[],a=>a.globals.lineProgress||0],accumulated:[Yt,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[mt,ms(mt),(a,t)=>{let r=0;for(const o of t)r+=o.evaluate(a);return r}],"*":[mt,ms(mt),(a,t)=>{let r=1;for(const o of t)r*=o.evaluate(a);return r}],"-":{type:mt,overloads:[[[mt,mt],(a,[t,r])=>t.evaluate(a)-r.evaluate(a)],[[mt],(a,[t])=>-t.evaluate(a)]]},"/":[mt,[mt,mt],(a,[t,r])=>t.evaluate(a)/r.evaluate(a)],"%":[mt,[mt,mt],(a,[t,r])=>t.evaluate(a)%r.evaluate(a)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(a,[t,r])=>Math.pow(t.evaluate(a),r.evaluate(a))],sqrt:[mt,[mt],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[mt,[mt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[mt,[mt],(a,[t])=>Math.log(t.evaluate(a))],log2:[mt,[mt],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[mt,[mt],(a,[t])=>Math.sin(t.evaluate(a))],cos:[mt,[mt],(a,[t])=>Math.cos(t.evaluate(a))],tan:[mt,[mt],(a,[t])=>Math.tan(t.evaluate(a))],asin:[mt,[mt],(a,[t])=>Math.asin(t.evaluate(a))],acos:[mt,[mt],(a,[t])=>Math.acos(t.evaluate(a))],atan:[mt,[mt],(a,[t])=>Math.atan(t.evaluate(a))],min:[mt,ms(mt),(a,t)=>Math.min(...t.map(r=>r.evaluate(a)))],max:[mt,ms(mt),(a,t)=>Math.max(...t.map(r=>r.evaluate(a)))],abs:[mt,[mt],(a,[t])=>Math.abs(t.evaluate(a))],round:[mt,[mt],(a,[t])=>{const r=t.evaluate(a);return r<0?-Math.round(-r):Math.round(r)}],floor:[mt,[mt],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[mt,[mt],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Ot,[Xt,Yt],(a,[t,r])=>a.properties()[t.value]===r.value],"filter-id-==":[Ot,[Yt],(a,[t])=>a.id()===t.value],"filter-type-==":[Ot,[Xt],(a,[t])=>a.geometryType()===t.value],"filter-<":[Ot,[Xt,Yt],(a,[t,r])=>{const o=a.properties()[t.value],f=r.value;return typeof o==typeof f&&o<f}],"filter-id-<":[Ot,[Yt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r<o}],"filter->":[Ot,[Xt,Yt],(a,[t,r])=>{const o=a.properties()[t.value],f=r.value;return typeof o==typeof f&&o>f}],"filter-id->":[Ot,[Yt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r>o}],"filter-<=":[Ot,[Xt,Yt],(a,[t,r])=>{const o=a.properties()[t.value],f=r.value;return typeof o==typeof f&&o<=f}],"filter-id-<=":[Ot,[Yt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r<=o}],"filter->=":[Ot,[Xt,Yt],(a,[t,r])=>{const o=a.properties()[t.value],f=r.value;return typeof o==typeof f&&o>=f}],"filter-id->=":[Ot,[Yt],(a,[t])=>{const r=a.id(),o=t.value;return typeof r==typeof o&&r>=o}],"filter-has":[Ot,[Yt],(a,[t])=>t.value in a.properties()],"filter-has-id":[Ot,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Ot,[vr(Xt)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Ot,[vr(Yt)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Ot,[Xt,vr(Yt)],(a,[t,r])=>r.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Ot,[Xt,vr(Yt)],(a,[t,r])=>function(o,f,g,_){for(;g<=_;){const v=g+_>>1;if(f[v]===o)return!0;f[v]>o?_=v-1:g=v+1}return!1}(a.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(a,[t,r])=>t.evaluate(a)&&r.evaluate(a)],[ms(Ot),(a,t)=>{for(const r of t)if(!r.evaluate(a))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(a,[t,r])=>t.evaluate(a)||r.evaluate(a)],[ms(Ot),(a,t)=>{for(const r of t)if(r.evaluate(a))return!0;return!1}]]},"!":[Ot,[Ot],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Ot,[Xt],(a,[t])=>{const r=a.globals&&a.globals.isSupportedScript;return!r||r(t.evaluate(a))}],upcase:[Xt,[Xt],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[Xt,[Xt],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[Xt,ms(Yt),(a,t)=>t.map(r=>Bn(r.evaluate(a))).join("")],"resolved-locale":[Xt,[ls],(a,[t])=>t.evaluate(a).resolvedLocale()]});class Ao{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new al,this._defaultValue=r?function(o){if(o.type==="color"&&br(o.default))return new ti(0,0,0,0);switch(o.type){case"color":return ti.parse(o.default)||null;case"padding":return cn.parse(o.default)||null;case"numberArray":return un.parse(o.default)||null;case"colorArray":return On.parse(o.default)||null;case"variableAnchorOffsetCollection":return hi.parse(o.default)||null;case"projectionDefinition":return Kt.parse(o.default)||null;default:return o.default===void 0?null:o.default}}(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,o,f,g,_){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=o,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,r,o,f,g,_){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=o||null,this._evaluator.canonical=f,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new Bi(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Po(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in hr}function wr(a,t){const r=new Os(hr,To,[],t?function(f){const g={color:Cr,string:Xt,number:mt,enum:Xt,boolean:Ot,formatted:Ds,padding:xn,numberArray:Ls,colorArray:Hl,projectionDefinition:$l,resolvedImage:ra,variableAnchorOffsetCollection:Ur};return f.type==="array"?vr(g[f.value]||Yt,f.length):g[f.type]}(t):void 0),o=r.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?$u(new Ao(o,t)):gs(r.errors)}class fr{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!Mo(r.expression),this.globalStateRefs=zo(r.expression)}evaluateWithoutErrorHandling(t,r,o,f,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,f,g,_)}evaluate(t,r,o,f,g,_){return this._styleExpression.evaluate(t,r,o,f,g,_)}}class $a{constructor(t,r,o,f){this.kind=t,this.zoomStops=o,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!Mo(r.expression),this.globalStateRefs=zo(r.expression),this.interpolationType=f}evaluateWithoutErrorHandling(t,r,o,f,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,r,o,f,g,_)}evaluate(t,r,o,f,g,_){return this._styleExpression.evaluate(t,r,o,f,g,_)}interpolationFactor(t,r,o){return this.interpolationType?ar.interpolationFactor(this.interpolationType,t,r,o):0}}function Ra(a,t){const r=wr(a,t);if(r.result==="error")return r;const o=r.value.expression,f=So(o);if(!f&&!Pa(t))return gs([new Qi("","data expressions not supported")]);const g=Aa(o,["zoom"]);if(!g&&!Hu(t))return gs([new Qi("","zoom expressions not supported")]);const _=oa(o);return _||g?_ instanceof Qi?gs([_]):_ instanceof ar&&!xr(t)?gs([new Qi("",'"interpolate" expressions cannot be used with this property')]):$u(_?new $a(f?"camera":"composite",r.value,_.labels,_ instanceof ar?_.interpolation:void 0):new fr(f?"constant":"source",r.value)):gs([new Qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Hr{constructor(t,r){this._parameters=t,this._specification=r,Sn(this,hc(this._parameters,this._specification))}static deserialize(t){return new Hr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function oa(a){let t=null;if(a instanceof sl)t=oa(a.result);else if(a instanceof Pr){for(const r of a.args)if(t=oa(r),t)break}else(a instanceof ul||a instanceof ar)&&a.input instanceof Zr&&a.input.name==="zoom"&&(t=a);return t instanceof Qi||a.eachChild(r=>{const o=oa(r);o instanceof Qi?t=o:!t&&o?t=new Qi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Qi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function zo(a,t=new Set){return a instanceof wo&&t.add(a.key),a.eachChild(r=>{zo(r,t)}),t}function Ro(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Ro(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const fc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function bn(a){if(a==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Ro(a)||(a=Ha(a));const t=wr(a,fc);if(t.result==="error")throw new Error(t.value.map(r=>`${r.key}: ${r.message}`).join(", "));return{filter:(r,o,f)=>t.value.evaluate(r,o,{},f),needGeometry:Si(a),getGlobalStateRefs:()=>zo(t.value.expression)}}function wn(a,t){return a<t?-1:a>t?1:0}function Si(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(Si(a[t]))return!0;return!1}function Ha(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?la(a[1],a[2],"=="):t==="!="?bl(la(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?la(a[1],a[2],t):t==="any"?(r=a.slice(1),["any"].concat(r.map(Ha))):t==="all"?["all"].concat(a.slice(1).map(Ha)):t==="none"?["all"].concat(a.slice(1).map(Ha).map(bl)):t==="in"?Wc(a[1],a.slice(2)):t==="!in"?bl(Wc(a[1],a.slice(2))):t==="has"?Gs(a[1]):t!=="!has"||bl(Gs(a[1]));var r}function la(a,t,r){switch(a){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,a,t]}}function Wc(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(r=>typeof r!=typeof t[0])?["filter-in-large",a,["literal",t.sort(wn)]]:["filter-in-small",a,["literal",t]]}}function Gs(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function bl(a){return["!",a]}function dc(a){const t=typeof a;if(t==="number"||t==="boolean"||t==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let f="[";for(const g of a)f+=`${dc(g)},`;return`${f}]`}const r=Object.keys(a).sort();let o="{";for(let f=0;f<r.length;f++)o+=`${JSON.stringify(r[f])}:${dc(a[r[f]])},`;return`${o}}`}function Zs(a){let t="";for(const r of yt)t+=`/${dc(a[r])}`;return t}function wl(a){const t=a.value;return t?[new ft(a.key,t,"constants have been deprecated as of v8")]:[]}function hn(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ca(a){if(Array.isArray(a))return a.map(ca);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const r in a)t[r]=ca(a[r]);return t}return hn(a)}function Rr(a){const t=a.key,r=a.value,o=a.valueSpec||{},f=a.objectElementValidators||{},g=a.style,_=a.styleSpec,v=a.validateSpec;let w=[];const M=si(r);if(M!=="object")return[new ft(t,r,`object expected, ${M} found`)];for(const P in r){const D=P.split(".")[0],B=ci(o,D)||o["*"];let j;if(ci(f,D))j=f[D];else if(ci(o,D))j=v;else if(f["*"])j=f["*"];else{if(!o["*"]){w.push(new ft(t,r[P],`unknown property "${P}"`));continue}j=v}w=w.concat(j({key:(t&&`${t}.`)+P,value:r[P],valueSpec:B,style:g,styleSpec:_,object:r,objectKey:P,validateSpec:v},r))}for(const P in o)f[P]||o[P].required&&o[P].default===void 0&&r[P]===void 0&&w.push(new ft(t,r,`missing required property "${P}"`));return w}function Xa(a){const t=a.value,r=a.valueSpec,o=a.style,f=a.styleSpec,g=a.key,_=a.arrayElementValidator||a.validateSpec;if(si(t)!=="array")return[new ft(g,t,`array expected, ${si(t)} found`)];if(r.length&&t.length!==r.length)return[new ft(g,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new ft(g,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let v={type:r.value,values:r.values};f.$version<7&&(v.function=r.function),si(r.value)==="object"&&(v=r.value);let w=[];for(let M=0;M<t.length;M++)w=w.concat(_({array:t,arrayIndex:M,value:t[M],valueSpec:v,validateSpec:a.validateSpec,style:o,styleSpec:f,key:`${g}[${M}]`}));return w}function Xr(a){const t=a.key,r=a.value,o=a.valueSpec;let f=si(r);return f==="number"&&r!=r&&(f="NaN"),f!=="number"?[new ft(t,r,`number expected, ${f} found`)]:"minimum"in o&&r<o.minimum?[new ft(t,r,`${r} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&r>o.maximum?[new ft(t,r,`${r} is greater than the maximum value ${o.maximum}`)]:[]}function Yr(a){const t=a.valueSpec,r=hn(a.value.type);let o,f,g,_={};const v=r!=="categorical"&&a.value.property===void 0,w=!v,M=si(a.value.stops)==="array"&&si(a.value.stops[0])==="array"&&si(a.value.stops[0][0])==="object",P=Rr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(j){if(r==="identity")return[new ft(j.key,j.value,'identity function may not have a "stops" property')];let G=[];const $=j.value;return G=G.concat(Xa({key:j.key,value:$,valueSpec:j.valueSpec,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:D})),si($)==="array"&&$.length===0&&G.push(new ft(j.key,$,"array must have at least one stop")),G},default:function(j){return j.validateSpec({key:j.key,value:j.value,valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec})}}});return r==="identity"&&v&&P.push(new ft(a.key,a.value,'missing required property "property"')),r==="identity"||a.value.stops||P.push(new ft(a.key,a.value,'missing required property "stops"')),r==="exponential"&&a.valueSpec.expression&&!xr(a.valueSpec)&&P.push(new ft(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(w&&!Pa(a.valueSpec)?P.push(new ft(a.key,a.value,"property functions not supported")):v&&!Hu(a.valueSpec)&&P.push(new ft(a.key,a.value,"zoom functions not supported"))),r!=="categorical"&&!M||a.value.property!==void 0||P.push(new ft(a.key,a.value,'"property" property is required')),P;function D(j){let G=[];const $=j.value,ee=j.key;if(si($)!=="array")return[new ft(ee,$,`array expected, ${si($)} found`)];if($.length!==2)return[new ft(ee,$,`array length 2 expected, length ${$.length} found`)];if(M){if(si($[0])!=="object")return[new ft(ee,$,`object expected, ${si($[0])} found`)];if($[0].zoom===void 0)return[new ft(ee,$,"object stop key must have zoom")];if($[0].value===void 0)return[new ft(ee,$,"object stop key must have value")];if(g&&g>hn($[0].zoom))return[new ft(ee,$[0].zoom,"stop zoom values must appear in ascending order")];hn($[0].zoom)!==g&&(g=hn($[0].zoom),f=void 0,_={}),G=G.concat(Rr({key:`${ee}[0]`,value:$[0],valueSpec:{zoom:{}},validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Xr,value:B}}))}else G=G.concat(B({key:`${ee}[0]`,value:$[0],validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec},$));return Po(ca($[1]))?G.concat([new ft(`${ee}[1]`,$[1],"expressions are not allowed in function stops.")]):G.concat(j.validateSpec({key:`${ee}[1]`,value:$[1],valueSpec:t,validateSpec:j.validateSpec,style:j.style,styleSpec:j.styleSpec}))}function B(j,G){const $=si(j.value),ee=hn(j.value),ae=j.value!==null?j.value:G;if(o){if($!==o)return[new ft(j.key,ae,`${$} stop domain type must match previous stop domain type ${o}`)]}else o=$;if($!=="number"&&$!=="string"&&$!=="boolean")return[new ft(j.key,ae,"stop domain value must be a number, string, or boolean")];if($!=="number"&&r!=="categorical"){let we=`number expected, ${$} found`;return Pa(t)&&r===void 0&&(we+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ft(j.key,ae,we)]}return r!=="categorical"||$!=="number"||isFinite(ee)&&Math.floor(ee)===ee?r!=="categorical"&&$==="number"&&f!==void 0&&ee<f?[new ft(j.key,ae,"stop domain values must appear in ascending order")]:(f=ee,r==="categorical"&&ee in _?[new ft(j.key,ae,"stop domain values must be unique")]:(_[ee]=!0,[])):[new ft(j.key,ae,`integer expected, found ${ee}`)]}}function Ir(a){const t=(a.expressionContext==="property"?Ra:wr)(ca(a.value),a.valueSpec);if(t.result==="error")return t.value.map(o=>new ft(`${a.key}${o.key}`,a.value,o.message));const r=t.value.expression||t.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!r.outputDefined())return[new ft(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Mo(r))return[new ft(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Mo(r))return[new ft(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Aa(r,["zoom","feature-state"]))return[new ft(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!So(r))return[new ft(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function pc(a){const t=a.key,r=a.value,o=si(r);return o!=="string"?[new ft(t,r,`color expected, ${o} found`)]:ti.parse(String(r))?[]:[new ft(t,r,`color expected, "${r}" found`)]}function Io(a){const t=a.key,r=a.value,o=a.valueSpec,f=[];return Array.isArray(o.values)?o.values.indexOf(hn(r))===-1&&f.push(new ft(t,r,`expected one of [${o.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(o.values).indexOf(hn(r))===-1&&f.push(new ft(t,r,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(r)} found`)),f}function Do(a){return Ro(ca(a.value))?Ir(Sn({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):mc(a)}function mc(a){const t=a.value,r=a.key;if(si(t)!=="array")return[new ft(r,t,`array expected, ${si(t)} found`)];const o=a.styleSpec;let f,g=[];if(t.length<1)return[new ft(r,t,"filter array must have at least 1 element")];switch(g=g.concat(Io({key:`${r}[0]`,value:t[0],valueSpec:o.filter_operator,style:a.style,styleSpec:a.styleSpec})),hn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&hn(t[1])==="$type"&&g.push(new ft(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new ft(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(f=si(t[1]),f!=="string"&&g.push(new ft(`${r}[1]`,t[1],`string expected, ${f} found`)));for(let _=2;_<t.length;_++)f=si(t[_]),hn(t[1])==="$type"?g=g.concat(Io({key:`${r}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:a.style,styleSpec:a.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&g.push(new ft(`${r}[${_}]`,t[_],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(mc({key:`${r}[${_}]`,value:t[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":f=si(t[1]),t.length!==2?g.push(new ft(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):f!=="string"&&g.push(new ft(`${r}[1]`,t[1],`string expected, ${f} found`))}return g}function qs(a,t){const r=a.key,o=a.validateSpec,f=a.style,g=a.styleSpec,_=a.value,v=a.objectKey,w=g[`${t}_${a.layerType}`];if(!w)return[];const M=v.match(/^(.*)-transition$/);if(t==="paint"&&M&&w[M[1]]&&w[M[1]].transition)return o({key:r,value:_,valueSpec:g.transition,style:f,styleSpec:g});const P=a.valueSpec||w[v];if(!P)return[new ft(r,_,`unknown property "${v}"`)];let D;if(si(_)==="string"&&Pa(P)&&!P.tokens&&(D=/^{([^}]+)}$/.exec(_)))return[new ft(r,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(D[1])} }\`.`)];const B=[];return a.layerType==="symbol"&&(v==="text-field"&&f&&!f.glyphs&&B.push(new ft(r,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&br(ca(_))&&hn(_.type)==="identity"&&B.push(new ft(r,_,'"text-font" does not support identity functions'))),B.concat(o({key:a.key,value:_,valueSpec:P,style:f,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function En(a){return qs(a,"paint")}function _s(a){return qs(a,"layout")}function Tr(a){let t=[];const r=a.value,o=a.key,f=a.style,g=a.styleSpec;if(si(r)!=="object")return[new ft(o,r,`object expected, ${si(r)} found`)];r.type||r.ref||t.push(new ft(o,r,'either "type" or "ref" is required'));let _=hn(r.type);const v=hn(r.ref);if(r.id){const w=hn(r.id);for(let M=0;M<a.arrayIndex;M++){const P=f.layers[M];hn(P.id)===w&&t.push(new ft(o,r.id,`duplicate layer id "${r.id}", previously used at line ${P.id.__line__}`))}}if("ref"in r){let w;["type","source","source-layer","filter","layout"].forEach(M=>{M in r&&t.push(new ft(o,r[M],`"${M}" is prohibited for ref layers`))}),f.layers.forEach(M=>{hn(M.id)===v&&(w=M)}),w?w.ref?t.push(new ft(o,r.ref,"ref cannot reference another ref layer")):_=hn(w.type):t.push(new ft(o,r.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(r.source){const w=f.sources&&f.sources[r.source],M=w&&hn(w.type);w?M==="vector"&&_==="raster"?t.push(new ft(o,r.source,`layer "${r.id}" requires a raster source`)):M!=="raster-dem"&&_==="hillshade"||M!=="raster-dem"&&_==="color-relief"?t.push(new ft(o,r.source,`layer "${r.id}" requires a raster-dem source`)):M==="raster"&&_!=="raster"?t.push(new ft(o,r.source,`layer "${r.id}" requires a vector source`)):M!=="vector"||r["source-layer"]?M==="raster-dem"&&_!=="hillshade"&&_!=="color-relief"?t.push(new ft(o,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):_!=="line"||!r.paint||!r.paint["line-gradient"]||M==="geojson"&&w.lineMetrics||t.push(new ft(o,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ft(o,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new ft(o,r.source,`source "${r.source}" not found`))}else t.push(new ft(o,r,'missing required property "source"'));return t=t.concat(Rr({key:o,value:r,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${o}.type`,value:r.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:r,objectKey:"type"}),filter:Do,layout:w=>Rr({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>_s(Sn({layerType:_},M))}}),paint:w=>Rr({layer:r,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":M=>En(Sn({layerType:_},M))}})}})),t}function Ia(a){const t=a.value,r=a.key,o=si(t);return o!=="string"?[new ft(r,t,`string expected, ${o} found`)]:[]}const Wu={promoteId:function({key:a,value:t}){if(si(t)==="string")return Ia({key:a,value:t});{const r=[];for(const o in t)r.push(...Ia({key:`${a}.${o}`,value:t[o]}));return r}}};function qh(a){const t=a.value,r=a.key,o=a.styleSpec,f=a.style,g=a.validateSpec;if(!t.type)return[new ft(r,t,'"type" is required')];const _=hn(t.type);let v;switch(_){case"vector":case"raster":return v=Rr({key:r,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:a.style,styleSpec:o,objectElementValidators:Wu,validateSpec:g}),v;case"raster-dem":return v=function(w){var M;const P=(M=w.sourceName)!==null&&M!==void 0?M:"",D=w.value,B=w.styleSpec,j=B.source_raster_dem,G=w.style;let $=[];const ee=si(D);if(D===void 0)return $;if(ee!=="object")return $.push(new ft("source_raster_dem",D,`object expected, ${ee} found`)),$;const ae=hn(D.encoding)==="custom",we=["redFactor","greenFactor","blueFactor","baseShift"],de=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const F in D)!ae&&we.includes(F)?$.push(new ft(F,D[F],`In "${P}": "${F}" is only valid when "encoding" is set to "custom". ${de} encoding found`)):j[F]?$=$.concat(w.validateSpec({key:F,value:D[F],valueSpec:j[F],validateSpec:w.validateSpec,style:G,styleSpec:B})):$.push(new ft(F,D[F],`unknown property "${F}"`));return $}({sourceName:r,value:t,style:a.style,styleSpec:o,validateSpec:g}),v;case"geojson":if(v=Rr({key:r,value:t,valueSpec:o.source_geojson,style:f,styleSpec:o,validateSpec:g,objectElementValidators:Wu}),t.cluster)for(const w in t.clusterProperties){const[M,P]=t.clusterProperties[w],D=typeof M=="string"?[M,["accumulated"],["get",w]]:M;v.push(...Ir({key:`${r}.${w}.map`,value:P,expressionContext:"cluster-map"})),v.push(...Ir({key:`${r}.${w}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return v;case"video":return Rr({key:r,value:t,valueSpec:o.source_video,style:f,validateSpec:g,styleSpec:o});case"image":return Rr({key:r,value:t,valueSpec:o.source_image,style:f,validateSpec:g,styleSpec:o});case"canvas":return[new ft(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Io({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Fn(a){const t=a.value,r=a.styleSpec,o=r.light,f=a.style;let g=[];const _=si(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new ft("light",t,`object expected, ${_} found`)]),g;for(const v in t){const w=v.match(/^(.*)-transition$/);g=g.concat(w&&o[w[1]]&&o[w[1]].transition?a.validateSpec({key:v,value:t[v],valueSpec:r.transition,validateSpec:a.validateSpec,style:f,styleSpec:r}):o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:f,styleSpec:r}):[new ft(v,t[v],`unknown property "${v}"`)])}return g}function $s(a){const t=a.value,r=a.styleSpec,o=r.sky,f=a.style,g=si(t);if(t===void 0)return[];if(g!=="object")return[new ft("sky",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:f,styleSpec:r}):[new ft(v,t[v],`unknown property "${v}"`)]);return _}function Lo(a){const t=a.value,r=a.styleSpec,o=r.terrain,f=a.style;let g=[];const _=si(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new ft("terrain",t,`object expected, ${_} found`)]),g;for(const v in t)g=g.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:a.validateSpec,style:f,styleSpec:r}):[new ft(v,t[v],`unknown property "${v}"`)]);return g}function Hs(a){let t=[];const r=a.value,o=a.key;if(Array.isArray(r)){const f=[],g=[];for(const _ in r)r[_].id&&f.includes(r[_].id)&&t.push(new ft(o,r,`all the sprites' ids must be unique, but ${r[_].id} is duplicated`)),f.push(r[_].id),r[_].url&&g.includes(r[_].url)&&t.push(new ft(o,r,`all the sprites' URLs must be unique, but ${r[_].url} is duplicated`)),g.push(r[_].url),t=t.concat(Rr({key:`${o}[${_}]`,value:r[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return t}return Ia({key:o,value:r})}function Qc(a){return t=a.value,t&&t.constructor===Object?[]:[new ft(a.key,a.value,`object expected, ${si(a.value)} found`)];var t}const ys={"*":()=>[],array:Xa,boolean:function(a){const t=a.value,r=a.key,o=si(t);return o!=="boolean"?[new ft(r,t,`boolean expected, ${o} found`)]:[]},number:Xr,color:pc,constants:wl,enum:Io,filter:Do,function:Yr,layer:Tr,object:Rr,source:qh,light:Fn,sky:$s,terrain:Lo,projection:function(a){const t=a.value,r=a.styleSpec,o=r.projection,f=a.style,g=si(t);if(t===void 0)return[];if(g!=="object")return[new ft("projection",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?a.validateSpec({key:v,value:t[v],valueSpec:o[v],style:f,styleSpec:r}):[new ft(v,t[v],`unknown property "${v}"`)]);return _},projectionDefinition:function(a){const t=a.key;let r=a.value;r=r instanceof String?r.valueOf():r;const o=si(r);return o!=="array"||function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"}(r)||function(f){return!!["interpolate","step","literal"].includes(f[0])}(r)?["array","string"].includes(o)?[]:[new ft(t,r,`projection expected, invalid type "${o}" found`)]:[new ft(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Ia,formatted:function(a){return Ia(a).length===0?[]:Ir(a)},resolvedImage:function(a){return Ia(a).length===0?[]:Ir(a)},padding:function(a){const t=a.key,r=a.value;if(si(r)==="array"){if(r.length<1||r.length>4)return[new ft(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const o={type:"number"};let f=[];for(let g=0;g<r.length;g++)f=f.concat(a.validateSpec({key:`${t}[${g}]`,value:r[g],validateSpec:a.validateSpec,valueSpec:o}));return f}return Xr({key:t,value:r,valueSpec:{}})},numberArray:function(a){const t=a.key,r=a.value;if(si(r)==="array"){const o={type:"number"};if(r.length<1)return[new ft(t,r,"array length at least 1 expected, length 0 found")];let f=[];for(let g=0;g<r.length;g++)f=f.concat(a.validateSpec({key:`${t}[${g}]`,value:r[g],validateSpec:a.validateSpec,valueSpec:o}));return f}return Xr({key:t,value:r,valueSpec:{}})},colorArray:function(a){const t=a.key,r=a.value;if(si(r)==="array"){if(r.length<1)return[new ft(t,r,"array length at least 1 expected, length 0 found")];let o=[];for(let f=0;f<r.length;f++)o=o.concat(pc({key:`${t}[${f}]`,value:r[f]}));return o}return pc({key:t,value:r})},variableAnchorOffsetCollection:function(a){const t=a.key,r=a.value,o=si(r),f=a.styleSpec;if(o!=="array"||r.length<1||r.length%2!=0)return[new ft(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<r.length;_+=2)g=g.concat(Io({key:`${t}[${_}]`,value:r[_],valueSpec:f.layout_symbol["text-anchor"]})),g=g.concat(Xa({key:`${t}[${_+1}]`,value:r[_+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:f}));return g},sprite:Hs,state:Qc};function vs(a){const t=a.value,r=a.valueSpec,o=a.styleSpec;return a.validateSpec=vs,r.expression&&br(hn(t))?Yr(a):r.expression&&Po(ca(t))?Ir(a):r.type&&ys[r.type]?ys[r.type](a):Rr(Sn({},a,{valueSpec:r.type?o[r.type]:r}))}function Tl(a){const t=a.value,r=a.key,o=Ia(a);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new ft(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new ft(r,t,'"glyphs" url must include a "{range}" token'))),o}function Kr(a,t=xe){let r=[];return r=r.concat(vs({key:"",value:a,valueSpec:t.$root,styleSpec:t,style:a,validateSpec:vs,objectElementValidators:{glyphs:Tl,"*":()=>[]}})),a.constants&&(r=r.concat(wl({key:"constants",value:a.constants}))),Qu(r)}function Da(a){return function(t){return a({...t,validateSpec:vs})}}function Qu(a){return[].concat(a).sort((t,r)=>t.line-r.line)}function Cn(a){return function(...t){return Qu(a.apply(this,t))}}Kr.source=Cn(Da(qh)),Kr.sprite=Cn(Da(Hs)),Kr.glyphs=Cn(Da(Tl)),Kr.light=Cn(Da(Fn)),Kr.sky=Cn(Da($s)),Kr.terrain=Cn(Da(Lo)),Kr.state=Cn(Da(Qc)),Kr.layer=Cn(Da(Tr)),Kr.filter=Cn(Da(Do)),Kr.paintProperty=Cn(Da(En)),Kr.layoutProperty=Cn(Da(_s));const Xs=Kr,Jc=Xs.light,gc=Xs.sky,_c=Xs.paintProperty,eu=Xs.layoutProperty;function Ys(a,t){let r=!1;if(t&&t.length)for(const o of t)a.fire(new Ae(new Error(o.message))),r=!0;return r}class Ks{constructor(t,r,o){const f=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(r=_[1])+2*(o=_[2]);for(let w=0;w<this.d*this.d;w++){const M=_[3+w],P=_[3+w+1];f.push(M===P?null:_.subarray(M,P))}const v=_[3+f.length+1];this.keys=_.subarray(_[3+f.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=r+2*o;for(let _=0;_<this.d*this.d;_++)f.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=o,this.scale=r/t,this.uid=0;const g=o/r*t;this.min=-g,this.max=t+g}insert(t,r,o,f,g){this._forEachCell(r,o,f,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(o),this.bboxes.push(f),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,o,f,g,_){this.cells[g].push(_)}query(t,r,o,f,g){const _=this.min,v=this.max;if(t<=_&&r<=_&&v<=o&&v<=f&&!g)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,r,o,f,this._queryCell,w,{},g),w}}_queryCell(t,r,o,f,g,_,v,w){const M=this.cells[g];if(M!==null){const P=this.keys,D=this.bboxes;for(let B=0;B<M.length;B++){const j=M[B];if(v[j]===void 0){const G=4*j;(w?w(D[G+0],D[G+1],D[G+2],D[G+3]):t<=D[G+2]&&r<=D[G+3]&&o>=D[G+0]&&f>=D[G+1])?(v[j]=!0,_.push(P[j])):v[j]=!1}}}}_forEachCell(t,r,o,f,g,_,v,w){const M=this._convertToCellCoord(t),P=this._convertToCellCoord(r),D=this._convertToCellCoord(o),B=this._convertToCellCoord(f);for(let j=M;j<=D;j++)for(let G=P;G<=B;G++){const $=this.d*G+j;if((!w||w(this._convertFromCellCoord(j),this._convertFromCellCoord(G),this._convertFromCellCoord(j+1),this._convertFromCellCoord(G+1)))&&g.call(this,t,r,o,f,$,_,v,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const f=new Int32Array(r+o+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let g=r;for(let _=0;_<t.length;_++){const v=t[_];f[3+_]=g,f.set(v,g),g+=v.length}return f[3+t.length]=g,f.set(this.keys,g),g+=this.keys.length,f[3+t.length+1]=g,f.set(this.bboxes,g),g+=this.bboxes.length,f.buffer}static serialize(t,r){const o=t.toArrayBuffer();return r&&r.push(o),{buffer:o}}static deserialize(t){return new Ks(t.buffer)}}const La={};function xt(a,t,r={}){if(La[a])throw new Error(`${a} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:a,writeable:!1}),La[a]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}xt("Object",Object),xt("Set",Set),xt("TransferableGridIndex",Ks),xt("Color",ti),xt("Error",Error),xt("AJAXError",he),xt("ResolvedImage",rr),xt("StylePropertyFunction",Hr),xt("StyleExpression",Ao,{omit:["_evaluator"]}),xt("ZoomDependentExpression",$a),xt("ZoomConstantExpression",fr),xt("CompoundExpression",Zr,{omit:["_evaluate"]});for(const a in hr)hr[a]._classRegistryKey||xt(`Expression_${a}`,hr[a]);function tu(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function xs(a){return a.$name||a.constructor._classRegistryKey}function iu(a){return!function(t){if(t===null||typeof t!="object")return!1;const r=xs(t);return!(!r||r==="Object")}(a)&&(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||tu(a)||ba(a)||ArrayBuffer.isView(a)||a instanceof ImageData)}function Sl(a,t){if(iu(a))return(tu(a)||ba(a))&&t&&t.push(a),ArrayBuffer.isView(a)&&t&&t.push(a.buffer),a instanceof ImageData&&t&&t.push(a.data.buffer),a;if(Array.isArray(a)){const g=[];for(const _ of a)g.push(Sl(_,t));return g}if(typeof a!="object")throw new Error("can't serialize object of type "+typeof a);const r=xs(a);if(!r)throw new Error(`can't serialize object of unregistered class ${a.constructor.name}`);if(!La[r])throw new Error(`${r} is not registered.`);const{klass:o}=La[r],f=o.serialize?o.serialize(a,t):{};if(o.serialize){if(t&&f===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in a){if(!a.hasOwnProperty(g)||La[r].omit.indexOf(g)>=0)continue;const _=a[g];f[g]=La[r].shallow.indexOf(g)>=0?_:Sl(_,t)}a instanceof Error&&(f.message=a.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(f.$name=r),f}function Wr(a){if(iu(a))return a;if(Array.isArray(a))return a.map(Wr);if(typeof a!="object")throw new Error("can't deserialize object of type "+typeof a);const t=xs(a)||"Object";if(!La[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=La[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(a);const o=Object.create(r.prototype);for(const f of Object.keys(a)){if(f==="$name")continue;const g=a[f];o[f]=La[t].shallow.indexOf(f)>=0?g:Wr(g)}return o}class yc{constructor(){this.first=!0}update(t,r){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const oi={"Latin-1 Supplement":a=>a>=128&&a<=255,"Hangul Jamo":a=>a>=4352&&a<=4607,Khmer:a=>a>=6016&&a<=6143,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Kanbun:a=>a>=12688&&a<=12703,"CJK Strokes":a=>a>=12736&&a<=12783,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Hangul Syllables":a=>a>=44032&&a<=55215,"Private Use Area":a=>a>=57344&&a<=63743,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Ya(a){for(const t of a)if(Qs(t.charCodeAt(0)))return!0;return!1}function bs(a){for(const t of a)if(!eh(t.charCodeAt(0)))return!1;return!0}function Ws(a){const t=a.map(r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}}).filter(r=>r);return new RegExp(t.join("|"),"u")}const Ju=Ws(["Arab","Dupl","Mong","Ougr","Syrc"]);function eh(a){return!Ju.test(String.fromCodePoint(a))}const ko=Ws(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Qs(a){return!(a!==746&&a!==747&&(a<4352||!(oi["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||oi["CJK Compatibility"](a)||oi["CJK Strokes"](a)||!(!oi["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||oi["Enclosed CJK Letters and Months"](a)||oi["Ideographic Description Characters"](a)||oi.Kanbun(a)||oi.Katakana(a)&&a!==12540||!(!oi["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!oi["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||oi["Vertical Forms"](a)||oi["Yijing Hexagram Symbols"](a)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(a))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(a))||ko.test(String.fromCodePoint(a)))))}function nu(a){return!(Qs(a)||function(t){return!!(oi["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||oi["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||oi["Letterlike Symbols"](t)||oi["Number Forms"](t)||oi["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||oi["Control Pictures"](t)&&t!==9251||oi["Optical Character Recognition"](t)||oi["Enclosed Alphanumerics"](t)||oi["Geometric Shapes"](t)||oi["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||oi["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||oi["CJK Symbols and Punctuation"](t)||oi.Katakana(t)||oi["Private Use Area"](t)||oi["CJK Compatibility Forms"](t)||oi["Small Form Variants"](t)||oi["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}const th=Ws(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Ka(a){return th.test(String.fromCodePoint(a))}function ru(a,t){return!(!t&&Ka(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||oi.Khmer(a))}function au(a){for(const t of a)if(Ka(t.charCodeAt(0)))return!0;return!1}const Wa=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){if(Wa.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(a,t){return c(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(a.pluginStatus!=="loading")return this.setState(a),a;const r=a.pluginURL,o=new Promise(g=>{this.loadScriptResolve=g});t(r);const f=new Promise(g=>setTimeout(()=>g(),this.TIMEOUT));if(yield Promise.race([o,f]),this.isParsed()){const g={pluginStatus:"loaded",pluginURL:r};return this.setState(g),g}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)})}};class Ui{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new yc,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yc,this.transition={},this.globalState={})}isSupportedScript(t){return function(r,o){for(const f of r)if(!ru(f.charCodeAt(0),o))return!1;return!0}(t,Wa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*r}}}class ua{constructor(t,r){this.property=t,this.value=r,this.expression=function(o,f){if(br(o))return new Hr(o,f);if(Po(o)){const g=Ra(o,f);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=o;return f.type==="color"&&typeof o=="string"?g=ti.parse(o):f.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?f.type!=="numberArray"||typeof o!="number"&&!Array.isArray(o)?f.type!=="colorArray"||typeof o!="string"&&!Array.isArray(o)?f.type==="variableAnchorOffsetCollection"&&Array.isArray(o)?g=hi.parse(o):f.type==="projectionDefinition"&&typeof o=="string"&&(g=Kt.parse(o)):g=On.parse(o):g=un.parse(o):g=cn.parse(o),{globalStateRefs:new Set,kind:"constant",evaluate:()=>g}}}(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,o){return this.property.possiblyEvaluate(this,t,r,o)}}class li{constructor(t){this.property=t,this.value=new ua(t,void 0)}transitioned(t,r){return new An(this.property,this.value,r,cr({},t.transition,this.transition),t.now)}untransitioned(){return new An(this.property,this.value,null,{},0)}}class Ai{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return ia(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new li(this._values[t].property)),this._values[t].value=new ua(this._values[t].property,r===null?void 0:ia(r))}getTransition(t){return ia(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new li(this._values[t].property)),this._values[t].transition=ia(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o);const f=this.getTransition(r);f!==void 0&&(t[`${r}-transition`]=f)}return t}transitioned(t,r){const o=new vc(this._properties);for(const f of Object.keys(this._values))o._values[f]=this._values[f].transitioned(t,r._values[f]);return o}untransitioned(){const t=new vc(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class An{constructor(t,r,o,f,g){this.property=t,this.value=r,this.begin=g+f.delay||0,this.end=this.begin+f.duration||0,t.specification.transition&&(f.delay||f.duration)&&(this.prior=o)}possiblyEvaluate(t,r,o){const f=t.now||0,g=this.value.possiblyEvaluate(t,r,o),_=this.prior;if(_){if(f>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(f<this.begin)return _.possiblyEvaluate(t,r,o);{const v=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,r,o),g,Ft(v))}}return g}}class vc{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,o){const f=new Oo(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,r,o);return f}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ml{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return ia(this._values[t].value)}setValue(t,r){this._values[t]=new ua(this._values[t].property,r===null?void 0:ia(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const o=this.getValue(r);o!==void 0&&(t[r]=o)}return t}possiblyEvaluate(t,r,o){const f=new Oo(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].possiblyEvaluate(t,r,o);return f}}class dr{constructor(t,r,o){this.property=t,this.value=r,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,o,f){return this.property.evaluate(this.value,this.parameters,t,r,o,f)}}class Oo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class wt{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,o){const f=Gr[this.specification.type];return f?f(t,r,o):t}}class It{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,o,f){return new dr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},o,f)}:t.expression,r)}interpolate(t,r,o){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new dr(this,{kind:"constant",value:void 0},t.parameters);const f=Gr[this.specification.type];if(f){const g=f(t.value.value,r.value.value,o);return new dr(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,r,o,f,g,_){return t.kind==="constant"?t.value:t.evaluate(r,o,f,g,_)}}class su extends It{possiblyEvaluate(t,r,o,f){if(t.value===void 0)return new dr(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const g=t.expression.evaluate(r,null,{},o,f),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(_,_,_,r);return new dr(this,{kind:"constant",value:v},r)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new dr(this,{kind:"constant",value:g},r)}return new dr(this,t.expression,r)}evaluate(t,r,o,f,g,_){if(t.kind==="source"){const v=t.evaluate(r,o,f,g,_);return this._calculate(v,v,v,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},o,f),t.evaluate({zoom:Math.floor(r.zoom)},o,f),t.evaluate({zoom:Math.floor(r.zoom)+1},o,f),r):t.value}_calculate(t,r,o,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class pn{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,f){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(r,null,{},o,f);return this._calculate(g,g,g,r)}return this._calculate(t.expression.evaluate(new Ui(Math.floor(r.zoom-1),r)),t.expression.evaluate(new Ui(Math.floor(r.zoom),r)),t.expression.evaluate(new Ui(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,o,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:o,to:r}}interpolate(t){return t}}class Bo{constructor(t){this.specification=t}possiblyEvaluate(t,r,o,f){return!!t.expression.evaluate(r,null,{},o,f)}interpolate(){return!1}}class sr{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const o=t[r];o.specification.overridable&&this.overridableProperties.push(r);const f=this.defaultPropertyValues[r]=new ua(o,void 0),g=this.defaultTransitionablePropertyValues[r]=new li(o);this.defaultTransitioningPropertyValues[r]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=f.possiblyEvaluate({})}}}xt("DataDrivenProperty",It),xt("DataConstantProperty",wt),xt("CrossFadedDataDrivenProperty",su),xt("CrossFadedProperty",pn),xt("ColorRampProperty",Bo);const ih="-transition";class Qn extends Ke{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=bn(t.filter)),r.layout&&(this._unevaluatedLayout=new Ml(r.layout)),r.paint)){this._transitionablePaint=new Ai(r.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Oo(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=bn(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const o=this._unevaluatedLayout._values[r];for(const f of o.getGlobalStateRefs())t.add(f)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}setLayoutProperty(t,r,o={}){r!=null&&this._validate(eu,`layers.${this.id}.layout.${t}`,t,r,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(ih)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,o={}){if(r!=null&&this._validate(_c,`layers.${this.id}.paint.${t}`,t,r,o))return!1;if(t.endsWith(ih))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const f=this._transitionablePaint._values[t],g=f.property.specification["property-type"]==="cross-faded-data-driven",_=f.value.isDataDriven(),v=f.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,v,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),ta(t,(r,o)=>!(r===void 0||o==="layout"&&!Object.keys(r).length||o==="paint"&&!Object.keys(r).length))}_validate(t,r,o,f,g={}){return(!g||g.validate!==!1)&&Ys(this,t.call(Xs,{key:r,layerType:this.type,objectKey:o,value:f,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof dr&&Pa(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const $h={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ws{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ji{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function on(a,t=1){let r=0,o=0;return{members:a.map(f=>{const g=$h[f.type].BYTES_PER_ELEMENT,_=r=Sr(r,Math.max(t,g)),v=f.components||1;return o=Math.max(o,g),r+=g*v,{name:f.name,type:f.type,components:v,offset:_}}),size:Sr(r,Math.max(o,t)),alignment:t}}function Sr(a,t){return Math.ceil(a/t)*t}class Vi extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const f=2*t;return this.int16[f+0]=r,this.int16[f+1]=o,t}}Vi.prototype.bytesPerElement=4,xt("StructArrayLayout2i4",Vi);class Qa extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o)}emplace(t,r,o,f){const g=3*t;return this.int16[g+0]=r,this.int16[g+1]=o,this.int16[g+2]=f,t}}Qa.prototype.bytesPerElement=6,xt("StructArrayLayout3i6",Qa);class No extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,o,f)}emplace(t,r,o,f,g){const _=4*t;return this.int16[_+0]=r,this.int16[_+1]=o,this.int16[_+2]=f,this.int16[_+3]=g,t}}No.prototype.bytesPerElement=8,xt("StructArrayLayout4i8",No);class Fo extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,o,f,g,_)}emplace(t,r,o,f,g,_,v){const w=6*t;return this.int16[w+0]=r,this.int16[w+1]=o,this.int16[w+2]=f,this.int16[w+3]=g,this.int16[w+4]=_,this.int16[w+5]=v,t}}Fo.prototype.bytesPerElement=12,xt("StructArrayLayout2i4i12",Fo);class Ts extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,o,f,g,_)}emplace(t,r,o,f,g,_,v){const w=4*t,M=8*t;return this.int16[w+0]=r,this.int16[w+1]=o,this.uint8[M+4]=f,this.uint8[M+5]=g,this.uint8[M+6]=_,this.uint8[M+7]=v,t}}Ts.prototype.bytesPerElement=8,xt("StructArrayLayout2i4ub8",Ts);class Qr extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const f=2*t;return this.float32[f+0]=r,this.float32[f+1]=o,t}}Qr.prototype.bytesPerElement=8,xt("StructArrayLayout2f8",Qr);class El extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_,v,w,M,P){const D=this.length;return this.resize(D+1),this.emplace(D,t,r,o,f,g,_,v,w,M,P)}emplace(t,r,o,f,g,_,v,w,M,P,D){const B=10*t;return this.uint16[B+0]=r,this.uint16[B+1]=o,this.uint16[B+2]=f,this.uint16[B+3]=g,this.uint16[B+4]=_,this.uint16[B+5]=v,this.uint16[B+6]=w,this.uint16[B+7]=M,this.uint16[B+8]=P,this.uint16[B+9]=D,t}}El.prototype.bytesPerElement=20,xt("StructArrayLayout10ui20",El);class Cl extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_,v,w,M,P,D,B){const j=this.length;return this.resize(j+1),this.emplace(j,t,r,o,f,g,_,v,w,M,P,D,B)}emplace(t,r,o,f,g,_,v,w,M,P,D,B,j){const G=12*t;return this.int16[G+0]=r,this.int16[G+1]=o,this.int16[G+2]=f,this.int16[G+3]=g,this.uint16[G+4]=_,this.uint16[G+5]=v,this.uint16[G+6]=w,this.uint16[G+7]=M,this.int16[G+8]=P,this.int16[G+9]=D,this.int16[G+10]=B,this.int16[G+11]=j,t}}Cl.prototype.bytesPerElement=24,xt("StructArrayLayout4i4ui4i24",Cl);class xc extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o)}emplace(t,r,o,f){const g=3*t;return this.float32[g+0]=r,this.float32[g+1]=o,this.float32[g+2]=f,t}}xc.prototype.bytesPerElement=12,xt("StructArrayLayout3f12",xc);class d extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}d.prototype.bytesPerElement=4,xt("StructArrayLayout1ul4",d);class e extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_,v,w,M){const P=this.length;return this.resize(P+1),this.emplace(P,t,r,o,f,g,_,v,w,M)}emplace(t,r,o,f,g,_,v,w,M,P){const D=10*t,B=5*t;return this.int16[D+0]=r,this.int16[D+1]=o,this.int16[D+2]=f,this.int16[D+3]=g,this.int16[D+4]=_,this.int16[D+5]=v,this.uint32[B+3]=w,this.uint16[D+8]=M,this.uint16[D+9]=P,t}}e.prototype.bytesPerElement=20,xt("StructArrayLayout6i1ul2ui20",e);class n extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,o,f,g,_)}emplace(t,r,o,f,g,_,v){const w=6*t;return this.int16[w+0]=r,this.int16[w+1]=o,this.int16[w+2]=f,this.int16[w+3]=g,this.int16[w+4]=_,this.int16[w+5]=v,t}}n.prototype.bytesPerElement=12,xt("StructArrayLayout2i2i2i12",n);class l extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,r,o,f,g)}emplace(t,r,o,f,g,_){const v=4*t,w=8*t;return this.float32[v+0]=r,this.float32[v+1]=o,this.float32[v+2]=f,this.int16[w+6]=g,this.int16[w+7]=_,t}}l.prototype.bytesPerElement=16,xt("StructArrayLayout2f1f2i16",l);class h extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,r,o,f,g,_)}emplace(t,r,o,f,g,_,v){const w=16*t,M=4*t,P=8*t;return this.uint8[w+0]=r,this.uint8[w+1]=o,this.float32[M+1]=f,this.float32[M+2]=g,this.int16[P+6]=_,this.int16[P+7]=v,t}}h.prototype.bytesPerElement=16,xt("StructArrayLayout2ub2f2i16",h);class m extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o)}emplace(t,r,o,f){const g=3*t;return this.uint16[g+0]=r,this.uint16[g+1]=o,this.uint16[g+2]=f,t}}m.prototype.bytesPerElement=6,xt("StructArrayLayout3ui6",m);class y extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_,v,w,M,P,D,B,j,G,$,ee,ae){const we=this.length;return this.resize(we+1),this.emplace(we,t,r,o,f,g,_,v,w,M,P,D,B,j,G,$,ee,ae)}emplace(t,r,o,f,g,_,v,w,M,P,D,B,j,G,$,ee,ae,we){const de=24*t,F=12*t,J=48*t;return this.int16[de+0]=r,this.int16[de+1]=o,this.uint16[de+2]=f,this.uint16[de+3]=g,this.uint32[F+2]=_,this.uint32[F+3]=v,this.uint32[F+4]=w,this.uint16[de+10]=M,this.uint16[de+11]=P,this.uint16[de+12]=D,this.float32[F+7]=B,this.float32[F+8]=j,this.uint8[J+36]=G,this.uint8[J+37]=$,this.uint8[J+38]=ee,this.uint32[F+10]=ae,this.int16[de+22]=we,t}}y.prototype.bytesPerElement=48,xt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",y);class b extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,f,g,_,v,w,M,P,D,B,j,G,$,ee,ae,we,de,F,J,me,De,et,Fe,Ze,ct,rt){const ht=this.length;return this.resize(ht+1),this.emplace(ht,t,r,o,f,g,_,v,w,M,P,D,B,j,G,$,ee,ae,we,de,F,J,me,De,et,Fe,Ze,ct,rt)}emplace(t,r,o,f,g,_,v,w,M,P,D,B,j,G,$,ee,ae,we,de,F,J,me,De,et,Fe,Ze,ct,rt,ht){const $e=32*t,Et=16*t;return this.int16[$e+0]=r,this.int16[$e+1]=o,this.int16[$e+2]=f,this.int16[$e+3]=g,this.int16[$e+4]=_,this.int16[$e+5]=v,this.int16[$e+6]=w,this.int16[$e+7]=M,this.uint16[$e+8]=P,this.uint16[$e+9]=D,this.uint16[$e+10]=B,this.uint16[$e+11]=j,this.uint16[$e+12]=G,this.uint16[$e+13]=$,this.uint16[$e+14]=ee,this.uint16[$e+15]=ae,this.uint16[$e+16]=we,this.uint16[$e+17]=de,this.uint16[$e+18]=F,this.uint16[$e+19]=J,this.uint16[$e+20]=me,this.uint16[$e+21]=De,this.uint16[$e+22]=et,this.uint32[Et+12]=Fe,this.float32[Et+13]=Ze,this.float32[Et+14]=ct,this.uint16[$e+30]=rt,this.uint16[$e+31]=ht,t}}b.prototype.bytesPerElement=64,xt("StructArrayLayout8i15ui1ul2f2ui64",b);class T extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}T.prototype.bytesPerElement=4,xt("StructArrayLayout1f4",T);class A extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o)}emplace(t,r,o,f){const g=3*t;return this.uint16[6*t+0]=r,this.float32[g+1]=o,this.float32[g+2]=f,t}}A.prototype.bytesPerElement=12,xt("StructArrayLayout1ui2f12",A);class z extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,o){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,o)}emplace(t,r,o,f){const g=4*t;return this.uint32[2*t+0]=r,this.uint16[g+2]=o,this.uint16[g+3]=f,t}}z.prototype.bytesPerElement=8,xt("StructArrayLayout1ul2ui8",z);class O extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const o=this.length;return this.resize(o+1),this.emplace(o,t,r)}emplace(t,r,o){const f=2*t;return this.uint16[f+0]=r,this.uint16[f+1]=o,t}}O.prototype.bytesPerElement=4,xt("StructArrayLayout2ui4",O);class L extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}L.prototype.bytesPerElement=2,xt("StructArrayLayout1ui2",L);class N extends Ji{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,o,f){const g=this.length;return this.resize(g+1),this.emplace(g,t,r,o,f)}emplace(t,r,o,f,g){const _=4*t;return this.float32[_+0]=r,this.float32[_+1]=o,this.float32[_+2]=f,this.float32[_+3]=g,t}}N.prototype.bytesPerElement=16,xt("StructArrayLayout4f16",N);class Z extends ws{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new Ie(this.anchorPointX,this.anchorPointY)}}Z.prototype.size=20;class ne extends e{get(t){return new Z(this,t)}}xt("CollisionBoxArray",ne);class ie extends ws{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ie.prototype.size=48;class re extends y{get(t){return new ie(this,t)}}xt("PlacedSymbolArray",re);class oe extends ws{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}oe.prototype.size=64;class fe extends b{get(t){return new oe(this,t)}}xt("SymbolInstanceArray",fe);class le extends T{getoffsetX(t){return this.float32[1*t+0]}}xt("GlyphOffsetArray",le);class ge extends Qa{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}xt("SymbolLineVertexArray",ge);class ve extends ws{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ve.prototype.size=12;class ue extends A{get(t){return new ve(this,t)}}xt("TextAnchorOffsetArray",ue);class Te extends ws{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Te.prototype.size=8;class Oe extends z{get(t){return new Te(this,t)}}xt("FeatureIndexArray",Oe);class ze extends Vi{}class Re extends Vi{}class Be extends Vi{}class gt extends Fo{}class pt extends Ts{}class it extends Qr{}class Mt extends El{}class ii extends Cl{}class yi extends xc{}class ln extends d{}class Pi extends n{}class fn extends h{}class zi extends m{}class Ri extends O{}const Oi=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:Zn}=Oi;class pi{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,o,f){const g=this.segments[this.segments.length-1];return t>pi.MAX_VERTEX_ARRAY_LENGTH&&Wi(`Max vertices per segment is ${pi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${pi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!g||g.vertexLength+t>pi.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==f?this.createNewSegment(r,o,f):g}createNewSegment(t,r,o){const f={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return o!==void 0&&(f.sortKey=o),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(t,r,o){return this.prepareSegment(0,t,r,o)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,o,f){return new pi([{vertexOffset:t,primitiveOffset:r,vertexLength:o,primitiveLength:f,vaos:{},sortKey:0}])}}function qn(a,t){return 256*(a=Ki(Math.floor(a),0,255))+Ki(Math.floor(t),0,255)}pi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xt("SegmentVector",pi);const or=on([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Js,Ss,ha,fa={exports:{}},eo={exports:{}},Al={exports:{}},jo=function(){if(ha)return fa.exports;ha=1;var a=(Js||(Js=1,eo.exports=function(r,o){var f,g,_,v,w,M,P,D;for(g=r.length-(f=3&r.length),_=o,w=3432918353,M=461845907,D=0;D<g;)P=255&r.charCodeAt(D)|(255&r.charCodeAt(++D))<<8|(255&r.charCodeAt(++D))<<16|(255&r.charCodeAt(++D))<<24,++D,_=27492+(65535&(v=5*(65535&(_=(_^=P=(65535&(P=(P=(65535&P)*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(P=0,f){case 3:P^=(255&r.charCodeAt(D+2))<<16;case 2:P^=(255&r.charCodeAt(D+1))<<8;case 1:_^=P=(65535&(P=(P=(65535&(P^=255&r.charCodeAt(D)))*w+(((P>>>16)*w&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295}return _^=r.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),eo.exports),t=(Ss||(Ss=1,Al.exports=function(r,o){for(var f,g=r.length,_=o^g,v=0;g>=4;)f=1540483477*(65535&(f=255&r.charCodeAt(v)|(255&r.charCodeAt(++v))<<8|(255&r.charCodeAt(++v))<<16|(255&r.charCodeAt(++v))<<24))+((1540483477*(f>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),g-=4,++v;switch(g){case 3:_^=(255&r.charCodeAt(v+2))<<16;case 2:_^=(255&r.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&r.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Al.exports);return fa.exports=a,fa.exports.murmur3=a,fa.exports.murmur2=t,fa.exports}(),lr=pe(jo);class da{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,o,f){this.ids.push(Ms(t)),this.positions.push(r,o,f)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ms(t);let o=0,f=this.ids.length-1;for(;o<f;){const _=o+f>>1;this.ids[_]>=r?f=_:o=_+1}const g=[];for(;this.ids[o]===r;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(t,r){const o=new Float64Array(t.ids),f=new Uint32Array(t.positions);return Uo(o,f,0,o.length-1),r&&r.push(o.buffer,f.buffer),{ids:o,positions:f}}static deserialize(t){const r=new da;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Ms(a){const t=+a;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:lr(String(a))}function Uo(a,t,r,o){for(;r<o;){const f=a[r+o>>1];let g=r-1,_=o+1;for(;;){do g++;while(a[g]<f);do _--;while(a[_]>f);if(g>=_)break;Gi(a,g,_),Gi(t,3*g,3*_),Gi(t,3*g+1,3*_+1),Gi(t,3*g+2,3*_+2)}_-r<o-_?(Uo(a,t,r,_),r=_+1):(Uo(a,t,_+1,o),o=_)}}function Gi(a,t,r){const o=a[t];a[t]=a[r],a[r]=o}xt("FeaturePositionMap",da);class Ii{constructor(t,r){this.gl=t.gl,this.location=r}}class Jn extends Ii{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class mn extends Ii{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class bc extends Ii{constructor(t,r){super(t,r),this.current=ti.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const Hh=new Float32Array(16);function ou(a){return[qn(255*a.r,255*a.g),qn(255*a.b,255*a.a)]}class Ja{constructor(t,r,o){this.value=t,this.uniformNames=r.map(f=>`u_${f}`),this.type=o}setUniform(t,r,o){t.set(o.constantOr(this.value))}getBinding(t,r,o){return this.type==="color"?new bc(t,r):new Jn(t,r)}}class Vo{constructor(t,r){this.uniformNames=r.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,o,f){const g=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,r,o){return o.substr(0,9)==="u_pattern"?new mn(t,r):new Jn(t,r)}}class jn{constructor(t,r,o,f){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=r.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new f}populatePaintArray(t,r,o,f,g){const _=this.paintVertexArray.length,v=this.expression.evaluate(new Ui(0),r,{},f,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,v)}updatePaintArray(t,r,o,f){const g=this.expression.evaluate({zoom:0},o,f);this._setPaintValue(t,r,g)}_setPaintValue(t,r,o){if(this.type==="color"){const f=ou(o);for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,f[0],f[1])}else{for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class en{constructor(t,r,o,f,g,_){this.expression=t,this.uniformNames=r.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=f,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=r.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,r,o,f,g){const _=this.expression.evaluate(new Ui(this.zoom),r,{},f,[],g),v=this.expression.evaluate(new Ui(this.zoom+1),r,{},f,[],g),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,_,v)}updatePaintArray(t,r,o,f){const g=this.expression.evaluate({zoom:this.zoom},o,f),_=this.expression.evaluate({zoom:this.zoom+1},o,f);this._setPaintValue(t,r,g,_)}_setPaintValue(t,r,o,f){if(this.type==="color"){const g=ou(o),_=ou(f);for(let v=t;v<r;v++)this.paintVertexArray.emplace(v,g[0],g[1],_[0],_[1])}else{for(let g=t;g<r;g++)this.paintVertexArray.emplace(g,o,f);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(f))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,f=Ki(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(f)}getBinding(t,r,o){return new Jn(t,r)}}class pr{constructor(t,r,o,f,g,_){this.expression=t,this.type=r,this.useIntegerZoom=o,this.zoom=f,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,r,o){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(f,t,r.patterns&&r.patterns[this.layerId],o)}updatePaintArray(t,r,o,f,g){this._setPaintValues(t,r,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(t,r,o,f){if(!f||!o)return;const{min:g,mid:_,max:v}=o,w=f[g],M=f[_],P=f[v];if(w&&M&&P)for(let D=t;D<r;D++)this.zoomInPaintVertexArray.emplace(D,M.tl[0],M.tl[1],M.br[0],M.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],M.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(D,M.tl[0],M.tl[1],M.br[0],M.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],M.pixelRatio,P.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,or.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,or.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class lu{constructor(t,r,o){this.binders={},this._buffers=[];const f=[];for(const g in t.paint._values){if(!o(g))continue;const _=t.paint.get(g);if(!(_ instanceof dr&&Pa(_.property.specification)))continue;const v=ka(g,t.type),w=_.value,M=_.property.specification.type,P=_.property.useIntegerZoom,D=_.property.specification["property-type"],B=D==="cross-faded"||D==="cross-faded-data-driven";if(w.kind==="constant")this.binders[g]=B?new Vo(w.value,v):new Ja(w.value,v,M),f.push(`/u_${g}`);else if(w.kind==="source"||B){const j=Pn(g,M,"source");this.binders[g]=B?new pr(w,M,P,r,j,t.id):new jn(w,v,M,j),f.push(`/a_${g}`)}else{const j=Pn(g,M,"composite");this.binders[g]=new en(w,v,M,P,r,j),f.push(`/z_${g}`)}}this.cacheKey=f.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof jn||r instanceof en?r.maxValue:0}populatePaintArrays(t,r,o,f,g){for(const _ in this.binders){const v=this.binders[_];(v instanceof jn||v instanceof en||v instanceof pr)&&v.populatePaintArray(t,r,o,f,g)}}setConstantPatternPositions(t,r){for(const o in this.binders){const f=this.binders[o];f instanceof Vo&&f.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,o,f,g){let _=!1;for(const v in t){const w=r.getPositions(v);for(const M of w){const P=o.feature(M.index);for(const D in this.binders){const B=this.binders[D];if((B instanceof jn||B instanceof en||B instanceof pr)&&B.expression.isStateDependent===!0){const j=f.paint.get(D);B.expression=j.value,B.updatePaintArray(M.start,M.end,P,t[v],g),_=!0}}}}return _}defines(){const t=[];for(const r in this.binders){const o=this.binders[r];(o instanceof Ja||o instanceof Vo)&&t.push(...o.uniformNames.map(f=>`#define HAS_UNIFORM_${f}`))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof jn||o instanceof en)for(let f=0;f<o.paintVertexAttributes.length;f++)t.push(o.paintVertexAttributes[f].name);else if(o instanceof pr)for(let f=0;f<or.members.length;f++)t.push(or.members[f].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const o=this.binders[r];if(o instanceof Ja||o instanceof Vo||o instanceof en)for(const f of o.uniformNames)t.push(f)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const o=[];for(const f in this.binders){const g=this.binders[f];if(g instanceof Ja||g instanceof Vo||g instanceof en){for(const _ of g.uniformNames)if(r[_]){const v=g.getBinding(t,r[_],_);o.push({name:_,property:f,binding:v})}}}return o}setUniforms(t,r,o,f){for(const{name:g,property:_,binding:v}of r)this.binders[_].setUniform(v,f,o.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const o=this.binders[r];if(t&&o instanceof pr){const f=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(o instanceof jn||o instanceof en)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const r in this.binders){const o=this.binders[r];(o instanceof jn||o instanceof en||o instanceof pr)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof jn||r instanceof en||r instanceof pr)&&r.destroy()}}}class Mr{constructor(t,r,o=()=>!0){this.programConfigurations={};for(const f of t)this.programConfigurations[f.id]=new lu(f,r,o);this.needsUpload=!1,this._featureMap=new da,this._bufferOffset=0}populatePaintArrays(t,r,o,f,g,_){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,r,f,g,_);r.id!==void 0&&this._featureMap.add(r.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,o,f){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,r,g,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function ka(a,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}function Pn(a,t,r){const o={color:{source:Qr,composite:N},number:{source:T,composite:Qr}},f=function(g){return{"line-pattern":{source:Mt,composite:Mt},"fill-pattern":{source:Mt,composite:Mt},"fill-extrusion-pattern":{source:Mt,composite:Mt}}[g]}(a);return f&&f[r]||o[t][r]}xt("ConstantBinder",Ja),xt("CrossFadedConstantBinder",Vo),xt("SourceExpressionBinder",jn),xt("CrossFadedCompositeBinder",pr),xt("CompositeExpressionBinder",en),xt("ProgramConfiguration",lu,{omit:["_buffers"]}),xt("ProgramConfigurationSet",Mr);const to=Math.pow(2,14)-1,Xh=-to-1;function Go(a){const t=ot/a.extent,r=a.loadGeometry();for(let o=0;o<r.length;o++){const f=r[o];for(let g=0;g<f.length;g++){const _=f[g],v=Math.round(_.x*t),w=Math.round(_.y*t);_.x=Ki(v,Xh,to),_.y=Ki(w,Xh,to),(v<_.x||v>_.x+1||w<_.y||w>_.y+1)&&Wi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function Pl(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Go(a):[]}}const Ff=-32768;function wc(a,t,r,o,f){a.emplaceBack(Ff+8*t+o,Ff+8*r+f)}class cu{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Re,this.indexArray=new zi,this.segments=new pi,this.programConfigurations=new Mr(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){const f=this.layers[0],g=[];let _=null,v=!1,w=f.type==="heatmap";if(f.type==="circle"){const P=f;_=P.layout.get("circle-sort-key"),v=!_.isConstant(),w=w||P.paint.get("circle-pitch-alignment")==="map"}const M=w?r.subdivisionGranularity.circle:1;for(const{feature:P,id:D,index:B,sourceLayerIndex:j}of t){const G=this.layers[0]._featureFilter.needGeometry,$=Pl(P,G);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{globalState:this.globalState}),$,o))continue;const ee=v?_.evaluate($,{},o):void 0,ae={id:D,properties:P.properties,type:P.type,sourceLayerIndex:j,index:B,geometry:G?$.geometry:Go(P),patterns:{},sortKey:ee};g.push(ae)}v&&g.sort((P,D)=>P.sortKey-D.sortKey);for(const P of g){const{geometry:D,index:B,sourceLayerIndex:j}=P,G=t[B].feature;this.addFeature(P,D,B,o,M),r.featureIndex.insert(G,D,B,j,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,o,f,g=1){let _;switch(g){case 1:_=[0,7];break;case 3:_=[0,2,5,7];break;case 5:_=[0,1,3,4,6,7];break;case 7:_=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${g}; valid values are 1, 3, 5, 7.`)}const v=_.length;for(const w of r)for(const M of w){const P=M.x,D=M.y;if(P<0||P>=ot||D<0||D>=ot)continue;const B=this.segments.prepareSegment(v*v,this.layoutVertexArray,this.indexArray,t.sortKey),j=B.vertexLength;for(let G=0;G<v;G++)for(let $=0;$<v;$++)wc(this.layoutVertexArray,P,D,_[$],_[G]);for(let G=0;G<v-1;G++)for(let $=0;$<v-1;$++){const ee=j+G*v+$,ae=j+(G+1)*v+$;this.indexArray.emplaceBack(ee,ae+1,ee+1),this.indexArray.emplaceBack(ee,ae,ae+1)}B.vertexLength+=v*v,B.primitiveLength+=(v-1)*(v-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},f)}}function jf(a,t){for(let r=0;r<a.length;r++)if(Tc(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(Tc(a,t[r]))return!0;return!!Kh(a,t)}function Xd(a,t,r){return!!Tc(a,t)||!!Wh(t,a,r)}function Uf(a,t){if(a.length===1)return Yd(t,a[0]);for(let r=0;r<t.length;r++){const o=t[r];for(let f=0;f<o.length;f++)if(Tc(a,o[f]))return!0}for(let r=0;r<a.length;r++)if(Yd(t,a[r]))return!0;for(let r=0;r<t.length;r++)if(Kh(a,t[r]))return!0;return!1}function Yh(a,t,r){if(a.length>1){if(Kh(a,t))return!0;for(let o=0;o<t.length;o++)if(Wh(t[o],a,r))return!0}for(let o=0;o<a.length;o++)if(Wh(a[o],t,r))return!0;return!1}function Kh(a,t){if(a.length===0||t.length===0)return!1;for(let r=0;r<a.length-1;r++){const o=a[r],f=a[r+1];for(let g=0;g<t.length-1;g++)if(Vf(o,f,t[g],t[g+1]))return!0}return!1}function Vf(a,t,r,o){return Nr(a,r,o)!==Nr(t,r,o)&&Nr(a,t,r)!==Nr(a,t,o)}function Wh(a,t,r){const o=r*r;if(t.length===1)return a.distSqr(t[0])<o;for(let f=1;f<t.length;f++)if(Gf(a,t[f-1],t[f])<o)return!0;return!1}function Gf(a,t,r){const o=t.distSqr(r);if(o===0)return a.distSqr(t);const f=((a.x-t.x)*(r.x-t.x)+(a.y-t.y)*(r.y-t.y))/o;return a.distSqr(f<0?t:f>1?r:r.sub(t)._mult(f)._add(t))}function Yd(a,t){let r,o,f,g=!1;for(let _=0;_<a.length;_++){r=a[_];for(let v=0,w=r.length-1;v<r.length;w=v++)o=r[v],f=r[w],o.y>t.y!=f.y>t.y&&t.x<(f.x-o.x)*(t.y-o.y)/(f.y-o.y)+o.x&&(g=!g)}return g}function Tc(a,t){let r=!1;for(let o=0,f=a.length-1;o<a.length;f=o++){const g=a[o],_=a[f];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(r=!r)}return r}function mr(a,t,r){const o=r[0],f=r[2];if(a.x<o.x&&t.x<o.x||a.x>f.x&&t.x>f.x||a.y<o.y&&t.y<o.y||a.y>f.y&&t.y>f.y)return!1;const g=Nr(a,t,r[0]);return g!==Nr(a,t,r[1])||g!==Nr(a,t,r[2])||g!==Nr(a,t,r[3])}function $n(a,t,r){const o=t.paint.get(a).value;return o.kind==="constant"?o.value:r.programConfigurations.get(t.id).getMaxValue(a)}function nh(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function rh(a,t,r,o,f){if(!t[0]&&!t[1])return a;const g=Ie.convert(t)._mult(f);r==="viewport"&&g._rotate(-o);const _=[];for(let v=0;v<a.length;v++)_.push(a[v].sub(g));return _}let Zf,qf;xt("CircleBucket",cu,{omit:["layers"]});var Kd={get paint(){return qf=qf||new sr({"circle-radius":new It(xe.paint_circle["circle-radius"]),"circle-color":new It(xe.paint_circle["circle-color"]),"circle-blur":new It(xe.paint_circle["circle-blur"]),"circle-opacity":new It(xe.paint_circle["circle-opacity"]),"circle-translate":new wt(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new wt(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new wt(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new wt(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new It(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new It(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new It(xe.paint_circle["circle-stroke-opacity"])})},get layout(){return Zf=Zf||new sr({"circle-sort-key":new It(xe.layout_circle["circle-sort-key"])})}};class Qh extends Qn{constructor(t){super(t,Kd)}createBucket(t){return new cu(t)}queryRadius(t){const r=t;return $n("circle-radius",this,r)+$n("circle-stroke-width",this,r)+nh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:f,transform:g,pixelsToTileUnits:_,unwrappedTileID:v,getElevation:w}){const M=rh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-g.bearingInRadians,_),P=this.paint.get("circle-radius").evaluate(r,o)+this.paint.get("circle-stroke-width").evaluate(r,o),D=this.paint.get("circle-pitch-alignment")==="map",B=D?M:function(G,$,ee,ae){return G.map(we=>Jh(we,$,ee,ae))}(M,g,v,w),j=D?P*_:P;for(const G of f)for(const $ of G){const ee=D?$:Jh($,g,v,w);let ae=j;const we=g.projectTileCoordinates($.x,$.y,v,w).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ae*=we/g.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ae*=g.cameraToCenterDistance/we),Xd(B,ee,ae))return!0}return!1}}function Jh(a,t,r,o){const f=t.projectTileCoordinates(a.x,a.y,r,o).point;return new Ie((.5*f.x+.5)*t.width,(.5*-f.y+.5)*t.height)}class $f extends cu{}let Hf;xt("HeatmapBucket",$f,{omit:["layers"]});var Wd={get paint(){return Hf=Hf||new sr({"heatmap-radius":new It(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new It(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new wt(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bo(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new wt(xe.paint_heatmap["heatmap-opacity"])})}};function ah(a,{width:t,height:r},o,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==t*r*o)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${t*r*o}`)}else f=new Uint8Array(t*r*o);return a.width=t,a.height=r,a.data=f,a}function ef(a,{width:t,height:r},o){if(t===a.width&&r===a.height)return;const f=ah({},{width:t,height:r},o);sh(a,f,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,t),height:Math.min(a.height,r)},o),a.width=t,a.height=r,a.data=f.data}function sh(a,t,r,o,f,g){if(f.width===0||f.height===0)return t;if(f.width>a.width||f.height>a.height||r.x>a.width-f.width||r.y>a.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>t.width||f.height>t.height||o.x>t.width-f.width||o.y>t.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<f.height;w++){const M=((r.y+w)*a.width+r.x)*g,P=((o.y+w)*t.width+o.x)*g;for(let D=0;D<f.width*g;D++)v[P+D]=_[M+D]}return t}class uu{constructor(t,r){ah(this,t,1,r)}resize(t){ef(this,t,1)}clone(){return new uu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,f,g){sh(t,r,o,f,g,1)}}class Er{constructor(t,r){ah(this,t,4,r)}resize(t){ef(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Er({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,o,f,g){sh(t,r,o,f,g,4)}setPixel(t,r,o){const f=4*(t*this.width+r);this.data[f+0]=Math.round(255*o.r/o.a),this.data[f+1]=Math.round(255*o.g/o.a),this.data[f+2]=Math.round(255*o.b/o.a),this.data[f+3]=Math.round(255*o.a)}}function oh(a){const t={},r=a.resolution||256,o=a.clips?a.clips.length:1,f=a.image||new Er({width:r,height:o});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const g=(_,v,w)=>{t[a.evaluationKey]=w;const M=a.expression.evaluate(t);f.setPixel(_/4/r,v/4,M)};if(a.clips)for(let _=0,v=0;_<o;++_,v+=4*r)for(let w=0,M=0;w<r;w++,M+=4){const P=w/(r-1),{start:D,end:B}=a.clips[_];g(v,M,D*(1-P)+B*P)}else for(let _=0,v=0;_<r;_++,v+=4)g(0,v,_/(r-1));return f}xt("AlphaImage",uu),xt("RGBAImage",Er);const lh="big-fb";class Qd extends Qn{createBucket(t){return new $f(t)}constructor(t){super(t,Wd),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=oh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(lh)&&this.heatmapFbos.delete(lh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let tf;var Jd={get paint(){return tf=tf||new sr({"hillshade-illumination-direction":new wt(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new wt(xe.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new wt(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new wt(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new wt(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new wt(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new wt(xe.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new wt(xe.paint_hillshade["hillshade-method"])})}};class Zo extends Qn{constructor(t){super(t,Jd),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,o=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const g=Math.max(t.length,r.length,o.length,f.length);t=t.concat(Array(g-t.length).fill(t.at(-1))),r=r.concat(Array(g-r.length).fill(r.at(-1))),o=o.concat(Array(g-o.length).fill(o.at(-1))),f=f.concat(Array(g-f.length).fill(f.at(-1)));const _=r.map(an);return{directionRadians:t.map(an),altitudeRadians:_,shadowColor:f,highlightColor:o}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let nf;var kp={get paint(){return nf=nf||new sr({"color-relief-opacity":new wt(xe["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Bo(xe["paint_color-relief"]["color-relief-color"])})}};class rf{constructor(t,r,o,f){this.context=t,this.format=o,this.texture=t.gl.createTexture(),this.update(r,f)}update(t,r,o){const{width:f,height:g}=t,_=!(this.size&&this.size[0]===f&&this.size[1]===g||o),{context:v}=this,{gl:w}=v;if(this.useMipmap=!!(r&&r.useMipmap),w.bindTexture(w.TEXTURE_2D,this.texture),v.pixelStoreUnpackFlipY.set(!1),v.pixelStoreUnpack.set(1),v.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!r||r.premultiply!==!1)),_)this.size=[f,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ba(t)?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,t):w.texImage2D(w.TEXTURE_2D,0,this.format,f,g,0,this.format,w.UNSIGNED_BYTE,t.data);else{const{x:M,y:P}=o||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ba(t)?w.texSubImage2D(w.TEXTURE_2D,0,M,P,w.RGBA,w.UNSIGNED_BYTE,t):w.texSubImage2D(w.TEXTURE_2D,0,M,P,f,g,w.RGBA,w.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&w.generateMipmap(w.TEXTURE_2D),v.pixelStoreUnpackFlipY.setDefault(),v.pixelStoreUnpack.setDefault(),v.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,o){const{context:f}=this,{gl:g}=f;g.bindTexture(g.TEXTURE_2D,this.texture),o!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(o=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,o||t),this.filter=t),r!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,r),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class io{constructor(t,r,o,f=1,g=1,_=1,v=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void Wi(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const w=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=g,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let M=0;M<w;M++)this.data[this._idx(-1,M)]=this.data[this._idx(0,M)],this.data[this._idx(w,M)]=this.data[this._idx(w-1,M)],this.data[this._idx(M,-1)]=this.data[this._idx(M,0)],this.data[this._idx(M,w)]=this.data[this._idx(M,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let M=0;M<w;M++)for(let P=0;P<w;P++){const D=this.get(M,P);D>this.max&&(this.max=D),D<this.min&&(this.min=D)}}get(t,r){const o=new Uint8Array(this.data.buffer),f=4*this._idx(t,r);return this.unpack(o[f],o[f+1],o[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,o){return t*this.redFactor+r*this.greenFactor+o*this.blueFactor-this.baseShift}pack(t){return Xf(t,this.getUnpackVector())}getPixels(){return new Er({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let f=r*this.dim,g=r*this.dim+this.dim,_=o*this.dim,v=o*this.dim+this.dim;switch(r){case-1:f=g-1;break;case 1:g=f+1}switch(o){case-1:_=v-1;break;case 1:v=_+1}const w=-r*this.dim,M=-o*this.dim;for(let P=_;P<v;P++)for(let D=f;D<g;D++)this.data[this._idx(D,P)]=t.data[this._idx(D+w,P+M)]}}function Xf(a,t){const r=t[0],o=t[1],f=t[2],g=t[3],_=Math.min(r,o,f),v=Math.round((a+g)/_);return{r:Math.floor(v*_/r)%256,g:Math.floor(v*_/o)%256,b:Math.floor(v*_/f)%256}}xt("DEMData",io);class af extends Qn{constructor(t){super(t,kp)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},o=this._transitionablePaint._values["color-relief-color"].value.expression;if(o instanceof fr&&o._styleExpression.expression instanceof ar){this.colorRampExpression=o;const _=o._styleExpression.expression;r.elevationStops=_.labels,r.colorStops=[];for(const v of r.elevationStops)r.colorStops.push(_.evaluate({globals:{elevation:v}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[ti.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const f={elevationStops:[],colorStops:[]},g=(r.elevationStops.length-1)/(t-1);for(let _=0;_<r.elevationStops.length-.5;_+=g)f.elevationStops.push(r.elevationStops[Math.round(_)]),f.colorStops.push(r.colorStops[Math.round(_)]);return Wi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,o){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const f=this._createColorRamp(r),g=new Er({width:f.colorStops.length,height:1}),_=new Er({width:f.colorStops.length,height:1});for(let v=0;v<f.elevationStops.length;v++){const w=Xf(f.elevationStops[v],o);_.setPixel(0,v,new ti(w.r/255,w.g/255,w.b/255,1)),g.setPixel(0,v,f.colorStops[v])}return this.colorRampTextures={elevationTexture:new rf(t,_,t.gl.RGBA),colorTexture:new rf(t,g,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const ch=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:zn}=ch;function Yf(a,t,r){const o=r.patternDependencies;let f=!1;for(const g of t){const _=g.paint.get(`${a}-pattern`);_.isConstant()||(f=!0);const v=_.constantOr(null);v&&(f=!0,o[v.to]=!0,o[v.from]=!0)}return f}function Kf(a,t,r,o,f){const g=f.patternDependencies;for(const _ of t){const v=_.paint.get(`${a}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:o-1},r,{},f.availableImages),M=v.evaluate({zoom:o},r,{},f.availableImages),P=v.evaluate({zoom:o+1},r,{},f.availableImages);w=w&&w.name?w.name:w,M=M&&M.name?M.name:M,P=P&&P.name?P.name:P,g[w]=!0,g[M]=!0,g[P]=!0,r.patterns[_.id]={min:w,mid:M,max:P}}}return r}function Wf(a,t,r,o,f){let g;if(f===function(_,v,w,M){let P=0;for(let D=v,B=w-M;D<w;D+=M)P+=(_[B]-_[D])*(_[D+1]+_[B+1]),B=D;return P}(a,t,r,o)>0)for(let _=t;_<r;_+=o)g=gn(_/o|0,a[_],a[_+1],g);else for(let _=r-o;_>=t;_-=o)g=gn(_/o|0,a[_],a[_+1],g);return g&&zl(g,g.next)&&(gr(g),g=g.next),g}function Es(a,t){if(!a)return a;t||(t=a);let r,o=a;do if(r=!1,o.steiner||!zl(o,o.next)&&ui(o.prev,o,o.next)!==0)o=o.next;else{if(gr(o),o=t=o.prev,o===o.next)break;r=!0}while(r||o!==t);return t}function es(a,t,r,o,f,g,_){if(!a)return;!_&&g&&function(w,M,P,D){let B=w;do B.z===0&&(B.z=hh(B.x,B.y,M,P,D)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==w);B.prevZ.nextZ=null,B.prevZ=null,function(j){let G,$=1;do{let ee,ae=j;j=null;let we=null;for(G=0;ae;){G++;let de=ae,F=0;for(let me=0;me<$&&(F++,de=de.nextZ,de);me++);let J=$;for(;F>0||J>0&&de;)F!==0&&(J===0||!de||ae.z<=de.z)?(ee=ae,ae=ae.nextZ,F--):(ee=de,de=de.nextZ,J--),we?we.nextZ=ee:j=ee,ee.prevZ=we,we=ee;ae=de}we.nextZ=null,$*=2}while(G>1)}(B)}(a,o,f,g);let v=a;for(;a.prev!==a.next;){const w=a.prev,M=a.next;if(g?tp(a,o,f,g):ep(a))t.push(w.i,a.i,M.i),gr(a),a=M.next,v=M.next;else if((a=M)===v){_?_===1?es(a=uh(Es(a),t),t,r,o,f,g,2):_===2&&no(a,t,r,o,f,g):es(Es(a),t,r,o,f,g,1);break}}}function ep(a){const t=a.prev,r=a,o=a.next;if(ui(t,r,o)>=0)return!1;const f=t.x,g=r.x,_=o.x,v=t.y,w=r.y,M=o.y,P=Math.min(f,g,_),D=Math.min(v,w,M),B=Math.max(f,g,_),j=Math.max(v,w,M);let G=o.next;for(;G!==t;){if(G.x>=P&&G.x<=B&&G.y>=D&&G.y<=j&&hu(f,v,g,w,_,M,G.x,G.y)&&ui(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function tp(a,t,r,o){const f=a.prev,g=a,_=a.next;if(ui(f,g,_)>=0)return!1;const v=f.x,w=g.x,M=_.x,P=f.y,D=g.y,B=_.y,j=Math.min(v,w,M),G=Math.min(P,D,B),$=Math.max(v,w,M),ee=Math.max(P,D,B),ae=hh(j,G,t,r,o),we=hh($,ee,t,r,o);let de=a.prevZ,F=a.nextZ;for(;de&&de.z>=ae&&F&&F.z<=we;){if(de.x>=j&&de.x<=$&&de.y>=G&&de.y<=ee&&de!==f&&de!==_&&hu(v,P,w,D,M,B,de.x,de.y)&&ui(de.prev,de,de.next)>=0||(de=de.prevZ,F.x>=j&&F.x<=$&&F.y>=G&&F.y<=ee&&F!==f&&F!==_&&hu(v,P,w,D,M,B,F.x,F.y)&&ui(F.prev,F,F.next)>=0))return!1;F=F.nextZ}for(;de&&de.z>=ae;){if(de.x>=j&&de.x<=$&&de.y>=G&&de.y<=ee&&de!==f&&de!==_&&hu(v,P,w,D,M,B,de.x,de.y)&&ui(de.prev,de,de.next)>=0)return!1;de=de.prevZ}for(;F&&F.z<=we;){if(F.x>=j&&F.x<=$&&F.y>=G&&F.y<=ee&&F!==f&&F!==_&&hu(v,P,w,D,M,B,F.x,F.y)&&ui(F.prev,F,F.next)>=0)return!1;F=F.nextZ}return!0}function uh(a,t){let r=a;do{const o=r.prev,f=r.next.next;!zl(o,f)&&ed(o,r,r.next,f)&&fu(o,f)&&fu(f,o)&&(t.push(o.i,r.i,f.i),gr(r),gr(r.next),r=a=f),r=r.next}while(r!==a);return Es(r)}function no(a,t,r,o,f,g){let _=a;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&qo(_,v)){let w=td(_,v);return _=Es(_,_.next),w=Es(w,w.next),es(_,t,r,o,f,g,0),void es(w,t,r,o,f,g,0)}v=v.next}_=_.next}while(_!==a)}function ip(a,t){let r=a.x-t.x;return r===0&&(r=a.y-t.y,r===0)&&(r=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Qf(a,t){const r=function(f,g){let _=g;const v=f.x,w=f.y;let M,P=-1/0;if(zl(f,_))return _;do{if(zl(f,_.next))return _.next;if(w<=_.y&&w>=_.next.y&&_.next.y!==_.y){const $=_.x+(w-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if($<=v&&$>P&&(P=$,M=_.x<_.next.x?_:_.next,$===v))return M}_=_.next}while(_!==g);if(!M)return null;const D=M,B=M.x,j=M.y;let G=1/0;_=M;do{if(v>=_.x&&_.x>=B&&v!==_.x&&fh(w<j?v:P,w,B,j,w<j?P:v,w,_.x,_.y)){const $=Math.abs(w-_.y)/(v-_.x);fu(_,f)&&($<G||$===G&&(_.x>M.x||_.x===M.x&&np(M,_)))&&(M=_,G=$)}_=_.next}while(_!==D);return M}(a,t);if(!r)return t;const o=td(r,a);return Es(o,o.next),Es(r,r.next)}function np(a,t){return ui(a.prev,a,t.prev)<0&&ui(t.next,a,a.next)<0}function hh(a,t,r,o,f){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-r)*f|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*f|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jf(a){let t=a,r=a;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==a);return r}function fh(a,t,r,o,f,g,_,v){return(f-_)*(t-v)>=(a-_)*(g-v)&&(a-_)*(o-v)>=(r-_)*(t-v)&&(r-_)*(g-v)>=(f-_)*(o-v)}function hu(a,t,r,o,f,g,_,v){return!(a===_&&t===v)&&fh(a,t,r,o,f,g,_,v)}function qo(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(r,o){let f=r;do{if(f.i!==r.i&&f.next.i!==r.i&&f.i!==o.i&&f.next.i!==o.i&&ed(f,f.next,r,o))return!0;f=f.next}while(f!==r);return!1}(a,t)&&(fu(a,t)&&fu(t,a)&&function(r,o){let f=r,g=!1;const _=(r.x+o.x)/2,v=(r.y+o.y)/2;do f.y>v!=f.next.y>v&&f.next.y!==f.y&&_<(f.next.x-f.x)*(v-f.y)/(f.next.y-f.y)+f.x&&(g=!g),f=f.next;while(f!==r);return g}(a,t)&&(ui(a.prev,a,t.prev)||ui(a,t.prev,t))||zl(a,t)&&ui(a.prev,a,a.next)>0&&ui(t.prev,t,t.next)>0)}function ui(a,t,r){return(t.y-a.y)*(r.x-t.x)-(t.x-a.x)*(r.y-t.y)}function zl(a,t){return a.x===t.x&&a.y===t.y}function ed(a,t,r,o){const f=sf(ui(a,t,r)),g=sf(ui(a,t,o)),_=sf(ui(r,o,a)),v=sf(ui(r,o,t));return f!==g&&_!==v||!(f!==0||!Hn(a,r,t))||!(g!==0||!Hn(a,o,t))||!(_!==0||!Hn(r,a,o))||!(v!==0||!Hn(r,t,o))}function Hn(a,t,r){return t.x<=Math.max(a.x,r.x)&&t.x>=Math.min(a.x,r.x)&&t.y<=Math.max(a.y,r.y)&&t.y>=Math.min(a.y,r.y)}function sf(a){return a>0?1:a<0?-1:0}function fu(a,t){return ui(a.prev,a,a.next)<0?ui(a,t,a.next)>=0&&ui(a,a.prev,t)>=0:ui(a,t,a.prev)<0||ui(a,a.next,t)<0}function td(a,t){const r=Cs(a.i,a.x,a.y),o=Cs(t.i,t.x,t.y),f=a.next,g=t.prev;return a.next=t,t.prev=a,r.next=f,f.prev=r,o.next=r,r.prev=o,g.next=o,o.prev=g,o}function gn(a,t,r,o){const f=Cs(a,t,r);return o?(f.next=o.next,f.prev=o,o.next.prev=f,o.next=f):(f.prev=f,f.next=f),f}function gr(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Cs(a,t,r){return{i:a,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Sc{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class dh{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}dh.noSubdivision=new dh({fill:new Sc(0,0),line:new Sc(0,0),tile:new Sc(0,0),stencil:new Sc(0,0),circle:1}),xt("SubdivisionGranularityExpression",Sc),xt("SubdivisionGranularitySetting",dh);const du=-32768,Mc=32767;class Oa{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ot/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const o=0|Math.round(t),f=0|Math.round(r),g=this._getKey(o,f);if(this._vertexDictionary.has(g))return this._vertexDictionary.get(g);const _=this._vertexBuffer.length/2;return this._vertexDictionary.set(g,_),this._vertexBuffer.push(o,f),_}_subdivideTrianglesScanline(t){if(this._granularity<2)return function(f,g){const _=[];for(let v=0;v<g.length;v+=3){const w=g[v],M=g[v+1],P=g[v+2],D=f[2*w],B=f[2*w+1];(f[2*M]-D)*(f[2*P+1]-B)-(f[2*M+1]-B)*(f[2*P]-D)>0?(_.push(w),_.push(P),_.push(M)):(_.push(w),_.push(M),_.push(P))}return _}(this._vertexBuffer,t);const r=[],o=t.length;for(let f=0;f<o;f+=3){const g=[t[f+0],t[f+1],t[f+2]],_=[this._vertexBuffer[2*t[f+0]+0],this._vertexBuffer[2*t[f+0]+1],this._vertexBuffer[2*t[f+1]+0],this._vertexBuffer[2*t[f+1]+1],this._vertexBuffer[2*t[f+2]+0],this._vertexBuffer[2*t[f+2]+1]];let v=1/0,w=1/0,M=-1/0,P=-1/0;for(let $=0;$<3;$++){const ee=_[2*$],ae=_[2*$+1];v=Math.min(v,ee),M=Math.max(M,ee),w=Math.min(w,ae),P=Math.max(P,ae)}if(v===M||w===P)continue;const D=Math.floor(v/this._granularityCellSize),B=Math.ceil(M/this._granularityCellSize),j=Math.floor(w/this._granularityCellSize),G=Math.ceil(P/this._granularityCellSize);if(D!==B||j!==G)for(let $=j;$<G;$++){const ee=this._scanlineGenerateVertexRingForCellRow($,_,g);Ba(this._vertexBuffer,ee,r)}else r.push(...g)}return r}_scanlineGenerateVertexRingForCellRow(t,r,o){const f=t*this._granularityCellSize,g=f+this._granularityCellSize,_=[];for(let v=0;v<3;v++){const w=r[2*v],M=r[2*v+1],P=r[2*(v+1)%6],D=r[(2*(v+1)+1)%6],B=r[2*(v+2)%6],j=r[(2*(v+2)+1)%6],G=P-w,$=D-M,ee=G===0,ae=$===0,we=(f-M)/$,de=(g-M)/$,F=Math.min(we,de),J=Math.max(we,de);if(!ae&&(F>=1||J<=0)||ae&&(M<f||M>g)){D>=f&&D<=g&&_.push(o[(v+1)%3]);continue}!ae&&F>0&&_.push(this._vertexToIndex(w+G*F,M+$*F));const me=w+G*Math.max(F,0),De=w+G*Math.min(J,1);ee||this._generateIntraEdgeVertices(_,w,M,P,D,me,De),!ae&&J<1&&_.push(this._vertexToIndex(w+G*J,M+$*J)),(ae||D>=f&&D<=g)&&_.push(o[(v+1)%3]),!ae&&(D<=f||D>=g)&&this._generateInterEdgeVertices(_,w,M,P,D,B,j,De,f,g)}return _}_generateIntraEdgeVertices(t,r,o,f,g,_,v){const w=f-r,M=g-o,P=M===0,D=P?Math.min(r,f):Math.min(_,v),B=P?Math.max(r,f):Math.max(_,v),j=Math.floor(D/this._granularityCellSize)+1,G=Math.ceil(B/this._granularityCellSize)-1;if(P?r<f:_<v)for(let $=j;$<=G;$++){const ee=$*this._granularityCellSize;t.push(this._vertexToIndex(ee,o+M*(ee-r)/w))}else for(let $=G;$>=j;$--){const ee=$*this._granularityCellSize;t.push(this._vertexToIndex(ee,o+M*(ee-r)/w))}}_generateInterEdgeVertices(t,r,o,f,g,_,v,w,M,P){const D=g-o,B=_-f,j=v-g,G=(M-g)/j,$=(P-g)/j,ee=Math.min(G,$),ae=Math.max(G,$),we=f+B*ee;let de=Math.floor(Math.min(we,w)/this._granularityCellSize)+1,F=Math.ceil(Math.max(we,w)/this._granularityCellSize)-1,J=w<we;const me=j===0;if(me&&(v===M||v===P))return;if(me||ee>=1||ae<=0){const et=o-v,Fe=_+(r-_)*Math.min((M-v)/et,(P-v)/et);de=Math.floor(Math.min(Fe,w)/this._granularityCellSize)+1,F=Math.ceil(Math.max(Fe,w)/this._granularityCellSize)-1,J=w<Fe}const De=D>0?P:M;if(J)for(let et=de;et<=F;et++)t.push(this._vertexToIndex(et*this._granularityCellSize,De));else for(let et=F;et>=de;et--)t.push(this._vertexToIndex(et*this._granularityCellSize,De))}_generateOutline(t){const r=[];for(const o of t){const f=Rl(o,this._granularity,!0),g=this._pointArrayToIndices(f),_=[];for(let v=1;v<g.length;v++)_.push(g[v-1]),_.push(g[v]);r.push(_)}return r}_handlePoles(t){let r=!1,o=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(o=!0)),(r||o)&&this._fillPoles(t,r,o)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const o=t[r+1];o===du&&(t[r+1]=-32767),o===Mc&&(t[r+1]=32766)}}_generatePoleQuad(t,r,o,f,g,_){f>g!=(_===du)?(t.push(r),t.push(o),t.push(this._vertexToIndex(f,_)),t.push(o),t.push(this._vertexToIndex(g,_)),t.push(this._vertexToIndex(f,_))):(t.push(o),t.push(r),t.push(this._vertexToIndex(f,_)),t.push(this._vertexToIndex(g,_)),t.push(o),t.push(this._vertexToIndex(f,_)))}_fillPoles(t,r,o){const f=this._vertexBuffer,g=ot,_=t.length;for(let v=2;v<_;v+=3){const w=t[v-2],M=t[v-1],P=t[v],D=f[2*w],B=f[2*w+1],j=f[2*M],G=f[2*M+1],$=f[2*P],ee=f[2*P+1];r&&(B===0&&G===0&&this._generatePoleQuad(t,w,M,D,j,du),G===0&&ee===0&&this._generatePoleQuad(t,M,P,j,$,du),ee===0&&B===0&&this._generatePoleQuad(t,P,w,$,D,du)),o&&(B===g&&G===g&&this._generatePoleQuad(t,w,M,D,j,Mc),G===g&&ee===g&&this._generatePoleQuad(t,M,P,j,$,Mc),ee===g&&B===g&&this._generatePoleQuad(t,P,w,$,D,Mc))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:o,holeIndices:f}=function(v){const w=[],M=[];for(const P of v)if(P.length!==0){P!==v[0]&&w.push(M.length/2);for(let D=0;D<P.length;D++)M.push(P[D].x),M.push(P[D].y)}return{flattened:M,holeIndices:w}}(t);let g;this._initializeVertices(o);try{const v=function(M,P,D=2){const B=P&&P.length,j=B?P[0]*D:M.length;let G=Wf(M,0,j,D,!0);const $=[];if(!G||G.next===G.prev)return $;let ee,ae,we;if(B&&(G=function(de,F,J,me){const De=[];for(let et=0,Fe=F.length;et<Fe;et++){const Ze=Wf(de,F[et]*me,et<Fe-1?F[et+1]*me:de.length,me,!1);Ze===Ze.next&&(Ze.steiner=!0),De.push(Jf(Ze))}De.sort(ip);for(let et=0;et<De.length;et++)J=Qf(De[et],J);return J}(M,P,G,D)),M.length>80*D){ee=1/0,ae=1/0;let de=-1/0,F=-1/0;for(let J=D;J<j;J+=D){const me=M[J],De=M[J+1];me<ee&&(ee=me),De<ae&&(ae=De),me>de&&(de=me),De>F&&(F=De)}we=Math.max(de-ee,F-ae),we=we!==0?32767/we:0}return es(G,$,D,ee,ae,we,0),$}(o,f),w=this._convertIndices(o,v);g=this._subdivideTrianglesScanline(w)}catch(v){console.error(v)}let _=[];return r&&(_=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(g),{verticesFlattened:this._vertexBuffer,indicesTriangles:g,indicesLineList:_}}_convertIndices(t,r){const o=[];for(let f=0;f<r.length;f++)o.push(this._vertexToIndex(t[2*r[f]],t[2*r[f]+1]));return o}_pointArrayToIndices(t){const r=[];for(let o=0;o<t.length;o++){const f=t[o];r.push(this._vertexToIndex(f.x,f.y))}return r}}function ts(a,t,r,o=!0){return new Oa(r,t).subdividePolygonInternal(a,o)}function Rl(a,t,r=!1){if(!a||a.length<1)return[];if(a.length<2)return[];const o=a[0],f=a[a.length-1],g=r&&(o.x!==f.x||o.y!==f.y);if(t<2)return g?[...a,a[0]]:[...a];const _=Math.floor(ot/t),v=[];v.push(new Ie(a[0].x,a[0].y));const w=a.length,M=g?w:w-1;for(let P=0;P<M;P++){const D=a[P],B=P<w-1?a[P+1]:a[0],j=D.x,G=D.y,$=B.x,ee=B.y,ae=j!==$,we=G!==ee;if(!ae&&!we)continue;const de=$-j,F=ee-G,J=Math.abs(de),me=Math.abs(F);let De=j,et=G;for(;;){const Ze=de>0?(Math.floor(De/_)+1)*_:(Math.ceil(De/_)-1)*_,ct=F>0?(Math.floor(et/_)+1)*_:(Math.ceil(et/_)-1)*_,rt=Math.abs(De-Ze),ht=Math.abs(et-ct),$e=Math.abs(De-$),Et=Math.abs(et-ee),kt=ae?rt/J:Number.POSITIVE_INFINITY,zt=we?ht/me:Number.POSITIVE_INFINITY;if(($e<=rt||!ae)&&(Et<=ht||!we))break;if(kt<zt&&ae||!we){De=Ze,et+=F*kt;const Tt=new Ie(De,Math.round(et));v[v.length-1].x===Tt.x&&v[v.length-1].y===Tt.y||v.push(Tt)}else{De+=de*zt,et=ct;const Tt=new Ie(Math.round(De),et);v[v.length-1].x===Tt.x&&v[v.length-1].y===Tt.y||v.push(Tt)}}const Fe=new Ie($,ee);v[v.length-1].x===Fe.x&&v[v.length-1].y===Fe.y||v.push(Fe)}return v}function Ba(a,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let o=0,f=a[2*t[0]];for(let w=1;w<t.length;w++){const M=a[2*t[w]];M<f&&(f=M,o=w)}const g=t.length;let _=o,v=(_+1)%g;for(;;){const w=_-1>=0?_-1:g-1,M=(v+1)%g,P=a[2*t[w]],D=a[2*t[M]],B=a[2*t[_]],j=a[2*t[_]+1],G=a[2*t[v]+1];let $=!1;if(P<D)$=!0;else if(P>D)$=!1;else{const ee=G-j,ae=-(a[2*t[v]]-B),we=j<G?1:-1;((P-B)*ee+(a[2*t[w]+1]-j)*ae)*we>((D-B)*ee+(a[2*t[M]+1]-j)*ae)*we&&($=!0)}if($){const ee=t[w],ae=t[_],we=t[v];ee!==ae&&ee!==we&&ae!==we&&r.push(we,ae,ee),_--,_<0&&(_=g-1)}else{const ee=t[M],ae=t[_],we=t[v];ee!==ae&&ee!==we&&ae!==we&&r.push(we,ae,ee),v++,v>=g&&(v=0)}if(w===M)break}}function id(a,t,r,o,f,g,_,v,w){const M=f.length/2,P=_&&v&&w;if(M<pi.MAX_VERTEX_ARRAY_LENGTH){const D=t.prepareSegment(M,r,o),B=D.vertexLength;for(let $=0;$<g.length;$+=3)o.emplaceBack(B+g[$],B+g[$+1],B+g[$+2]);let j,G;D.vertexLength+=M,D.primitiveLength+=g.length/3,P&&(G=_.prepareSegment(M,r,v),j=G.vertexLength,G.vertexLength+=M);for(let $=0;$<f.length;$+=2)a(f[$],f[$+1]);if(P)for(let $=0;$<w.length;$++){const ee=w[$];for(let ae=1;ae<ee.length;ae+=2)v.emplaceBack(j+ee[ae-1],j+ee[ae]);G.primitiveLength+=ee.length/2}}else(function(D,B,j,G,$,ee){const ae=[];for(let me=0;me<G.length/2;me++)ae.push(-1);const we={count:0};let de=0,F=D.getOrCreateLatestSegment(B,j),J=F.vertexLength;for(let me=2;me<$.length;me+=3){const De=$[me-2],et=$[me-1],Fe=$[me];let Ze=ae[De]<de,ct=ae[et]<de,rt=ae[Fe]<de;F.vertexLength+((Ze?1:0)+(ct?1:0)+(rt?1:0))>pi.MAX_VERTEX_ARRAY_LENGTH&&(F=D.createNewSegment(B,j),de=we.count,Ze=!0,ct=!0,rt=!0,J=0);const ht=is(ae,G,ee,we,De,Ze,F),$e=is(ae,G,ee,we,et,ct,F),Et=is(ae,G,ee,we,Fe,rt,F);j.emplaceBack(J+ht-de,J+$e-de,J+Et-de),F.primitiveLength++}})(t,r,o,f,g,a),P&&function(D,B,j,G,$,ee){const ae=[];for(let me=0;me<G.length/2;me++)ae.push(-1);const we={count:0};let de=0,F=D.getOrCreateLatestSegment(B,j),J=F.vertexLength;for(let me=0;me<$.length;me++){const De=$[me];for(let et=1;et<$[me].length;et+=2){const Fe=De[et-1],Ze=De[et];let ct=ae[Fe]<de,rt=ae[Ze]<de;F.vertexLength+((ct?1:0)+(rt?1:0))>pi.MAX_VERTEX_ARRAY_LENGTH&&(F=D.createNewSegment(B,j),de=we.count,ct=!0,rt=!0,J=0);const ht=is(ae,G,ee,we,Fe,ct,F),$e=is(ae,G,ee,we,Ze,rt,F);j.emplaceBack(J+ht-de,J+$e-de),F.primitiveLength++}}}(_,r,v,f,w,a),t.forceNewSegmentOnNextPrepare(),_?.forceNewSegmentOnNextPrepare()}function is(a,t,r,o,f,g,_){if(g){const v=o.count;return r(t[2*f],t[2*f+1]),a[f]=o.count,o.count++,_.vertexLength++,v}return a[f]}class $o{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Be,this.indexArray=new zi,this.indexArray2=new Ri,this.programConfigurations=new Mr(t.layers,t.zoom),this.segments=new pi,this.segments2=new pi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=Yf("fill",this.layers,r);const f=this.layers[0].layout.get("fill-sort-key"),g=!f.isConstant(),_=[];for(const{feature:v,id:w,index:M,sourceLayerIndex:P}of t){const D=this.layers[0]._featureFilter.needGeometry,B=Pl(v,D);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{globalState:this.globalState}),B,o))continue;const j=g?f.evaluate(B,{},o,r.availableImages):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:P,index:M,geometry:D?B.geometry:Go(v),patterns:{},sortKey:j};_.push(G)}g&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:M,sourceLayerIndex:P}=v;if(this.hasPattern){const D=Kf("fill",this.layers,v,this.zoom,r);this.patternFeatures.push(D)}else this.addFeature(v,w,M,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[M].feature,w,M,P,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,zn),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,o,f,g,_){for(const v of qc(r,500)){const w=ts(v,f,_.fill.getGranularityForZoomLevel(f.z)),M=this.layoutVertexArray;id((P,D)=>{M.emplaceBack(P,D)},this.segments,this.layoutVertexArray,this.indexArray,w.verticesFlattened,w.indicesTriangles,this.segments2,this.indexArray2,w.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,f)}}let Ho,of;xt("FillBucket",$o,{omit:["layers","patternFeatures"]});var nd={get paint(){return of=of||new sr({"fill-antialias":new wt(xe.paint_fill["fill-antialias"]),"fill-opacity":new It(xe.paint_fill["fill-opacity"]),"fill-color":new It(xe.paint_fill["fill-color"]),"fill-outline-color":new It(xe.paint_fill["fill-outline-color"]),"fill-translate":new wt(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new wt(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new su(xe.paint_fill["fill-pattern"])})},get layout(){return Ho=Ho||new sr({"fill-sort-key":new It(xe.layout_fill["fill-sort-key"])})}};class ro extends Qn{constructor(t){super(t,nd)}recalculate(t,r){super.recalculate(t,r);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new $o(t)}queryRadius(){return nh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:o,pixelsToTileUnits:f}){return Uf(rh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-o.bearingInRadians,f),r)}isTileClipped(){return!0}}const rp=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),pu=on([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ph}=rp;var Ec,Cc,lf,rd,Ac,ad,mh,gh={};function ap(){if(Cc)return Ec;Cc=1;var a=ce();function t(f,g,_,v,w){this.properties={},this.extent=_,this.type=0,this._pbf=f,this._geometry=-1,this._keys=v,this._values=w,f.readFields(r,this,g)}function r(f,g,_){f==1?g.id=_.readVarint():f==2?function(v,w){for(var M=v.readVarint()+v.pos;v.pos<M;){var P=w._keys[v.readVarint()],D=w._values[v.readVarint()];w.properties[P]=D}}(_,g):f==3?g.type=_.readVarint():f==4&&(g._geometry=_.pos)}function o(f){for(var g,_,v=0,w=0,M=f.length,P=M-1;w<M;P=w++)v+=((_=f[P]).x-(g=f[w]).x)*(g.y+_.y);return v}return Ec=t,t.types=["Unknown","Point","LineString","Polygon"],t.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var g,_=f.readVarint()+f.pos,v=1,w=0,M=0,P=0,D=[];f.pos<_;){if(w<=0){var B=f.readVarint();v=7&B,w=B>>3}if(w--,v===1||v===2)M+=f.readSVarint(),P+=f.readSVarint(),v===1&&(g&&D.push(g),g=[]),g.push(new a(M,P));else{if(v!==7)throw new Error("unknown command "+v);g&&g.push(g[0].clone())}}return g&&D.push(g),D},t.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var g=f.readVarint()+f.pos,_=1,v=0,w=0,M=0,P=1/0,D=-1/0,B=1/0,j=-1/0;f.pos<g;){if(v<=0){var G=f.readVarint();_=7&G,v=G>>3}if(v--,_===1||_===2)(w+=f.readSVarint())<P&&(P=w),w>D&&(D=w),(M+=f.readSVarint())<B&&(B=M),M>j&&(j=M);else if(_!==7)throw new Error("unknown command "+_)}return[P,B,D,j]},t.prototype.toGeoJSON=function(f,g,_){var v,w,M=this.extent*Math.pow(2,_),P=this.extent*f,D=this.extent*g,B=this.loadGeometry(),j=t.types[this.type];function G(ae){for(var we=0;we<ae.length;we++){var de=ae[we];ae[we]=[360*(de.x+P)/M-180,360/Math.PI*Math.atan(Math.exp((180-360*(de.y+D)/M)*Math.PI/180))-90]}}switch(this.type){case 1:var $=[];for(v=0;v<B.length;v++)$[v]=B[v][0];G(B=$);break;case 2:for(v=0;v<B.length;v++)G(B[v]);break;case 3:for(B=function(ae){var we=ae.length;if(we<=1)return[ae];for(var de,F,J=[],me=0;me<we;me++){var De=o(ae[me]);De!==0&&(F===void 0&&(F=De<0),F===De<0?(de&&J.push(de),de=[ae[me]]):de.push(ae[me]))}return de&&J.push(de),J}(B),v=0;v<B.length;v++)for(w=0;w<B[v].length;w++)G(B[v][w])}B.length===1?B=B[0]:j="Multi"+j;var ee={type:"Feature",geometry:{type:j,coordinates:B},properties:this.properties};return"id"in this&&(ee.id=this.id),ee},Ec}function sp(){if(rd)return lf;rd=1;var a=ap();function t(o,f){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(r,this,f),this.length=this._features.length}function r(o,f,g){o===15?f.version=g.readVarint():o===1?f.name=g.readString():o===5?f.extent=g.readVarint():o===2?f._features.push(g.pos):o===3?f._keys.push(g.readString()):o===4&&f._values.push(function(_){for(var v=null,w=_.readVarint()+_.pos;_.pos<w;){var M=_.readVarint()>>3;v=M===1?_.readString():M===2?_.readFloat():M===3?_.readDouble():M===4?_.readVarint64():M===5?_.readVarint():M===6?_.readSVarint():M===7?_.readBoolean():null}return v}(g))}return lf=t,t.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var f=this._pbf.readVarint()+this._pbf.pos;return new a(this._pbf,f,this.extent,this._keys,this._values)},lf}function Ni(){return mh||(mh=1,gh.VectorTile=function(){if(ad)return Ac;ad=1;var a=sp();function t(r,o,f){if(r===3){var g=new a(f,f.readVarint()+f.pos);g.length&&(o[g.name]=g)}}return Ac=function(r,o){this.layers=r.readFields(t,{},o)},Ac}(),gh.VectorTileFeature=ap(),gh.VectorTileLayer=sp()),gh}var Fi=pe(Ni());const vi=Fi.VectorTileFeature.types,wi=Math.pow(2,13);function Ei(a,t,r,o,f,g,_,v){a.emplaceBack(t,r,2*Math.floor(o*wi)+_,f*wi*2,g*wi*2,Math.round(v))}class Jr{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new gt,this.centroidVertexArray=new ze,this.indexArray=new zi,this.programConfigurations=new Mr(t.layers,t.zoom),this.segments=new pi,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.features=[],this.hasPattern=Yf("fill-extrusion",this.layers,r);for(const{feature:f,id:g,index:_,sourceLayerIndex:v}of t){const w=this.layers[0]._featureFilter.needGeometry,M=Pl(f,w);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{globalState:this.globalState}),M,o))continue;const P={id:g,sourceLayerIndex:v,index:_,geometry:w?M.geometry:Go(f),properties:f.properties,type:f.type,patterns:{}};this.hasPattern?this.features.push(Kf("fill-extrusion",this.layers,P,this.zoom,r)):this.addFeature(P,P.geometry,_,o,{},r.subdivisionGranularity),r.featureIndex.insert(f,P.geometry,_,v,this.index,!0)}}addFeatures(t,r,o){for(const f of this.features){const{geometry:g}=f;this.addFeature(f,g,f.index,r,o,t.subdivisionGranularity)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ph),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,pu.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,o,f,g,_){for(const v of qc(r,500)){const w={x:0,y:0,sampleCount:0},M=this.layoutVertexArray.length;this.processPolygon(w,f,t,v,_);const P=this.layoutVertexArray.length-M,D=Math.floor(w.x/w.sampleCount),B=Math.floor(w.y/w.sampleCount);for(let j=0;j<P;j++)this.centroidVertexArray.emplaceBack(D,B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,f)}processPolygon(t,r,o,f,g){if(f.length<1||cf(f[0]))return;for(const D of f)D.length!==0&&Il(t,D);const _={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},v=g.fill.getGranularityForZoomLevel(r.z),w=vi[o.type]==="Polygon";for(const D of f){if(D.length===0||cf(D))continue;const B=Rl(D,v,w);this._generateSideFaces(B,_)}if(!w)return;const M=ts(f,r,v,!1),P=this.layoutVertexArray;id((D,B)=>{Ei(P,D,B,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,M.verticesFlattened,M.indicesTriangles)}_generateSideFaces(t,r){let o=0;for(let f=1;f<t.length;f++){const g=t[f],_=t[f-1];if(mu(g,_))continue;r.segment.vertexLength+4>pi.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const v=g.sub(_)._perp()._unit(),w=_.dist(g);o+w>32768&&(o=0),Ei(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,0,o),Ei(this.layoutVertexArray,g.x,g.y,v.x,v.y,0,1,o),o+=w,Ei(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,0,o),Ei(this.layoutVertexArray,_.x,_.y,v.x,v.y,0,1,o);const M=r.segment.vertexLength;this.indexArray.emplaceBack(M,M+2,M+1),this.indexArray.emplaceBack(M+1,M+2,M+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Il(a,t){for(let r=0;r<t.length;r++){const o=t[r];r===t.length-1&&t[0].x===o.x&&t[0].y===o.y||(a.x+=o.x,a.y+=o.y,a.sampleCount++)}}function mu(a,t){return a.x===t.x&&(a.x<0||a.x>ot)||a.y===t.y&&(a.y<0||a.y>ot)}function cf(a){return a.every(t=>t.x<0)||a.every(t=>t.x>ot)||a.every(t=>t.y<0)||a.every(t=>t.y>ot)}let ao;xt("FillExtrusionBucket",Jr,{omit:["layers","features"]});var Un={get paint(){return ao=ao||new sr({"fill-extrusion-opacity":new wt(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new It(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new wt(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new wt(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new su(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new It(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new It(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new wt(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Dl extends Qn{constructor(t){super(t,Un)}createBucket(t){return new Jr(t)}queryRadius(){return nh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:f,transform:g,pixelsToTileUnits:_,pixelPosMatrix:v}){const w=rh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-g.bearingInRadians,_),M=this.paint.get("fill-extrusion-height").evaluate(r,o),P=this.paint.get("fill-extrusion-base").evaluate(r,o),D=function(j,G){const $=[];for(const ee of j){const ae=[ee.x,ee.y,0,1];je(ae,ae,G),$.push(new Ie(ae[0]/ae[3],ae[1]/ae[3]))}return $}(w,v),B=function(j,G,$,ee){const ae=[],we=[],de=ee[8]*G,F=ee[9]*G,J=ee[10]*G,me=ee[11]*G,De=ee[8]*$,et=ee[9]*$,Fe=ee[10]*$,Ze=ee[11]*$;for(const ct of j){const rt=[],ht=[];for(const $e of ct){const Et=$e.x,kt=$e.y,zt=ee[0]*Et+ee[4]*kt+ee[12],Tt=ee[1]*Et+ee[5]*kt+ee[13],ei=ee[2]*Et+ee[6]*kt+ee[14],Hi=ee[3]*Et+ee[7]*kt+ee[15],_n=ei+J,yn=Hi+me,Fa=zt+De,Dr=Tt+et,In=ei+Fe,dn=Hi+Ze,Xn=new Ie((zt+de)/yn,(Tt+F)/yn);Xn.z=_n/yn,rt.push(Xn);const Vn=new Ie(Fa/dn,Dr/dn);Vn.z=In/dn,ht.push(Vn)}ae.push(rt),we.push(ht)}return[ae,we]}(f,P,M,v);return function(j,G,$){let ee=1/0;Uf($,G)&&(ee=uf($,G[0]));for(let ae=0;ae<G.length;ae++){const we=G[ae],de=j[ae];for(let F=0;F<we.length-1;F++){const J=we[F],me=[J,we[F+1],de[F+1],de[F],J];jf($,me)&&(ee=Math.min(ee,uf($,me)))}}return ee!==1/0&&ee}(B[0],B[1],D)}}function As(a,t){return a.x*t.x+a.y*t.y}function uf(a,t){if(a.length===1){let r=0;const o=t[r++];let f;for(;!f||o.equals(f);)if(f=t[r++],!f)return 1/0;for(;r<t.length;r++){const g=t[r],_=a[0],v=f.sub(o),w=g.sub(o),M=_.sub(o),P=As(v,v),D=As(v,w),B=As(w,w),j=As(M,v),G=As(M,w),$=P*B-D*D,ee=(B*j-D*G)/$,ae=(P*G-D*j)/$,we=o.z*(1-ee-ae)+f.z*ee+g.z*ae;if(isFinite(we))return we}return 1/0}{let r=1/0;for(const o of t)r=Math.min(r,o.z);return r}}const ns=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gu}=ns,_h=on([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:pa}=_h,sd=Fi.VectorTileFeature.types,od=Math.cos(Math.PI/180*37.5),yh=Math.pow(2,14)/.5;class _u{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(r=>r.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new pt,this.layoutVertexArray2=new it,this.indexArray=new zi,this.programConfigurations=new Mr(t.layers,t.zoom),this.segments=new pi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(t,r,o){this.hasPattern=Yf("line",this.layers,r);const f=this.layers[0].layout.get("line-sort-key"),g=!f.isConstant(),_=[];for(const{feature:v,id:w,index:M,sourceLayerIndex:P}of t){const D=this.layers[0]._featureFilter.needGeometry,B=Pl(v,D);if(!this.layers[0]._featureFilter.filter(new Ui(this.zoom,{globalState:this.globalState}),B,o))continue;const j=g?f.evaluate(B,{},o):void 0,G={id:w,properties:v.properties,type:v.type,sourceLayerIndex:P,index:M,geometry:D?B.geometry:Go(v),patterns:{},sortKey:j};_.push(G)}g&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:M,sourceLayerIndex:P}=v;if(this.hasPattern){const D=Kf("line",this.layers,v,this.zoom,r);this.patternFeatures.push(D)}else this.addFeature(v,w,M,o,{},r.subdivisionGranularity);r.featureIndex.insert(t[M].feature,w,M,P,this.index)}}update(t,r,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,o)}addFeatures(t,r,o){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,r,o,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,pa)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gu),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,o,f,g,_){const v=this.layers[0].layout,w=v.get("line-join").evaluate(t,{}),M=v.get("line-cap"),P=v.get("line-miter-limit"),D=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const B of r)this.addLine(B,t,w,M,P,D,f,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,f)}addLine(t,r,o,f,g,_,v,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Rl(t,v?w.line.getGranularityForZoomLevel(v.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let de=0;de<t.length-1;de++)this.totalDistance+=t[de].dist(t[de+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=sd[r.type]==="Polygon";let P=t.length;for(;P>=2&&t[P-1].equals(t[P-2]);)P--;let D=0;for(;D<P-1&&t[D].equals(t[D+1]);)D++;if(P<(M?3:2))return;o==="bevel"&&(g=1.05);const B=this.overscaling<=16?122880/(512*this.overscaling):0,j=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let G,$,ee,ae,we;this.e1=this.e2=-1,M&&(G=t[P-2],we=t[D].sub(G)._unit()._perp());for(let de=D;de<P;de++){if(ee=de===P-1?M?t[D+1]:void 0:t[de+1],ee&&t[de].equals(ee))continue;we&&(ae=we),G&&($=G),G=t[de],we=ee?ee.sub(G)._unit()._perp():ae,ae=ae||we;let F=ae.add(we);F.x===0&&F.y===0||F._unit();const J=ae.x*we.x+ae.y*we.y,me=F.x*we.x+F.y*we.y,De=me!==0?1/me:1/0,et=2*Math.sqrt(2-2*me),Fe=me<od&&$&&ee,Ze=ae.x*we.y-ae.y*we.x>0;if(Fe&&de>D){const ht=G.dist($);if(ht>2*B){const $e=G.sub(G.sub($)._mult(B/ht)._round());this.updateDistance($,$e),this.addCurrentVertex($e,ae,0,0,j),$=$e}}const ct=$&&ee;let rt=ct?o:M?"butt":f;if(ct&&rt==="round"&&(De<_?rt="miter":De<=2&&(rt="fakeround")),rt==="miter"&&De>g&&(rt="bevel"),rt==="bevel"&&(De>2&&(rt="flipbevel"),De<g&&(rt="miter")),$&&this.updateDistance($,G),rt==="miter")F._mult(De),this.addCurrentVertex(G,F,0,0,j);else if(rt==="flipbevel"){if(De>100)F=we.mult(-1);else{const ht=De*ae.add(we).mag()/ae.sub(we).mag();F._perp()._mult(ht*(Ze?-1:1))}this.addCurrentVertex(G,F,0,0,j),this.addCurrentVertex(G,F.mult(-1),0,0,j)}else if(rt==="bevel"||rt==="fakeround"){const ht=-Math.sqrt(De*De-1),$e=Ze?ht:0,Et=Ze?0:ht;if($&&this.addCurrentVertex(G,ae,$e,Et,j),rt==="fakeround"){const kt=Math.round(180*et/Math.PI/20);for(let zt=1;zt<kt;zt++){let Tt=zt/kt;if(Tt!==.5){const Hi=Tt-.5;Tt+=Tt*Hi*(Tt-1)*((1.0904+J*(J*(3.55645-1.43519*J)-3.2452))*Hi*Hi+(.848013+J*(.215638*J-1.06021)))}const ei=we.sub(ae)._mult(Tt)._add(ae)._unit()._mult(Ze?-1:1);this.addHalfVertex(G,ei.x,ei.y,!1,Ze,0,j)}}ee&&this.addCurrentVertex(G,we,-$e,-Et,j)}else if(rt==="butt")this.addCurrentVertex(G,F,0,0,j);else if(rt==="square"){const ht=$?1:-1;this.addCurrentVertex(G,F,ht,ht,j)}else rt==="round"&&($&&(this.addCurrentVertex(G,ae,0,0,j),this.addCurrentVertex(G,ae,1,1,j,!0)),ee&&(this.addCurrentVertex(G,we,-1,-1,j,!0),this.addCurrentVertex(G,we,0,0,j)));if(Fe&&de<P-1){const ht=G.dist(ee);if(ht>2*B){const $e=G.add(ee.sub(G)._mult(B/ht)._round());this.updateDistance(G,$e),this.addCurrentVertex($e,we,0,0,j),G=$e}}}}addCurrentVertex(t,r,o,f,g,_=!1){const v=r.y*f-r.x,w=-r.y-r.x*f;this.addHalfVertex(t,r.x+r.y*o,r.y-r.x*o,_,!1,o,g),this.addHalfVertex(t,v,w,_,!0,-f,g),this.distance>yh/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,o,f,g,_))}addHalfVertex({x:t,y:r},o,f,g,_,v,w){const M=.5*(this.lineClips?this.scaledDistance*(yh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(r<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*f)+128,1+(v===0?0:v<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const P=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,P,this.e2),w.primitiveLength++),_?this.e2=P:this.e1=P}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Xo,_r;xt("LineBucket",_u,{omit:["layers","patternFeatures"]});var Yo={get paint(){return _r=_r||new sr({"line-opacity":new It(xe.paint_line["line-opacity"]),"line-color":new It(xe.paint_line["line-color"]),"line-translate":new wt(xe.paint_line["line-translate"]),"line-translate-anchor":new wt(xe.paint_line["line-translate-anchor"]),"line-width":new It(xe.paint_line["line-width"]),"line-gap-width":new It(xe.paint_line["line-gap-width"]),"line-offset":new It(xe.paint_line["line-offset"]),"line-blur":new It(xe.paint_line["line-blur"]),"line-dasharray":new pn(xe.paint_line["line-dasharray"]),"line-pattern":new su(xe.paint_line["line-pattern"]),"line-gradient":new Bo(xe.paint_line["line-gradient"])})},get layout(){return Xo=Xo||new sr({"line-cap":new wt(xe.layout_line["line-cap"]),"line-join":new It(xe.layout_line["line-join"]),"line-miter-limit":new wt(xe.layout_line["line-miter-limit"]),"line-round-limit":new wt(xe.layout_line["line-round-limit"]),"line-sort-key":new It(xe.layout_line["line-sort-key"])})}};class yu extends It{possiblyEvaluate(t,r){return r=new Ui(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,o,f){return r=cr({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,o,f)}}let Ko;class ld extends Qn{constructor(t){super(t,Yo),this.gradientVersion=0,Ko||(Ko=new yu(Yo.paint.properties["line-width"].specification),Ko.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(r)&&r._styleExpression.expression instanceof ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=Ko.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new _u(t)}queryRadius(t){const r=t,o=hf($n("line-width",this,r),$n("line-gap-width",this,r)),f=$n("line-offset",this,r);return o/2+Math.abs(f)+nh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:o,geometry:f,transform:g,pixelsToTileUnits:_}){const v=rh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-g.bearingInRadians,_),w=_/2*hf(this.paint.get("line-width").evaluate(r,o),this.paint.get("line-gap-width").evaluate(r,o)),M=this.paint.get("line-offset").evaluate(r,o);return M&&(f=function(P,D){const B=[];for(let j=0;j<P.length;j++){const G=P[j],$=[];for(let ee=0;ee<G.length;ee++){const ae=G[ee-1],we=G[ee],de=G[ee+1],F=ee===0?new Ie(0,0):we.sub(ae)._unit()._perp(),J=ee===G.length-1?new Ie(0,0):de.sub(we)._unit()._perp(),me=F._add(J)._unit(),De=me.x*J.x+me.y*J.y;De!==0&&me._mult(1/De),$.push(me._mult(D)._add(we))}B.push($)}return B}(f,M*_)),function(P,D,B){for(let j=0;j<D.length;j++){const G=D[j];if(P.length>=3){for(let $=0;$<G.length;$++)if(Tc(P,G[$]))return!0}if(Yh(P,G,B))return!0}return!1}(v,f,w)}isTileClipped(){return!0}}function hf(a,t){return t>0?t+2*a:a}const op=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),vh=on([{name:"a_projected_pos",components:3,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const cd=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);on([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ma=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lp=on([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Na(a,t,r){return a.sections.forEach(o=>{o.text=function(f,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?f=f.toLocaleUpperCase():v==="lowercase"&&(f=f.toLocaleLowerCase()),Wa.applyArabicShaping&&(f=Wa.applyArabicShaping(f)),f}(o.text,t,r)}),a}on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),on([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const vu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ud,hd,Wo,Rn=24,xh={};function xu(){return ud||(ud=1,xh.read=function(a,t,r,o,f){var g,_,v=8*f-o-1,w=(1<<v)-1,M=w>>1,P=-7,D=r?f-1:0,B=r?-1:1,j=a[t+D];for(D+=B,g=j&(1<<-P)-1,j>>=-P,P+=v;P>0;g=256*g+a[t+D],D+=B,P-=8);for(_=g&(1<<-P)-1,g>>=-P,P+=o;P>0;_=256*_+a[t+D],D+=B,P-=8);if(g===0)g=1-M;else{if(g===w)return _?NaN:1/0*(j?-1:1);_+=Math.pow(2,o),g-=M}return(j?-1:1)*_*Math.pow(2,g-o)},xh.write=function(a,t,r,o,f,g){var _,v,w,M=8*g-f-1,P=(1<<M)-1,D=P>>1,B=f===23?Math.pow(2,-24)-Math.pow(2,-77):0,j=o?0:g-1,G=o?1:-1,$=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,_=P):(_=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-_))<1&&(_--,w*=2),(t+=_+D>=1?B/w:B*Math.pow(2,1-D))*w>=2&&(_++,w/=2),_+D>=P?(v=0,_=P):_+D>=1?(v=(t*w-1)*Math.pow(2,f),_+=D):(v=t*Math.pow(2,D-1)*Math.pow(2,f),_=0));f>=8;a[r+j]=255&v,j+=G,v/=256,f-=8);for(_=_<<f|v,M+=f;M>0;a[r+j]=255&_,j+=G,_/=256,M-=8);a[r+j-G]|=128*$}),xh}function fd(){if(Wo)return hd;Wo=1,hd=t;var a=xu();function t(F){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(F)?F:new Uint8Array(F||0),this.pos=0,this.type=0,this.length=this.buf.length}t.Varint=0,t.Fixed64=1,t.Bytes=2,t.Fixed32=5;var r=4294967296,o=1/r,f=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function g(F){return F.type===t.Bytes?F.readVarint()+F.pos:F.pos+1}function _(F,J,me){return me?4294967296*J+(F>>>0):4294967296*(J>>>0)+(F>>>0)}function v(F,J,me){var De=J<=16383?1:J<=2097151?2:J<=268435455?3:Math.floor(Math.log(J)/(7*Math.LN2));me.realloc(De);for(var et=me.pos-1;et>=F;et--)me.buf[et+De]=me.buf[et]}function w(F,J){for(var me=0;me<F.length;me++)J.writeVarint(F[me])}function M(F,J){for(var me=0;me<F.length;me++)J.writeSVarint(F[me])}function P(F,J){for(var me=0;me<F.length;me++)J.writeFloat(F[me])}function D(F,J){for(var me=0;me<F.length;me++)J.writeDouble(F[me])}function B(F,J){for(var me=0;me<F.length;me++)J.writeBoolean(F[me])}function j(F,J){for(var me=0;me<F.length;me++)J.writeFixed32(F[me])}function G(F,J){for(var me=0;me<F.length;me++)J.writeSFixed32(F[me])}function $(F,J){for(var me=0;me<F.length;me++)J.writeFixed64(F[me])}function ee(F,J){for(var me=0;me<F.length;me++)J.writeSFixed64(F[me])}function ae(F,J){return(F[J]|F[J+1]<<8|F[J+2]<<16)+16777216*F[J+3]}function we(F,J,me){F[me]=J,F[me+1]=J>>>8,F[me+2]=J>>>16,F[me+3]=J>>>24}function de(F,J){return(F[J]|F[J+1]<<8|F[J+2]<<16)+(F[J+3]<<24)}return t.prototype={destroy:function(){this.buf=null},readFields:function(F,J,me){for(me=me||this.length;this.pos<me;){var De=this.readVarint(),et=De>>3,Fe=this.pos;this.type=7&De,F(et,J,this),this.pos===Fe&&this.skip(De)}return J},readMessage:function(F,J){return this.readFields(F,J,this.readVarint()+this.pos)},readFixed32:function(){var F=ae(this.buf,this.pos);return this.pos+=4,F},readSFixed32:function(){var F=de(this.buf,this.pos);return this.pos+=4,F},readFixed64:function(){var F=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*r;return this.pos+=8,F},readSFixed64:function(){var F=ae(this.buf,this.pos)+de(this.buf,this.pos+4)*r;return this.pos+=8,F},readFloat:function(){var F=a.read(this.buf,this.pos,!0,23,4);return this.pos+=4,F},readDouble:function(){var F=a.read(this.buf,this.pos,!0,52,8);return this.pos+=8,F},readVarint:function(F){var J,me,De=this.buf;return J=127&(me=De[this.pos++]),me<128?J:(J|=(127&(me=De[this.pos++]))<<7,me<128?J:(J|=(127&(me=De[this.pos++]))<<14,me<128?J:(J|=(127&(me=De[this.pos++]))<<21,me<128?J:function(et,Fe,Ze){var ct,rt,ht=Ze.buf;if(ct=(112&(rt=ht[Ze.pos++]))>>4,rt<128||(ct|=(127&(rt=ht[Ze.pos++]))<<3,rt<128)||(ct|=(127&(rt=ht[Ze.pos++]))<<10,rt<128)||(ct|=(127&(rt=ht[Ze.pos++]))<<17,rt<128)||(ct|=(127&(rt=ht[Ze.pos++]))<<24,rt<128)||(ct|=(1&(rt=ht[Ze.pos++]))<<31,rt<128))return _(et,ct,Fe);throw new Error("Expected varint not more than 10 bytes")}(J|=(15&(me=De[this.pos]))<<28,F,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var F=this.readVarint();return F%2==1?(F+1)/-2:F/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var F=this.readVarint()+this.pos,J=this.pos;return this.pos=F,F-J>=12&&f?function(me,De,et){return f.decode(me.subarray(De,et))}(this.buf,J,F):function(me,De,et){for(var Fe="",Ze=De;Ze<et;){var ct,rt,ht,$e=me[Ze],Et=null,kt=$e>239?4:$e>223?3:$e>191?2:1;if(Ze+kt>et)break;kt===1?$e<128&&(Et=$e):kt===2?(192&(ct=me[Ze+1]))==128&&(Et=(31&$e)<<6|63&ct)<=127&&(Et=null):kt===3?(rt=me[Ze+2],(192&(ct=me[Ze+1]))==128&&(192&rt)==128&&((Et=(15&$e)<<12|(63&ct)<<6|63&rt)<=2047||Et>=55296&&Et<=57343)&&(Et=null)):kt===4&&(rt=me[Ze+2],ht=me[Ze+3],(192&(ct=me[Ze+1]))==128&&(192&rt)==128&&(192&ht)==128&&((Et=(15&$e)<<18|(63&ct)<<12|(63&rt)<<6|63&ht)<=65535||Et>=1114112)&&(Et=null)),Et===null?(Et=65533,kt=1):Et>65535&&(Et-=65536,Fe+=String.fromCharCode(Et>>>10&1023|55296),Et=56320|1023&Et),Fe+=String.fromCharCode(Et),Ze+=kt}return Fe}(this.buf,J,F)},readBytes:function(){var F=this.readVarint()+this.pos,J=this.buf.subarray(this.pos,F);return this.pos=F,J},readPackedVarint:function(F,J){if(this.type!==t.Bytes)return F.push(this.readVarint(J));var me=g(this);for(F=F||[];this.pos<me;)F.push(this.readVarint(J));return F},readPackedSVarint:function(F){if(this.type!==t.Bytes)return F.push(this.readSVarint());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readSVarint());return F},readPackedBoolean:function(F){if(this.type!==t.Bytes)return F.push(this.readBoolean());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readBoolean());return F},readPackedFloat:function(F){if(this.type!==t.Bytes)return F.push(this.readFloat());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readFloat());return F},readPackedDouble:function(F){if(this.type!==t.Bytes)return F.push(this.readDouble());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readDouble());return F},readPackedFixed32:function(F){if(this.type!==t.Bytes)return F.push(this.readFixed32());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readFixed32());return F},readPackedSFixed32:function(F){if(this.type!==t.Bytes)return F.push(this.readSFixed32());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readSFixed32());return F},readPackedFixed64:function(F){if(this.type!==t.Bytes)return F.push(this.readFixed64());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readFixed64());return F},readPackedSFixed64:function(F){if(this.type!==t.Bytes)return F.push(this.readSFixed64());var J=g(this);for(F=F||[];this.pos<J;)F.push(this.readSFixed64());return F},skip:function(F){var J=7&F;if(J===t.Varint)for(;this.buf[this.pos++]>127;);else if(J===t.Bytes)this.pos=this.readVarint()+this.pos;else if(J===t.Fixed32)this.pos+=4;else{if(J!==t.Fixed64)throw new Error("Unimplemented type: "+J);this.pos+=8}},writeTag:function(F,J){this.writeVarint(F<<3|J)},realloc:function(F){for(var J=this.length||16;J<this.pos+F;)J*=2;if(J!==this.length){var me=new Uint8Array(J);me.set(this.buf),this.buf=me,this.length=J}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(F){this.realloc(4),we(this.buf,F,this.pos),this.pos+=4},writeSFixed32:function(F){this.realloc(4),we(this.buf,F,this.pos),this.pos+=4},writeFixed64:function(F){this.realloc(8),we(this.buf,-1&F,this.pos),we(this.buf,Math.floor(F*o),this.pos+4),this.pos+=8},writeSFixed64:function(F){this.realloc(8),we(this.buf,-1&F,this.pos),we(this.buf,Math.floor(F*o),this.pos+4),this.pos+=8},writeVarint:function(F){(F=+F||0)>268435455||F<0?function(J,me){var De,et;if(J>=0?(De=J%4294967296|0,et=J/4294967296|0):(et=~(-J/4294967296),4294967295^(De=~(-J%4294967296))?De=De+1|0:(De=0,et=et+1|0)),J>=18446744073709552e3||J<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");me.realloc(10),function(Fe,Ze,ct){ct.buf[ct.pos++]=127&Fe|128,Fe>>>=7,ct.buf[ct.pos++]=127&Fe|128,Fe>>>=7,ct.buf[ct.pos++]=127&Fe|128,Fe>>>=7,ct.buf[ct.pos++]=127&Fe|128,ct.buf[ct.pos]=127&(Fe>>>=7)}(De,0,me),function(Fe,Ze){var ct=(7&Fe)<<4;Ze.buf[Ze.pos++]|=ct|((Fe>>>=3)?128:0),Fe&&(Ze.buf[Ze.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ze.buf[Ze.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ze.buf[Ze.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ze.buf[Ze.pos++]=127&Fe|((Fe>>>=7)?128:0),Fe&&(Ze.buf[Ze.pos++]=127&Fe)))))}(et,me)}(F,this):(this.realloc(4),this.buf[this.pos++]=127&F|(F>127?128:0),F<=127||(this.buf[this.pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||(this.buf[this.pos++]=127&(F>>>=7)|(F>127?128:0),F<=127||(this.buf[this.pos++]=F>>>7&127))))},writeSVarint:function(F){this.writeVarint(F<0?2*-F-1:2*F)},writeBoolean:function(F){this.writeVarint(!!F)},writeString:function(F){F=String(F),this.realloc(4*F.length),this.pos++;var J=this.pos;this.pos=function(De,et,Fe){for(var Ze,ct,rt=0;rt<et.length;rt++){if((Ze=et.charCodeAt(rt))>55295&&Ze<57344){if(!ct){Ze>56319||rt+1===et.length?(De[Fe++]=239,De[Fe++]=191,De[Fe++]=189):ct=Ze;continue}if(Ze<56320){De[Fe++]=239,De[Fe++]=191,De[Fe++]=189,ct=Ze;continue}Ze=ct-55296<<10|Ze-56320|65536,ct=null}else ct&&(De[Fe++]=239,De[Fe++]=191,De[Fe++]=189,ct=null);Ze<128?De[Fe++]=Ze:(Ze<2048?De[Fe++]=Ze>>6|192:(Ze<65536?De[Fe++]=Ze>>12|224:(De[Fe++]=Ze>>18|240,De[Fe++]=Ze>>12&63|128),De[Fe++]=Ze>>6&63|128),De[Fe++]=63&Ze|128)}return Fe}(this.buf,F,this.pos);var me=this.pos-J;me>=128&&v(J,me,this),this.pos=J-1,this.writeVarint(me),this.pos+=me},writeFloat:function(F){this.realloc(4),a.write(this.buf,F,this.pos,!0,23,4),this.pos+=4},writeDouble:function(F){this.realloc(8),a.write(this.buf,F,this.pos,!0,52,8),this.pos+=8},writeBytes:function(F){var J=F.length;this.writeVarint(J),this.realloc(J);for(var me=0;me<J;me++)this.buf[this.pos++]=F[me]},writeRawMessage:function(F,J){this.pos++;var me=this.pos;F(J,this);var De=this.pos-me;De>=128&&v(me,De,this),this.pos=me-1,this.writeVarint(De),this.pos+=De},writeMessage:function(F,J,me){this.writeTag(F,t.Bytes),this.writeRawMessage(J,me)},writePackedVarint:function(F,J){J.length&&this.writeMessage(F,w,J)},writePackedSVarint:function(F,J){J.length&&this.writeMessage(F,M,J)},writePackedBoolean:function(F,J){J.length&&this.writeMessage(F,B,J)},writePackedFloat:function(F,J){J.length&&this.writeMessage(F,P,J)},writePackedDouble:function(F,J){J.length&&this.writeMessage(F,D,J)},writePackedFixed32:function(F,J){J.length&&this.writeMessage(F,j,J)},writePackedSFixed32:function(F,J){J.length&&this.writeMessage(F,G,J)},writePackedFixed64:function(F,J){J.length&&this.writeMessage(F,$,J)},writePackedSFixed64:function(F,J){J.length&&this.writeMessage(F,ee,J)},writeBytesField:function(F,J){this.writeTag(F,t.Bytes),this.writeBytes(J)},writeFixed32Field:function(F,J){this.writeTag(F,t.Fixed32),this.writeFixed32(J)},writeSFixed32Field:function(F,J){this.writeTag(F,t.Fixed32),this.writeSFixed32(J)},writeFixed64Field:function(F,J){this.writeTag(F,t.Fixed64),this.writeFixed64(J)},writeSFixed64Field:function(F,J){this.writeTag(F,t.Fixed64),this.writeSFixed64(J)},writeVarintField:function(F,J){this.writeTag(F,t.Varint),this.writeVarint(J)},writeSVarintField:function(F,J){this.writeTag(F,t.Varint),this.writeSVarint(J)},writeStringField:function(F,J){this.writeTag(F,t.Bytes),this.writeString(J)},writeFloatField:function(F,J){this.writeTag(F,t.Fixed32),this.writeFloat(J)},writeDoubleField:function(F,J){this.writeTag(F,t.Fixed64),this.writeDouble(J)},writeBooleanField:function(F,J){this.writeVarintField(F,!!J)}},hd}var Qo,ff=pe(fd());function dd(a,t,r){a===1&&r.readMessage(pd,t)}function pd(a,t,r){if(a===3){const{id:o,bitmap:f,width:g,height:_,left:v,top:w,advance:M}=r.readMessage(Op,{});t.push({id:o,bitmap:new uu({width:g+6,height:_+6},f),metrics:{width:g,height:_,left:v,top:w,advance:M}})}}function Op(a,t,r){a===1?t.id=r.readVarint():a===2?t.bitmap=r.readBytes():a===3?t.width=r.readVarint():a===4?t.height=r.readVarint():a===5?t.left=r.readSVarint():a===6?t.top=r.readSVarint():a===7&&(t.advance=r.readVarint())}function cp(a){let t=0,r=0;for(const _ of a)t+=_.w*_.h,r=Math.max(r,_.w);a.sort((_,v)=>v.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let f=0,g=0;for(const _ of a)for(let v=o.length-1;v>=0;v--){const w=o[v];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,g=Math.max(g,_.y+_.h),f=Math.max(f,_.x+_.w),_.w===w.w&&_.h===w.h){const M=o.pop();v<o.length&&(o[v]=M)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(o.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:f,h:g,fill:t/(f*g)||0}}class md{constructor(t,{pixelRatio:r,version:o,stretchX:f,stretchY:g,content:_,textFitWidth:v,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=f,this.stretchY=g,this.content=_,this.version=o,this.textFitWidth=v,this.textFitHeight=w}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class gd{constructor(t,r){const o={},f={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,o,g),this.addImages(r,f,g);const{w:_,h:v}=cp(g),w=new Er({width:_||1,height:v||1});for(const M in t){const P=t[M],D=o[M].paddedRect;Er.copy(P.data,w,{x:0,y:0},{x:D.x+1,y:D.y+1},P.data)}for(const M in r){const P=r[M],D=f[M].paddedRect,B=D.x+1,j=D.y+1,G=P.data.width,$=P.data.height;Er.copy(P.data,w,{x:0,y:0},{x:B,y:j},P.data),Er.copy(P.data,w,{x:0,y:$-1},{x:B,y:j-1},{width:G,height:1}),Er.copy(P.data,w,{x:0,y:0},{x:B,y:j+$},{width:G,height:1}),Er.copy(P.data,w,{x:G-1,y:0},{x:B-1,y:j},{width:1,height:$}),Er.copy(P.data,w,{x:0,y:0},{x:B+G,y:j},{width:1,height:$})}this.image=w,this.iconPositions=o,this.patternPositions=f}addImages(t,r,o){for(const f in t){const g=t[f],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};o.push(_),r[f]=new md(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),r),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),r)}patchUpdatedImage(t,r,o){if(!t||!r||t.version===r.version)return;t.version=r.version;const[f,g]=t.tl;o.update(r.data,void 0,{x:f,y:g})}}xt("ImagePosition",md),xt("ImageAtlas",gd),E.an=void 0,(Qo=E.an||(E.an={}))[Qo.none=0]="none",Qo[Qo.horizontal=1]="horizontal",Qo[Qo.vertical=2]="vertical",Qo[Qo.horizontalOnly=3]="horizontalOnly";class bu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,o){const f=new bu;return f.scale=t||1,f.fontStack=r,f.verticalAlign=o||"bottom",f}static forImage(t,r){const o=new bu;return o.imageName=t,o.verticalAlign=r||"bottom",o}}class Ps{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const o=new Ps;for(let f=0;f<t.sections.length;f++){const g=t.sections[f];g.image?o.addImageSection(g):o.addTextSection(g,r)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let r="";for(let o=0;o<t.length;o++){const f=t.charCodeAt(o+1)||null,g=t.charCodeAt(o-1)||null;r+=f&&nu(f)&&!vu[t[o+1]]||g&&nu(g)&&!vu[t[o-1]]||!vu[t[o]]?t[o]:vu[t[o]]}return r}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&bh[this.text.charCodeAt(o)];o++)t++;let r=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&bh[this.text.charCodeAt(o)];o--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const o=new Ps;return o.text=this.text.substring(t,r),o.sectionIndex=this.sectionIndex.slice(t,r),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,r)=>Math.max(t,this.sections[r].scale),0)}getMaxImageSize(t){let r=0,o=0;for(let f=0;f<this.length();f++){const g=this.getSection(f);if(g.imageName){const _=t[g.imageName];if(!_)continue;const v=_.displaySize;r=Math.max(r,v[0]),o=Math.max(o,v[1])}}return{maxImageWidth:r,maxImageHeight:o}}addTextSection(t,r){this.text+=t.text,this.sections.push(bu.forText(t.scale,t.fontStack||r,t.verticalAlign));const o=this.sections.length-1;for(let f=0;f<t.text.length;++f)this.sectionIndex.push(o)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Wi("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(bu.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Wi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pc(a,t,r,o,f,g,_,v,w,M,P,D,B,j,G){const $=Ps.fromFeature(a,f);let ee;D===E.an.vertical&&$.verticalizePunctuation();const{processBidirectionalText:ae,processStyledBidirectionalText:we}=Wa;if(ae&&$.sections.length===1){ee=[];const J=ae($.toString(),df($,M,g,t,o,j));for(const me of J){const De=new Ps;De.text=me,De.sections=$.sections;for(let et=0;et<me.length;et++)De.sectionIndex.push(0);ee.push(De)}}else if(we){ee=[];const J=we($.text,$.sectionIndex,df($,M,g,t,o,j));for(const me of J){const De=new Ps;De.text=me[0],De.sectionIndex=me[1],De.sections=$.sections,ee.push(De)}}else ee=function(J,me){const De=[],et=J.text;let Fe=0;for(const Ze of me)De.push(J.substring(Fe,Ze)),Fe=Ze;return Fe<et.length&&De.push(J.substring(Fe,et.length)),De}($,df($,M,g,t,o,j));const de=[],F={positionedLines:de,text:$.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:D,iconsInText:!1,verticalizable:!1};return function(J,me,De,et,Fe,Ze,ct,rt,ht,$e,Et,kt){let zt=0,Tt=0,ei=0,Hi=0;const _n=rt==="right"?1:rt==="left"?0:.5,yn=Rn/kt;let Fa=0;for(const dn of Fe){dn.trim();const Xn=dn.getMaxScale(),Vn={positionedGlyphs:[],lineOffset:0};J.positionedLines[Fa]=Vn;const er=Vn.positionedGlyphs;let Lr=0;if(!dn.length()){Tt+=Ze,++Fa;continue}const kr=xd(et,dn,yn);for(let Or=0;Or<dn.length();Or++){const vn=dn.getSection(Or),Gn=dn.getSectionIndex(Or),Ln=dn.getCharCode(Or),kn=pp(ht,Et,Ln);let tn;if(vn.imageName){if(J.iconsInText=!0,vn.scale=vn.scale*yn,tn=Np(vn,kn,Xn,kr,et),!tn)continue;Lr=Math.max(Lr,tn.imageOffset)}else if(tn=Bp(vn,Ln,kn,kr,me,De),!tn)continue;const{rect:_a,metrics:i,baselineOffset:s}=tn;er.push({glyph:Ln,imageName:vn.imageName,x:zt,y:Tt+s+-17,vertical:kn,scale:vn.scale,fontStack:vn.fontStack,sectionIndex:Gn,metrics:i,rect:_a}),kn?(J.verticalizable=!0,zt+=(vn.imageName?i.advance:Rn)*vn.scale+$e):zt+=i.advance*vn.scale+$e}er.length!==0&&(ei=Math.max(zt-$e,ei),Fp(er,0,er.length-1,_n)),zt=0,Vn.lineOffset=Math.max(Lr,(Xn-1)*Rn);const Dn=Ze*Xn+Lr;Tt+=Dn,Hi=Math.max(Dn,Hi),++Fa}const{horizontalAlign:Dr,verticalAlign:In}=Zi(ct);(function(dn,Xn,Vn,er,Lr,kr,Dn,Or,vn){const Gn=(Xn-Vn)*Lr;let Ln=0;Ln=kr!==Dn?-Or*er- -17:-er*vn*Dn+.5*Dn;for(const kn of dn)for(const tn of kn.positionedGlyphs)tn.x+=Gn,tn.y+=Ln})(J.positionedLines,_n,Dr,In,ei,Hi,Ze,Tt,Fe.length),J.top+=-In*Tt,J.bottom=J.top+Tt,J.left+=-Dr*ei,J.right=J.left+ei}(F,t,r,o,ee,_,v,w,D,M,B,G),!function(J){for(const me of J)if(me.positionedGlyphs.length!==0)return!1;return!0}(de)&&F}const bh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},up={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hp={40:!0};function _d(a,t,r,o,f,g){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*Rn/g+f:0}{const _=r[t.fontStack],v=_&&_[a];return v?v.metrics.advance*t.scale+f:0}}function yd(a,t,r,o){const f=Math.pow(a-t,2);return o?a<t?f/2:2*f:f+Math.abs(r)*r}function fp(a,t,r){let o=0;return a===10&&(o-=1e4),r&&(o+=150),a!==40&&a!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function wh(a,t,r,o,f,g){let _=null,v=yd(t,r,f,g);for(const w of o){const M=yd(t-w.x,r,f,g)+w.badness;M<=v&&(_=w,v=M)}return{index:a,x:t,priorBreak:_,badness:v}}function vd(a){return a?vd(a.priorBreak).concat(a.index):[]}function df(a,t,r,o,f,g){if(!a)return[];const _=[],v=function(D,B,j,G,$,ee){let ae=0;for(let we=0;we<D.length();we++){const de=D.getSection(we);ae+=_d(D.getCharCode(we),de,G,$,B,ee)}return ae/Math.max(1,Math.ceil(ae/j))}(a,t,r,o,f,g),w=a.text.indexOf("")>=0;let M=0;for(let D=0;D<a.length();D++){const B=a.getSection(D),j=a.getCharCode(D);if(bh[j]||(M+=_d(j,B,o,f,t,g)),D<a.length()-1){const G=!((P=j)<11904)&&(!!oi["CJK Compatibility Forms"](P)||!!oi["CJK Compatibility"](P)||!!oi["CJK Strokes"](P)||!!oi["CJK Symbols and Punctuation"](P)||!!oi["Enclosed CJK Letters and Months"](P)||!!oi["Halfwidth and Fullwidth Forms"](P)||!!oi["Ideographic Description Characters"](P)||!!oi["Vertical Forms"](P)||ko.test(String.fromCodePoint(P)));(up[j]||G||B.imageName||D!==a.length()-2&&hp[a.getCharCode(D+1)])&&_.push(wh(D+1,M,v,_,fp(j,a.getCharCode(D+1),G&&w),!1))}}var P;return vd(wh(a.length(),M,v,_,0,!0))}function Zi(a){let t=.5,r=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function xd(a,t,r){const o=t.getMaxScale()*Rn,{maxImageWidth:f,maxImageHeight:g}=t.getMaxImageSize(a),_=Math.max(o,g*r);return{verticalLineContentWidth:Math.max(o,f*r),horizontalLineContentHeight:_}}function dp(a){switch(a){case"top":return 0;case"center":return .5;default:return 1}}function pp(a,t,r){return!(a===E.an.horizontal||!t&&!Qs(r)||t&&(bh[r]||(o=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(o)))));var o}function Bp(a,t,r,o,f,g){const _=g[a.fontStack],v=function(M,P,D,B){if(M&&M.rect)return M;const j=P[D.fontStack],G=j&&j[B];return G?{rect:null,metrics:G.metrics}:null}(_&&_[t],f,a,t);if(v===null)return null;let w;if(r)w=o.verticalLineContentWidth-a.scale*Rn;else{const M=dp(a.verticalAlign);w=(o.horizontalLineContentHeight-a.scale*Rn)*M}return{rect:v.rect,metrics:v.metrics,baselineOffset:w}}function Np(a,t,r,o,f){const g=f[a.imageName];if(!g)return null;const _=g.paddedRect,v=g.displaySize,w={width:v[0],height:v[1],left:1,top:-3,advance:t?v[1]:v[0]};let M;if(t)M=o.verticalLineContentWidth-v[1]*a.scale;else{const P=dp(a.verticalAlign);M=(o.horizontalLineContentHeight-v[1]*a.scale)*P}return{rect:_,metrics:w,baselineOffset:M,imageOffset:(t?v[0]:v[1])*a.scale-Rn*r}}function Fp(a,t,r,o){if(o===0)return;const f=a[r],g=(a[r].x+f.metrics.advance*f.scale)*o;for(let _=t;_<=r;_++)a[_].x-=g}function pf(a,t,r){const{horizontalAlign:o,verticalAlign:f}=Zi(r),g=t[0]-a.displaySize[0]*o,_=t[1]-a.displaySize[1]*f;return{image:a,top:_,bottom:_+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function zc(a){var t,r;let o=a.left,f=a.top,g=a.right-o,_=a.bottom-f;const v=(t=a.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(r=a.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",M=(a.image.content[2]-a.image.content[0])/(a.image.content[3]-a.image.content[1]);if(w==="proportional"){if(v==="stretchOnly"&&g/_<M||v==="proportional"){const P=Math.ceil(_*M);o*=P/g,g=P}}else if(v==="proportional"&&w==="stretchOnly"&&M!==0&&g/_>M){const P=Math.ceil(g/M);f*=P/_,_=P}return{x1:o,y1:f,x2:o+g,y2:f+_}}function mf(a,t,r,o,f,g){const _=a.image;let v;if(_.content){const ee=_.content,ae=_.pixelRatio||1;v=[ee[0]/ae,ee[1]/ae,_.displaySize[0]-ee[2]/ae,_.displaySize[1]-ee[3]/ae]}const w=t.left*g,M=t.right*g;let P,D,B,j;r==="width"||r==="both"?(j=f[0]+w-o[3],D=f[0]+M+o[1]):(j=f[0]+(w+M-_.displaySize[0])/2,D=j+_.displaySize[0]);const G=t.top*g,$=t.bottom*g;return r==="height"||r==="both"?(P=f[1]+G-o[0],B=f[1]+$+o[2]):(P=f[1]+(G+$-_.displaySize[1])/2,B=P+_.displaySize[1]),{image:_,top:P,right:D,bottom:B,left:j,collisionPadding:v}}const rs=128,so=32640;function Ll(a,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new Ui(a+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:f}=r;let g=0;for(;g<o.length&&o[g]<=a;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<a+1;)_++;_=Math.min(o.length-1,_);const v=o[g],w=o[_];return r.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:f}:{kind:"camera",minZoom:v,maxZoom:w,minSize:r.evaluate(new Ui(v)),maxSize:r.evaluate(new Ui(w)),interpolationType:f}}}function as(a,t,r){let o="never";const f=a.get(t);return f?o=f:a.get(r)&&(o="always"),o}const Th=Fi.VectorTileFeature.types,jp=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sh(a,t,r,o,f,g,_,v,w,M,P,D,B){const j=v?Math.min(so,Math.round(v[0])):0,G=v?Math.min(so,Math.round(v[1])):0;a.emplaceBack(t,r,Math.round(32*o),Math.round(32*f),g,_,(j<<1)+(w?1:0),G,16*M,16*P,256*D,256*B)}function gf(a,t,r){a.emplaceBack(t.x,t.y,r),a.emplaceBack(t.x,t.y,r),a.emplaceBack(t.x,t.y,r),a.emplaceBack(t.x,t.y,r)}function mp(a){for(const t of a.sections)if(au(t.text))return!0;return!1}class _f{constructor(t){this.layoutVertexArray=new ii,this.indexArray=new zi,this.programConfigurations=t,this.segments=new pi,this.dynamicLayoutVertexArray=new yi,this.opacityVertexArray=new ln,this.hasVisibleVertices=!1,this.placedSymbolArray=new re}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,o,f){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,op.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,vh.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,jp,!0),this.opacityVertexBuffer.itemSize=1),(o||f)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}xt("SymbolBuffers",_f);class bd{constructor(t,r,o){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new o,this.segments=new pi,this.collisionVertexArray=new fn}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,cd.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}xt("CollisionBuffers",bd);class kl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ll(this.zoom,r["text-size"]),this.iconSizeData=Ll(this.zoom,r["icon-size"]);const o=this.layers[0].layout,f=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=as(o,"text-overlap","text-allow-overlap")!=="never"||as(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>E.an[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new _f(new Mr(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new _f(new Mr(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new le,this.lineVertexArray=new ge,this.symbolInstances=new fe,this.textAnchorOffsets=new ue}calculateGlyphDependencies(t,r,o,f,g){for(let _=0;_<t.length;_++)if(r[t.charCodeAt(_)]=!0,(o||f)&&g){const v=vu[t.charAt(_)];v&&(r[v.charCodeAt(0)]=!0)}}populate(t,r,o){const f=this.layers[0],g=f.layout,_=g.get("text-font"),v=g.get("text-field"),w=g.get("icon-image"),M=(v.value.kind!=="constant"||v.value.value instanceof nr&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),P=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,D=g.get("symbol-sort-key");if(this.features=[],!M&&!P)return;const B=r.iconDependencies,j=r.glyphDependencies,G=r.availableImages,$=new Ui(this.zoom,{globalState:this.globalState});for(const{feature:ee,id:ae,index:we,sourceLayerIndex:de}of t){const F=f._featureFilter.needGeometry,J=Pl(ee,F);if(!f._featureFilter.filter($,J,o))continue;let me,De;if(F||(J.geometry=Go(ee)),M){const Fe=f.getValueAndResolveTokens("text-field",J,o,G),Ze=nr.factory(Fe),ct=this.hasRTLText=this.hasRTLText||mp(Ze);(!ct||Wa.getRTLTextPluginStatus()==="unavailable"||ct&&Wa.isParsed())&&(me=Na(Ze,f,J))}if(P){const Fe=f.getValueAndResolveTokens("icon-image",J,o,G);De=Fe instanceof rr?Fe:rr.fromString(Fe)}if(!me&&!De)continue;const et=this.sortFeaturesByKey?D.evaluate(J,{},o):void 0;if(this.features.push({id:ae,text:me,icon:De,index:we,sourceLayerIndex:de,geometry:J.geometry,properties:ee.properties,type:Th[ee.type],sortKey:et}),De&&(B[De.name]=!0),me){const Fe=_.evaluate(J,{},o).join(","),Ze=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(E.an.vertical)>=0;for(const ct of me.sections)if(ct.image)B[ct.image.name]=!0;else{const rt=Ya(me.toString()),ht=ct.fontStack||Fe,$e=j[ht]=j[ht]||{};this.calculateGlyphDependencies(ct.text,$e,Ze,this.allowVerticalPlacement,rt)}}}g.get("symbol-placement")==="line"&&(this.features=function(ee){const ae={},we={},de=[];let F=0;function J(Fe){de.push(ee[Fe]),F++}function me(Fe,Ze,ct){const rt=we[Fe];return delete we[Fe],we[Ze]=rt,de[rt].geometry[0].pop(),de[rt].geometry[0]=de[rt].geometry[0].concat(ct[0]),rt}function De(Fe,Ze,ct){const rt=ae[Ze];return delete ae[Ze],ae[Fe]=rt,de[rt].geometry[0].shift(),de[rt].geometry[0]=ct[0].concat(de[rt].geometry[0]),rt}function et(Fe,Ze,ct){const rt=ct?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Fe}:${rt.x}:${rt.y}`}for(let Fe=0;Fe<ee.length;Fe++){const Ze=ee[Fe],ct=Ze.geometry,rt=Ze.text?Ze.text.toString():null;if(!rt){J(Fe);continue}const ht=et(rt,ct),$e=et(rt,ct,!0);if(ht in we&&$e in ae&&we[ht]!==ae[$e]){const Et=De(ht,$e,ct),kt=me(ht,$e,de[Et].geometry);delete ae[ht],delete we[$e],we[et(rt,de[kt].geometry,!0)]=kt,de[Et].geometry=null}else ht in we?me(ht,$e,ct):$e in ae?De(ht,$e,ct):(J(Fe),ae[ht]=F-1,we[$e]=F-1)}return de.filter(Fe=>Fe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ee,ae)=>ee.sortKey-ae.sortKey)}update(t,r,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const o=this.lineVertexArray.length;if(t.segment!==void 0){let f=t.dist(r[t.segment+1]),g=t.dist(r[t.segment]);const _={};for(let v=t.segment+1;v<r.length;v++)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:f},v<r.length-1&&(f+=r[v+1].dist(r[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:r[v].x,y:r[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=r[v-1].dist(r[v]));for(let v=0;v<r.length;v++){const w=_[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,r,o,f,g,_,v,w,M,P,D,B){const j=t.indexArray,G=t.layoutVertexArray,$=t.segments.prepareSegment(4*r.length,G,j,this.canOverlap?_.sortKey:void 0),ee=this.glyphOffsetArray.length,ae=$.vertexLength,we=this.allowVerticalPlacement&&v===E.an.vertical?Math.PI/2:0,de=_.text&&_.text.sections;for(let F=0;F<r.length;F++){const{tl:J,tr:me,bl:De,br:et,tex:Fe,pixelOffsetTL:Ze,pixelOffsetBR:ct,minFontScaleX:rt,minFontScaleY:ht,glyphOffset:$e,isSDF:Et,sectionIndex:kt}=r[F],zt=$.vertexLength,Tt=$e[1];Sh(G,w.x,w.y,J.x,Tt+J.y,Fe.x,Fe.y,o,Et,Ze.x,Ze.y,rt,ht),Sh(G,w.x,w.y,me.x,Tt+me.y,Fe.x+Fe.w,Fe.y,o,Et,ct.x,Ze.y,rt,ht),Sh(G,w.x,w.y,De.x,Tt+De.y,Fe.x,Fe.y+Fe.h,o,Et,Ze.x,ct.y,rt,ht),Sh(G,w.x,w.y,et.x,Tt+et.y,Fe.x+Fe.w,Fe.y+Fe.h,o,Et,ct.x,ct.y,rt,ht),gf(t.dynamicLayoutVertexArray,w,we),j.emplaceBack(zt,zt+2,zt+1),j.emplaceBack(zt+1,zt+2,zt+3),$.vertexLength+=4,$.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($e[0]),F!==r.length-1&&kt===r[F+1].sectionIndex||t.programConfigurations.populatePaintArrays(G.length,_,_.index,{},B,de&&de[kt])}t.placedSymbolArray.emplaceBack(w.x,w.y,ee,this.glyphOffsetArray.length-ee,ae,M,P,w.segment,o?o[0]:0,o?o[1]:0,f[0],f[1],v,0,!1,0,D)}_addCollisionDebugVertex(t,r,o,f,g,_){return r.emplaceBack(0,0),t.emplaceBack(o.x,o.y,f,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,r,o,f,g,_,v){const w=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),M=w.vertexLength,P=g.layoutVertexArray,D=g.collisionVertexArray,B=v.anchorX,j=v.anchorY;this._addCollisionDebugVertex(P,D,_,B,j,new Ie(t,r)),this._addCollisionDebugVertex(P,D,_,B,j,new Ie(o,r)),this._addCollisionDebugVertex(P,D,_,B,j,new Ie(o,f)),this._addCollisionDebugVertex(P,D,_,B,j,new Ie(t,f)),w.vertexLength+=4;const G=g.indexArray;G.emplaceBack(M,M+1),G.emplaceBack(M+1,M+2),G.emplaceBack(M+2,M+3),G.emplaceBack(M+3,M),w.primitiveLength+=4}addDebugCollisionBoxes(t,r,o,f){for(let g=t;g<r;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,f?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new bd(Pi,ma.members,Ri),this.iconCollisionBox=new bd(Pi,ma.members,Ri);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,o,f,g,_,v,w,M){const P={};for(let D=r;D<o;D++){const B=t.get(D);P.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.textFeatureIndex=B.featureIndex;break}for(let D=f;D<g;D++){const B=t.get(D);P.verticalTextBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.verticalTextFeatureIndex=B.featureIndex;break}for(let D=_;D<v;D++){const B=t.get(D);P.iconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.iconFeatureIndex=B.featureIndex;break}for(let D=w;D<M;D++){const B=t.get(D);P.verticalIconBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},P.verticalIconFeatureIndex=B.featureIndex;break}return P}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const o=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const o=t.placedSymbolArray.get(r),f=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<f;g+=4)t.indexArray.emplaceBack(g,g+2,g+1),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),o=Math.cos(t),f=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const w=this.symbolInstances.get(v);f.push(0|Math.round(r*w.anchorX+o*w.anchorY)),g.push(w.featureIndex)}return _.sort((v,w)=>f[v]-f[w]||g[w]-g[v]),_}addToSortKeyRanges(t,r){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===r?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const o=this.symbolInstances.get(r);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((f,g,_)=>{f>=0&&_.indexOf(f)===g&&this.addIndicesForPlacedSymbol(this.text,f)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wd,Td;xt("SymbolBucket",kl,{omit:["layers","collisionBoxArray","features","compareText"]}),kl.MAX_GLYPHS=65535,kl.addDynamicAttributes=gf;var Sd={get paint(){return Td=Td||new sr({"icon-opacity":new It(xe.paint_symbol["icon-opacity"]),"icon-color":new It(xe.paint_symbol["icon-color"]),"icon-halo-color":new It(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new It(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new It(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new wt(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new wt(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new It(xe.paint_symbol["text-opacity"]),"text-color":new It(xe.paint_symbol["text-color"],{runtimeType:Cr,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new It(xe.paint_symbol["text-halo-color"]),"text-halo-width":new It(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new It(xe.paint_symbol["text-halo-blur"]),"text-translate":new wt(xe.paint_symbol["text-translate"]),"text-translate-anchor":new wt(xe.paint_symbol["text-translate-anchor"])})},get layout(){return wd=wd||new sr({"symbol-placement":new wt(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new wt(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new wt(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new It(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new wt(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new wt(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new wt(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new wt(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new wt(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new wt(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new It(xe.layout_symbol["icon-size"]),"icon-text-fit":new wt(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new wt(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new It(xe.layout_symbol["icon-image"]),"icon-rotate":new It(xe.layout_symbol["icon-rotate"]),"icon-padding":new It(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new wt(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new It(xe.layout_symbol["icon-offset"]),"icon-anchor":new It(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new wt(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new wt(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new wt(xe.layout_symbol["text-rotation-alignment"]),"text-field":new It(xe.layout_symbol["text-field"]),"text-font":new It(xe.layout_symbol["text-font"]),"text-size":new It(xe.layout_symbol["text-size"]),"text-max-width":new It(xe.layout_symbol["text-max-width"]),"text-line-height":new wt(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new It(xe.layout_symbol["text-letter-spacing"]),"text-justify":new It(xe.layout_symbol["text-justify"]),"text-radial-offset":new It(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new wt(xe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new It(xe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new It(xe.layout_symbol["text-anchor"]),"text-max-angle":new wt(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new wt(xe.layout_symbol["text-writing-mode"]),"text-rotate":new It(xe.layout_symbol["text-rotate"]),"text-padding":new wt(xe.layout_symbol["text-padding"]),"text-keep-upright":new wt(xe.layout_symbol["text-keep-upright"]),"text-transform":new It(xe.layout_symbol["text-transform"]),"text-offset":new It(xe.layout_symbol["text-offset"]),"text-allow-overlap":new wt(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new wt(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new wt(xe.layout_symbol["text-ignore-placement"]),"text-optional":new wt(xe.layout_symbol["text-optional"])})}};class yf{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:na,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}xt("FormatSectionOverride",yf,{omit:["defaultValue"]});class wu extends Qn{constructor(t){super(t,Sd)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const f=[];for(const g of o)f.indexOf(g)<0&&f.push(g);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,o,f){const g=this.layout.get(t).evaluate(r,{},o,f),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Po(_.value)||!g?g:function(v,w){return w.replace(/{([^{}]+)}/g,(M,P)=>v&&P in v?String(v[P]):"")}(r.properties,g)}createBucket(t){return new kl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Sd.paint.overridableProperties){if(!wu.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),o=new yf(r),f=new Ao(o,r.property.specification);let g=null;g=r.value.kind==="constant"||r.value.kind==="source"?new fr("source",f):new $a("composite",f,r.value.zoomStops),this.paint._values[t]=new dr(r.property,g,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,o){return!(!this.layout||r.isDataDriven()||o.isDataDriven())&&wu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const o=t.get("text-field"),f=Sd.paint.properties[r];let g=!1;const _=v=>{for(const w of v)if(f.overrides&&f.overrides.hasOverride(w))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof nr)_(o.value.value.sections);else if(o.value.kind==="source"){const v=M=>{g||(M instanceof Mn&&Vt(M.value)===Ds?_(M.value.sections):M instanceof ds?_(M.sections):M.eachChild(v))},w=o.value;w._styleExpression&&v(w._styleExpression.expression)}return g}}let gp;var Up={get paint(){return gp=gp||new sr({"background-color":new wt(xe.paint_background["background-color"]),"background-pattern":new pn(xe.paint_background["background-pattern"]),"background-opacity":new wt(xe.paint_background["background-opacity"])})}};class Mh extends Qn{constructor(t){super(t,Up)}}let _p;var yp={get paint(){return _p=_p||new sr({"raster-opacity":new wt(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new wt(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new wt(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new wt(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new wt(xe.paint_raster["raster-saturation"]),"raster-contrast":new wt(xe.paint_raster["raster-contrast"]),"raster-resampling":new wt(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new wt(xe.paint_raster["raster-fade-duration"])})}};class xi extends Qn{constructor(t){super(t,yp)}}class Md extends Qn{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class vf{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Ed={once:!0},xf=63710088e-1;class oo{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oo(uo(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,o=this.lat*r,f=t.lat*r,g=Math.sin(o)*Math.sin(f)+Math.cos(o)*Math.cos(f)*Math.cos((t.lng-this.lng)*r);return xf*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof oo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new oo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new oo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Tu=2*Math.PI*xf;function Eh(a){return Tu*Math.cos(a*Math.PI/180)}function Rc(a){return(180+a)/360}function Cd(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function vp(a,t){return a/Eh(t)}function Ad(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Pd(a,t){return a*Eh(Ad(t))}class Su{constructor(t,r,o=0){this.x=+t,this.y=+r,this.z=+o}static fromLngLat(t,r=0){const o=oo.convert(t);return new Su(Rc(o.lng),Cd(o.lat),vp(r,o.lat))}toLngLat(){return new oo(360*this.x-180,Ad(this.y))}toAltitude(){return Pd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Tu*(t=Ad(this.y),1/Math.cos(t*Math.PI/180));var t}}function Ch(a,t,r){var o=2*Math.PI*6378137/256/Math.pow(2,r);return[a*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class ji{constructor(t,r,o){if(!function(f,g,_){return!(f<0||f>25||_<0||_>=Math.pow(2,f)||g<0||g>=Math.pow(2,f))}(t,r,o))throw new Error(`x=${r}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=o,this.key=Mu(0,t,t,r,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,o){const f=(_=this.y,v=this.z,w=Ch(256*(g=this.x),256*(_=Math.pow(2,v)-_-1),v),M=Ch(256*(g+1),256*(_+1),v),w[0]+","+w[1]+","+M[0]+","+M[1]);var g,_,v,w,M;const P=function(D,B,j){let G,$="";for(let ee=D;ee>0;ee--)G=1<<ee-1,$+=(B&G?1:0)+(j&G?2:0);return $}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,P).replace(/{bbox-epsg-3857}/g,f)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new Ie((t.x*r-this.x)*ot,(t.y*r-this.y)*ot)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bf{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Mu(t,r.z,r.z,r.x,r.y)}}class qi{constructor(t,r,o,f,g){if(this.terrainRttPosMatrix32f=null,t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=r,this.canonical=new ji(o,+f,+g),this.key=Mu(r,t,o,f,g)}clone(){return new qi(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new qi(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new qi(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Mu(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Mu(this.wrap*+r,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new qi(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,o=2*this.canonical.x,f=2*this.canonical.y;return[new qi(r,this.wrap,r,o,f),new qi(r,this.wrap,r,o+1,f),new qi(r,this.wrap,r,o,f+1),new qi(r,this.wrap,r,o+1,f+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new qi(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new qi(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Su(t.x-this.wrap,t.y))}}function Mu(a,t,r,o,f){(a*=2)<0&&(a=-1*a-1);const g=1<<r;return(g*g*a+g*f+o).toString(36)+r.toString(36)+t.toString(36)}xt("CanonicalTileID",ji),xt("OverscaledTileID",qi,{omit:["terrainRttPosMatrix32f"]});class Jo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new Jo;return r.extend(t(new Ie(this.minX,this.minY))),r.extend(t(new Ie(this.maxX,this.minY))),r.extend(t(new Ie(this.minX,this.maxY))),r.extend(t(new Ie(this.maxX,this.maxY))),r}static fromPoints(t){const r=new Jo;for(const o of t)r.extend(o);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class wf{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const o=t[r];this._stringToNumber[o]=r,this._numberToString[r]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Ah{constructor(t,r,o,f,g){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=o,t._y=f,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class zd{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ks(ot,16,0),this.grid3D=new Ks(ot,16,0),this.featureIndexArray=new Oe,this.promoteId=r}insert(t,r,o,f,g,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,f,g);const w=_?this.grid3D:this.grid;for(let M=0;M<r.length;M++){const P=r[M],D=[1/0,1/0,-1/0,-1/0];for(let B=0;B<P.length;B++){const j=P[B];D[0]=Math.min(D[0],j.x),D[1]=Math.min(D[1],j.y),D[2]=Math.max(D[2],j.x),D[3]=Math.max(D[3],j.y)}D[0]<ot&&D[1]<ot&&D[2]>=0&&D[3]>=0&&w.insert(v,D[0],D[1],D[2],D[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Fi.VectorTile(new ff(this.rawTileData)).layers,this.sourceLayerCoder=new wf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,o,f){this.loadVTLayers();const g=t.params,_=ot/t.tileSize/t.scale,v=bn(g.filter),w=t.queryGeometry,M=t.queryPadding*_,P=Jo.fromPoints(w),D=this.grid.query(P.minX-M,P.minY-M,P.maxX+M,P.maxY+M),B=Jo.fromPoints(t.cameraQueryGeometry).expandBy(M),j=this.grid3D.query(B.minX,B.minY,B.maxX,B.maxY,(ee,ae,we,de)=>function(F,J,me,De,et){for(const Ze of F)if(J<=Ze.x&&me<=Ze.y&&De>=Ze.x&&et>=Ze.y)return!0;const Fe=[new Ie(J,me),new Ie(J,et),new Ie(De,et),new Ie(De,me)];if(F.length>2){for(const Ze of Fe)if(Tc(F,Ze))return!0}for(let Ze=0;Ze<F.length-1;Ze++)if(mr(F[Ze],F[Ze+1],Fe))return!0;return!1}(t.cameraQueryGeometry,ee-M,ae-M,we+M,de+M));for(const ee of j)D.push(ee);D.sort(Id);const G={};let $;for(let ee=0;ee<D.length;ee++){const ae=D[ee];if(ae===$)continue;$=ae;const we=this.featureIndexArray.get(ae);let de=null;this.loadMatchingFeature(G,we.bucketIndex,we.sourceLayerIndex,we.featureIndex,v,g.layers,g.availableImages,r,o,f,(F,J,me)=>(de||(de=Go(F)),J.queryIntersectsFeature({queryGeometry:w,feature:F,featureState:me,geometry:de,zoom:this.z,transform:t.transform,pixelsToTileUnits:_,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation})))}return G}loadMatchingFeature(t,r,o,f,g,_,v,w,M,P,D){const B=this.bucketLayerIDs[r];if(_&&!B.some(ee=>_.has(ee)))return;const j=this.sourceLayerCoder.decode(o),G=this.vtLayers[j].feature(f);if(g.needGeometry){const ee=Pl(G,!0);if(!g.filter(new Ui(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!g.filter(new Ui(this.tileID.overscaledZ),G))return;const $=this.getId(G,j);for(let ee=0;ee<B.length;ee++){const ae=B[ee];if(_&&!_.has(ae))continue;const we=w[ae];if(!we)continue;let de={};$&&P&&(de=P.getState(we.sourceLayer||"_geojsonTileLayer",$));const F=cr({},M[ae]);F.paint=Rd(F.paint,we.paint,G,de,v),F.layout=Rd(F.layout,we.layout,G,de,v);const J=!D||D(G,we,de);if(!J)continue;const me=new Ah(G,this.z,this.x,this.y,$);me.layer=F;let De=t[ae];De===void 0&&(De=t[ae]=[]),De.push({featureIndex:f,feature:me,intersectionZ:J})}}lookupSymbolFeatures(t,r,o,f,g,_,v,w){const M={};this.loadVTLayers();const P=bn(g);for(const D of t)this.loadMatchingFeature(M,o,f,D,P,_,v,w,r);return M}hasLayer(t){for(const r of this.bucketLayerIDs)for(const o of r)if(t===o)return!0;return!1}getId(t,r){var o;let f=t.id;return this.promoteId&&(f=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((o=t.properties)===null||o===void 0)&&o.cluster)&&this.promoteId&&(f=Number(t.properties.cluster_id))),f}}function Rd(a,t,r,o,f){return rn(a,(g,_)=>{const v=t instanceof Oo?t.get(_):null;return v&&v.evaluate?v.evaluate(r,o,f):v})}function Id(a,t){return t-a}function Tf(a,t,r,o,f){const g=[];for(let _=0;_<a.length;_++){const v=a[_];let w;for(let M=0;M<v.length-1;M++){let P=v[M],D=v[M+1];P.x<t&&D.x<t||(P.x<t?P=new Ie(t,P.y+(t-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x<t&&(D=new Ie(t,P.y+(t-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y<r&&D.y<r||(P.y<r?P=new Ie(P.x+(r-P.y)/(D.y-P.y)*(D.x-P.x),r)._round():D.y<r&&(D=new Ie(P.x+(r-P.y)/(D.y-P.y)*(D.x-P.x),r)._round()),P.x>=o&&D.x>=o||(P.x>=o?P=new Ie(o,P.y+(o-P.x)/(D.x-P.x)*(D.y-P.y))._round():D.x>=o&&(D=new Ie(o,P.y+(o-P.x)/(D.x-P.x)*(D.y-P.y))._round()),P.y>=f&&D.y>=f||(P.y>=f?P=new Ie(P.x+(f-P.y)/(D.y-P.y)*(D.x-P.x),f)._round():D.y>=f&&(D=new Ie(P.x+(f-P.y)/(D.y-P.y)*(D.x-P.x),f)._round()),w&&P.equals(w[w.length-1])||(w=[P],g.push(w)),w.push(D)))))}}return g}xt("FeatureIndex",zd,{omit:["rawTileData","sourceLayerCoder"]});class Ol extends Ie{constructor(t,r,o,f){super(t,r),this.angle=o,f!==void 0&&(this.segment=f)}clone(){return new Ol(this.x,this.y,this.angle,this.segment)}}function Dd(a,t,r,o,f){if(t.segment===void 0||r===0)return!0;let g=t,_=t.segment+1,v=0;for(;v>-r/2;){if(_--,_<0)return!1;v-=a[_].dist(g),g=a[_]}v+=a[_].dist(a[_+1]),_++;const w=[];let M=0;for(;v<r/2;){const P=a[_],D=a[_+1];if(!D)return!1;let B=a[_-1].angleTo(P)-P.angleTo(D);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:B}),M+=B;v-w[0].distance>o;)M-=w.shift().angleDelta;if(M>f)return!1;_++,v+=P.dist(D)}return!0}function xp(a){let t=0;for(let r=0;r<a.length-1;r++)t+=a[r].dist(a[r+1]);return t}function Ld(a,t,r){return a?.6*t*r:0}function bp(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function Vp(a,t,r,o,f,g){const _=Ld(r,f,g),v=bp(r,o)*g;let w=0;const M=xp(a)/2;for(let P=0;P<a.length-1;P++){const D=a[P],B=a[P+1],j=D.dist(B);if(w+j>M){const G=(M-w)/j,$=Gr.number(D.x,B.x,G),ee=Gr.number(D.y,B.y,G),ae=new Ol($,ee,B.angleTo(D),P);return ae._round(),!_||Dd(a,ae,v,_,t)?ae:void 0}w+=j}}function Bl(a,t,r,o,f,g,_,v,w){const M=Ld(o,g,_),P=bp(o,f),D=P*_,B=a[0].x===0||a[0].x===w||a[0].y===0||a[0].y===w;return t-D<t/4&&(t=D+t/4),kd(a,B?t/2*v%t:(P/2+2*g)*_*v%t,t,M,r,D,B,!1,w)}function kd(a,t,r,o,f,g,_,v,w){const M=g/2,P=xp(a);let D=0,B=t-r,j=[];for(let G=0;G<a.length-1;G++){const $=a[G],ee=a[G+1],ae=$.dist(ee),we=ee.angleTo($);for(;B+r<D+ae;){B+=r;const de=(B-D)/ae,F=Gr.number($.x,ee.x,de),J=Gr.number($.y,ee.y,de);if(F>=0&&F<w&&J>=0&&J<w&&B-M>=0&&B+M<=P){const me=new Ol(F,J,we,G);me._round(),o&&!Dd(a,me,g,o,f)||j.push(me)}}D+=ae}return v||j.length||_||(j=kd(a,D/2,r,o,f,g,_,!0,w)),j}function Sf(a,t,r,o){const f=[],g=a.image,_=g.pixelRatio,v=g.paddedRect.w-2,w=g.paddedRect.h-2;let M={x1:a.left,y1:a.top,x2:a.right,y2:a.bottom};const P=g.stretchX||[[0,v]],D=g.stretchY||[[0,w]],B=($e,Et)=>$e+Et[1]-Et[0],j=P.reduce(B,0),G=D.reduce(B,0),$=v-j,ee=w-G;let ae=0,we=j,de=0,F=G,J=0,me=$,De=0,et=ee;if(g.content&&o){const $e=g.content,Et=$e[2]-$e[0],kt=$e[3]-$e[1];(g.textFitWidth||g.textFitHeight)&&(M=zc(a)),ae=Mf(P,0,$e[0]),de=Mf(D,0,$e[1]),we=Mf(P,$e[0],$e[2]),F=Mf(D,$e[1],$e[3]),J=$e[0]-ae,De=$e[1]-de,me=Et-we,et=kt-F}const Fe=M.x1,Ze=M.y1,ct=M.x2-Fe,rt=M.y2-Ze,ht=($e,Et,kt,zt)=>{const Tt=Eu($e.stretch-ae,we,ct,Fe),ei=Ef($e.fixed-J,me,$e.stretch,j),Hi=Eu(Et.stretch-de,F,rt,Ze),_n=Ef(Et.fixed-De,et,Et.stretch,G),yn=Eu(kt.stretch-ae,we,ct,Fe),Fa=Ef(kt.fixed-J,me,kt.stretch,j),Dr=Eu(zt.stretch-de,F,rt,Ze),In=Ef(zt.fixed-De,et,zt.stretch,G),dn=new Ie(Tt,Hi),Xn=new Ie(yn,Hi),Vn=new Ie(yn,Dr),er=new Ie(Tt,Dr),Lr=new Ie(ei/_,_n/_),kr=new Ie(Fa/_,In/_),Dn=t*Math.PI/180;if(Dn){const Gn=Math.sin(Dn),Ln=Math.cos(Dn),kn=[Ln,-Gn,Gn,Ln];dn._matMult(kn),Xn._matMult(kn),er._matMult(kn),Vn._matMult(kn)}const Or=$e.stretch+$e.fixed,vn=Et.stretch+Et.fixed;return{tl:dn,tr:Xn,bl:er,br:Vn,tex:{x:g.paddedRect.x+1+Or,y:g.paddedRect.y+1+vn,w:kt.stretch+kt.fixed-Or,h:zt.stretch+zt.fixed-vn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lr,pixelOffsetBR:kr,minFontScaleX:me/_/ct,minFontScaleY:et/_/rt,isSDF:r}};if(o&&(g.stretchX||g.stretchY)){const $e=wp(P,$,j),Et=wp(D,ee,G);for(let kt=0;kt<$e.length-1;kt++){const zt=$e[kt],Tt=$e[kt+1];for(let ei=0;ei<Et.length-1;ei++)f.push(ht(zt,Et[ei],Tt,Et[ei+1]))}}else f.push(ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return f}function Mf(a,t,r){let o=0;for(const f of a)o+=Math.max(t,Math.min(r,f[1]))-Math.max(t,Math.min(r,f[0]));return o}function wp(a,t,r){const o=[{fixed:-1,stretch:0}];for(const[f,g]of a){const _=o[o.length-1];o.push({fixed:f-_.stretch,stretch:_.stretch}),o.push({fixed:f-_.stretch,stretch:_.stretch+(g-f)})}return o.push({fixed:t+1,stretch:r}),o}function Eu(a,t,r,o){return a/t*r+o}function Ef(a,t,r,o){return a-t*r/o}xt("Anchor",Ol);class ga{constructor(t,r,o,f,g,_,v,w,M,P){var D;if(this.boxStartIndex=t.length,M){let B=_.top,j=_.bottom;const G=_.collisionPadding;G&&(B-=G[1],j+=G[3]);let $=j-B;$>0&&($=Math.max(10,$),this.circleDiameter=$)}else{const B=!((D=_.image)===null||D===void 0)&&D.content&&(_.image.textFitWidth||_.image.textFitHeight)?zc(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};B.y1=B.y1*v-w[0],B.y2=B.y2*v+w[2],B.x1=B.x1*v-w[3],B.x2=B.x2*v+w[1];const j=_.collisionPadding;if(j&&(B.x1-=j[0]*v,B.y1-=j[1]*v,B.x2+=j[2]*v,B.y2+=j[3]*v),P){const G=new Ie(B.x1,B.y1),$=new Ie(B.x2,B.y1),ee=new Ie(B.x1,B.y2),ae=new Ie(B.x2,B.y2),we=P*Math.PI/180;G._rotate(we),$._rotate(we),ee._rotate(we),ae._rotate(we),B.x1=Math.min(G.x,$.x,ee.x,ae.x),B.x2=Math.max(G.x,$.x,ee.x,ae.x),B.y1=Math.min(G.y,$.y,ee.y,ae.y),B.y2=Math.max(G.y,$.y,ee.y,ae.y)}t.emplaceBack(r.x,r.y,B.x1,B.y1,B.x2,B.y2,o,f,g)}this.boxEndIndex=t.length}}class Od{constructor(t=[],r=(o,f)=>o<f?-1:o>f?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:o}=this,f=r[t];for(;t>0;){const g=t-1>>1,_=r[g];if(o(f,_)>=0)break;r[t]=_,t=g}r[t]=f}_down(t){const{data:r,compare:o}=this,f=this.length>>1,g=r[t];for(;t<f;){let _=1+(t<<1);const v=_+1;if(v<this.length&&o(r[v],r[_])<0&&(_=v),o(r[_],g)>=0)break;r[t]=r[_],t=_}r[t]=g}}function Tp(a,t=1,r=!1){const o=Jo.fromPoints(a[0]),f=Math.min(o.width(),o.height());let g=f/2;const _=new Od([],Sp),{minX:v,minY:w,maxX:M,maxY:P}=o;if(f===0)return new Ie(v,w);for(let j=v;j<M;j+=f)for(let G=w;G<P;G+=f)_.push(new lo(j+g,G+g,g,a));let D=function(j){let G=0,$=0,ee=0;const ae=j[0];for(let we=0,de=ae.length,F=de-1;we<de;F=we++){const J=ae[we],me=ae[F],De=J.x*me.y-me.x*J.y;$+=(J.x+me.x)*De,ee+=(J.y+me.y)*De,G+=3*De}return new lo($/G,ee/G,0,j)}(a),B=_.length;for(;_.length;){const j=_.pop();(j.d>D.d||!D.d)&&(D=j,r&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,B)),j.max-D.d<=t||(g=j.h/2,_.push(new lo(j.p.x-g,j.p.y-g,g,a)),_.push(new lo(j.p.x+g,j.p.y-g,g,a)),_.push(new lo(j.p.x-g,j.p.y+g,g,a)),_.push(new lo(j.p.x+g,j.p.y+g,g,a)),B+=4)}return r&&(console.log(`num probes: ${B}`),console.log(`best distance: ${D.d}`)),D.p}function Sp(a,t){return t.max-a.max}function lo(a,t,r,o){this.p=new Ie(a,t),this.h=r,this.d=function(f,g){let _=!1,v=1/0;for(let w=0;w<g.length;w++){const M=g[w];for(let P=0,D=M.length,B=D-1;P<D;B=P++){const j=M[P],G=M[B];j.y>f.y!=G.y>f.y&&f.x<(G.x-j.x)*(f.y-j.y)/(G.y-j.y)+j.x&&(_=!_),v=Math.min(v,Gf(f,j,G))}}return(_?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var $i;E.aD=void 0,($i=E.aD||(E.aD={}))[$i.center=1]="center",$i[$i.left=2]="left",$i[$i.right=3]="right",$i[$i.top=4]="top",$i[$i.bottom=5]="bottom",$i[$i["top-left"]=6]="top-left",$i[$i["top-right"]=7]="top-right",$i[$i["bottom-left"]=8]="bottom-left",$i[$i["bottom-right"]=9]="bottom-right";const Cf=Number.POSITIVE_INFINITY;function Ph(a,t){return t[1]!==Cf?function(r,o,f){let g=0,_=0;switch(o=Math.abs(o),f=Math.abs(f),r){case"top-right":case"top-left":case"top":_=f-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-f}switch(r){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(a,t[0],t[1]):function(r,o){let f=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(r){case"top-right":case"top-left":g=_-7;break;case"bottom-right":case"bottom-left":g=7-_;break;case"bottom":g=7-o;break;case"top":g=o-7}switch(r){case"top-right":case"bottom-right":f=-_;break;case"top-left":case"bottom-left":f=_;break;case"left":f=o;break;case"right":f=-o}return[f,g]}(a,t[0])}function co(a,t,r){var o;const f=a.layout,g=(o=f.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},r);if(g){const v=g.values,w=[];for(let M=0;M<v.length;M+=2){const P=w[M]=v[M],D=v[M+1].map(B=>B*Rn);P.startsWith("top")?D[1]-=7:P.startsWith("bottom")&&(D[1]+=7),w[M+1]=D}return new hi(w)}const _=f.get("text-variable-anchor");if(_){let v;v=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(t,{},r)*Rn,Cf]:f.get("text-offset").evaluate(t,{},r).map(M=>M*Rn);const w=[];for(const M of _)w.push(M,Ph(M,v));return new hi(w)}return null}function Bd(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Gp(a,t,r,o,f,g,_,v,w,M,P,D){let B=g.textMaxSize.evaluate(t,{});B===void 0&&(B=_);const j=a.layers[0].layout,G=j.get("icon-offset").evaluate(t,{},P),$=Nd(r.horizontal),ee=_/24,ae=a.tilePixelRatio*ee,we=a.tilePixelRatio*B/24,de=a.tilePixelRatio*v,F=a.tilePixelRatio*j.get("symbol-spacing"),J=j.get("text-padding")*a.tilePixelRatio,me=function(kt,zt,Tt,ei=1){const Hi=kt.get("icon-padding").evaluate(zt,{},Tt),_n=Hi&&Hi.values;return[_n[0]*ei,_n[1]*ei,_n[2]*ei,_n[3]*ei]}(j,t,P,a.tilePixelRatio),De=j.get("text-max-angle")/180*Math.PI,et=j.get("text-rotation-alignment")!=="viewport"&&j.get("symbol-placement")!=="point",Fe=j.get("icon-rotation-alignment")==="map"&&j.get("symbol-placement")!=="point",Ze=j.get("symbol-placement"),ct=F/2,rt=j.get("icon-text-fit");let ht;o&&rt!=="none"&&(a.allowVerticalPlacement&&r.vertical&&(ht=mf(o,r.vertical,rt,j.get("icon-text-fit-padding"),G,ee)),$&&(o=mf(o,$,rt,j.get("icon-text-fit-padding"),G,ee)));const $e=P?D.line.getGranularityForZoomLevel(P.z):1,Et=(kt,zt)=>{zt.x<0||zt.x>=ot||zt.y<0||zt.y>=ot||function(Tt,ei,Hi,_n,yn,Fa,Dr,In,dn,Xn,Vn,er,Lr,kr,Dn,Or,vn,Gn,Ln,kn,tn,_a,i,s,u){const p=Tt.addToLineVertexArray(ei,Hi);let x,S,U,W,_e=0,Ne=0,tt=0,lt=0,Ve=-1,Ge=-1;const Zt={};let $t=lr("");if(Tt.allowVerticalPlacement&&_n.vertical){const ea=In.layout.get("text-rotate").evaluate(tn,{},s)+90;U=new ga(dn,ei,Xn,Vn,er,_n.vertical,Lr,kr,Dn,ea),Dr&&(W=new ga(dn,ei,Xn,Vn,er,Dr,vn,Gn,Dn,ea))}if(yn){const ea=In.layout.get("icon-rotate").evaluate(tn,{}),zs=In.layout.get("icon-text-fit")!=="none",Rh=Sf(yn,ea,i,zs),tl=Dr?Sf(Dr,ea,i,zs):void 0;S=new ga(dn,ei,Xn,Vn,er,yn,vn,Gn,!1,ea),_e=4*Rh.length;const Ih=Tt.iconSizeData;let Ul=null;Ih.kind==="source"?(Ul=[rs*In.layout.get("icon-size").evaluate(tn,{})],Ul[0]>so&&Wi(`${Tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Ih.kind==="composite"&&(Ul=[rs*_a.compositeIconSizes[0].evaluate(tn,{},s),rs*_a.compositeIconSizes[1].evaluate(tn,{},s)],(Ul[0]>so||Ul[1]>so)&&Wi(`${Tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Tt.addSymbols(Tt.icon,Rh,Ul,kn,Ln,tn,E.an.none,ei,p.lineStartIndex,p.lineLength,-1,s),Ve=Tt.icon.placedSymbolArray.length-1,tl&&(Ne=4*tl.length,Tt.addSymbols(Tt.icon,tl,Ul,kn,Ln,tn,E.an.vertical,ei,p.lineStartIndex,p.lineLength,-1,s),Ge=Tt.icon.placedSymbolArray.length-1)}const Xi=Object.keys(_n.horizontal);for(const ea of Xi){const zs=_n.horizontal[ea];if(!x){$t=lr(zs.text);const tl=In.layout.get("text-rotate").evaluate(tn,{},s);x=new ga(dn,ei,Xn,Vn,er,zs,Lr,kr,Dn,tl)}const Rh=zs.positionedLines.length===1;if(tt+=Ic(Tt,ei,zs,Fa,In,Dn,tn,Or,p,_n.vertical?E.an.horizontal:E.an.horizontalOnly,Rh?Xi:[ea],Zt,Ve,_a,s),Rh)break}_n.vertical&&(lt+=Ic(Tt,ei,_n.vertical,Fa,In,Dn,tn,Or,p,E.an.vertical,["vertical"],Zt,Ge,_a,s));const Pe=x?x.boxStartIndex:Tt.collisionBoxArray.length,Me=x?x.boxEndIndex:Tt.collisionBoxArray.length,ke=U?U.boxStartIndex:Tt.collisionBoxArray.length,st=U?U.boxEndIndex:Tt.collisionBoxArray.length,Dt=S?S.boxStartIndex:Tt.collisionBoxArray.length,gi=S?S.boxEndIndex:Tt.collisionBoxArray.length,Gt=W?W.boxStartIndex:Tt.collisionBoxArray.length,Wt=W?W.boxEndIndex:Tt.collisionBoxArray.length;let nn=-1;const Ti=(ea,zs)=>ea&&ea.circleDiameter?Math.max(ea.circleDiameter,zs):zs;nn=Ti(x,nn),nn=Ti(U,nn),nn=Ti(S,nn),nn=Ti(W,nn);const el=nn>-1?1:0;el&&(nn*=u/Rn),Tt.glyphOffsetArray.length>=kl.MAX_GLYPHS&&Wi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),tn.sortKey!==void 0&&Tt.addToSortKeyRanges(Tt.symbolInstances.length,tn.sortKey);const qp=co(In,tn,s),[dg,pg]=function(ea,zs){const Rh=ea.length,tl=zs?.values;if(tl?.length>0)for(let Ih=0;Ih<tl.length;Ih+=2){const Ul=tl[Ih+1];ea.emplaceBack(E.aD[tl[Ih]],Ul[0],Ul[1])}return[Rh,ea.length]}(Tt.textAnchorOffsets,qp);Tt.symbolInstances.emplaceBack(ei.x,ei.y,Zt.right>=0?Zt.right:-1,Zt.center>=0?Zt.center:-1,Zt.left>=0?Zt.left:-1,Zt.vertical||-1,Ve,Ge,$t,Pe,Me,ke,st,Dt,gi,Gt,Wt,Xn,tt,lt,_e,Ne,el,0,Lr,nn,dg,pg)}(a,zt,kt,r,o,f,ht,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,ae,[J,J,J,J],et,w,de,me,Fe,G,t,g,M,P,_)};if(Ze==="line")for(const kt of Tf(t.geometry,0,0,ot,ot)){const zt=Rl(kt,$e),Tt=Bl(zt,F,De,r.vertical||$,o,24,we,a.overscaling,ot);for(const ei of Tt)$&&Zp(a,$.text,ct,ei)||Et(zt,ei)}else if(Ze==="line-center"){for(const kt of t.geometry)if(kt.length>1){const zt=Rl(kt,$e),Tt=Vp(zt,De,r.vertical||$,o,24,we);Tt&&Et(zt,Tt)}}else if(t.type==="Polygon")for(const kt of qc(t.geometry,0)){const zt=Tp(kt,16);Et(Rl(kt[0],$e,!0),new Ol(zt.x,zt.y,0))}else if(t.type==="LineString")for(const kt of t.geometry){const zt=Rl(kt,$e);Et(zt,new Ol(zt[0].x,zt[0].y,0))}else if(t.type==="Point")for(const kt of t.geometry)for(const zt of kt)Et([zt],new Ol(zt.x,zt.y,0))}function Ic(a,t,r,o,f,g,_,v,w,M,P,D,B,j,G){const $=function(we,de,F,J,me,De,et,Fe){const Ze=J.layout.get("text-rotate").evaluate(De,{})*Math.PI/180,ct=[];for(const rt of de.positionedLines)for(const ht of rt.positionedGlyphs){if(!ht.rect)continue;const $e=ht.rect||{};let Et=4,kt=!0,zt=1,Tt=0;const ei=(me||Fe)&&ht.vertical,Hi=ht.metrics.advance*ht.scale/2;if(Fe&&de.verticalizable&&(Tt=rt.lineOffset/2-(ht.imageName?-(Rn-ht.metrics.width*ht.scale)/2:(ht.scale-1)*Rn)),ht.imageName){const Gn=et[ht.imageName];kt=Gn.sdf,zt=Gn.pixelRatio,Et=1/zt}const _n=me?[ht.x+Hi,ht.y]:[0,0];let yn=me?[0,0]:[ht.x+Hi+F[0],ht.y+F[1]-Tt],Fa=[0,0];ei&&(Fa=yn,yn=[0,0]);const Dr=ht.metrics.isDoubleResolution?2:1,In=(ht.metrics.left-Et)*ht.scale-Hi+yn[0],dn=(-ht.metrics.top-Et)*ht.scale+yn[1],Xn=In+$e.w/Dr*ht.scale/zt,Vn=dn+$e.h/Dr*ht.scale/zt,er=new Ie(In,dn),Lr=new Ie(Xn,dn),kr=new Ie(In,Vn),Dn=new Ie(Xn,Vn);if(ei){const Gn=new Ie(-Hi,Hi- -17),Ln=-Math.PI/2,kn=12-Hi,tn=new Ie(22-kn,-(ht.imageName?kn:0)),_a=new Ie(...Fa);er._rotateAround(Ln,Gn)._add(tn)._add(_a),Lr._rotateAround(Ln,Gn)._add(tn)._add(_a),kr._rotateAround(Ln,Gn)._add(tn)._add(_a),Dn._rotateAround(Ln,Gn)._add(tn)._add(_a)}if(Ze){const Gn=Math.sin(Ze),Ln=Math.cos(Ze),kn=[Ln,-Gn,Gn,Ln];er._matMult(kn),Lr._matMult(kn),kr._matMult(kn),Dn._matMult(kn)}const Or=new Ie(0,0),vn=new Ie(0,0);ct.push({tl:er,tr:Lr,bl:kr,br:Dn,tex:$e,writingMode:de.writingMode,glyphOffset:_n,sectionIndex:ht.sectionIndex,isSDF:kt,pixelOffsetTL:Or,pixelOffsetBR:vn,minFontScaleX:0,minFontScaleY:0})}return ct}(0,r,v,f,g,_,o,a.allowVerticalPlacement),ee=a.textSizeData;let ae=null;ee.kind==="source"?(ae=[rs*f.layout.get("text-size").evaluate(_,{})],ae[0]>so&&Wi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(ae=[rs*j.compositeTextSizes[0].evaluate(_,{},G),rs*j.compositeTextSizes[1].evaluate(_,{},G)],(ae[0]>so||ae[1]>so)&&Wi(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,$,ae,v,g,_,M,t,w.lineStartIndex,w.lineLength,B,G);for(const we of P)D[we]=a.text.placedSymbolArray.length-1;return 4*$.length}function Nd(a){for(const t in a)return a[t];return null}function Zp(a,t,r,o){const f=a.compareText;if(t in f){const g=f[t];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<r)return!0}else f[t]=[];return f[t].push(o),!1}const Mp=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Fd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,o]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=o>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const g=Mp[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new Fd(v,_,g,t)}constructor(t,r=64,o=Float64Array,f){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Mp.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=r,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return jd(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,o,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,w=[0,g.length-1,0],M=[];for(;w.length;){const P=w.pop()||0,D=w.pop()||0,B=w.pop()||0;if(D-B<=v){for(let ee=B;ee<=D;ee++){const ae=_[2*ee],we=_[2*ee+1];ae>=t&&ae<=o&&we>=r&&we<=f&&M.push(g[ee])}continue}const j=B+D>>1,G=_[2*j],$=_[2*j+1];G>=t&&G<=o&&$>=r&&$<=f&&M.push(g[j]),(P===0?t<=G:r<=$)&&(w.push(B),w.push(j-1),w.push(1-P)),(P===0?o>=G:f>=$)&&(w.push(j+1),w.push(D),w.push(1-P))}return M}within(t,r,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:_}=this,v=[0,f.length-1,0],w=[],M=o*o;for(;v.length;){const P=v.pop()||0,D=v.pop()||0,B=v.pop()||0;if(D-B<=_){for(let ee=B;ee<=D;ee++)Vd(g[2*ee],g[2*ee+1],t,r)<=M&&w.push(f[ee]);continue}const j=B+D>>1,G=g[2*j],$=g[2*j+1];Vd(G,$,t,r)<=M&&w.push(f[j]),(P===0?t-o<=G:r-o<=$)&&(v.push(B),v.push(j-1),v.push(1-P)),(P===0?t+o>=G:r+o>=$)&&(v.push(j+1),v.push(D),v.push(1-P))}return w}}function jd(a,t,r,o,f,g){if(f-o<=r)return;const _=o+f>>1;Ep(a,t,_,o,f,g),jd(a,t,r,o,_-1,1-g),jd(a,t,r,_+1,f,1-g)}function Ep(a,t,r,o,f,g){for(;f>o;){if(f-o>600){const M=f-o+1,P=r-o+1,D=Math.log(M),B=.5*Math.exp(2*D/3),j=.5*Math.sqrt(D*B*(M-B)/M)*(P-M/2<0?-1:1);Ep(a,t,r,Math.max(o,Math.floor(r-P*B/M+j)),Math.min(f,Math.floor(r+(M-P)*B/M+j)),g)}const _=t[2*r+g];let v=o,w=f;for(zh(a,t,o,r),t[2*f+g]>_&&zh(a,t,o,f);v<w;){for(zh(a,t,v,w),v++,w--;t[2*v+g]<_;)v++;for(;t[2*w+g]>_;)w--}t[2*o+g]===_?zh(a,t,o,w):(w++,zh(a,t,w,f)),w<=r&&(o=w+1),r<=w&&(f=w-1)}}function zh(a,t,r,o){Ud(a,r,o),Ud(t,2*r,2*o),Ud(t,2*r+1,2*o+1)}function Ud(a,t,r){const o=a[t];a[t]=a[r],a[r]=o}function Vd(a,t,r,o){const f=a-r,g=t-o;return f*f+g*g}var Nl;E.cw=void 0,(Nl=E.cw||(E.cw={})).create="create",Nl.load="load",Nl.fullLoad="fullLoad";let Fl=null,Cu=[];const Gd=1e3/60,jl="loadTime",Dc="fullLoadTime",Cp={mark(a){performance.mark(a)},frame(a){const t=a;Fl!=null&&Cu.push(t-Fl),Fl=t},clearMetrics(){Fl=null,Cu=[],performance.clearMeasures(jl),performance.clearMeasures(Dc);for(const a in E.cw)performance.clearMarks(E.cw[a])},getPerformanceMetrics(){performance.measure(jl,E.cw.create,E.cw.load),performance.measure(Dc,E.cw.create,E.cw.fullLoad);const a=performance.getEntriesByName(jl)[0].duration,t=performance.getEntriesByName(Dc)[0].duration,r=Cu.length,o=1/(Cu.reduce((g,_)=>g+_,0)/r/1e3),f=Cu.filter(g=>g>Gd).reduce((g,_)=>g+(_-Gd)/Gd,0);return{loadTime:a,fullLoadTime:t,fps:o,percentDroppedFrames:f/(r+f)*100,totalFrames:r}}};E.$=ot,E.A=Ye,E.B=function([a,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:a*Math.cos(t)*Math.sin(r),y:a*Math.sin(t)*Math.sin(r),z:a*Math.cos(r)}},E.C=Gr,E.D=wt,E.E=Ke,E.F=Ui,E.G=gc,E.H=function(a){if(Rs==null){const t=a.navigator?a.navigator.userAgent:null;Rs=!!a.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Rs},E.I=md,E.J=class{constructor(a,t){this.target=a,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new vf(()=>this.process()),this.subscription=Fr(this.target,"message",r=>this.receive(r),!1),this.globalScope=yr(self)?a:window}registerMessageHandler(a,t){this.messageHandlers[a]=t}sendAsync(a,t){return new Promise((r,o)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),g=t?Fr(t.signal,"abort",()=>{g?.unsubscribe(),delete this.resolveRejects[f];const w={id:f,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},Ed):null;this.resolveRejects[f]={resolve:w=>{g?.unsubscribe(),r(w)},reject:w=>{g?.unsubscribe(),o(w)}};const _=[],v=Object.assign(Object.assign({},a),{id:f,sourceMapId:this.mapId,origin:location.origin,data:Sl(a.data,_)});this.target.postMessage(v,{transfer:_})})}receive(a){const t=a.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const o=this.abortControllers[r];return delete this.abortControllers[r],void(o&&o.abort())}if(yr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),t=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(a,t)}processTask(a,t){return c(this,void 0,void 0,function*(){if(t.type==="<response>"){const f=this.resolveRejects[a];return delete this.resolveRejects[a],f?void(t.error?f.reject(Wr(t.error)):f.resolve(Wr(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Wr(t.data),o=new AbortController;this.abortControllers[a]=o;try{const f=yield this.messageHandlers[t.type](t.sourceMapId,r,o);this.completeTask(a,null,f)}catch(f){this.completeTask(a,f)}})}completeTask(a,t,r){const o=[];delete this.abortControllers[a];const f={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Sl(t):null,data:Sl(r,o)};this.target.postMessage(f,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},E.K=te,E.L=function(){var a=new Ye(16);return Ye!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},E.M=function(a,t,r){var o,f,g,_,v,w,M,P,D,B,j,G,$=r[0],ee=r[1],ae=r[2];return t===a?(a[12]=t[0]*$+t[4]*ee+t[8]*ae+t[12],a[13]=t[1]*$+t[5]*ee+t[9]*ae+t[13],a[14]=t[2]*$+t[6]*ee+t[10]*ae+t[14],a[15]=t[3]*$+t[7]*ee+t[11]*ae+t[15]):(f=t[1],g=t[2],_=t[3],v=t[4],w=t[5],M=t[6],P=t[7],D=t[8],B=t[9],j=t[10],G=t[11],a[0]=o=t[0],a[1]=f,a[2]=g,a[3]=_,a[4]=v,a[5]=w,a[6]=M,a[7]=P,a[8]=D,a[9]=B,a[10]=j,a[11]=G,a[12]=o*$+v*ee+D*ae+t[12],a[13]=f*$+w*ee+B*ae+t[13],a[14]=g*$+M*ee+j*ae+t[14],a[15]=_*$+P*ee+G*ae+t[15]),a},E.N=function(a,t,r){var o=r[0],f=r[1],g=r[2];return a[0]=t[0]*o,a[1]=t[1]*o,a[2]=t[2]*o,a[3]=t[3]*o,a[4]=t[4]*f,a[5]=t[5]*f,a[6]=t[6]*f,a[7]=t[7]*f,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},E.O=function(a,t,r){var o=t[0],f=t[1],g=t[2],_=t[3],v=t[4],w=t[5],M=t[6],P=t[7],D=t[8],B=t[9],j=t[10],G=t[11],$=t[12],ee=t[13],ae=t[14],we=t[15],de=r[0],F=r[1],J=r[2],me=r[3];return a[0]=de*o+F*v+J*D+me*$,a[1]=de*f+F*w+J*B+me*ee,a[2]=de*g+F*M+J*j+me*ae,a[3]=de*_+F*P+J*G+me*we,a[4]=(de=r[4])*o+(F=r[5])*v+(J=r[6])*D+(me=r[7])*$,a[5]=de*f+F*w+J*B+me*ee,a[6]=de*g+F*M+J*j+me*ae,a[7]=de*_+F*P+J*G+me*we,a[8]=(de=r[8])*o+(F=r[9])*v+(J=r[10])*D+(me=r[11])*$,a[9]=de*f+F*w+J*B+me*ee,a[10]=de*g+F*M+J*j+me*ae,a[11]=de*_+F*P+J*G+me*we,a[12]=(de=r[12])*o+(F=r[13])*v+(J=r[14])*D+(me=r[15])*$,a[13]=de*f+F*w+J*B+me*ee,a[14]=de*g+F*M+J*j+me*ae,a[15]=de*_+F*P+J*G+me*we,a},E.P=Ie,E.Q=function(a,t){const r={};for(let o=0;o<t.length;o++){const f=t[o];f in a&&(r[f]=a[f])}return r},E.R=Er,E.S=oo,E.T=rf,E.U=Cd,E.V=Rc,E.W=Xe,E.X=Je,E.Y=Is,E.Z=qi,E._=c,E.a=H,E.a$=function(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a[2]=t[2]*r,a[3]=t[3]*r,a},E.a0=Su,E.a1=Jo,E.a2=25,E.a3=ji,E.a4=a=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(r=>{t.onloadstart=()=>{r(t)};for(const o of a){const f=window.document.createElement("source");Le(o)||(t.crossOrigin="Anonymous"),f.src=o,t.appendChild(f)}})},E.a5=ft,E.a6=function(){return ho++},E.a7=ne,E.a8=kl,E.a9=bn,E.aA=Rn,E.aB=dt,E.aC=function(a,t,r,o,f=!1){if(!r[0]&&!r[1])return[0,0];const g=f?o==="map"?-a.bearingInRadians:0:o==="viewport"?a.bearingInRadians:0;if(g){const _=Math.sin(g),v=Math.cos(g);r=[r[0]*v-r[1]*_,r[0]*_+r[1]*v]}return[f?r[0]:dt(t,r[0],a.zoom),f?r[1]:dt(t,r[1],a.zoom)]},E.aE=as,E.aF=Bd,E.aG=Zi,E.aH=Fd,E.aI=on,E.aJ=dh,E.aK=ze,E.aL=pi,E.aM=zi,E.aN=uo,E.aO=tr,E.aP=Pd,E.aQ=Ci,E.aR=ni,E.aS=function(a){var t=new Ye(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t},E.aT=function(a,t,r){return a[0]=t[0]-r[0],a[1]=t[1]-r[1],a[2]=t[2]-r[2],a},E.aU=function(a,t){var r=t[0],o=t[1],f=t[2],g=r*r+o*o+f*f;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a},E.aV=Tn,E.aW=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]},E.aX=function(a,t,r){return a[0]=t[0]*r[0],a[1]=t[1]*r[1],a[2]=t[2]*r[2],a[3]=t[3]*r[3],a},E.aY=Lt,E.aZ=function(a,t,r){const o=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return o===0?null:(-(a[0]*r[0]+a[1]*r[1]+a[2]*r[2])-r[3])/o},E.a_=We,E.aa=Pl,E.ab=Ah,E.ac=function(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,o,f,g)=>{const _=f||g;return t[o]=!_||_.toLowerCase(),""}),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},E.ad=an,E.ae=function(a){return Math.pow(2,a)},E.af=Nt,E.ag=Ki,E.ah=85.051129,E.ai=vp,E.aj=function(a){return Math.log(a)/Math.LN2},E.ak=function(a){var t=a[0],r=a[1];return t*t+r*r},E.al=function(a,t){const r=[];for(const o in a)o in t||r.push(o);return r},E.am=function(a,t){let r=0,o=0;if(a.kind==="constant")o=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:f,minZoom:g,maxZoom:_}=a,v=f?Ki(ar.interpolationFactor(f,t,g,_),0,1):0;a.kind==="camera"?o=Gr.number(a.minSize,a.maxSize,v):r=v}return{uSizeT:r,uSize:o}},E.ao=function(a,{uSize:t,uSizeT:r},{lowerSize:o,upperSize:f}){return a.kind==="source"?o/rs:a.kind==="composite"?Gr.number(o/rs,f/rs,r):t},E.ap=function(a,t){var r=t[0],o=t[1],f=t[2],g=t[3],_=t[4],v=t[5],w=t[6],M=t[7],P=t[8],D=t[9],B=t[10],j=t[11],G=t[12],$=t[13],ee=t[14],ae=t[15],we=r*v-o*_,de=r*w-f*_,F=r*M-g*_,J=o*w-f*v,me=o*M-g*v,De=f*M-g*w,et=P*$-D*G,Fe=P*ee-B*G,Ze=P*ae-j*G,ct=D*ee-B*$,rt=D*ae-j*$,ht=B*ae-j*ee,$e=we*ht-de*rt+F*ct+J*Ze-me*Fe+De*et;return $e?(a[0]=(v*ht-w*rt+M*ct)*($e=1/$e),a[1]=(f*rt-o*ht-g*ct)*$e,a[2]=($*De-ee*me+ae*J)*$e,a[3]=(B*me-D*De-j*J)*$e,a[4]=(w*Ze-_*ht-M*Fe)*$e,a[5]=(r*ht-f*Ze+g*Fe)*$e,a[6]=(ee*F-G*De-ae*de)*$e,a[7]=(P*De-B*F+j*de)*$e,a[8]=(_*rt-v*Ze+M*et)*$e,a[9]=(o*Ze-r*rt-g*et)*$e,a[10]=(G*me-$*F+ae*we)*$e,a[11]=(D*F-P*me-j*we)*$e,a[12]=(v*Fe-_*ct-w*et)*$e,a[13]=(r*ct-o*Fe+f*et)*$e,a[14]=($*de-G*J-ee*we)*$e,a[15]=(P*J-D*de+B*we)*$e,a):null},E.aq=ye,E.ar=function(a){return Math.hypot(a[0],a[1])},E.as=function(a){return a[0]=0,a[1]=0,a},E.at=function(a,t,r){return a[0]=t[0]*r,a[1]=t[1]*r,a},E.au=gf,E.av=je,E.aw=function(a,t,r,o){const f=t.y-a.y,g=t.x-a.x,_=o.y-r.y,v=o.x-r.x,w=_*g-v*f;if(w===0)return null;const M=(v*(a.y-r.y)-_*(a.x-r.x))/w;return new Ie(a.x+M*g,a.y+M*f)},E.ax=Tf,E.ay=jf,E.az=function(a){let t=1/0,r=1/0,o=-1/0,f=-1/0;for(const g of a)t=Math.min(t,g.x),r=Math.min(r,g.y),o=Math.max(o,g.x),f=Math.max(f,g.y);return[t,r,o,f]},E.b=ba,E.b$=lp,E.b0=function(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]},E.b1=bf,E.b2=Mu,E.b3=function(a,t,r,o,f){var g,_=1/Math.tan(t/2);return a[0]=_/r,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=_,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,f!=null&&f!==1/0?(a[10]=(f+o)*(g=1/(o-f)),a[14]=2*f*o*g):(a[10]=-1,a[14]=-2*o),a},E.b4=function(a){var t=new Ye(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},E.b5=function(a,t,r){var o=Math.sin(r),f=Math.cos(r),g=t[0],_=t[1],v=t[2],w=t[3],M=t[4],P=t[5],D=t[6],B=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*f+M*o,a[1]=_*f+P*o,a[2]=v*f+D*o,a[3]=w*f+B*o,a[4]=M*f-g*o,a[5]=P*f-_*o,a[6]=D*f-v*o,a[7]=B*f-w*o,a},E.b6=function(a,t,r){var o=Math.sin(r),f=Math.cos(r),g=t[4],_=t[5],v=t[6],w=t[7],M=t[8],P=t[9],D=t[10],B=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*f+M*o,a[5]=_*f+P*o,a[6]=v*f+D*o,a[7]=w*f+B*o,a[8]=M*f-g*o,a[9]=P*f-_*o,a[10]=D*f-v*o,a[11]=B*f-w*o,a},E.b7=function(){const a=new Float32Array(16);return Nt(a),a},E.b8=function(){const a=new Float64Array(16);return Nt(a),a},E.b9=function(){return new Float64Array(16)},E.bA=function(a){return a[0]=0,a[1]=0,a[2]=0,a},E.bB=function(a,t,r,o){const f=Math.sqrt(a*a+t*t),g=Math.sqrt(r*r+o*o);a/=f,t/=f,r/=g,o/=g;const _=Math.acos(a*r+t*o);return-t*r+a*o>0?_:-_},E.bC=function(a,t){const r=At(a,2*Math.PI),o=At(t,2*Math.PI);return Math.min(Math.abs(r-o),Math.abs(r-o+2*Math.PI),Math.abs(r-o-2*Math.PI))},E.bD=function(){const a={},t=xe.$version;for(const r in xe.$root){const o=xe.$root[r];if(o.required){let f=null;f=r==="version"?t:o.type==="array"?[]:{},f!=null&&(a[r]=f)}}return a},E.bE=yc,E.bF=be,E.bG=function a(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let o=0;o<t.length;o++)if(!a(t[o],r[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const o in t)if(!a(t[o],r[o]))return!1;return!0}return t===r},E.bH=function(a){a=a.slice();const t=Object.create(null);for(let r=0;r<a.length;r++)t[a[r].id]=a[r];for(let r=0;r<a.length;r++)"ref"in a[r]&&(a[r]=jt(a[r],t[a[r].ref]));return a},E.bI=function(a){if(a.type==="custom")return new Md(a);switch(a.type){case"background":return new Mh(a);case"circle":return new Qh(a);case"color-relief":return new af(a);case"fill":return new ro(a);case"fill-extrusion":return new Dl(a);case"heatmap":return new Qd(a);case"hillshade":return new Zo(a);case"line":return new ld(a);case"raster":return new xi(a);case"symbol":return new wu(a)}},E.bJ=ia,E.bK=function(a,t){if(!a)return[{command:"setStyle",args:[t]}];let r=[];try{if(!bt(a.version,t.version))return[{command:"setStyle",args:[t]}];bt(a.center,t.center)||r.push({command:"setCenter",args:[t.center]}),bt(a.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),bt(a.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),bt(a.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),bt(a.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),bt(a.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),bt(a.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),bt(a.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),bt(a.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),bt(a.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),bt(a.light,t.light)||r.push({command:"setLight",args:[t.light]}),bt(a.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),bt(a.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),bt(a.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const o={},f=[];(function(_,v,w,M){let P;for(P in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,P)&&(Object.prototype.hasOwnProperty.call(v,P)||ai(P,w,M));for(P in v)Object.prototype.hasOwnProperty.call(v,P)&&(Object.prototype.hasOwnProperty.call(_,P)?bt(_[P],v[P])||(_[P].type==="geojson"&&v[P].type==="geojson"&&fi(_,v,P)?Rt(w,{command:"setGeoJSONSourceData",args:[P,v[P].data]}):ri(P,v,w,M)):Bt(P,v,w))})(a.sources,t.sources,f,o);const g=[];a.layers&&a.layers.forEach(_=>{"source"in _&&o[_.source]?r.push({command:"removeLayer",args:[_.id]}):g.push(_)}),r=r.concat(f),function(_,v,w){v=v||[];const M=(_=_||[]).map(di),P=v.map(di),D=_.reduce(Yn,{}),B=v.reduce(Yn,{}),j=M.slice(),G=Object.create(null);let $,ee,ae,we,de;for(let F=0,J=0;F<M.length;F++)$=M[F],Object.prototype.hasOwnProperty.call(B,$)?J++:(Rt(w,{command:"removeLayer",args:[$]}),j.splice(j.indexOf($,J),1));for(let F=0,J=0;F<P.length;F++)$=P[P.length-1-F],j[j.length-1-F]!==$&&(Object.prototype.hasOwnProperty.call(D,$)?(Rt(w,{command:"removeLayer",args:[$]}),j.splice(j.lastIndexOf($,j.length-J),1)):J++,we=j[j.length-F],Rt(w,{command:"addLayer",args:[B[$],we]}),j.splice(j.length-F,0,$),G[$]=!0);for(let F=0;F<P.length;F++)if($=P[F],ee=D[$],ae=B[$],!G[$]&&!bt(ee,ae))if(bt(ee.source,ae.source)&&bt(ee["source-layer"],ae["source-layer"])&&bt(ee.type,ae.type)){for(de in Ut(ee.layout,ae.layout,w,$,null,"setLayoutProperty"),Ut(ee.paint,ae.paint,w,$,null,"setPaintProperty"),bt(ee.filter,ae.filter)||Rt(w,{command:"setFilter",args:[$,ae.filter]}),bt(ee.minzoom,ae.minzoom)&&bt(ee.maxzoom,ae.maxzoom)||Rt(w,{command:"setLayerZoomRange",args:[$,ae.minzoom,ae.maxzoom]}),ee)Object.prototype.hasOwnProperty.call(ee,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Ut(ee[de],ae[de],w,$,de.slice(6),"setPaintProperty"):bt(ee[de],ae[de])||Rt(w,{command:"setLayerProperty",args:[$,de,ae[de]]}));for(de in ae)Object.prototype.hasOwnProperty.call(ae,de)&&!Object.prototype.hasOwnProperty.call(ee,de)&&de!=="layout"&&de!=="paint"&&de!=="filter"&&de!=="metadata"&&de!=="minzoom"&&de!=="maxzoom"&&(de.indexOf("paint.")===0?Ut(ee[de],ae[de],w,$,de.slice(6),"setPaintProperty"):bt(ee[de],ae[de])||Rt(w,{command:"setLayerProperty",args:[$,de,ae[de]]}))}else Rt(w,{command:"removeLayer",args:[$]}),we=j[j.lastIndexOf($)+1],Rt(w,{command:"addLayer",args:[ae,we]})}(g,t.layers,r)}catch(o){console.warn("Unable to compute style diff:",o),r=[{command:"setStyle",args:[t]}]}return r},E.bL=function(a){const t=[],r=a.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},E.bM=rn,E.bN=ta,E.bO=class extends Ii{constructor(a,t){super(a,t),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},E.bP=bc,E.bQ=class extends Ii{constructor(a,t){super(a,t),this.current=Hh}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let t=1;t<16;t++)if(a[t]!==this.current[t]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},E.bR=mn,E.bS=class extends Ii{constructor(a,t){super(a,t),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},E.bT=class extends Ii{constructor(a,t){super(a,t),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},E.bU=vt,E.bV=function(a,t){var r=Math.sin(t),o=Math.cos(t);return a[0]=o,a[1]=r,a[2]=0,a[3]=-r,a[4]=o,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},E.bW=function(a,t,r){var o=t[0],f=t[1],g=t[2];return a[0]=o*r[0]+f*r[3]+g*r[6],a[1]=o*r[1]+f*r[4]+g*r[7],a[2]=o*r[2]+f*r[5]+g*r[8],a},E.bX=function(a,t,r,o,f,g,_){var v=1/(t-r),w=1/(o-f),M=1/(g-_);return a[0]=-2*v,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*w,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*M,a[11]=0,a[12]=(t+r)*v,a[13]=(f+o)*w,a[14]=(_+g)*M,a[15]=1,a},E.bY=class extends Ii{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(4*a.length);for(let r=0;r<a.length;r++)t[4*r]=a[r].r,t[4*r+1]=a[r].g,t[4*r+2]=a[r].b,t[4*r+3]=a[r].a;this.gl.uniform4fv(this.location,t)}}},E.bZ=class extends Ii{constructor(a,t){super(a,t),this.current=new Array}set(a){if(a!=this.current){this.current=a;const t=new Float32Array(a);this.gl.uniform1fv(this.location,t)}}},E.b_=class extends l{},E.ba=function(a,t,r){const o=new Float64Array(4);return qt(o,a,t-90,r),o},E.bb=function(a,t,r,o){var f,g,_,v,w,M=t[0],P=t[1],D=t[2],B=t[3],j=r[0],G=r[1],$=r[2],ee=r[3];return(g=M*j+P*G+D*$+B*ee)<0&&(g=-g,j=-j,G=-G,$=-$,ee=-ee),1-g>nt?(f=Math.acos(g),_=Math.sin(f),v=Math.sin((1-o)*f)/_,w=Math.sin(o*f)/_):(v=1-o,w=o),a[0]=v*M+w*j,a[1]=v*P+w*G,a[2]=v*D+w*$,a[3]=v*B+w*ee,a},E.bc=function(a){const t=new Float64Array(9);var r,o,f,g,_,v,w,M,P,D,B,j,G,$,ee,ae,we,de;D=(f=(o=a)[0])*(w=f+f),B=(g=o[1])*w,G=(_=o[2])*w,$=_*(M=g+g),ae=(v=o[3])*w,we=v*M,de=v*(P=_+_),(r=t)[0]=1-(j=g*M)-(ee=_*P),r[3]=B-de,r[6]=G+we,r[1]=B+de,r[4]=1-D-ee,r[7]=$-ae,r[2]=G-we,r[5]=$+ae,r[8]=1-D-j;const F=tr(-Math.asin(Ki(t[2],-1,1)));let J,me;return Math.hypot(t[5],t[8])<.001?(J=0,me=-tr(Math.atan2(t[3],t[4]))):(J=tr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),me=tr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:J,pitch:F+90,bearing:me}},E.bd=function(a,t){return a.roll==t.roll&&a.pitch==t.pitch&&a.bearing==t.bearing},E.be=ti,E.bf=Jn,E.bg=du,E.bh=Mc,E.bi=Sc,E.bj=Ht,E.bk=Ft,E.bl=Kt,E.bm=function(a,t,r,o,f){return Ht(o,f,Ki((a-t)/(r-t),0,1))},E.bn=At,E.bo=function(){return new Float64Array(3)},E.bp=function(a,t,r,o){return a[0]=t[0]+r[0]*o,a[1]=t[1]+r[1]*o,a[2]=t[2]+r[2]*o,a},E.bq=qt,E.br=function(a,t,r){var o=r[0],f=r[1],g=r[2],_=t[0],v=t[1],w=t[2],M=f*w-g*v,P=g*_-o*w,D=o*v-f*_,B=f*D-g*P,j=g*M-o*D,G=o*P-f*M,$=2*r[3];return P*=$,D*=$,j*=2,G*=2,a[0]=_+(M*=$)+(B*=2),a[1]=v+P+j,a[2]=w+D+G,a},E.bs=function(a,t,r){const o=(f=[a[0],a[1],a[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((P=f[8])*(_=f[4])-(v=f[5])*(M=f[7]))+f[1]*(-P*(g=f[3])+v*(w=f[6]))+f[2]*(M*g-_*w);var f,g,_,v,w,M,P;if(o===0)return null;const D=Tn([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),B=Tn([],[r[0],r[1],r[2]],[a[0],a[1],a[2]]),j=Tn([],[a[0],a[1],a[2]],[t[0],t[1],t[2]]),G=Ci([],D,-a[3]);return ni(G,G,Ci([],B,-t[3])),ni(G,G,Ci([],j,-r[3])),Ci(G,G,1/o),G},E.bt=xf,E.bu=function(){return new Float64Array(4)},E.bv=function(a,t,r,o){var f=[],g=[];return f[0]=t[0]-r[0],f[1]=t[1]-r[1],f[2]=t[2]-r[2],g[0]=f[0]*Math.cos(o)-f[1]*Math.sin(o),g[1]=f[0]*Math.sin(o)+f[1]*Math.cos(o),g[2]=f[2],a[0]=g[0]+r[0],a[1]=g[1]+r[1],a[2]=g[2]+r[2],a},E.bw=function(a,t,r,o){var f=[],g=[];return f[0]=t[0]-r[0],f[1]=t[1]-r[1],f[2]=t[2]-r[2],g[0]=f[0],g[1]=f[1]*Math.cos(o)-f[2]*Math.sin(o),g[2]=f[1]*Math.sin(o)+f[2]*Math.cos(o),a[0]=g[0]+r[0],a[1]=g[1]+r[1],a[2]=g[2]+r[2],a},E.bx=function(a,t,r,o){var f=[],g=[];return f[0]=t[0]-r[0],f[1]=t[1]-r[1],f[2]=t[2]-r[2],g[0]=f[2]*Math.sin(o)+f[0]*Math.cos(o),g[1]=f[1],g[2]=f[2]*Math.cos(o)-f[0]*Math.sin(o),a[0]=g[0]+r[0],a[1]=g[1]+r[1],a[2]=g[2]+r[2],a},E.by=function(a,t,r){var o=Math.sin(r),f=Math.cos(r),g=t[0],_=t[1],v=t[2],w=t[3],M=t[8],P=t[9],D=t[10],B=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*f-M*o,a[1]=_*f-P*o,a[2]=v*f-D*o,a[3]=w*f-B*o,a[8]=g*o+M*f,a[9]=_*o+P*f,a[10]=v*o+D*f,a[11]=w*o+B*f,a},E.bz=function(a,t){const r=At(a,360),o=At(t,360),f=o-r,g=o>r?f-360:f+360;return Math.abs(f)<Math.abs(g)?f:g},E.c=Ce,E.c0=class extends m{},E.c1=lh,E.c2=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},E.c3=oh,E.c4=function(a,t,r){var o=t[0],f=t[1],g=t[2],_=r[3]*o+r[7]*f+r[11]*g+r[15];return a[0]=(r[0]*o+r[4]*f+r[8]*g+r[12])/(_=_||1),a[1]=(r[1]*o+r[5]*f+r[9]*g+r[13])/_,a[2]=(r[2]*o+r[6]*f+r[10]*g+r[14])/_,a},E.c5=class extends No{},E.c6=class extends L{},E.c7=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]&&a[4]===t[4]&&a[5]===t[5]&&a[6]===t[6]&&a[7]===t[7]&&a[8]===t[8]&&a[9]===t[9]&&a[10]===t[10]&&a[11]===t[11]&&a[12]===t[12]&&a[13]===t[13]&&a[14]===t[14]&&a[15]===t[15]},E.c8=function(a,t){var r=a[0],o=a[1],f=a[2],g=a[3],_=a[4],v=a[5],w=a[6],M=a[7],P=a[8],D=a[9],B=a[10],j=a[11],G=a[12],$=a[13],ee=a[14],ae=a[15],we=t[0],de=t[1],F=t[2],J=t[3],me=t[4],De=t[5],et=t[6],Fe=t[7],Ze=t[8],ct=t[9],rt=t[10],ht=t[11],$e=t[12],Et=t[13],kt=t[14],zt=t[15];return Math.abs(r-we)<=nt*Math.max(1,Math.abs(r),Math.abs(we))&&Math.abs(o-de)<=nt*Math.max(1,Math.abs(o),Math.abs(de))&&Math.abs(f-F)<=nt*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(g-J)<=nt*Math.max(1,Math.abs(g),Math.abs(J))&&Math.abs(_-me)<=nt*Math.max(1,Math.abs(_),Math.abs(me))&&Math.abs(v-De)<=nt*Math.max(1,Math.abs(v),Math.abs(De))&&Math.abs(w-et)<=nt*Math.max(1,Math.abs(w),Math.abs(et))&&Math.abs(M-Fe)<=nt*Math.max(1,Math.abs(M),Math.abs(Fe))&&Math.abs(P-Ze)<=nt*Math.max(1,Math.abs(P),Math.abs(Ze))&&Math.abs(D-ct)<=nt*Math.max(1,Math.abs(D),Math.abs(ct))&&Math.abs(B-rt)<=nt*Math.max(1,Math.abs(B),Math.abs(rt))&&Math.abs(j-ht)<=nt*Math.max(1,Math.abs(j),Math.abs(ht))&&Math.abs(G-$e)<=nt*Math.max(1,Math.abs(G),Math.abs($e))&&Math.abs($-Et)<=nt*Math.max(1,Math.abs($),Math.abs(Et))&&Math.abs(ee-kt)<=nt*Math.max(1,Math.abs(ee),Math.abs(kt))&&Math.abs(ae-zt)<=nt*Math.max(1,Math.abs(ae),Math.abs(zt))},E.c9=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},E.cA=function(a){delete H.REGISTERED_PROTOCOLS[a]},E.cB=function(a,t){const r={};for(let f=0;f<a.length;f++){const g=t&&t[a[f].id]||Zs(a[f]);t&&(t[a[f].id]=g);let _=r[g];_||(_=r[g]=[]),_.push(a[f])}const o=[];for(const f in r)o.push(r[f]);return o},E.cC=xt,E.cD=wf,E.cE=zd,E.cF=gd,E.cG=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=ot/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const t=a.bucket.layers[0],r=t.layout,o=t._unevaluatedLayout._values,f={layoutIconSize:o["icon-size"].possiblyEvaluate(new Ui(a.bucket.zoom+1),a.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new Ui(a.bucket.zoom+1),a.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new Ui(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:M,maxZoom:P}=a.bucket.textSizeData;f.compositeTextSizes=[o["text-size"].possiblyEvaluate(new Ui(M),a.canonical),o["text-size"].possiblyEvaluate(new Ui(P),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:M,maxZoom:P}=a.bucket.iconSizeData;f.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new Ui(M),a.canonical),o["icon-size"].possiblyEvaluate(new Ui(P),a.canonical)]}const g=r.get("text-line-height")*Rn,_=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),w=r.get("text-size");for(const M of a.bucket.features){const P=r.get("text-font").evaluate(M,{},a.canonical).join(","),D=w.evaluate(M,{},a.canonical),B=f.layoutTextSize.evaluate(M,{},a.canonical),j=f.layoutIconSize.evaluate(M,{},a.canonical),G={horizontal:{},vertical:void 0},$=M.text;let ee,ae=[0,0];if($){const F=$.toString(),J=r.get("text-letter-spacing").evaluate(M,{},a.canonical)*Rn,me=bs(F)?J:0,De=r.get("text-anchor").evaluate(M,{},a.canonical),et=co(t,M,a.canonical);if(!et){const rt=r.get("text-radial-offset").evaluate(M,{},a.canonical);ae=rt?Ph(De,[rt*Rn,Cf]):r.get("text-offset").evaluate(M,{},a.canonical).map(ht=>ht*Rn)}let Fe=_?"center":r.get("text-justify").evaluate(M,{},a.canonical);const Ze=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(M,{},a.canonical)*Rn:1/0,ct=()=>{a.bucket.allowVerticalPlacement&&Ya(F)&&(G.vertical=Pc($,a.glyphMap,a.glyphPositions,a.imagePositions,P,Ze,g,De,"left",me,ae,E.an.vertical,!0,B,D))};if(!_&&et){const rt=new Set;if(Fe==="auto")for(let $e=0;$e<et.values.length;$e+=2)rt.add(Bd(et.values[$e]));else rt.add(Fe);let ht=!1;for(const $e of rt)if(!G.horizontal[$e])if(ht)G.horizontal[$e]=G.horizontal[0];else{const Et=Pc($,a.glyphMap,a.glyphPositions,a.imagePositions,P,Ze,g,"center",$e,me,ae,E.an.horizontal,!1,B,D);Et&&(G.horizontal[$e]=Et,ht=Et.positionedLines.length===1)}ct()}else{Fe==="auto"&&(Fe=Bd(De));const rt=Pc($,a.glyphMap,a.glyphPositions,a.imagePositions,P,Ze,g,De,Fe,me,ae,E.an.horizontal,!1,B,D);rt&&(G.horizontal[Fe]=rt),ct(),Ya(F)&&_&&v&&(G.vertical=Pc($,a.glyphMap,a.glyphPositions,a.imagePositions,P,Ze,g,De,Fe,me,ae,E.an.vertical,!1,B,D))}}let we=!1;if(M.icon&&M.icon.name){const F=a.imageMap[M.icon.name];F&&(ee=pf(a.imagePositions[M.icon.name],r.get("icon-offset").evaluate(M,{},a.canonical),r.get("icon-anchor").evaluate(M,{},a.canonical)),we=!!F.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=we:a.bucket.sdfIcons!==we&&Wi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(F.pixelRatio!==a.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const de=Nd(G.horizontal)||G.vertical;a.bucket.iconsInText=!!de&&de.iconsInText,(de||ee)&&Gp(a.bucket,M,G,ee,a.imageMap,f,B,j,ae,we,a.canonical,a.subdivisionGranularity)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},E.cH=_u,E.cI=$o,E.cJ=Jr,E.cK=Fi,E.cL=ff,E.cM=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},E.cN=function(a,t,r,o,f){return c(this,void 0,void 0,function*(){if(Je())try{return yield Is(a,t,r,o,f)}catch{}return function(g,_,v,w,M){const P=g.width,D=g.height;ss&&fo||(ss=new OffscreenCanvas(P,D),fo=ss.getContext("2d",{willReadFrequently:!0})),ss.width=P,ss.height=D,fo.drawImage(g,0,0,P,D);const B=fo.getImageData(_,v,w,M);return fo.clearRect(0,0,P,D),B.data}(a,t,r,o,f)})},E.cO=io,E.cP=pe,E.cQ=ce,E.cR=Ni,E.cS=fd,E.cT=wr,E.cU=Wa,E.ca=a=>a.type==="symbol",E.cb=a=>a.type==="circle",E.cc=a=>a.type==="heatmap",E.cd=a=>a.type==="line",E.ce=a=>a.type==="fill",E.cf=a=>a.type==="fill-extrusion",E.cg=a=>a.type==="hillshade",E.ch=a=>a.type==="color-relief",E.ci=a=>a.type==="raster",E.cj=a=>a.type==="background",E.ck=a=>a.type==="custom",E.cl=Yi,E.cm=function(a,t,r){const o=He(t.x-r.x,t.y-r.y),f=He(a.x-r.x,a.y-r.y);var g,_;return tr(Math.atan2(o[0]*f[1]-o[1]*f[0],(g=o)[0]*(_=f)[0]+g[1]*_[1]))},E.cn=Mi,E.co=function(a,t){return Oc[t]&&(a instanceof MouseEvent||a instanceof WheelEvent)},E.cp=function(a,t){return ir[t]&&"touches"in a},E.cq=function(a){return ir[a]||Oc[a]},E.cr=function(a,t,r){var o=t[0],f=t[1];return a[0]=r[0]*o+r[4]*f+r[12],a[1]=r[1]*o+r[5]*f+r[13],a},E.cs=function(a,t){const{x:r,y:o}=Su.fromLngLat(t);return!(a<0||a>25||o<0||o>=1||r<0||r>=1)},E.ct=function(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},E.cu=class extends Qa{},E.cv=Cp,E.cx=function(a){return a.message===os},E.cy=he,E.cz=function(a,t){H.REGISTERED_PROTOCOLS[a]=t},E.d=Le,E.e=cr,E.f=a=>c(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),E.g=Y,E.h=a=>new Promise((t,r)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=ql})},o.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(a)],{type:"image/png"});o.src=a.byteLength?URL.createObjectURL(f):ql}),E.i=yr,E.j=(a,t)=>Ee(cr(a,{type:"json"}),t),E.k=Ae,E.l=Ue,E.m=Ee,E.n=(a,t)=>Ee(cr(a,{type:"arrayBuffer"}),t),E.o=function(a){return new ff(a).readFields(dd,[])},E.p=cp,E.q=uu,E.r=sr,E.s=Fr,E.t=Ai,E.u=oi,E.v=xe,E.w=Wi,E.x=Jc,E.y=Ys,E.z=Xs}),V("worker",["./shared"],function(E){class c{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,Y){for(const he of H){this._layerConfigs[he.id]=he;const be=this._layers[he.id]=E.bI(he);be._featureFilter=E.a9(be.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(const he of Y)delete this.keyCache[he],delete this._layerConfigs[he],delete this._layers[he];this.familiesBySource={};const te=E.cB(Object.values(this._layerConfigs),this.keyCache);for(const he of te){const be=he.map(Ae=>this._layers[Ae.id]),Ee=be[0];if(Ee.visibility==="none")continue;const Le=Ee.source||"";let Se=this.familiesBySource[Le];Se||(Se=this.familiesBySource[Le]={});const qe=Ee.sourceLayer||"_geojsonTileLayer";let Ue=Se[qe];Ue||(Ue=Se[qe]=[]),Ue.push(be)}}}class pe{constructor(H){const Y={},te=[];for(const Le in H){const Se=H[Le],qe=Y[Le]={};for(const Ue in Se){const Ae=Se[+Ue];if(!Ae||Ae.bitmap.width===0||Ae.bitmap.height===0)continue;const Ke={x:0,y:0,w:Ae.bitmap.width+2,h:Ae.bitmap.height+2};te.push(Ke),qe[Ue]={rect:Ke,metrics:Ae.metrics}}}const{w:he,h:be}=E.p(te),Ee=new E.q({width:he||1,height:be||1});for(const Le in H){const Se=H[Le];for(const qe in Se){const Ue=Se[+qe];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const Ae=Y[Le][qe].rect;E.q.copy(Ue.bitmap,Ee,{x:0,y:0},{x:Ae.x+1,y:Ae.y+1},Ue.bitmap)}}this.image=Ee,this.positions=Y}}E.cC("GlyphAtlas",pe);class se{constructor(H){this.tileID=new E.Z(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId,this.inFlightDependencies=[],this.globalState=H.globalState}parse(H,Y,te,he,be){return E._(this,void 0,void 0,function*(){this.status="parsing",this.data=H,this.collisionBoxArray=new E.a7;const Ee=new E.cD(Object.keys(H.layers).sort()),Le=new E.cE(this.tileID,this.promoteId);Le.bucketLayerIDs=[];const Se={},qe={featureIndex:Le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:te,subdivisionGranularity:be},Ue=Y.familiesBySource[this.source];for(const Ut in Ue){const di=H.layers[Ut];if(!di)continue;di.version===1&&E.w(`Vector tile source "${this.source}" layer "${Ut}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Yn=Ee.encode(Ut),ft=[];for(let Sn=0;Sn<di.length;Sn++){const Qi=di.feature(Sn),jr=Le.getId(Qi,Ut);ft.push({feature:Qi,id:jr,index:Sn,sourceLayerIndex:Yn})}for(const Sn of Ue[Ut]){const Qi=Sn[0];Qi.source!==this.source&&E.w(`layer.source = ${Qi.source} does not equal this.source = ${this.source}`),Qi.minzoom&&this.zoom<Math.floor(Qi.minzoom)||Qi.maxzoom&&this.zoom>=Qi.maxzoom||Qi.visibility!=="none"&&(X(Sn,this.zoom,te),(Se[Qi.id]=Qi.createBucket({index:Le.bucketLayerIDs.length,layers:Sn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Yn,sourceID:this.source,globalState:this.globalState})).populate(ft,qe,this.tileID.canonical),Le.bucketLayerIDs.push(Sn.map(jr=>jr.id)))}}const Ae=E.bM(qe.glyphDependencies,Ut=>Object.keys(Ut).map(Number));this.inFlightDependencies.forEach(Ut=>Ut?.abort()),this.inFlightDependencies=[];let Ke=Promise.resolve({});if(Object.keys(Ae).length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),Ke=he.sendAsync({type:"GG",data:{stacks:Ae,source:this.source,tileID:this.tileID,type:"glyphs"}},Ut)}const xe=Object.keys(qe.iconDependencies);let yt=Promise.resolve({});if(xe.length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),yt=he.sendAsync({type:"GI",data:{icons:xe,source:this.source,tileID:this.tileID,type:"icons"}},Ut)}const jt=Object.keys(qe.patternDependencies);let bt=Promise.resolve({});if(jt.length){const Ut=new AbortController;this.inFlightDependencies.push(Ut),bt=he.sendAsync({type:"GI",data:{icons:jt,source:this.source,tileID:this.tileID,type:"patterns"}},Ut)}const[Rt,Bt,ai]=yield Promise.all([Ke,yt,bt]),ri=new pe(Rt),fi=new E.cF(Bt,ai);for(const Ut in Se){const di=Se[Ut];di instanceof E.a8?(X(di.layers,this.zoom,te),E.cG({bucket:di,glyphMap:Rt,glyphPositions:ri.positions,imageMap:Bt,imagePositions:fi.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:qe.subdivisionGranularity})):di.hasPattern&&(di instanceof E.cH||di instanceof E.cI||di instanceof E.cJ)&&(X(di.layers,this.zoom,te),di.addFeatures(qe,this.tileID.canonical,fi.patternPositions))}return this.status="done",{buckets:Object.values(Se).filter(Ut=>!Ut.isEmpty()),featureIndex:Le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ri.image,imageAtlas:fi,glyphMap:this.returnDependencies?Rt:null,iconMap:this.returnDependencies?Bt:null,glyphPositions:this.returnDependencies?ri.positions:null}})}}function X(Ce,H,Y){const te=new E.F(H);for(const he of Ce)he.recalculate(te,Y)}class ce{constructor(H,Y,te){this.actor=H,this.layerIndex=Y,this.availableImages=te,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(H,Y){return E._(this,void 0,void 0,function*(){const te=yield E.n(H.request,Y);try{return{vectorTile:new E.cK.VectorTile(new E.cL(te.data)),rawData:te.data,cacheControl:te.cacheControl,expires:te.expires}}catch(he){const be=new Uint8Array(te.data);let Ee=`Unable to parse the tile at ${H.request.url}, `;throw Ee+=be[0]===31&&be[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${he.message}`,new Error(Ee)}})}loadTile(H){return E._(this,void 0,void 0,function*(){const Y=H.uid,te=!!(H&&H.request&&H.request.collectResourceTiming)&&new E.cM(H.request),he=new se(H);this.loading[Y]=he;const be=new AbortController;he.abort=be;try{const Ee=yield this.loadVectorTile(H,be);if(delete this.loading[Y],!Ee)return null;const Le=Ee.rawData,Se={};Ee.expires&&(Se.expires=Ee.expires),Ee.cacheControl&&(Se.cacheControl=Ee.cacheControl);const qe={};if(te){const Ae=te.finish();Ae&&(qe.resourceTiming=JSON.parse(JSON.stringify(Ae)))}he.vectorTile=Ee.vectorTile;const Ue=he.parse(Ee.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);this.loaded[Y]=he,this.fetching[Y]={rawTileData:Le,cacheControl:Se,resourceTiming:qe};try{const Ae=yield Ue;return E.e({rawTileData:Le.slice(0)},Ae,Se,qe)}finally{delete this.fetching[Y]}}catch(Ee){throw delete this.loading[Y],he.status="done",this.loaded[Y]=he,Ee}})}reloadTile(H){return E._(this,void 0,void 0,function*(){const Y=H.uid;if(!this.loaded||!this.loaded[Y])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const te=this.loaded[Y];if(te.showCollisionBoxes=H.showCollisionBoxes,te.globalState=H.globalState,te.status==="parsing"){const he=yield te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity);let be;if(this.fetching[Y]){const{rawTileData:Ee,cacheControl:Le,resourceTiming:Se}=this.fetching[Y];delete this.fetching[Y],be=E.e({rawTileData:Ee.slice(0)},he,Le,Se)}else be=he;return be}if(te.status==="done"&&te.vectorTile)return te.parse(te.vectorTile,this.layerIndex,this.availableImages,this.actor,H.subdivisionGranularity)})}abortTile(H){return E._(this,void 0,void 0,function*(){const Y=this.loading,te=H.uid;Y&&Y[te]&&Y[te].abort&&(Y[te].abort.abort(),delete Y[te])})}removeTile(H){return E._(this,void 0,void 0,function*(){this.loaded&&this.loaded[H.uid]&&delete this.loaded[H.uid]})}}class K{constructor(){this.loaded={}}loadTile(H){return E._(this,void 0,void 0,function*(){const{uid:Y,encoding:te,rawImageData:he,redFactor:be,greenFactor:Ee,blueFactor:Le,baseShift:Se}=H,qe=he.width+2,Ue=he.height+2,Ae=E.b(he)?new E.R({width:qe,height:Ue},yield E.cN(he,-1,-1,qe,Ue)):he,Ke=new E.cO(Y,Ae,te,be,Ee,Le,Se);return this.loaded=this.loaded||{},this.loaded[Y]=Ke,Ke})}removeTile(H){const Y=this.loaded,te=H.uid;Y&&Y[te]&&delete Y[te]}}var Q,Ie,Qe=function(){if(Ie)return Q;function Ce(Y,te){if(Y.length!==0){H(Y[0],te);for(var he=1;he<Y.length;he++)H(Y[he],!te)}}function H(Y,te){for(var he=0,be=0,Ee=0,Le=Y.length,Se=Le-1;Ee<Le;Se=Ee++){var qe=(Y[Ee][0]-Y[Se][0])*(Y[Se][1]+Y[Ee][1]),Ue=he+qe;be+=Math.abs(he)>=Math.abs(qe)?he-Ue+qe:qe-Ue+he,he=Ue}he+be>=0!=!!te&&Y.reverse()}return Ie=1,Q=function Y(te,he){var be,Ee=te&&te.type;if(Ee==="FeatureCollection")for(be=0;be<te.features.length;be++)Y(te.features[be],he);else if(Ee==="GeometryCollection")for(be=0;be<te.geometries.length;be++)Y(te.geometries[be],he);else if(Ee==="Feature")Y(te.geometry,he);else if(Ee==="Polygon")Ce(te.coordinates,he);else if(Ee==="MultiPolygon")for(be=0;be<te.coordinates.length;be++)Ce(te.coordinates[be],he);return te}}(),St=E.cP(Qe);const at=E.cK.VectorTileFeature.prototype.toGeoJSON;class Ct{constructor(H){this._feature=H,this.extent=E.$,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(this._feature.type===1){const H=[];for(const Y of this._feature.geometry)H.push([new E.P(Y[0],Y[1])]);return H}{const H=[];for(const Y of this._feature.geometry){const te=[];for(const he of Y)te.push(new E.P(he[0],he[1]));H.push(te)}return H}}toGeoJSON(H,Y,te){return at.call(this,H,Y,te)}}class Xe{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=E.$,this.length=H.length,this._features=H}feature(H){return new Ct(this._features[H])}}var Je,nt,Ye,vt={exports:{}},Nt=function(){if(Ye)return vt.exports;Ye=1;var Ce=E.cS(),H=function(){if(nt)return Je;nt=1;var Ue=E.cQ(),Ae=E.cR().VectorTileFeature;function Ke(yt,jt){this.options=jt||{},this.features=yt,this.length=yt.length}function xe(yt,jt){this.id=typeof yt.id=="number"?yt.id:void 0,this.type=yt.type,this.rawGeometry=yt.type===1?[yt.geometry]:yt.geometry,this.properties=yt.tags,this.extent=jt||4096}return Je=Ke,Ke.prototype.feature=function(yt){return new xe(this.features[yt],this.options.extent)},xe.prototype.loadGeometry=function(){var yt=this.rawGeometry;this.geometry=[];for(var jt=0;jt<yt.length;jt++){for(var bt=yt[jt],Rt=[],Bt=0;Bt<bt.length;Bt++)Rt.push(new Ue(bt[Bt][0],bt[Bt][1]));this.geometry.push(Rt)}return this.geometry},xe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var yt=this.geometry,jt=1/0,bt=-1/0,Rt=1/0,Bt=-1/0,ai=0;ai<yt.length;ai++)for(var ri=yt[ai],fi=0;fi<ri.length;fi++){var Ut=ri[fi];jt=Math.min(jt,Ut.x),bt=Math.max(bt,Ut.x),Rt=Math.min(Rt,Ut.y),Bt=Math.max(Bt,Ut.y)}return[jt,Rt,bt,Bt]},xe.prototype.toGeoJSON=Ae.prototype.toGeoJSON,Je}();function Y(Ue){var Ae=new Ce;return function(Ke,xe){for(var yt in Ke.layers)xe.writeMessage(3,te,Ke.layers[yt])}(Ue,Ae),Ae.finish()}function te(Ue,Ae){var Ke;Ae.writeVarintField(15,Ue.version||1),Ae.writeStringField(1,Ue.name||""),Ae.writeVarintField(5,Ue.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(Ke=0;Ke<Ue.length;Ke++)xe.feature=Ue.feature(Ke),Ae.writeMessage(2,he,xe);var yt=xe.keys;for(Ke=0;Ke<yt.length;Ke++)Ae.writeStringField(3,yt[Ke]);var jt=xe.values;for(Ke=0;Ke<jt.length;Ke++)Ae.writeMessage(4,qe,jt[Ke])}function he(Ue,Ae){var Ke=Ue.feature;Ke.id!==void 0&&Ae.writeVarintField(1,Ke.id),Ae.writeMessage(2,be,Ue),Ae.writeVarintField(3,Ke.type),Ae.writeMessage(4,Se,Ke)}function be(Ue,Ae){var Ke=Ue.feature,xe=Ue.keys,yt=Ue.values,jt=Ue.keycache,bt=Ue.valuecache;for(var Rt in Ke.properties){var Bt=Ke.properties[Rt],ai=jt[Rt];if(Bt!==null){ai===void 0&&(xe.push(Rt),jt[Rt]=ai=xe.length-1),Ae.writeVarint(ai);var ri=typeof Bt;ri!=="string"&&ri!=="boolean"&&ri!=="number"&&(Bt=JSON.stringify(Bt));var fi=ri+":"+Bt,Ut=bt[fi];Ut===void 0&&(yt.push(Bt),bt[fi]=Ut=yt.length-1),Ae.writeVarint(Ut)}}}function Ee(Ue,Ae){return(Ae<<3)+(7&Ue)}function Le(Ue){return Ue<<1^Ue>>31}function Se(Ue,Ae){for(var Ke=Ue.loadGeometry(),xe=Ue.type,yt=0,jt=0,bt=Ke.length,Rt=0;Rt<bt;Rt++){var Bt=Ke[Rt],ai=1;xe===1&&(ai=Bt.length),Ae.writeVarint(Ee(1,ai));for(var ri=xe===3?Bt.length-1:Bt.length,fi=0;fi<ri;fi++){fi===1&&xe!==1&&Ae.writeVarint(Ee(2,ri-1));var Ut=Bt[fi].x-yt,di=Bt[fi].y-jt;Ae.writeVarint(Le(Ut)),Ae.writeVarint(Le(di)),yt+=Ut,jt+=di}xe===3&&Ae.writeVarint(Ee(7,1))}}function qe(Ue,Ae){var Ke=typeof Ue;Ke==="string"?Ae.writeStringField(1,Ue):Ke==="boolean"?Ae.writeBooleanField(7,Ue):Ke==="number"&&(Ue%1!=0?Ae.writeDoubleField(3,Ue):Ue<0?Ae.writeSVarintField(6,Ue):Ae.writeVarintField(5,Ue))}return vt.exports=Y,vt.exports.fromVectorTileJs=Y,vt.exports.fromGeojsonVt=function(Ue,Ae){Ae=Ae||{};var Ke={};for(var xe in Ue)Ke[xe]=new H(Ue[xe].features,Ae),Ke[xe].name=xe,Ke[xe].version=Ae.version,Ke[xe].extent=Ae.extent;return Y({layers:Ke})},vt.exports.GeoJSONWrapper=H,vt.exports}(),Jt=E.cP(Nt);const Lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},_i=Math.fround||(ni=new Float32Array(1),Ce=>(ni[0]=+Ce,ni[0]));var ni;class Ci{constructor(H){this.options=Object.assign(Object.create(Lt),H),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(H){const{log:Y,minZoom:te,maxZoom:he}=this.options;Y&&console.time("total time");const be=`prepare ${H.length} points`;Y&&console.time(be),this.points=H;const Ee=[];for(let Se=0;Se<H.length;Se++){const qe=H[Se];if(!qe.geometry)continue;const[Ue,Ae]=qe.geometry.coordinates,Ke=_i(We(Ue)),xe=_i(je(Ae));Ee.push(Ke,xe,1/0,Se,-1,1),this.options.reduce&&Ee.push(0)}let Le=this.trees[he+1]=this._createTree(Ee);Y&&console.timeEnd(be);for(let Se=he;Se>=te;Se--){const qe=+Date.now();Le=this.trees[Se]=this._createTree(this._cluster(Le,Se)),Y&&console.log("z%d: %d clusters in %dms",Se,Le.numItems,+Date.now()-qe)}return Y&&console.timeEnd("total time"),this}getClusters(H,Y){let te=((H[0]+180)%360+360)%360-180;const he=Math.max(-90,Math.min(90,H[1]));let be=H[2]===180?180:((H[2]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)te=-180,be=180;else if(te>be){const Ae=this.getClusters([te,he,180,Ee],Y),Ke=this.getClusters([-180,he,be,Ee],Y);return Ae.concat(Ke)}const Le=this.trees[this._limitZoom(Y)],Se=Le.range(We(te),je(Ee),We(be),je(he)),qe=Le.data,Ue=[];for(const Ae of Se){const Ke=this.stride*Ae;Ue.push(qe[Ke+5]>1?Tn(qe,Ke,this.clusterProps):this.points[qe[Ke+3]])}return Ue}getChildren(H){const Y=this._getOriginId(H),te=this._getOriginZoom(H),he="No cluster with the specified id.",be=this.trees[te];if(!be)throw new Error(he);const Ee=be.data;if(Y*this.stride>=Ee.length)throw new Error(he);const Le=this.options.radius/(this.options.extent*Math.pow(2,te-1)),Se=be.within(Ee[Y*this.stride],Ee[Y*this.stride+1],Le),qe=[];for(const Ue of Se){const Ae=Ue*this.stride;Ee[Ae+4]===H&&qe.push(Ee[Ae+5]>1?Tn(Ee,Ae,this.clusterProps):this.points[Ee[Ae+3]])}if(qe.length===0)throw new Error(he);return qe}getLeaves(H,Y,te){const he=[];return this._appendLeaves(he,H,Y=Y||10,te=te||0,0),he}getTile(H,Y,te){const he=this.trees[this._limitZoom(H)],be=Math.pow(2,H),{extent:Ee,radius:Le}=this.options,Se=Le/Ee,qe=(te-Se)/be,Ue=(te+1+Se)/be,Ae={features:[]};return this._addTileFeatures(he.range((Y-Se)/be,qe,(Y+1+Se)/be,Ue),he.data,Y,te,be,Ae),Y===0&&this._addTileFeatures(he.range(1-Se/be,qe,1,Ue),he.data,be,te,be,Ae),Y===be-1&&this._addTileFeatures(he.range(0,qe,Se/be,Ue),he.data,-1,te,be,Ae),Ae.features.length?Ae:null}getClusterExpansionZoom(H){let Y=this._getOriginZoom(H)-1;for(;Y<=this.options.maxZoom;){const te=this.getChildren(H);if(Y++,te.length!==1)break;H=te[0].properties.cluster_id}return Y}_appendLeaves(H,Y,te,he,be){const Ee=this.getChildren(Y);for(const Le of Ee){const Se=Le.properties;if(Se&&Se.cluster?be+Se.point_count<=he?be+=Se.point_count:be=this._appendLeaves(H,Se.cluster_id,te,he,be):be<he?be++:H.push(Le),H.length===te)break}return be}_createTree(H){const Y=new E.aH(H.length/this.stride|0,this.options.nodeSize,Float32Array);for(let te=0;te<H.length;te+=this.stride)Y.add(H[te],H[te+1]);return Y.finish(),Y.data=H,Y}_addTileFeatures(H,Y,te,he,be,Ee){for(const Le of H){const Se=Le*this.stride,qe=Y[Se+5]>1;let Ue,Ae,Ke;if(qe)Ue=ki(Y,Se,this.clusterProps),Ae=Y[Se],Ke=Y[Se+1];else{const jt=this.points[Y[Se+3]];Ue=jt.properties;const[bt,Rt]=jt.geometry.coordinates;Ae=We(bt),Ke=je(Rt)}const xe={type:1,geometry:[[Math.round(this.options.extent*(Ae*be-te)),Math.round(this.options.extent*(Ke*be-he))]],tags:Ue};let yt;yt=qe||this.options.generateId?Y[Se+3]:this.points[Y[Se+3]].id,yt!==void 0&&(xe.id=yt),Ee.features.push(xe)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,Y){const{radius:te,extent:he,reduce:be,minPoints:Ee}=this.options,Le=te/(he*Math.pow(2,Y)),Se=H.data,qe=[],Ue=this.stride;for(let Ae=0;Ae<Se.length;Ae+=Ue){if(Se[Ae+2]<=Y)continue;Se[Ae+2]=Y;const Ke=Se[Ae],xe=Se[Ae+1],yt=H.within(Se[Ae],Se[Ae+1],Le),jt=Se[Ae+5];let bt=jt;for(const Rt of yt){const Bt=Rt*Ue;Se[Bt+2]>Y&&(bt+=Se[Bt+5])}if(bt>jt&&bt>=Ee){let Rt,Bt=Ke*jt,ai=xe*jt,ri=-1;const fi=(Ae/Ue<<5)+(Y+1)+this.points.length;for(const Ut of yt){const di=Ut*Ue;if(Se[di+2]<=Y)continue;Se[di+2]=Y;const Yn=Se[di+5];Bt+=Se[di]*Yn,ai+=Se[di+1]*Yn,Se[di+4]=fi,be&&(Rt||(Rt=this._map(Se,Ae,!0),ri=this.clusterProps.length,this.clusterProps.push(Rt)),be(Rt,this._map(Se,di)))}Se[Ae+4]=fi,qe.push(Bt/bt,ai/bt,1/0,fi,-1,bt),be&&qe.push(ri)}else{for(let Rt=0;Rt<Ue;Rt++)qe.push(Se[Ae+Rt]);if(bt>1)for(const Rt of yt){const Bt=Rt*Ue;if(!(Se[Bt+2]<=Y)){Se[Bt+2]=Y;for(let ai=0;ai<Ue;ai++)qe.push(Se[Bt+ai])}}}}return qe}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,Y,te){if(H[Y+5]>1){const Ee=this.clusterProps[H[Y+6]];return te?Object.assign({},Ee):Ee}const he=this.points[H[Y+3]].properties,be=this.options.map(he);return te&&be===he?Object.assign({},be):be}}function Tn(Ce,H,Y){return{type:"Feature",id:Ce[H+3],properties:ki(Ce,H,Y),geometry:{type:"Point",coordinates:[(te=Ce[H],360*(te-.5)),_t(Ce[H+1])]}};var te}function ki(Ce,H,Y){const te=Ce[H+5],he=te>=1e4?`${Math.round(te/1e3)}k`:te>=1e3?Math.round(te/100)/10+"k":te,be=Ce[H+6],Ee=be===-1?{}:Object.assign({},Y[be]);return Object.assign(Ee,{cluster:!0,cluster_id:Ce[H+3],point_count:te,point_count_abbreviated:he})}function We(Ce){return Ce/360+.5}function je(Ce){const H=Math.sin(Ce*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function _t(Ce){const H=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function qt(Ce,H,Y,te){let he=te;const be=H+(Y-H>>1);let Ee,Le=Y-H;const Se=Ce[H],qe=Ce[H+1],Ue=Ce[Y],Ae=Ce[Y+1];for(let Ke=H+3;Ke<Y;Ke+=3){const xe=ye(Ce[Ke],Ce[Ke+1],Se,qe,Ue,Ae);if(xe>he)Ee=Ke,he=xe;else if(xe===he){const yt=Math.abs(Ke-be);yt<Le&&(Ee=Ke,Le=yt)}}he>te&&(Ee-H>3&&qt(Ce,H,Ee,te),Ce[Ee+2]=he,Y-Ee>3&&qt(Ce,Ee,Y,te))}function ye(Ce,H,Y,te,he,be){let Ee=he-Y,Le=be-te;if(Ee!==0||Le!==0){const Se=((Ce-Y)*Ee+(H-te)*Le)/(Ee*Ee+Le*Le);Se>1?(Y=he,te=be):Se>0&&(Y+=Ee*Se,te+=Le*Se)}return Ee=Ce-Y,Le=H-te,Ee*Ee+Le*Le}function He(Ce,H,Y,te){const he={id:Ce??null,type:H,geometry:Y,tags:te,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(H==="Point"||H==="MultiPoint"||H==="LineString")ot(he,Y);else if(H==="Polygon")ot(he,Y[0]);else if(H==="MultiLineString")for(const be of Y)ot(he,be);else if(H==="MultiPolygon")for(const be of Y)ot(he,be[0]);return he}function ot(Ce,H){for(let Y=0;Y<H.length;Y+=3)Ce.minX=Math.min(Ce.minX,H[Y]),Ce.minY=Math.min(Ce.minY,H[Y+1]),Ce.maxX=Math.max(Ce.maxX,H[Y]),Ce.maxY=Math.max(Ce.maxY,H[Y+1])}function dt(Ce,H,Y,te){if(!H.geometry)return;const he=H.geometry.coordinates;if(he&&he.length===0)return;const be=H.geometry.type,Ee=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2);let Le=[],Se=H.id;if(Y.promoteId?Se=H.properties[Y.promoteId]:Y.generateId&&(Se=te||0),be==="Point")At(he,Le);else if(be==="MultiPoint")for(const qe of he)At(qe,Le);else if(be==="LineString")Ht(he,Le,Ee,!1);else if(be==="MultiLineString"){if(Y.lineMetrics){for(const qe of he)Le=[],Ht(qe,Le,Ee,!1),Ce.push(He(Se,"LineString",Le,H.properties));return}Ft(he,Le,Ee,!1)}else if(be==="Polygon")Ft(he,Le,Ee,!0);else{if(be!=="MultiPolygon"){if(be==="GeometryCollection"){for(const qe of H.geometry.geometries)dt(Ce,{id:Se,geometry:qe,properties:H.properties},Y,te);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const qe of he){const Ue=[];Ft(qe,Ue,Ee,!0),Le.push(Ue)}}Ce.push(He(Se,be,Le,H.properties))}function At(Ce,H){H.push(Yi(Ce[0]),Mi(Ce[1]),0)}function Ht(Ce,H,Y,te){let he,be,Ee=0;for(let Se=0;Se<Ce.length;Se++){const qe=Yi(Ce[Se][0]),Ue=Mi(Ce[Se][1]);H.push(qe,Ue,0),Se>0&&(Ee+=te?(he*Ue-qe*be)/2:Math.sqrt(Math.pow(qe-he,2)+Math.pow(Ue-be,2))),he=qe,be=Ue}const Le=H.length-3;H[2]=1,qt(H,0,Le,Y),H[Le+2]=1,H.size=Math.abs(Ee),H.start=0,H.end=H.size}function Ft(Ce,H,Y,te){for(let he=0;he<Ce.length;he++){const be=[];Ht(Ce[he],be,Y,te),H.push(be)}}function Yi(Ce){return Ce/360+.5}function Mi(Ce){const H=Math.sin(Ce*Math.PI/180),Y=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return Y<0?0:Y>1?1:Y}function Ki(Ce,H,Y,te,he,be,Ee,Le){if(te/=H,be>=(Y/=H)&&Ee<te)return Ce;if(Ee<Y||be>=te)return null;const Se=[];for(const qe of Ce){const Ue=qe.geometry;let Ae=qe.type;const Ke=he===0?qe.minX:qe.minY,xe=he===0?qe.maxX:qe.maxY;if(Ke>=Y&&xe<te){Se.push(qe);continue}if(xe<Y||Ke>=te)continue;let yt=[];if(Ae==="Point"||Ae==="MultiPoint")uo(Ue,yt,Y,te,he);else if(Ae==="LineString")cr(Ue,yt,Y,te,he,!1,Le.lineMetrics);else if(Ae==="MultiLineString")rn(Ue,yt,Y,te,he,!1);else if(Ae==="Polygon")rn(Ue,yt,Y,te,he,!0);else if(Ae==="MultiPolygon")for(const jt of Ue){const bt=[];rn(jt,bt,Y,te,he,!0),bt.length&&yt.push(bt)}if(yt.length){if(Le.lineMetrics&&Ae==="LineString"){for(const jt of yt)Se.push(He(qe.id,Ae,jt,qe.tags));continue}Ae!=="LineString"&&Ae!=="MultiLineString"||(yt.length===1?(Ae="LineString",yt=yt[0]):Ae="MultiLineString"),Ae!=="Point"&&Ae!=="MultiPoint"||(Ae=yt.length===3?"Point":"MultiPoint"),Se.push(He(qe.id,Ae,yt,qe.tags))}}return Se.length?Se:null}function uo(Ce,H,Y,te,he){for(let be=0;be<Ce.length;be+=3){const Ee=Ce[be+he];Ee>=Y&&Ee<=te&&ta(H,Ce[be],Ce[be+1],Ce[be+2])}}function cr(Ce,H,Y,te,he,be,Ee){let Le=ho(Ce);const Se=he===0?ia:il;let qe,Ue,Ae=Ce.start;for(let bt=0;bt<Ce.length-3;bt+=3){const Rt=Ce[bt],Bt=Ce[bt+1],ai=Ce[bt+2],ri=Ce[bt+3],fi=Ce[bt+4],Ut=he===0?Rt:Bt,di=he===0?ri:fi;let Yn=!1;Ee&&(qe=Math.sqrt(Math.pow(Rt-ri,2)+Math.pow(Bt-fi,2))),Ut<Y?di>Y&&(Ue=Se(Le,Rt,Bt,ri,fi,Y),Ee&&(Le.start=Ae+qe*Ue)):Ut>te?di<te&&(Ue=Se(Le,Rt,Bt,ri,fi,te),Ee&&(Le.start=Ae+qe*Ue)):ta(Le,Rt,Bt,ai),di<Y&&Ut>=Y&&(Ue=Se(Le,Rt,Bt,ri,fi,Y),Yn=!0),di>te&&Ut<=te&&(Ue=Se(Le,Rt,Bt,ri,fi,te),Yn=!0),!be&&Yn&&(Ee&&(Le.end=Ae+qe*Ue),H.push(Le),Le=ho(Ce)),Ee&&(Ae+=qe)}let Ke=Ce.length-3;const xe=Ce[Ke],yt=Ce[Ke+1],jt=he===0?xe:yt;jt>=Y&&jt<=te&&ta(Le,xe,yt,Ce[Ke+2]),Ke=Le.length-3,be&&Ke>=3&&(Le[Ke]!==Le[0]||Le[Ke+1]!==Le[1])&&ta(Le,Le[0],Le[1],Le[2]),Le.length&&H.push(Le)}function ho(Ce){const H=[];return H.size=Ce.size,H.start=Ce.start,H.end=Ce.end,H}function rn(Ce,H,Y,te,he,be){for(const Ee of Ce)cr(Ee,H,Y,te,he,be,!1)}function ta(Ce,H,Y,te){Ce.push(H,Y,te)}function ia(Ce,H,Y,te,he,be){const Ee=(be-H)/(te-H);return ta(Ce,be,Y+(he-Y)*Ee,1),Ee}function il(Ce,H,Y,te,he,be){const Ee=(be-Y)/(he-Y);return ta(Ce,H+(te-H)*Ee,be,1),Ee}function Wi(Ce,H){const Y=[];for(let te=0;te<Ce.length;te++){const he=Ce[te],be=he.type;let Ee;if(be==="Point"||be==="MultiPoint"||be==="LineString")Ee=Nr(he.geometry,H);else if(be==="MultiLineString"||be==="Polygon"){Ee=[];for(const Le of he.geometry)Ee.push(Nr(Le,H))}else if(be==="MultiPolygon"){Ee=[];for(const Le of he.geometry){const Se=[];for(const qe of Le)Se.push(Nr(qe,H));Ee.push(Se)}}Y.push(He(he.id,be,Ee,he.tags))}return Y}function Nr(Ce,H){const Y=[];Y.size=Ce.size,Ce.start!==void 0&&(Y.start=Ce.start,Y.end=Ce.end);for(let te=0;te<Ce.length;te+=3)Y.push(Ce[te]+H,Ce[te+1],Ce[te+2]);return Y}function yr(Ce,H){if(Ce.transformed)return Ce;const Y=1<<Ce.z,te=Ce.x,he=Ce.y;for(const be of Ce.features){const Ee=be.geometry,Le=be.type;if(be.geometry=[],Le===1)for(let Se=0;Se<Ee.length;Se+=2)be.geometry.push(Rs(Ee[Se],Ee[Se+1],H,Y,te,he));else for(let Se=0;Se<Ee.length;Se++){const qe=[];for(let Ue=0;Ue<Ee[Se].length;Ue+=2)qe.push(Rs(Ee[Se][Ue],Ee[Se][Ue+1],H,Y,te,he));be.geometry.push(qe)}}return Ce.transformed=!0,Ce}function Rs(Ce,H,Y,te,he,be){return[Math.round(Y*(Ce*te-he)),Math.round(Y*(H*te-be))]}function ba(Ce,H,Y,te,he){const be=H===he.maxZoom?0:he.tolerance/((1<<H)*he.extent),Ee={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:Y,y:te,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Le of Ce)ql(Ee,Le,be,he);return Ee}function ql(Ce,H,Y,te){const he=H.geometry,be=H.type,Ee=[];if(Ce.minX=Math.min(Ce.minX,H.minX),Ce.minY=Math.min(Ce.minY,H.minY),Ce.maxX=Math.max(Ce.maxX,H.maxX),Ce.maxY=Math.max(Ce.maxY,H.maxY),be==="Point"||be==="MultiPoint")for(let Le=0;Le<he.length;Le+=3)Ee.push(he[Le],he[Le+1]),Ce.numPoints++,Ce.numSimplified++;else if(be==="LineString")Is(Ee,he,Ce,Y,!1,!1);else if(be==="MultiLineString"||be==="Polygon")for(let Le=0;Le<he.length;Le++)Is(Ee,he[Le],Ce,Y,be==="Polygon",Le===0);else if(be==="MultiPolygon")for(let Le=0;Le<he.length;Le++){const Se=he[Le];for(let qe=0;qe<Se.length;qe++)Is(Ee,Se[qe],Ce,Y,!0,qe===0)}if(Ee.length){let Le=H.tags||null;if(be==="LineString"&&te.lineMetrics){Le={};for(const qe in H.tags)Le[qe]=H.tags[qe];Le.mapbox_clip_start=he.start/he.size,Le.mapbox_clip_end=he.end/he.size}const Se={geometry:Ee,type:be==="Polygon"||be==="MultiPolygon"?3:be==="LineString"||be==="MultiLineString"?2:1,tags:Le};H.id!==null&&(Se.id=H.id),Ce.features.push(Se)}}function Is(Ce,H,Y,te,he,be){const Ee=te*te;if(te>0&&H.size<(he?Ee:te))return void(Y.numPoints+=H.length/3);const Le=[];for(let Se=0;Se<H.length;Se+=3)(te===0||H[Se+2]>Ee)&&(Y.numSimplified++,Le.push(H[Se],H[Se+1])),Y.numPoints++;he&&function(Se,qe){let Ue=0;for(let Ae=0,Ke=Se.length,xe=Ke-2;Ae<Ke;xe=Ae,Ae+=2)Ue+=(Se[Ae]-Se[xe])*(Se[Ae+1]+Se[xe+1]);if(Ue>0===qe)for(let Ae=0,Ke=Se.length;Ae<Ke/2;Ae+=2){const xe=Se[Ae],yt=Se[Ae+1];Se[Ae]=Se[Ke-2-Ae],Se[Ae+1]=Se[Ke-1-Ae],Se[Ke-2-Ae]=xe,Se[Ke-1-Ae]=yt}}(Le,be),Ce.push(Le)}const ss={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class fo{constructor(H,Y){const te=(Y=this.options=function(be,Ee){for(const Le in Ee)be[Le]=Ee[Le];return be}(Object.create(ss),Y)).debug;if(te&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");let he=function(be,Ee){const Le=[];if(be.type==="FeatureCollection")for(let Se=0;Se<be.features.length;Se++)dt(Le,be.features[Se],Ee,Se);else dt(Le,be.type==="Feature"?be:{geometry:be},Ee);return Le}(H,Y);this.tiles={},this.tileCoords=[],te&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),he=function(be,Ee){const Le=Ee.buffer/Ee.extent;let Se=be;const qe=Ki(be,1,-1-Le,Le,0,-1,2,Ee),Ue=Ki(be,1,1-Le,2+Le,0,-1,2,Ee);return(qe||Ue)&&(Se=Ki(be,1,-Le,1+Le,0,-1,2,Ee)||[],qe&&(Se=Wi(qe,1).concat(Se)),Ue&&(Se=Se.concat(Wi(Ue,-1)))),Se}(he,Y),he.length&&this.splitTile(he,0,0,0),te&&(he.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(H,Y,te,he,be,Ee,Le){const Se=[H,Y,te,he],qe=this.options,Ue=qe.debug;for(;Se.length;){he=Se.pop(),te=Se.pop(),Y=Se.pop(),H=Se.pop();const Ae=1<<Y,Ke=Fr(Y,te,he);let xe=this.tiles[Ke];if(!xe&&(Ue>1&&console.time("creation"),xe=this.tiles[Ke]=ba(H,Y,te,he,qe),this.tileCoords.push({z:Y,x:te,y:he}),Ue)){Ue>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,te,he,xe.numFeatures,xe.numPoints,xe.numSimplified),console.timeEnd("creation"));const Yn=`z${Y}`;this.stats[Yn]=(this.stats[Yn]||0)+1,this.total++}if(xe.source=H,be==null){if(Y===qe.indexMaxZoom||xe.numPoints<=qe.indexMaxPoints)continue}else{if(Y===qe.maxZoom||Y===be)continue;if(be!=null){const Yn=be-Y;if(te!==Ee>>Yn||he!==Le>>Yn)continue}}if(xe.source=null,H.length===0)continue;Ue>1&&console.time("clipping");const yt=.5*qe.buffer/qe.extent,jt=.5-yt,bt=.5+yt,Rt=1+yt;let Bt=null,ai=null,ri=null,fi=null,Ut=Ki(H,Ae,te-yt,te+bt,0,xe.minX,xe.maxX,qe),di=Ki(H,Ae,te+jt,te+Rt,0,xe.minX,xe.maxX,qe);H=null,Ut&&(Bt=Ki(Ut,Ae,he-yt,he+bt,1,xe.minY,xe.maxY,qe),ai=Ki(Ut,Ae,he+jt,he+Rt,1,xe.minY,xe.maxY,qe),Ut=null),di&&(ri=Ki(di,Ae,he-yt,he+bt,1,xe.minY,xe.maxY,qe),fi=Ki(di,Ae,he+jt,he+Rt,1,xe.minY,xe.maxY,qe),di=null),Ue>1&&console.timeEnd("clipping"),Se.push(Bt||[],Y+1,2*te,2*he),Se.push(ai||[],Y+1,2*te,2*he+1),Se.push(ri||[],Y+1,2*te+1,2*he),Se.push(fi||[],Y+1,2*te+1,2*he+1)}}getTile(H,Y,te){H=+H,Y=+Y,te=+te;const he=this.options,{extent:be,debug:Ee}=he;if(H<0||H>24)return null;const Le=1<<H,Se=Fr(H,Y=Y+Le&Le-1,te);if(this.tiles[Se])return yr(this.tiles[Se],be);Ee>1&&console.log("drilling down to z%d-%d-%d",H,Y,te);let qe,Ue=H,Ae=Y,Ke=te;for(;!qe&&Ue>0;)Ue--,Ae>>=1,Ke>>=1,qe=this.tiles[Fr(Ue,Ae,Ke)];return qe&&qe.source?(Ee>1&&(console.log("found parent tile z%d-%d-%d",Ue,Ae,Ke),console.time("drilling down")),this.splitTile(qe.source,Ue,Ae,Ke,H,Y,te),Ee>1&&console.timeEnd("drilling down"),this.tiles[Se]?yr(this.tiles[Se],be):null):null}}function Fr(Ce,H,Y){return 32*((1<<Ce)*Y+H)+Ce}function an(Ce,H){return H?Ce.properties[H]:Ce.id}function tr(Ce,H){if(Ce==null)return!0;if(Ce.type==="Feature")return an(Ce,H)!=null;if(Ce.type==="FeatureCollection"){const Y=new Set;for(const te of Ce.features){const he=an(te,H);if(he==null||Y.has(he))return!1;Y.add(he)}return!0}return!1}function ir(Ce,H){const Y=new Map;if(Ce!=null)if(Ce.type==="Feature")Y.set(an(Ce,H),Ce);else for(const te of Ce.features)Y.set(an(te,H),te);return Y}class Oc extends ce{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(H,Y){return E._(this,void 0,void 0,function*(){const te=H.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const he=this._geoJSONIndex.getTile(te.z,te.x,te.y);if(!he)return null;const be=new Xe(he.features);let Ee=Jt(be);return Ee.byteOffset===0&&Ee.byteLength===Ee.buffer.byteLength||(Ee=new Uint8Array(Ee)),{vectorTile:be,rawData:Ee.buffer}})}loadData(H){return E._(this,void 0,void 0,function*(){var Y;(Y=this._pendingRequest)===null||Y===void 0||Y.abort();const te=!!(H&&H.request&&H.request.collectResourceTiming)&&new E.cM(H.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(H,this._pendingRequest),this._geoJSONIndex=H.cluster?new Ci(function({superclusterOptions:Ee,clusterProperties:Le}){if(!Le||!Ee)return Ee;const Se={},qe={},Ue={accumulated:null,zoom:0},Ae={properties:null},Ke=Object.keys(Le);for(const xe of Ke){const[yt,jt]=Le[xe],bt=E.cT(jt),Rt=E.cT(typeof yt=="string"?[yt,["accumulated"],["get",xe]]:yt);Se[xe]=bt.value,qe[xe]=Rt.value}return Ee.map=xe=>{Ae.properties=xe;const yt={};for(const jt of Ke)yt[jt]=Se[jt].evaluate(Ue,Ae);return yt},Ee.reduce=(xe,yt)=>{Ae.properties=yt;for(const jt of Ke)Ue.accumulated=xe[jt],xe[jt]=qe[jt].evaluate(Ue,Ae)},Ee}(H)).load((yield this._pendingData).features):(he=yield this._pendingData,new fo(he,H.geojsonVtOptions)),this.loaded={};const be={};if(te){const Ee=te.finish();Ee&&(be.resourceTiming={},be.resourceTiming[H.source]=JSON.parse(JSON.stringify(Ee)))}return be}catch(be){if(delete this._pendingRequest,E.cx(be))return{abandoned:!0};throw be}var he})}getData(){return E._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(H){const Y=this.loaded;return Y&&Y[H.uid]?super.reloadTile(H):this.loadTile(H)}loadAndProcessGeoJSON(H,Y){return E._(this,void 0,void 0,function*(){let te=yield this.loadGeoJSON(H,Y);if(delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(St(te,!0),H.filter){const he=E.cT(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map(Ee=>`${Ee.key}: ${Ee.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(Ee=>he.value.evaluate({zoom:0},Ee))}}return te})}loadGeoJSON(H,Y){return E._(this,void 0,void 0,function*(){const{promoteId:te}=H;if(H.request){const he=yield E.j(H.request,Y);return this._dataUpdateable=tr(he.data,te)?ir(he.data,te):void 0,he.data}if(typeof H.data=="string")try{const he=JSON.parse(H.data);return this._dataUpdateable=tr(he,te)?ir(he,te):void 0,he}catch{throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`)}if(!H.dataDiff)throw new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${H.source}`);return function(he,be,Ee){var Le,Se,qe,Ue;if(be.removeAll&&he.clear(),be.remove)for(const Ae of be.remove)he.delete(Ae);if(be.add)for(const Ae of be.add){const Ke=an(Ae,Ee);Ke!=null&&he.set(Ke,Ae)}if(be.update)for(const Ae of be.update){let Ke=he.get(Ae.id);if(Ke==null)continue;const xe=!Ae.removeAllProperties&&(((Le=Ae.removeProperties)===null||Le===void 0?void 0:Le.length)>0||((Se=Ae.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Ae.newGeometry||Ae.removeAllProperties||xe)&&(Ke=Object.assign({},Ke),he.set(Ae.id,Ke),xe&&(Ke.properties=Object.assign({},Ke.properties))),Ae.newGeometry&&(Ke.geometry=Ae.newGeometry),Ae.removeAllProperties)Ke.properties={};else if(((qe=Ae.removeProperties)===null||qe===void 0?void 0:qe.length)>0)for(const yt of Ae.removeProperties)Object.prototype.hasOwnProperty.call(Ke.properties,yt)&&delete Ke.properties[yt];if(((Ue=Ae.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:yt,value:jt}of Ae.addOrUpdateProperties)Ke.properties[yt]=jt}}(this._dataUpdateable,H.dataDiff,te),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(H){return E._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(H){return this._geoJSONIndex.getClusterExpansionZoom(H.clusterId)}getClusterChildren(H){return this._geoJSONIndex.getChildren(H.clusterId)}getClusterLeaves(H){return this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset)}}class os{constructor(H){this.self=H,this.actor=new E.J(H),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Y,te)=>{if(this.externalWorkerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.externalWorkerSourceTypes[Y]=te},this.self.addProtocol=E.cz,this.self.removeProtocol=E.cA,this.self.registerRTLTextPlugin=Y=>{E.cU.setMethods(Y)},this.actor.registerMessageHandler("LDT",(Y,te)=>this._getDEMWorkerSource(Y,te.source).loadTile(te)),this.actor.registerMessageHandler("RDT",(Y,te)=>E._(this,void 0,void 0,function*(){this._getDEMWorkerSource(Y,te.source).removeTile(te)})),this.actor.registerMessageHandler("GCEZ",(Y,te)=>E._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterExpansionZoom(te)})),this.actor.registerMessageHandler("GCC",(Y,te)=>E._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterChildren(te)})),this.actor.registerMessageHandler("GCL",(Y,te)=>E._(this,void 0,void 0,function*(){return this._getWorkerSource(Y,te.type,te.source).getClusterLeaves(te)})),this.actor.registerMessageHandler("LD",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).loadData(te)),this.actor.registerMessageHandler("GD",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).getData()),this.actor.registerMessageHandler("LT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).loadTile(te)),this.actor.registerMessageHandler("RT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).reloadTile(te)),this.actor.registerMessageHandler("AT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).abortTile(te)),this.actor.registerMessageHandler("RMT",(Y,te)=>this._getWorkerSource(Y,te.type,te.source).removeTile(te)),this.actor.registerMessageHandler("RS",(Y,te)=>E._(this,void 0,void 0,function*(){if(!this.workerSources[Y]||!this.workerSources[Y][te.type]||!this.workerSources[Y][te.type][te.source])return;const he=this.workerSources[Y][te.type][te.source];delete this.workerSources[Y][te.type][te.source],he.removeSource!==void 0&&he.removeSource(te)})),this.actor.registerMessageHandler("RM",Y=>E._(this,void 0,void 0,function*(){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y]})),this.actor.registerMessageHandler("SR",(Y,te)=>E._(this,void 0,void 0,function*(){this.referrer=te})),this.actor.registerMessageHandler("SRPS",(Y,te)=>this._syncRTLPluginState(Y,te)),this.actor.registerMessageHandler("IS",(Y,te)=>E._(this,void 0,void 0,function*(){this.self.importScripts(te)})),this.actor.registerMessageHandler("SI",(Y,te)=>this._setImages(Y,te)),this.actor.registerMessageHandler("UL",(Y,te)=>E._(this,void 0,void 0,function*(){this._getLayerIndex(Y).update(te.layers,te.removedIds)})),this.actor.registerMessageHandler("SL",(Y,te)=>E._(this,void 0,void 0,function*(){this._getLayerIndex(Y).replace(te)}))}_setImages(H,Y){return E._(this,void 0,void 0,function*(){this.availableImages[H]=Y;for(const te in this.workerSources[H]){const he=this.workerSources[H][te];for(const be in he)he[be].availableImages=Y}})}_syncRTLPluginState(H,Y){return E._(this,void 0,void 0,function*(){return yield E.cU.syncState(Y,this.self.importScripts)})}_getAvailableImages(H){let Y=this.availableImages[H];return Y||(Y=[]),Y}_getLayerIndex(H){let Y=this.layerIndexes[H];return Y||(Y=this.layerIndexes[H]=new c),Y}_getWorkerSource(H,Y,te){if(this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][Y]||(this.workerSources[H][Y]={}),!this.workerSources[H][Y][te]){const he={sendAsync:(be,Ee)=>(be.targetMapId=H,this.actor.sendAsync(be,Ee))};switch(Y){case"vector":this.workerSources[H][Y][te]=new ce(he,this._getLayerIndex(H),this._getAvailableImages(H));break;case"geojson":this.workerSources[H][Y][te]=new Oc(he,this._getLayerIndex(H),this._getAvailableImages(H));break;default:this.workerSources[H][Y][te]=new this.externalWorkerSourceTypes[Y](he,this._getLayerIndex(H),this._getAvailableImages(H))}}return this.workerSources[H][Y][te]}_getDEMWorkerSource(H,Y){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][Y]||(this.demWorkerSources[H][Y]=new K),this.demWorkerSources[H][Y]}}return E.i(self)&&(self.worker=new os(self)),os}),V("index",["exports","./shared"],function(E,c){var pe="5.6.1";function se(){var d=new c.A(4);return c.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}let X,ce;const K={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(d,e,n){const l=requestAnimationFrame(m=>{h(),e(m)}),{unsubscribe:h}=c.s(d.signal,"abort",()=>{h(),cancelAnimationFrame(l),n(c.c())},!1)},frameAsync(d){return new Promise((e,n)=>{this.frame(d,e,n)})},getImageData(d,e=0){return this.getImageCanvasContext(d).getImageData(-e,-e,d.width+2*e,d.height+2*e)},getImageCanvasContext(d){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=d.width,e.height=d.height,n.drawImage(d,0,0,d.width,d.height),n},resolveURL:d=>(X||(X=document.createElement("a")),X.href=d,X.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ce==null&&(ce=matchMedia("(prefers-reduced-motion: reduce)")),ce.matches)}};class Q{static testProp(e){if(!Q.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in Q.docStyle)return e[n];return e[0]}static create(e,n,l){const h=window.document.createElement(e);return n!==void 0&&(h.className=n),l&&l.appendChild(h),h}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){Q.docStyle&&Q.selectProp&&(Q.userSelect=Q.docStyle[Q.selectProp],Q.docStyle[Q.selectProp]="none")}static enableDrag(){Q.docStyle&&Q.selectProp&&(Q.docStyle[Q.selectProp]=Q.userSelect)}static setTransform(e,n){e.style[Q.transformProp]=n}static addEventListener(e,n,l,h={}){e.addEventListener(n,l,"passive"in h?h:h.capture)}static removeEventListener(e,n,l,h={}){e.removeEventListener(n,l,"passive"in h?h:h.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",Q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Q.suppressClickInternal,!0)},0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,l){const h=n.boundingClientRect;return new c.P((l.clientX-h.left)/n.x-e.clientLeft,(l.clientY-h.top)/n.y-e.clientTop)}static mousePos(e,n){const l=Q.getScale(e);return Q.getPoint(e,l,n)}static touchPos(e,n){const l=[],h=Q.getScale(e);for(let m=0;m<n.length;m++)l.push(Q.getPoint(e,h,n[m]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const n=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),l=n.querySelectorAll("script");for(const h of l)h.remove();return Q.clean(n),n.innerHTML}static isPossiblyDangerous(e,n){const l=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!l.includes("javascript:")&&!l.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const n=e.children;for(const l of n)Q.removeAttributes(l),Q.clean(l)}static removeAttributes(e){for(const{name:n,value:l}of e.attributes)Q.isPossiblyDangerous(n,l)&&e.removeAttribute(n)}}Q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Q.selectProp=Q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Q.transformProp=Q.testProp(["transform","WebkitTransform"]);const Ie={supported:!1,testSupport:function(d){!at&&St&&(Ct?Xe(d):Qe=d)}};let Qe,St,at=!1,Ct=!1;function Xe(d){const e=d.createTexture();d.bindTexture(d.TEXTURE_2D,e);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,St),d.isContextLost())return;Ie.supported=!0}catch{}d.deleteTexture(e),at=!0}var Je;typeof document<"u"&&(St=document.createElement("img"),St.onload=()=>{Qe&&Xe(Qe),Qe=null,Ct=!0},St.onerror=()=>{at=!0,Qe=null},St.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let e,n,l,h;d.resetRequestQueue=()=>{e=[],n=0,l=0,h={}},d.addThrottleControl=T=>{const A=l++;return h[A]=T,A},d.removeThrottleControl=T=>{delete h[T],y()},d.getImage=(T,A,z=!0)=>new Promise((O,L)=>{Ie.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),c.e(T,{type:"image"}),e.push({abortController:A,requestParameters:T,supportImageRefresh:z,state:"queued",onError:N=>{L(N)},onSuccess:N=>{O(N)}}),y()});const m=T=>c._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:A,supportImageRefresh:z,onError:O,onSuccess:L,abortController:N}=T,Z=z===!1&&!c.i(self)&&!c.g(A.url)&&(!A.headers||Object.keys(A.headers).reduce((re,oe)=>re&&oe==="accept",!0));n++;const ne=Z?b(A,N):c.m(A,N);try{const re=yield ne;delete T.abortController,T.state="completed",re.data instanceof HTMLImageElement||c.b(re.data)?L(re):re.data&&L({data:yield(ie=re.data,typeof createImageBitmap=="function"?c.f(ie):c.h(ie)),cacheControl:re.cacheControl,expires:re.expires})}catch(re){delete T.abortController,O(re)}finally{n--,y()}var ie}),y=()=>{const T=(()=>{for(const A of Object.keys(h))if(h[A]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let A=n;A<T&&e.length>0;A++){const z=e.shift();z.abortController.signal.aborted?A--:m(z)}},b=(T,A)=>new Promise((z,O)=>{const L=new Image,N=T.url,Z=T.credentials;Z&&Z==="include"?L.crossOrigin="use-credentials":(Z&&Z==="same-origin"||!c.d(N))&&(L.crossOrigin="anonymous"),A.signal.addEventListener("abort",()=>{L.src="",O(c.c())}),L.fetchPriority="high",L.onload=()=>{L.onerror=L.onload=null,z({data:L})},L.onerror=()=>{L.onerror=L.onload=null,A.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},L.src=N})}(Je||(Je={})),Je.resetRequestQueue();class nt{constructor(e){this._transformRequestFn=e}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Ye(d){const e=[];if(typeof d=="string")e.push({id:"default",url:d});else if(d&&d.length>0){const n=[];for(const{id:l,url:h}of d){const m=`${l}${h}`;n.indexOf(m)===-1&&(n.push(m),e.push({id:l,url:h}))}}return e}function vt(d,e,n){try{const l=new URL(d);return l.pathname+=`${e}${n}`,l.toString()}catch{throw new Error(`Invalid sprite URL "${d}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Nt(d){const{userImage:e}=d;return!!(e&&e.render&&e.render())&&(d.data.replace(new Uint8Array(e.data.buffer)),!0)}class Jt extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:l}of this.requestors)l(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const l=n.spriteData;n.data=new c.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let l=!0;const h=n.data||n.spriteData;return this._validateStretch(n.stretchX,h&&h.width)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(n.stretchY,h&&h.height)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(n.content,n)||(this.fire(new c.k(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,n){if(!e)return!0;let l=0;for(const h of e){if(h[0]<l||h[1]<h[0]||n<h[1])return!1;l=h[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const l=n.spriteData,h=l&&l.width||n.data.width,m=l&&l.height||n.data.height;return!(e[0]<0||h<e[0]||e[1]<0||m<e[1]||e[2]<0||h<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,l=!0){const h=this.getImage(e);if(l&&(h.data.width!==n.data.width||h.data.height!==n.data.height))throw new Error(`size mismatch between old image (${h.data.width}x${h.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=h.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((n,l)=>{let h=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(h=!1);this.isLoaded()||h?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})})}_getImagesForIds(e){const n={};for(const l of e){let h=this.getImage(l);h||(this.fire(new c.l("styleimagemissing",{id:l})),h=this.getImage(l)),h?n[l]={data:h.data.clone(),pixelRatio:h.pixelRatio,sdf:h.sdf,version:h.version,stretchX:h.stretchX,stretchY:h.stretchY,content:h.content,textFitWidth:h.textFitWidth,textFitHeight:h.textFitHeight,hasRenderCallback:!!(h.userImage&&h.userImage.render)}:c.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],l=this.getImage(e);if(!l)return null;if(n&&n.position.version===l.version)return n.position;if(n)n.position.version=l.version;else{const h={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new c.I(h,l);this.patterns[e]={bin:h,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:n,h:l}=c.p(e),h=this.atlasImage;h.resize({width:n||1,height:l||1});for(const m in this.patterns){const{bin:y}=this.patterns[m],b=y.x+1,T=y.y+1,A=this.getImage(m).data,z=A.width,O=A.height;c.R.copy(A,h,{x:0,y:0},{x:b,y:T},{width:z,height:O}),c.R.copy(A,h,{x:0,y:O-1},{x:b,y:T-1},{width:z,height:1}),c.R.copy(A,h,{x:0,y:0},{x:b,y:T+O},{width:z,height:1}),c.R.copy(A,h,{x:z-1,y:0},{x:b-1,y:T},{width:1,height:O}),c.R.copy(A,h,{x:0,y:0},{x:b+z,y:T},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const l=this.getImage(n);l||c.w(`Image with ID: "${n}" was not found`),Nt(l)&&this.updateImage(n,l)}}}const Lt=1e20;function _i(d,e,n,l,h,m,y,b,T){for(let A=e;A<e+l;A++)ni(d,n*m+A,m,h,y,b,T);for(let A=n;A<n+h;A++)ni(d,A*m+e,1,l,y,b,T)}function ni(d,e,n,l,h,m,y){m[0]=0,y[0]=-Lt,y[1]=Lt,h[0]=d[e];for(let b=1,T=0,A=0;b<l;b++){h[b]=d[e+b*n];const z=b*b;do{const O=m[T];A=(h[b]-h[O]+z-O*O)/(b-O)/2}while(A<=y[T]&&--T>-1);T++,m[T]=b,y[T]=A,y[T+1]=Lt}for(let b=0,T=0;b<l;b++){for(;y[T+1]<b;)T++;const A=m[T],z=b-A;d[e+b*n]=h[A]+z*z}}class Ci{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return c._(this,void 0,void 0,function*(){const n=[];for(const m in e)for(const y of e[m])n.push(this._getAndCacheGlyphsPromise(m,y));const l=yield Promise.all(n),h={};for(const{stack:m,id:y,glyph:b}of l)h[m]||(h[m]={}),h[m][y]=b&&{id:b.id,bitmap:b.bitmap.clone(),metrics:b.metrics};return h})}_getAndCacheGlyphsPromise(e,n){return c._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let h=l.glyphs[n];if(h!==void 0)return{stack:e,id:n,glyph:h};if(h=this._tinySDF(l,e,n),h)return l.glyphs[n]=h,{stack:e,id:n,glyph:h};const m=Math.floor(n/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:e,id:n,glyph:h};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const b=Ci.loadGlyphRange(e,m,this.url,this.requestManager);l.requests[m]=b}const y=yield l.requests[m];for(const b in y)this._doesCharSupportLocalGlyph(+b)||(l.glyphs[+b]=y[+b]);return l.ranges[m]=!0,{stack:e,id:n,glyph:y[n]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||c.u["CJK Unified Ideographs"](e)||c.u["Hangul Syllables"](e)||c.u.Hiragana(e)||c.u.Katakana(e)||c.u["CJK Symbols and Punctuation"](e)||c.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,n,l){const h=this.localIdeographFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let b="400";/bold/i.test(n)?b="900":/medium/i.test(n)?b="500":/light/i.test(n)&&(b="200"),m=e.tinySDF=new Ci.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:b})}const y=m.draw(String.fromCharCode(l));return{id:l,bitmap:new c.q({width:y.width||60,height:y.height||60},y.data),metrics:{width:y.glyphWidth/2||24,height:y.glyphHeight/2||24,left:y.glyphLeft/2+.5||0,top:y.glyphTop/2-27.5||-8,advance:y.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ci.loadGlyphRange=function(d,e,n,l){return c._(this,void 0,void 0,function*(){const h=256*e,m=h+255,y=l.transformRequest(n.replace("{fontstack}",d).replace("{range}",`${h}-${m}`),"Glyphs"),b=yield c.n(y,new AbortController);if(!b||!b.data)throw new Error(`Could not load glyph range. range: ${e}, ${h}-${m}`);const T={};for(const A of c.o(b.data))T[A.id]=A;return T})},Ci.TinySDF=class{constructor({fontSize:d=24,buffer:e=3,radius:n=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=n;const b=this.size=d+4*e,T=this._createCanvas(b),A=this.ctx=T.getContext("2d",{willReadFrequently:!0});A.font=`${y} ${m} ${d}px ${h}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(d){const e=document.createElement("canvas");return e.width=e.height=d,e}draw(d){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(d),y=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-h))),T=Math.min(this.size-this.buffer,y+Math.ceil(l)),A=b+2*this.buffer,z=T+2*this.buffer,O=Math.max(A*z,0),L=new Uint8ClampedArray(O),N={data:L,width:A,height:z,glyphWidth:b,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(b===0||T===0)return N;const{ctx:Z,buffer:ne,gridInner:ie,gridOuter:re}=this;Z.clearRect(ne,ne,b,T),Z.fillText(d,ne,ne+y);const oe=Z.getImageData(ne,ne,b,T);re.fill(Lt,0,O),ie.fill(0,0,O);for(let fe=0;fe<T;fe++)for(let le=0;le<b;le++){const ge=oe.data[4*(fe*b+le)+3]/255;if(ge===0)continue;const ve=(fe+ne)*A+le+ne;if(ge===1)re[ve]=0,ie[ve]=Lt;else{const ue=.5-ge;re[ve]=ue>0?ue*ue:0,ie[ve]=ue<0?ue*ue:0}}_i(re,0,0,A,z,A,this.f,this.v,this.z),_i(ie,ne,ne,b,T,A,this.f,this.v,this.z);for(let fe=0;fe<O;fe++){const le=Math.sqrt(re[fe])-Math.sqrt(ie[fe]);L[fe]=Math.round(255-255*(le/this.radius+this.cutoff))}return N}};class Tn{constructor(){this.specification=c.v.light.position}possiblyEvaluate(e,n){return c.B(e.expression.evaluate(n))}interpolate(e,n,l){return{x:c.C.number(e.x,n.x,l),y:c.C.number(e.y,n.y,l),z:c.C.number(e.z,n.z,l)}}}let ki;class We extends c.E{constructor(e){super(),ki=ki||new c.r({anchor:new c.D(c.v.light.anchor),position:new Tn,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.t(ki),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(c.x,e,n))for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l){return(!l||l.validate!==!1)&&c.y(this,e.call(c.z,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}const je=new c.r({"sky-color":new c.D(c.v.sky["sky-color"]),"horizon-color":new c.D(c.v.sky["horizon-color"]),"fog-color":new c.D(c.v.sky["fog-color"]),"fog-ground-blend":new c.D(c.v.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.v.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.v.sky["atmosphere-blend"])});class _t extends c.E{constructor(e){super(),this._transitionable=new c.t(je),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0))}setSky(e,n={}){if(!this._validate(c.G,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const h=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),h):this._transitionable.setValue(l,h)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,l={}){return l?.validate!==!1&&c.y(this,e.call(c.z,c.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:c.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class qt{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const l=e.join(",")+String(n);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,n)),this.dashEntry[l]}getDashRanges(e,n,l){const h=[];let m=e.length%2==1?-e[e.length-1]*l:0,y=e[0]*l,b=!0;h.push({left:m,right:y,isDash:b,zeroLength:e[0]===0});let T=e[0];for(let A=1;A<e.length;A++){b=!b;const z=e[A];m=T*l,T+=z,y=T*l,h.push({left:m,right:y,isDash:b,zeroLength:z===0})}return h}addRoundDash(e,n,l){const h=n/2;for(let m=-l;m<=l;m++){const y=this.width*(this.nextRow+l+m);let b=0,T=e[b];for(let A=0;A<this.width;A++){A/T.right>1&&(T=e[++b]);const z=Math.abs(A-T.left),O=Math.abs(A-T.right),L=Math.min(z,O);let N;const Z=m/l*(h+1);if(T.isDash){const ne=h-Math.abs(Z);N=Math.sqrt(L*L+ne*ne)}else N=h-Math.sqrt(L*L+Z*Z);this.data[y+A]=Math.max(0,Math.min(255,N+128))}}}addRegularDash(e){for(let b=e.length-1;b>=0;--b){const T=e[b],A=e[b+1];T.zeroLength?e.splice(b,1):A&&A.isDash===T.isDash&&(A.left=T.left,e.splice(b,1))}const n=e[0],l=e[e.length-1];n.isDash===l.isDash&&(n.left=l.left-this.width,l.right=n.right+this.width);const h=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const T=Math.abs(b-y.left),A=Math.abs(b-y.right),z=Math.min(T,A);this.data[h+b]=Math.max(0,Math.min(255,(y.isDash?z:-z)+128))}}addDash(e,n){const l=n?7:0,h=2*l+1;if(this.nextRow+h>this.height)return c.w("LineAtlas out of space"),null;let m=0;for(let b=0;b<e.length;b++)m+=e[b];if(m!==0){const b=this.width/m,T=this.getDashRanges(e,this.width,b);n?this.addRoundDash(T,b,l):this.addRegularDash(T)}const y={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=h,this.dirty=!0,y}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const ye="maplibre_preloaded_worker_pool";class He{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<He.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ye]}numActive(){return Object.keys(this.active).length}}const ot=Math.floor(K.hardwareConcurrency/2);let dt,At;function Ht(){return dt||(dt=new He),dt}He.workerCount=c.H(globalThis)?Math.max(Math.min(ot,3),1):1;class Ft{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const l=this.workerPool.acquire(n);for(let h=0;h<l.length;h++){const m=new c.J(l[h],n);m.name=`Worker ${h}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const l=[];for(const h of this.actors)l.push(h.sendAsync({type:e,data:n}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(n=>{n.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const l of this.actors)l.registerMessageHandler(e,n)}}function Yi(){return At||(At=new Ft(Ht(),c.K),At.registerMessageHandler("GR",(d,e,n)=>c.m(e,n))),At}function Mi(d,e){const n=c.L();return c.M(n,n,[1,1,0]),c.N(n,n,[.5*d.width,.5*d.height,1]),d.calculatePosMatrix?c.O(n,n,d.calculatePosMatrix(e.toUnwrapped())):n}function Ki(d,e,n,l,h,m,y){var b;const T=function(L,N,Z){if(L)for(const ne of L){const ie=N[ne];if(ie&&ie.source===Z&&ie.type==="fill-extrusion")return!0}else for(const ne in N){const ie=N[ne];if(ie.source===Z&&ie.type==="fill-extrusion")return!0}return!1}((b=h?.layers)!==null&&b!==void 0?b:null,e,d.id),A=m.maxPitchScaleFactor(),z=d.tilesIn(l,A,T);z.sort(uo);const O=[];for(const L of z)O.push({wrappedTileID:L.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(e,n,d._state,L.queryGeometry,L.cameraQueryGeometry,L.scale,h,m,A,Mi(d.transform,L.tileID),y?(N,Z)=>y(L.tileID,N,Z):void 0)});return function(L,N){for(const Z in L)for(const ne of L[Z])cr(ne,N);return L}(function(L){const N={},Z={};for(const ne of L){const ie=ne.queryResults,re=ne.wrappedTileID,oe=Z[re]=Z[re]||{};for(const fe in ie){const le=ie[fe],ge=oe[fe]=oe[fe]||{},ve=N[fe]=N[fe]||[];for(const ue of le)ge[ue.featureIndex]||(ge[ue.featureIndex]=!0,ve.push(ue))}}return N}(O),d)}function uo(d,e){const n=d.tileID,l=e.tileID;return n.overscaledZ-l.overscaledZ||n.canonical.y-l.canonical.y||n.wrap-l.wrap||n.canonical.x-l.canonical.x}function cr(d,e){const n=d.feature,l=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=l}function ho(d,e,n){return c._(this,void 0,void 0,function*(){let l=d;if(d.url?l=(yield c.j(e.transformRequest(d.url,"Source"),n)).data:yield K.frameAsync(n),!l)return null;const h=c.Q(c.e(l,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(h.vectorLayerIds=l.vector_layers.map(m=>m.id)),h})}class rn{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof c.S?new c.S(e.lng,e.lat):c.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof c.S?new c.S(e.lng,e.lat):c.S.convert(e),this}extend(e){const n=this._sw,l=this._ne;let h,m;if(e instanceof c.S)h=e,m=e;else{if(!(e instanceof rn))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(rn.convert(e)):this.extend(c.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(c.S.convert(e)):this;if(h=e._sw,m=e._ne,!h||!m)return this}return n||l?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new c.S(h.lng,h.lat),this._ne=new c.S(m.lng,m.lat)),this}getCenter(){return new c.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.S(this.getWest(),this.getNorth())}getSouthEast(){return new c.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:l}=c.S.convert(e);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return e instanceof rn?e:e&&new rn(e)}static fromLngLat(e,n=0){const l=360*n/40075017,h=l/Math.cos(Math.PI/180*e.lat);return new rn(new c.S(e.lng-h,e.lat-l),new c.S(e.lng+h,e.lat+l))}adjustAntiMeridian(){const e=new c.S(this._sw.lng,this._sw.lat),n=new c.S(this._ne.lng,this._ne.lat);return new rn(e,e.lng>n.lng?new c.S(n.lng+360,n.lat):n)}}class ta{constructor(e,n,l){this.bounds=rn.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),l=Math.floor(c.V(this.bounds.getWest())*n),h=Math.floor(c.U(this.bounds.getNorth())*n),m=Math.ceil(c.V(this.bounds.getEast())*n),y=Math.ceil(c.U(this.bounds.getSouth())*n);return e.x>=l&&e.x<m&&e.y>=h&&e.y<y}}class ia extends c.E{constructor(e,n,l,h){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.Q(n,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(h)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ho(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(c.e(this,e),e.bounds&&(this.tileBounds=new ta(e.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new c.k(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};l.request.collectResourceTiming=this._collectResourceTiming;let h="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,y)=>{e.reloadPromise={resolve:m,reject:y}})}else e.actor=this.dispatcher.getActor(),h="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:h,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class il extends c.E{constructor(e,n,l,h){super(),this.id=e,this.dispatcher=l,this.setEventedParent(h),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},n),c.e(this,c.Q(n,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,function*(e=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield ho(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(c.e(this,n),n.bounds&&(this.tileBounds=new ta(n.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(n){this._tileJSONRequest=null,this.fire(new c.k(n))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return c.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield Je.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&(l.cacheControl||l.expires)&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const h=this.map.painter.context,m=h.gl,y=l.data;e.texture=this.map.painter.getTileTexture(y.width),e.texture?e.texture.update(y,{useMipmap:!0}):(e.texture=new c.T(h,y,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class Wi extends il{constructor(e,n,l,h){super(e,n,l,h),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const h=yield Je.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(h&&h.data){const m=h.data;this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&e.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const y=c.b(m)&&c.W()?m:yield this.readImageNow(m),b={type:this.type,uid:e.uid,source:this.id,rawImageData:y,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const T=yield e.actor.sendAsync({type:"LDT",data:b});e.dem=T,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(h){if(delete e.abortController,e.aborted)e.state="unloaded";else if(h)throw e.state="errored",h}})}readImageNow(e){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.X()){const n=e.width+2,l=e.height+2;try{return new c.R({width:n,height:l},yield c.Y(e,-1,-1,n,l))}catch{}}return K.getImageData(e,1)})}_getNeighboringTiles(e){const n=e.canonical,l=Math.pow(2,n.z),h=(n.x-1+l)%l,m=n.x===0?e.wrap-1:e.wrap,y=(n.x+1+l)%l,b=n.x+1===l?e.wrap+1:e.wrap,T={};return T[new c.Z(e.overscaledZ,m,n.z,h,n.y).key]={backfilled:!1},T[new c.Z(e.overscaledZ,b,n.z,y,n.y).key]={backfilled:!1},n.y>0&&(T[new c.Z(e.overscaledZ,m,n.z,h,n.y-1).key]={backfilled:!1},T[new c.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},T[new c.Z(e.overscaledZ,b,n.z,y,n.y-1).key]={backfilled:!1}),n.y+1<l&&(T[new c.Z(e.overscaledZ,m,n.z,h,n.y+1).key]={backfilled:!1},T[new c.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},T[new c.Z(e.overscaledZ,b,n.z,y,n.y+1).key]={backfilled:!1}),T}unloadTile(e){return c._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Nr extends c.E{constructor(e,n,l,h){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(h),this._data=n.data,this._options=c.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:c.$,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:c.$,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(c.$/this.tileSize)}_getClusterMaxZoom(e){const n=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${n}"`),n}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return c._(this,void 0,void 0,function*(){const e=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map(n=>n.coordinates).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return c._(this,void 0,void 0,function*(){const e=new rn,n=yield this.getData();let l;switch(n.type){case"FeatureCollection":l=n.features.map(h=>this.getCoordinatesFromGeometry(h.geometry)).flat(1/0);break;case"Feature":l=this.getCoordinatesFromGeometry(n.geometry);break;default:l=this.getCoordinatesFromGeometry(n)}if(l.length==0)return e;for(let h=0;h<l.length-1;h+=2)e.extend([l[h],l[h+1]]);return e})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:l}})}_updateWorkerData(e){return c._(this,void 0,void 0,function*(){const n=c.e({type:this.type},this.workerOptions);e?n.dataDiff=e:typeof this._data=="string"?(n.request=this.map._requestManager.transformRequest(K.resolveURL(this._data),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.l("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:n});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));let h=null;l.resourceTiming&&l.resourceTiming[this.id]&&(h=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&h&&h.length>0&&c.e(m,{resourceTiming:h}),this.fire(new c.l("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return c._(this,void 0,void 0,function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const h=yield this.actor.sendAsync({type:n,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(h,this.map.painter,n==="RT")})}abortTile(e){return c._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return c._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class yr extends c.E{constructor(e,n,l,h){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=l,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(h),this.options=n}load(e){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield Je.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new c.k(n))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(c.a0.fromLngLat);var l;return this.tileID=function(h){const m=c.a1.fromPoints(h),y=m.width(),b=m.height(),T=Math.max(y,b),A=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),z=Math.pow(2,A);return new c.a3(A,Math.floor((m.minX+m.maxX)/2*z),Math.floor((m.minY+m.maxY)/2*z))}(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map(h=>this.tileID.getTilePoint(h)._round()),this.flippedWindingOrder=((l=this.tileCoords)[1].x-l[0].x)*(l[2].y-l[0].y)-(l[1].y-l[0].y)*(l[2].x-l[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new c.T(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:n,minY:l,maxX:h,maxY:m}=c.a1.fromPoints(e),y={};for(let b=0;b<=c.a2;b++){const T=Math.pow(2,b),A=Math.floor(n*T),z=Math.floor(l*T),O=Math.floor(h*T),L=Math.floor(m*T);y[b]={minTileX:A,minTileY:z,maxTileX:O,maxTileY:L}}return y}}class Rs extends yr{constructor(e,n,l,h){super(e,n,l,h),this.roundZoom=!0,this.type="video",this.options=n}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield c.a4(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new c.k(n))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new c.k(new c.a5(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let l=!1;for(const h in this.tiles){const m=this.tiles[h];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ba extends yr{constructor(e,n,l,h){super(e,n,l,h),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(y=>typeof y!="number"))||this.fire(new c.k(new c.a5(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.a5(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new c.k(new c.a5(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.a5(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.a5(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,l=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(n,this.canvas,l.RGBA,{premultiply:!0});let h=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const ql={},Is=d=>{switch(d){case"geojson":return Nr;case"image":return yr;case"raster":return il;case"raster-dem":return Wi;case"vector":return ia;case"video":return Rs;case"canvas":return ba}return ql[d]},ss="RTLPluginLoaded";class fo extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Yi()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(n=>{throw this.status="error",n})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return c._(this,arguments,void 0,function*(n,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=K.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(ss))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Fr=null;function an(){return Fr||(Fr=new fo),Fr}class tr{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=c.a6(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,m){const y={};if(!m)return y;for(const b of h){const T=b.layerIds.map(A=>m.getLayer(A)).filter(Boolean);if(T.length!==0){b.layers=T,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(A=>T.filter(z=>z.id===A)[0]));for(const A of T)y[A.id]=b}}return y}(e.buckets,n?.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof c.a8){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof c.a8&&m.hasRTLText){this.hasRTLText=!0,an().lazyLoad();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new c.a7}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,l,h,m,y,b,T,A,z,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:y,tileSize:this.tileSize,pixelPosMatrix:z,transform:T,params:b,queryPadding:this.queryPadding*A,getElevation:O},e,n,l):{}}querySourceFeatures(e,n){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=n&&n.sourceLayer?n.sourceLayer:"",y=h._geojsonTileLayer||h[m];if(!y)return;const b=c.a9(n&&n.filter),{z:T,x:A,y:z}=this.tileID.canonical,O={z:T,x:A,y:z};for(let L=0;L<y.length;L++){const N=y.feature(L);if(b.needGeometry){const ie=c.aa(N,!0);if(!b.filter(new c.F(this.tileID.overscaledZ),ie,this.tileID.canonical))continue}else if(!b.filter(new c.F(this.tileID.overscaledZ),N))continue;const Z=l.getId(N,m),ne=new c.ab(N,T,A,z,Z);ne.tile=O,e.push(ne)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const l=c.ac(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const m=this.expirationTime-n;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const h in this.buckets){if(!n.style.hasLayer(h))continue;const m=this.buckets[h],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=l[y],T=e[y];if(!b||!T||Object.keys(T).length===0)continue;m.update(T,b,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=n&&n.style&&n.style.getLayer(h);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<K.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=K.now()+e}setDependencies(e,n){const l={};for(const h of n)l[h]=!0;this.dependencies[e]=l}hasDependency(e,n){for(const l of e){const h=this.dependencies[l];if(h){for(const m of n)if(h[m])return!0}}return!1}}class ir{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const m={value:n,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const l=e.wrapped().key,h=n===void 0?0:this.data[l].indexOf(n),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||n.push(h);for(const l of n)this.remove(l.value.tileID,l)}}class Oc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,l){const h=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},c.e(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==h&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const m in this.state[e][h])l[m]||(this.deletedStates[e][h][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][m]===null&&delete this.deletedStates[e][h][m]}removeFeatureState(e,n,l){if(this.deletedStates[e]===null)return;const h=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&n!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,n){const l=String(n),h=c.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][n];if(m===null)return{};for(const y in m)delete h[y]}return h}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),c.e(this.state[h][y],this.stateChanges[h][y]),m[y]=this.state[h][y];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(this.deletedStates[h]===null)for(const y in this.state[h])m[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(this.deletedStates[h][y]===null)this.state[h][y]={};else for(const b of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][b];m[y]=this.state[h][y]}l[h]=l[h]||{},c.e(l[h],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,n)}}const os=89.25;function Ce(d,e){const n=c.ag(e.lat,-c.ah,c.ah);return new c.P(c.V(e.lng)*d,c.U(n)*d)}function H(d,e){return new c.a0(e.x/d,e.y/d).toLngLat()}function Y(d){return d.cameraToCenterDistance*Math.min(.85*Math.tan(c.ad(90-d.pitch)),Math.tan(c.ad(os-d.pitch)))}function te(d,e){const n=d.canonical,l=e/c.ae(n.z),h=n.x+Math.pow(2,n.z)*d.wrap,m=c.af(new Float64Array(16));return c.M(m,m,[h*l,n.y*l,0]),c.N(m,m,[l/c.$,l/c.$,1]),m}function he(d,e,n,l,h){const m=c.a0.fromLngLat(d,e),y=h*c.ai(1,d.lat),b=y*Math.cos(c.ad(n)),T=Math.sqrt(y*y-b*b),A=T*Math.sin(c.ad(-l)),z=T*Math.cos(c.ad(-l));return new c.a0(m.x+A,m.y+z,m.z+b)}function be(d,e,n){const l=e.intersectsFrustum(d);if(!n||l===0)return l;const h=e.intersectsPlane(n);return h===0?0:l===2&&h===2?2:1}function Ee(d,e,n){let l=0;const h=(n-e)/10;for(let m=0;m<10;m++)l+=h*Math.pow(Math.cos(e+(m+.5)/10*(n-e)),d);return l}function Le(d,e){return function(n,l,h,m,y){const b=2*((d-1)/c.aj(Math.cos(c.ad(os-y))/Math.cos(c.ad(os)))-1),T=Math.acos(h/m),A=2*Ee(b-1,0,c.ad(y/2)),z=Math.min(c.ad(os),T+c.ad(y/2)),O=Ee(b-1,Math.min(z,T-c.ad(y/2)),z),L=Math.atan(l/h),N=Math.hypot(l,h);let Z=n;return Z+=c.aj(m/N/Math.max(.5,Math.cos(c.ad(y/2)))),Z+=b*c.aj(Math.cos(L))/2,Z-=c.aj(Math.max(1,O/A/e))/2,Z}}const Se=Le(9.314,3);function qe(d,e){const n=(e.roundZoom?Math.round:Math.floor)(d.zoom+c.aj(d.tileSize/e.tileSize));return Math.max(0,n)}function Ue(d,e){const n=d.getCameraFrustum(),l=d.getClippingPlane(),h=d.screenPointToMercatorCoordinate(d.getCameraPoint()),m=c.a0.fromLngLat(d.center,d.elevation);h.z=m.z+Math.cos(d.pitchInRadians)*d.cameraToCenterDistance/d.worldSize;const y=d.getCoveringTilesDetailsProvider(),b=y.allowVariableZoom(d,e),T=qe(d,e),A=e.minzoom||0,z=e.maxzoom!==void 0?e.maxzoom:d.maxZoom,O=Math.min(Math.max(0,T),z),L=Math.pow(2,O),N=[L*h.x,L*h.y,0],Z=[L*m.x,L*m.y,0],ne=Math.hypot(m.x-h.x,m.y-h.y),ie=Math.abs(m.z-h.z),re=Math.hypot(ne,ie),oe=ge=>({zoom:0,x:0,y:0,wrap:ge,fullyVisible:!1}),fe=[],le=[];if(d.renderWorldCopies&&y.allowWorldCopies())for(let ge=1;ge<=3;ge++)fe.push(oe(-ge)),fe.push(oe(ge));for(fe.push(oe(0));fe.length>0;){const ge=fe.pop(),ve=ge.x,ue=ge.y;let Te=ge.fullyVisible;const Oe={x:ve,y:ue,z:ge.zoom},ze=y.getTileBoundingVolume(Oe,ge.wrap,d.elevation,e);if(!Te){const pt=be(n,ze,l);if(pt===0)continue;Te=pt===2}const Re=y.distanceToTile2d(h.x,h.y,Oe,ze);let Be=T;b&&(Be=(e.calculateTileZoom||Se)(d.zoom+c.aj(d.tileSize/e.tileSize),Re,ie,re,d.fov)),Be=(e.roundZoom?Math.round:Math.floor)(Be),Be=Math.max(0,Be);const gt=Math.min(Be,z);if(ge.wrap=y.getWrap(m,Oe,ge.wrap),ge.zoom>=gt){if(ge.zoom<A)continue;const pt=O-ge.zoom,it=N[0]-.5-(ve<<pt),Mt=N[1]-.5-(ue<<pt),ii=e.reparseOverscaled?Math.max(ge.zoom,Be):ge.zoom;le.push({tileID:new c.Z(ge.zoom===z?ii:ge.zoom,ge.wrap,ge.zoom,ve,ue),distanceSq:c.ak([Z[0]-.5-ve,Z[1]-.5-ue]),tileDistanceToCamera:Math.sqrt(it*it+Mt*Mt)})}else for(let pt=0;pt<4;pt++)fe.push({zoom:ge.zoom+1,x:(ve<<1)+pt%2,y:(ue<<1)+(pt>>1),wrap:ge.wrap,fullyVisible:Te})}return le.sort((ge,ve)=>ge.distanceSq-ve.distanceSq).map(ge=>ge.tileID)}const Ae=c.a1.fromPoints([new c.P(0,0),new c.P(c.$,c.$)]);class Ke extends c.E{constructor(e,n,l){super(),this.id=e,this.dispatcher=l,this.on("data",h=>this._dataHandler(h)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((h,m,y,b)=>{const T=new(Is(m.type))(h,m,y,b);if(T.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${T.id}`);return T})(e,n,l,this),this._tiles={},this._cache=new ir(0,h=>this._unloadTile(h)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Oc,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,l){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,l)}catch(h){e.state="errored",h.status!==404?this._source.fire(new c.k(h,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new c.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const l=this._tiles[n];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(xe).map(e=>e.key)}getRenderableIds(e){const n=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&n.push(this._tiles[l]);return e?n.sort((l,h)=>{const m=l.tileID,y=h.tileID,b=new c.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians),T=new c.P(y.canonical.x,y.canonical.y)._rotate(-this.transform.bearingInRadians);return m.overscaledZ-y.overscaledZ||T.y-b.y||T.x-b.x}).map(l=>l.tileID.key):n.map(l=>l.tileID).sort(xe).map(l=>l.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)e?this._reloadTile(n,"expired"):this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(e,n){return c._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=n),yield this._loadTile(l,e,n))})}_tileLoaded(e,n,l){e.timeAdded=K.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const m=n[h];if(e.neighboringTiles&&e.neighboringTiles[m]){const y=this.getTileByID(m);l(e,y),l(y,e)}}function l(h,m){h.needsHillshadePrepare=!0,h.needsTerrainPrepare=!0;let y=m.tileID.canonical.x-h.tileID.canonical.x;const b=m.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),A=m.tileID.key;y===0&&b===0||Math.abs(b)>1||(Math.abs(y)>1&&(Math.abs(y+T)===1?y+=T:Math.abs(y-T)===1&&(y-=T)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,y,b),h.neighboringTiles&&h.neighboringTiles[A]&&(h.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,l,h){for(const m in this._tiles){let y=this._tiles[m];if(h[m]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>l)continue;let b=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const A=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[A.key],y&&y.hasData()&&(b=A)}let T=b;for(;T.overscaledZ>n;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]||e[T.canonical.key]){h[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=n?l:null}for(let l=e.overscaledZ-1;l>=n;l--){const h=e.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,h=Math.floor(n*l*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(h,this._tiles[h])}}_updateCoveredAndRetainedTiles(e,n,l,h,m,y){const b={},T={},A=Object.keys(e),z=K.now();for(const O of A){const L=e[O],N=this._tiles[O];if(!N||N.fadeEndTime!==0&&N.fadeEndTime<=z)continue;const Z=this.findLoadedParent(L,n),ne=this.findLoadedSibling(L),ie=Z||ne||null;ie&&(this._addTile(ie.tileID),b[ie.tileID.key]=ie.tileID),T[O]=L}this._retainLoadedChildren(T,h,l,e);for(const O in b)e[O]||(this._coveredTiles[O]=!0,e[O]=b[O]);if(y){const O={},L={};for(const N of m)this._tiles[N.key].hasData()?O[N.key]=N:L[N.key]=N;for(const N in L){const Z=L[N].children(this._source.maxzoom);this._tiles[Z[0].key]&&this._tiles[Z[1].key]&&this._tiles[Z[2].key]&&this._tiles[Z[3].key]&&(O[Z[0].key]=e[Z[0].key]=Z[0],O[Z[1].key]=e[Z[1].key]=Z[1],O[Z[2].key]=e[Z[2].key]=Z[2],O[Z[3].key]=e[Z[3].key]=Z[3],delete L[N])}for(const N in L){const Z=L[N],ne=this.findLoadedParent(Z,this._source.minzoom),ie=this.findLoadedSibling(Z),re=ne||ie||null;if(re){O[re.tileID.key]=e[re.tileID.key]=re.tileID;for(const oe in O)O[oe].isChildOf(re.tileID)&&delete O[oe]}}for(const N in this._tiles)O[N]||(this._coveredTiles[N]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new c.Z(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y)):(l=Ue(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(l=l.filter(z=>this._source.hasTile(z)))):l=[];const h=qe(e,this._source),m=Math.max(h-Ke.maxOverzooming,this._source.minzoom),y=Math.max(h+Ke.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const z={};for(const O of l)if(O.canonical.z>this._source.minzoom){const L=O.scaledTo(O.canonical.z-1);z[L.key]=L;const N=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));z[N.key]=N}l=l.concat(Object.values(z))}const b=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,b&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(l,h);yt(this._source.type)&&this._updateCoveredAndRetainedTiles(T,m,y,h,l,n);for(const z in T)this._tiles[z].clearFadeHold();const A=c.al(this._tiles,T);for(const z of A){const O=this._tiles[z];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(z)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var l;const h={},m={},y=Math.max(n-Ke.maxOverzooming,this._source.minzoom),b=Math.max(n+Ke.maxUnderzooming,this._source.minzoom),T={};for(const A of e){const z=this._addTile(A);h[A.key]=A,z.hasData()||n<this._source.maxzoom&&(T[A.key]=A)}this._retainLoadedChildren(T,n,b,h);for(const A of e){let z=this._tiles[A.key];if(z.hasData())continue;if(n+1>this._source.maxzoom){const L=A.children(this._source.maxzoom)[0],N=this.getTile(L);if(N&&N.hasData()){h[L.key]=L;continue}}else{const L=A.children(this._source.maxzoom);if(h[L[0].key]&&h[L[1].key]&&h[L[2].key]&&h[L[3].key])continue}let O=z.wasRequested();for(let L=A.overscaledZ-1;L>=y;--L){const N=A.scaledTo(L);if(m[N.key])break;if(m[N.key]=!0,z=this.getTile(N),!z&&O&&(z=this._addTile(N)),z){const Z=z.hasData();if((Z||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||O)&&(h[N.key]=N),O=z.wasRequested(),Z)break}}}return h}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}n.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of n)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,l=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=l}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const l=n;return n||(n=new tr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,l||this._source.fire(new c.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=n.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}refreshTiles(e){for(const n in this._tiles)(this._isIdRenderable(n)||this._tiles[n].state=="errored")&&e.some(l=>l.equals(this._tiles[n].tileID.canonical))&&this._reloadTile(n,"expired")}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,l){const h=[],m=this.transform;if(!m)return h;const y=m.getCoveringTilesDetailsProvider().allowWorldCopies(),b=l?m.getCameraQueryGeometry(e):e,T=N=>m.screenPointToMercatorCoordinate(N,this.terrain),A=this.transformBbox(e,T,!y),z=this.transformBbox(b,T,!y),O=this.getIds(),L=c.a1.fromPoints(z);for(let N=0;N<O.length;N++){const Z=this._tiles[O[N]];if(Z.holdingForFade())continue;const ne=y?[Z.tileID]:[Z.tileID.unwrapTo(-1),Z.tileID.unwrapTo(0)],ie=Math.pow(2,m.zoom-Z.tileID.overscaledZ),re=n*Z.queryPadding*c.$/Z.tileSize/ie;for(const oe of ne){const fe=L.map(le=>oe.getTilePoint(new c.a0(le.x,le.y)));if(fe.expandBy(re),fe.intersects(Ae)){const le=A.map(ve=>oe.getTilePoint(ve)),ge=z.map(ve=>oe.getTilePoint(ve));h.push({tile:Z,tileID:y?oe:oe.unwrapTo(0),queryGeometry:le,cameraQueryGeometry:ge,scale:ie})}}}return h}transformBbox(e,n,l){let h=e.map(n);if(l){const m=c.a1.fromPoints(e);m.shrinkBy(.001*Math.min(m.width(),m.height()));const y=m.map(n);c.a1.fromPoints(h).covers(y)||(h=h.map(b=>b.x>.5?new c.a0(b.x-1,b.y,b.z):b))}return h}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);return this.transform&&this.transform.populateCache(n),n}hasTransition(){if(this._source.hasTransition())return!0;if(yt(this._source.type)){const e=K.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,l){this._state.updateState(e=e||"_geojsonTileLayer",n,l)}removeFeatureState(e,n,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,l)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,l){const h=this._tiles[e];h&&h.setDependencies(n,l)}reloadTilesForDependencies(e,n){for(const l in this._tiles)this._tiles[l].hasDependency(e,n)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,n))}}function xe(d,e){const n=Math.abs(2*d.wrap)-+(d.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return d.overscaledZ-e.overscaledZ||l-n||e.canonical.y-d.canonical.y||e.canonical.x-d.canonical.x}function yt(d){return d==="raster"||d==="image"||d==="video"}Ke.maxOverzooming=10,Ke.maxUnderzooming=3;class jt{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=c.ag(e,0,1);let n=1,l=this._distances[n];const h=e*this.paddedLength+this.padding;for(;l<h&&n<this._distances.length;)l=this._distances[++n];const m=n-1,y=this._distances[m],b=l-y,T=b>0?(h-y)/b:0;return this.points[m].mult(1-T).add(this.points[n].mult(T))}}function bt(d,e){let n=!0;return d==="always"||d!=="never"&&e!=="never"||(n=!1),n}class Rt{constructor(e,n,l){const h=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(n/l);for(let y=0;y<this.xCellCount*this.yCellCount;y++)h.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,l,h,m){this._forEachCell(n,l,h,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)}insertCircle(e,n,l,h){this._forEachCell(n-h,l-h,n+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(l),this.circles.push(h)}_insertBoxCell(e,n,l,h,m,y){this.boxCells[m].push(y)}_insertCircleCell(e,n,l,h,m,y){this.circleCells[m].push(y)}_query(e,n,l,h,m,y,b){if(l<0||e>this.width||h<0||n>this.height)return[];const T=[];if(e<=0&&n<=0&&this.width<=l&&this.height<=h){if(m)return[{key:null,x1:e,y1:n,x2:l,y2:h}];for(let A=0;A<this.boxKeys.length;A++)T.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const z=this.circles[3*A],O=this.circles[3*A+1],L=this.circles[3*A+2];T.push({key:this.circleKeys[A],x1:z-L,y1:O-L,x2:z+L,y2:O+L})}}else this._forEachCell(e,n,l,h,this._queryCell,T,{hitTest:m,overlapMode:y,seenUids:{box:{},circle:{}}},b);return T}query(e,n,l,h){return this._query(e,n,l,h,!1,null)}hitTest(e,n,l,h,m,y){return this._query(e,n,l,h,!0,m,y).length>0}hitTestCircle(e,n,l,h,m){const y=e-l,b=e+l,T=n-l,A=n+l;if(b<0||y>this.width||A<0||T>this.height)return!1;const z=[];return this._forEachCell(y,T,b,A,this._queryCellCircle,z,{hitTest:!0,overlapMode:h,circle:{x:e,y:n,radius:l},seenUids:{box:{},circle:{}}},m),z.length>0}_queryCell(e,n,l,h,m,y,b,T){const{seenUids:A,hitTest:z,overlapMode:O}=b,L=this.boxCells[m];if(L!==null){const Z=this.bboxes;for(const ne of L)if(!A.box[ne]){A.box[ne]=!0;const ie=4*ne,re=this.boxKeys[ne];if(e<=Z[ie+2]&&n<=Z[ie+3]&&l>=Z[ie+0]&&h>=Z[ie+1]&&(!T||T(re))&&(!z||!bt(O,re.overlapMode))&&(y.push({key:re,x1:Z[ie],y1:Z[ie+1],x2:Z[ie+2],y2:Z[ie+3]}),z))return!0}}const N=this.circleCells[m];if(N!==null){const Z=this.circles;for(const ne of N)if(!A.circle[ne]){A.circle[ne]=!0;const ie=3*ne,re=this.circleKeys[ne];if(this._circleAndRectCollide(Z[ie],Z[ie+1],Z[ie+2],e,n,l,h)&&(!T||T(re))&&(!z||!bt(O,re.overlapMode))){const oe=Z[ie],fe=Z[ie+1],le=Z[ie+2];if(y.push({key:re,x1:oe-le,y1:fe-le,x2:oe+le,y2:fe+le}),z)return!0}}}return!1}_queryCellCircle(e,n,l,h,m,y,b,T){const{circle:A,seenUids:z,overlapMode:O}=b,L=this.boxCells[m];if(L!==null){const Z=this.bboxes;for(const ne of L)if(!z.box[ne]){z.box[ne]=!0;const ie=4*ne,re=this.boxKeys[ne];if(this._circleAndRectCollide(A.x,A.y,A.radius,Z[ie+0],Z[ie+1],Z[ie+2],Z[ie+3])&&(!T||T(re))&&!bt(O,re.overlapMode))return y.push(!0),!0}}const N=this.circleCells[m];if(N!==null){const Z=this.circles;for(const ne of N)if(!z.circle[ne]){z.circle[ne]=!0;const ie=3*ne,re=this.circleKeys[ne];if(this._circlesCollide(Z[ie],Z[ie+1],Z[ie+2],A.x,A.y,A.radius)&&(!T||T(re))&&!bt(O,re.overlapMode))return y.push(!0),!0}}}_forEachCell(e,n,l,h,m,y,b,T){const A=this._convertToXCellCoord(e),z=this._convertToYCellCoord(n),O=this._convertToXCellCoord(l),L=this._convertToYCellCoord(h);for(let N=A;N<=O;N++)for(let Z=z;Z<=L;Z++)if(m.call(this,e,n,l,h,this.xCellCount*Z+N,y,b,T))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,l,h,m,y){const b=h-e,T=m-n,A=l+y;return A*A>b*b+T*T}_circleAndRectCollide(e,n,l,h,m,y,b){const T=(y-h)/2,A=Math.abs(e-(h+T));if(A>T+l)return!1;const z=(b-m)/2,O=Math.abs(n-(m+z));if(O>z+l)return!1;if(A<=T||O<=z)return!0;const L=A-T,N=O-z;return L*L+N*N<=l*l}}function Bt(d,e,n){const l=c.L();if(!d){const{vecSouth:O,vecEast:L}=ri(e),N=se();N[0]=L[0],N[1]=L[1],N[2]=O[0],N[3]=O[1],h=N,(z=(y=(m=N)[0])*(A=m[3])-(T=m[2])*(b=m[1]))&&(h[0]=A*(z=1/z),h[1]=-b*z,h[2]=-T*z,h[3]=y*z),l[0]=N[0],l[1]=N[1],l[4]=N[2],l[5]=N[3]}var h,m,y,b,T,A,z;return c.N(l,l,[1/n,1/n,1]),l}function ai(d,e,n,l){if(d){const h=c.L();if(!e){const{vecSouth:m,vecEast:y}=ri(n);h[0]=y[0],h[1]=y[1],h[4]=m[0],h[5]=m[1]}return c.N(h,h,[l,l,1]),h}return n.pixelsToClipSpaceMatrix}function ri(d){const e=Math.cos(d.rollInRadians),n=Math.sin(d.rollInRadians),l=Math.cos(d.pitchInRadians),h=Math.cos(d.bearingInRadians),m=Math.sin(d.bearingInRadians),y=c.aq();y[0]=-h*l*n-m*e,y[1]=-m*l*n+h*e;const b=c.ar(y);b<1e-9?c.as(y):c.at(y,y,1/b);const T=c.aq();T[0]=h*l*e-m*n,T[1]=m*l*e+h*n;const A=c.ar(T);return A<1e-9?c.as(T):c.at(T,T,1/A),{vecEast:T,vecSouth:y}}function fi(d,e,n,l){let h;l?(h=[d,e,l(d,e),1],c.av(h,h,n)):(h=[d,e,0,1],Ds(h,h,n));const m=h[3];return{point:new c.P(h[0]/m,h[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function Ut(d,e){return .5+d/e*.5}function di(d,e){return d.x>=-e[0]&&d.x<=e[0]&&d.y>=-e[1]&&d.y<=e[1]}function Yn(d,e,n,l,h,m,y,b,T,A,z,O,L){const N=n?d.textSizeData:d.iconSizeData,Z=c.am(N,e.transform.zoom),ne=[256/e.width*2+1,256/e.height*2+1],ie=n?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;ie.clear();const re=d.lineVertexArray,oe=n?d.text.placedSymbolArray:d.icon.placedSymbolArray,fe=e.transform.width/e.transform.height;let le=!1;for(let ge=0;ge<oe.length;ge++){const ve=oe.get(ge);if(ve.hidden||ve.writingMode===c.an.vertical&&!le){ls(ve.numGlyphs,ie);continue}le=!1;const ue=new c.P(ve.anchorX,ve.anchorY),Te={getElevation:L,pitchedLabelPlaneMatrix:l,lineVertexArray:re,pitchWithMap:m,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ue,unwrappedTileID:T,width:A,height:z,translation:O},Oe=Ot(ve.anchorX,ve.anchorY,Te);if(!di(Oe.point,ne)){ls(ve.numGlyphs,ie);continue}const ze=Ut(e.transform.cameraToCenterDistance,Oe.signedDistanceFromCamera),Re=c.ao(N,Z,ve),Be=m?Re*e.transform.getPitchedTextCorrection(ve.anchorX,ve.anchorY,T)/ze:Re*ze,gt=Qi({projectionContext:Te,pitchedLabelPlaneMatrixInverse:h,symbol:ve,fontSize:Be,flip:!1,keepUpright:y,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:fe,rotateToLine:b});le=gt.useVertical,(gt.notEnoughRoom||le||gt.needsFlipping&&Qi({projectionContext:Te,pitchedLabelPlaneMatrixInverse:h,symbol:ve,fontSize:Be,flip:!0,keepUpright:y,glyphOffsetArray:d.glyphOffsetArray,dynamicLayoutVertexArray:ie,aspectRatio:fe,rotateToLine:b}).notEnoughRoom)&&ls(ve.numGlyphs,ie)}n?d.text.dynamicLayoutVertexBuffer.updateData(ie):d.icon.dynamicLayoutVertexBuffer.updateData(ie)}function ft(d,e,n,l,h,m,y,b){const T=m.glyphStartIndex+m.numGlyphs,A=m.lineStartIndex,z=m.lineStartIndex+m.lineLength,O=e.getoffsetX(m.glyphStartIndex),L=e.getoffsetX(T-1),N=ur(d*O,n,l,h,m.segment,A,z,b,y);if(!N)return null;const Z=ur(d*L,n,l,h,m.segment,A,z,b,y);return Z?b.projectionCache.anyProjectionOccluded?null:{first:N,last:Z}:null}function Sn(d,e,n,l){return d===c.an.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*l?{useVertical:!0}:(d===c.an.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function Qi(d){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:n,symbol:l,fontSize:h,flip:m,keepUpright:y,glyphOffsetArray:b,dynamicLayoutVertexArray:T,aspectRatio:A,rotateToLine:z}=d,O=h/24,L=l.lineOffsetX*O,N=l.lineOffsetY*O;let Z;if(l.numGlyphs>1){const ne=l.glyphStartIndex+l.numGlyphs,ie=l.lineStartIndex,re=l.lineStartIndex+l.lineLength,oe=ft(O,b,L,N,m,l,z,e);if(!oe)return{notEnoughRoom:!0};const fe=Xt(oe.first.point.x,oe.first.point.y,e,n),le=Xt(oe.last.point.x,oe.last.point.y,e,n);if(y&&!m){const ge=Sn(l.writingMode,fe,le,A);if(ge)return ge}Z=[oe.first];for(let ge=l.glyphStartIndex+1;ge<ne-1;ge++){const ve=ur(O*b.getoffsetX(ge),L,N,m,l.segment,ie,re,e,z);if(!ve)return{notEnoughRoom:!0};Z.push(ve)}Z.push(oe.last)}else{if(y&&!m){const ie=mt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,re=l.lineStartIndex+l.segment+1,oe=new c.P(e.lineVertexArray.getx(re),e.lineVertexArray.gety(re)),fe=mt(oe.x,oe.y,e),le=fe.signedDistanceFromCamera>0?fe.point:jr(e.tileAnchorPoint,oe,ie,1,e),ge=Xt(ie.x,ie.y,e,n),ve=Xt(le.x,le.y,e,n),ue=Sn(l.writingMode,ge,ve,A);if(ue)return ue}const ne=ur(O*b.getoffsetX(l.glyphStartIndex),L,N,m,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,e,z);if(!ne||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Z=[ne]}for(const ne of Z)c.au(T,ne.point,ne.angle);return{}}function jr(d,e,n,l,h){const m=d.add(d.sub(e)._unit()),y=mt(m.x,m.y,h).point,b=n.sub(y);return n.add(b._mult(l/b.mag()))}function na(d,e,n){const l=e.projectionCache;if(l.projections[d])return l.projections[d];const h=new c.P(e.lineVertexArray.getx(d),e.lineVertexArray.gety(d)),m=mt(h.x,h.y,e);if(m.signedDistanceFromCamera>0)return l.projections[d]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const y=d-n.direction;return jr(n.distanceFromAnchor===0?e.tileAnchorPoint:new c.P(e.lineVertexArray.getx(y),e.lineVertexArray.gety(y)),h,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function mt(d,e,n){const l=d+n.translation[0],h=e+n.translation[1];let m;return n.pitchWithMap?(m=fi(l,h,n.pitchedLabelPlaneMatrix,n.getElevation),m.isOccluded=!1):(m=n.transform.projectTileCoordinates(l,h,n.unwrappedTileID,n.getElevation),m.point.x=(.5*m.point.x+.5)*n.width,m.point.y=(.5*-m.point.y+.5)*n.height),m}function Xt(d,e,n,l){if(n.pitchWithMap){const h=[d,e,0,1];return c.av(h,h,l),n.transform.projectTileCoordinates(h[0]/h[3],h[1]/h[3],n.unwrappedTileID,n.getElevation).point}return{x:d/n.width*2-1,y:1-e/n.height*2}}function Ot(d,e,n){return n.transform.projectTileCoordinates(d,e,n.unwrappedTileID,n.getElevation)}function Cr(d,e,n){return d._unit()._perp()._mult(e*n)}function $l(d,e,n,l,h,m,y,b,T){if(b.projectionCache.offsets[d])return b.projectionCache.offsets[d];const A=n.add(e);if(d+T.direction<l||d+T.direction>=h)return b.projectionCache.offsets[d]=A,A;const z=na(d+T.direction,b,T),O=Cr(z.sub(n),y,T.direction),L=n.add(O),N=z.add(O);return b.projectionCache.offsets[d]=c.aw(m,A,L,N)||A,b.projectionCache.offsets[d]}function ur(d,e,n,l,h,m,y,b,T){const A=l?d-e:d+e;let z=A>0?1:-1,O=0;l&&(z*=-1,O=Math.PI),z<0&&(O+=Math.PI);let L,N=z>0?m+h:m+h+1;b.projectionCache.cachedAnchorPoint?L=b.projectionCache.cachedAnchorPoint:(L=mt(b.tileAnchorPoint.x,b.tileAnchorPoint.y,b).point,b.projectionCache.cachedAnchorPoint=L);let Z,ne,ie=L,re=L,oe=0,fe=0;const le=Math.abs(A),ge=[];let ve;for(;oe+fe<=le;){if(N+=z,N<m||N>=y)return null;oe+=fe,re=ie,ne=Z;const Oe={absOffsetX:le,direction:z,distanceFromAnchor:oe,previousVertex:re};if(ie=na(N,b,Oe),n===0)ge.push(re),ve=ie.sub(re);else{let ze;const Re=ie.sub(re);ze=Re.mag()===0?Cr(na(N+z,b,Oe).sub(ie),n,z):Cr(Re,n,z),ne||(ne=re.add(ze)),Z=$l(N,ze,ie,m,y,ne,n,b,Oe),ge.push(ne),ve=Z.sub(ne)}fe=ve.mag()}const ue=ve._mult((le-oe)/fe)._add(ne||re),Te=O+Math.atan2(ie.y-re.y,ie.x-re.x);return ge.push(ue),{point:ue,angle:T?Te:0,path:ge}}const Yt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ls(d,e){for(let n=0;n<d;n++){const l=e.length;e.resize(l+4),e.float32.set(Yt,3*l)}}function Ds(d,e,n){const l=e[0],h=e[1];return d[0]=n[0]*l+n[4]*h+n[12],d[1]=n[1]*l+n[5]*h+n[13],d[3]=n[3]*l+n[7]*h+n[15],d}const xn=100;class Hl{constructor(e,n=new Rt(e.width+200,e.height+200,25),l=new Rt(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=l,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+xn,this.screenBottomBoundary=e.height+xn,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,l,h,m,y,b,T,A,z,O,L){const N=this.projectAndGetPerspectiveRatio(e.anchorPointX+T[0],e.anchorPointY+T[1],m,z,L),Z=l*N.perspectiveRatio;let ne;if(y||b)ne=this._projectCollisionBox(e,Z,h,m,y,b,T,N,z,O,L);else{const ve=N.x+(O?O.x*Z:0),ue=N.y+(O?O.y*Z:0);ne={allPointsOccluded:!1,box:[ve+e.x1*Z,ue+e.y1*Z,ve+e.x2*Z,ue+e.y2*Z]}}const[ie,re,oe,fe]=ne.box,le=y?ne.allPointsOccluded:N.isOccluded;let ge=le;return ge||(ge=N.perspectiveRatio<this.perspectiveRatioCutoff),ge||(ge=!this.isInsideGrid(ie,re,oe,fe)),ge||n!=="always"&&this.grid.hitTest(ie,re,oe,fe,n,A)?{box:[ie,re,oe,fe],placeable:!1,offscreen:!1,occluded:le}:{box:[ie,re,oe,fe],placeable:!0,offscreen:this.isOffscreen(ie,re,oe,fe),occluded:le}}placeCollisionCircles(e,n,l,h,m,y,b,T,A,z,O,L,N,Z){const ne=[],ie=new c.P(n.anchorX,n.anchorY),re=this.getPerspectiveRatio(ie.x,ie.y,y,Z),oe=(A?m*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,y)/re:m*re)/c.aA,fe={getElevation:Z,pitchedLabelPlaneMatrix:b,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ie,unwrappedTileID:y,width:this.transform.width,height:this.transform.height,translation:N},le=ft(oe,h,n.lineOffsetX*oe,n.lineOffsetY*oe,!1,n,!1,fe);let ge=!1,ve=!1,ue=!0;if(le){const Te=.5*O*re+L,Oe=new c.P(-100,-100),ze=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Re=new jt,Be=le.first,gt=le.last;let pt=[];for(let ii=Be.path.length-1;ii>=1;ii--)pt.push(Be.path[ii]);for(let ii=1;ii<gt.path.length;ii++)pt.push(gt.path[ii]);const it=2.5*Te;if(A){const ii=this.projectPathToScreenSpace(pt,fe);pt=ii.some(yi=>yi.signedDistanceFromCamera<=0)?[]:ii.map(yi=>yi.point)}let Mt=[];if(pt.length>0){const ii=pt[0].clone(),yi=pt[0].clone();for(let ln=1;ln<pt.length;ln++)ii.x=Math.min(ii.x,pt[ln].x),ii.y=Math.min(ii.y,pt[ln].y),yi.x=Math.max(yi.x,pt[ln].x),yi.y=Math.max(yi.y,pt[ln].y);Mt=ii.x>=Oe.x&&yi.x<=ze.x&&ii.y>=Oe.y&&yi.y<=ze.y?[pt]:yi.x<Oe.x||ii.x>ze.x||yi.y<Oe.y||ii.y>ze.y?[]:c.ax([pt],Oe.x,Oe.y,ze.x,ze.y)}for(const ii of Mt){Re.reset(ii,.25*Te);let yi=0;yi=Re.length<=.5*Te?1:Math.ceil(Re.paddedLength/it)+1;for(let ln=0;ln<yi;ln++){const Pi=ln/Math.max(yi-1,1),fn=Re.lerp(Pi),zi=fn.x+xn,Ri=fn.y+xn;ne.push(zi,Ri,Te,0);const Oi=zi-Te,Zn=Ri-Te,pi=zi+Te,qn=Ri+Te;if(ue=ue&&this.isOffscreen(Oi,Zn,pi,qn),ve=ve||this.isInsideGrid(Oi,Zn,pi,qn),e!=="always"&&this.grid.hitTestCircle(zi,Ri,Te,e,z)&&(ge=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ge}}}}return{circles:!T&&ge||!ve||re<this.perspectiveRatioCutoff?[]:ne,offscreen:ue,collisionDetected:ge}}projectPathToScreenSpace(e,n){const l=function(h,m){const y=c.L();return c.ap(y,m.pitchedLabelPlaneMatrix),h.map(b=>{const T=fi(b.x,b.y,y,m.getElevation),A=m.transform.projectTileCoordinates(T.point.x,T.point.y,m.unwrappedTileID,m.getElevation);return A.point.x=(.5*A.point.x+.5)*m.width,A.point.y=(.5*-A.point.y+.5)*m.height,A})}(e,n);return function(h){let m=0,y=0,b=0,T=0;for(let A=0;A<h.length;A++)h[A].isOccluded?(b=A+1,T=0):(T++,T>y&&(y=T,m=b));return h.slice(m,m+y)}(l)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],l=new c.a1;for(const O of e){const L=new c.P(O.x+xn,O.y+xn);l.extend(L),n.push(L)}const{minX:h,minY:m,maxX:y,maxY:b}=l,T=this.grid.query(h,m,y,b).concat(this.ignoredGrid.query(h,m,y,b)),A={},z={};for(const O of T){const L=O.key;if(A[L.bucketInstanceId]===void 0&&(A[L.bucketInstanceId]={}),A[L.bucketInstanceId][L.featureIndex])continue;const N=[new c.P(O.x1,O.y1),new c.P(O.x2,O.y1),new c.P(O.x2,O.y2),new c.P(O.x1,O.y2)];c.ay(n,N)&&(A[L.bucketInstanceId][L.featureIndex]=!0,z[L.bucketInstanceId]===void 0&&(z[L.bucketInstanceId]=[]),z[L.bucketInstanceId].push(L.featureIndex))}return z}insertCollisionBox(e,n,l,h,m,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,l,h,m,y){const b=l?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:m,collisionGroupID:y,overlapMode:n};for(let A=0;A<e.length;A+=4)b.insertCircle(T,e[A],e[A+1],e[A+2])}projectAndGetPerspectiveRatio(e,n,l,h,m){if(m){let y;h?(y=[e,n,h(e,n),1],c.av(y,y,m)):(y=[e,n,0,1],Ds(y,y,m));const b=y[3];return{x:(y[0]/b+1)/2*this.transform.width+xn,y:(-y[1]/b+1)/2*this.transform.height+xn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/b*.5,isOccluded:!1,signedDistanceFromCamera:b}}{const y=this.transform.projectTileCoordinates(e,n,l,h);return{x:(y.point.x+1)/2*this.transform.width+xn,y:(1-y.point.y)/2*this.transform.height+xn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y.signedDistanceFromCamera*.5,isOccluded:y.isOccluded,signedDistanceFromCamera:y.signedDistanceFromCamera}}}getPerspectiveRatio(e,n,l,h){const m=this.transform.projectTileCoordinates(e,n,l,h);return .5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5}isOffscreen(e,n,l,h){return l<xn||e>=this.screenRightBoundary||h<xn||n>this.screenBottomBoundary}isInsideGrid(e,n,l,h){return l>=0&&e<this.gridRightBoundary&&h>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=c.af([]);return c.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,l,h,m,y,b,T,A,z,O){let L=1,N=0,Z=0,ne=1;const ie=e.anchorPointX+b[0],re=e.anchorPointY+b[1];if(y&&!m){const pt=this.projectAndGetPerspectiveRatio(ie+1,re,h,A,O),it=pt.x-T.x,Mt=Math.atan((pt.y-T.y)/it)+(it<0?Math.PI:0),ii=Math.sin(Mt),yi=Math.cos(Mt);L=yi,N=ii,Z=-ii,ne=yi}else if(!y&&m){const pt=ri(this.transform);L=pt.vecEast[0],N=pt.vecEast[1],Z=pt.vecSouth[0],ne=pt.vecSouth[1]}let oe=T.x,fe=T.y,le=n;m&&(oe=ie,fe=re,le=Math.pow(2,-(this.transform.zoom-l.overscaledZ)),le*=this.transform.getPitchedTextCorrection(ie,re,h),z||(le*=c.ag(.5+T.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),z&&(oe+=L*z.x*le+Z*z.y*le,fe+=N*z.x*le+ne*z.y*le);const ge=e.x1*le,ve=e.x2*le,ue=(ge+ve)/2,Te=e.y1*le,Oe=e.y2*le,ze=(Te+Oe)/2,Re=[{offsetX:ge,offsetY:Te},{offsetX:ue,offsetY:Te},{offsetX:ve,offsetY:Te},{offsetX:ve,offsetY:ze},{offsetX:ve,offsetY:Oe},{offsetX:ue,offsetY:Oe},{offsetX:ge,offsetY:Oe},{offsetX:ge,offsetY:ze}];let Be=[];for(const{offsetX:pt,offsetY:it}of Re)Be.push(new c.P(oe+L*pt+Z*it,fe+N*pt+ne*it));let gt=!1;if(m){const pt=Be.map(it=>this.projectAndGetPerspectiveRatio(it.x,it.y,h,A,O));gt=pt.some(it=>!it.isOccluded),Be=pt.map(it=>new c.P(it.x,it.y))}else gt=!0;return{box:c.az(Be),allPointsOccluded:!gt}}}class Ls{constructor(e,n,l,h){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):h&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ra{constructor(e,n,l,h,m){this.text=new Ls(e?e.text:null,n,l,m),this.icon=new Ls(e?e.icon:null,n,h,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ur{constructor(e,n,l){this.text=e,this.icon=n,this.skipFade=l}}class vr{constructor(e,n,l,h,m){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=m}}class sn{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:l=>l.collisionGroupID===n}}return this.collisionGroups[e]}}function po(d,e,n,l,h){const{horizontalAlign:m,verticalAlign:y}=c.aG(d);return new c.P(-(m-.5)*e+l[0]*h,-(y-.5)*n+l[1]*h)}class mo{constructor(e,n,l,h,m){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new Hl(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new sn(h),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=m,m&&(m.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(l,h)=>n.getElevation(e,l,h):null}getBucketParts(e,n,l,h){const m=l.getBucket(n),y=l.latestFeatureIndex;if(!m||!y||n.id!==m.layerIds[0])return;const b=l.collisionBoxArray,T=m.layers[0].layout,A=m.layers[0].paint,z=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),O=l.tileSize/c.$,L=l.tileID.toUnwrapped(),N=T.get("text-rotation-alignment")==="map",Z=c.aB(l,1,this.transform.zoom),ne=c.aC(this.collisionIndex.transform,l,A.get("text-translate"),A.get("text-translate-anchor")),ie=c.aC(this.collisionIndex.transform,l,A.get("icon-translate"),A.get("icon-translate-anchor")),re=Bt(N,this.transform,Z);this.retainedQueryData[m.bucketInstanceId]=new vr(m.bucketInstanceId,y,m.sourceLayerIndex,m.index,l.tileID);const oe={bucket:m,layout:T,translationText:ne,translationIcon:ie,unwrappedTileID:L,pitchedLabelPlaneMatrix:re,scale:z,textPixelRatio:O,holdingForFade:l.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:c.am(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(h)for(const fe of m.sortKeyRanges){const{sortKey:le,symbolInstanceStart:ge,symbolInstanceEnd:ve}=fe;e.push({sortKey:le,symbolInstanceStart:ge,symbolInstanceEnd:ve,parameters:oe})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:oe})}attemptAnchorPlacement(e,n,l,h,m,y,b,T,A,z,O,L,N,Z,ne,ie,re,oe,fe,le){const ge=c.aD[e.textAnchor],ve=[e.textOffset0,e.textOffset1],ue=po(ge,l,h,ve,m),Te=this.collisionIndex.placeCollisionBox(n,L,T,A,z,b,y,ie,O.predicate,fe,ue,le);if((!oe||this.collisionIndex.placeCollisionBox(oe,L,T,A,z,b,y,re,O.predicate,fe,ue,le).placeable)&&Te.placeable){let Oe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID]&&this.prevPlacement.placements[N.crossTileID].text&&(Oe=this.prevPlacement.variableOffsets[N.crossTileID].anchor),N.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[N.crossTileID]={textOffset:ve,width:l,height:h,anchor:ge,textBoxScale:m,prevAnchor:Oe},this.markUsedJustification(Z,ge,N,ne),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,ne,N),this.placedOrientations[N.crossTileID]=ne),{shift:ue,placedGlyphBoxes:Te}}}placeLayerBucketPart(e,n,l){const{bucket:h,layout:m,translationText:y,translationIcon:b,unwrappedTileID:T,pitchedLabelPlaneMatrix:A,textPixelRatio:z,holdingForFade:O,collisionBoxArray:L,partiallyEvaluatedTextSize:N,collisionGroup:Z}=e.parameters,ne=m.get("text-optional"),ie=m.get("icon-optional"),re=c.aE(m,"text-overlap","text-allow-overlap"),oe=re==="always",fe=c.aE(m,"icon-overlap","icon-allow-overlap"),le=fe==="always",ge=m.get("text-rotation-alignment")==="map",ve=m.get("text-pitch-alignment")==="map",ue=m.get("icon-text-fit")!=="none",Te=m.get("symbol-z-order")==="viewport-y",Oe=oe&&(le||!h.hasIconData()||ie),ze=le&&(oe||!h.hasTextData()||ne);!h.collisionArrays&&L&&h.deserializeCollisionBoxes(L);const Re=this.retainedQueryData[h.bucketInstanceId].tileID,Be=this._getTerrainElevationFunc(Re),gt=this.transform.getFastPathSimpleProjectionMatrix(Re),pt=(it,Mt,ii)=>{var yi,ln;if(n[it.crossTileID])return;if(O)return void(this.placements[it.crossTileID]=new Ur(!1,!1,!1));let Pi=!1,fn=!1,zi=!0,Ri=null,Oi={box:null,placeable:!1,offscreen:null,occluded:!1},Zn={placeable:!1},pi=null,qn=null,or=null,Js=0,Ss=0,ha=0;Mt.textFeatureIndex?Js=Mt.textFeatureIndex:it.useRuntimeCollisionCircles&&(Js=it.featureIndex),Mt.verticalTextFeatureIndex&&(Ss=Mt.verticalTextFeatureIndex);const fa=Mt.textBox;if(fa){const lr=Gi=>{let Ii=c.an.horizontal;if(h.allowVerticalPlacement&&!Gi&&this.prevPlacement){const Jn=this.prevPlacement.placedOrientations[it.crossTileID];Jn&&(this.placedOrientations[it.crossTileID]=Jn,Ii=Jn,this.markUsedOrientation(h,Ii,it))}return Ii},da=(Gi,Ii)=>{if(h.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&Mt.verticalTextBox){for(const Jn of h.writingModes)if(Jn===c.an.vertical?(Oi=Ii(),Zn=Oi):Oi=Gi(),Oi&&Oi.placeable)break}else Oi=Gi()},Ms=it.textAnchorOffsetStartIndex,Uo=it.textAnchorOffsetEndIndex;if(Uo===Ms){const Gi=(Ii,Jn)=>{const mn=this.collisionIndex.placeCollisionBox(Ii,re,z,Re,T,ve,ge,y,Z.predicate,Be,void 0,gt);return mn&&mn.placeable&&(this.markUsedOrientation(h,Jn,it),this.placedOrientations[it.crossTileID]=Jn),mn};da(()=>Gi(fa,c.an.horizontal),()=>{const Ii=Mt.verticalTextBox;return h.allowVerticalPlacement&&it.numVerticalGlyphVertices>0&&Ii?Gi(Ii,c.an.vertical):{box:null,offscreen:null}}),lr(Oi&&Oi.placeable)}else{let Gi=c.aD[(ln=(yi=this.prevPlacement)===null||yi===void 0?void 0:yi.variableOffsets[it.crossTileID])===null||ln===void 0?void 0:ln.anchor];const Ii=(mn,bc,Hh)=>{const ou=mn.x2-mn.x1,Ja=mn.y2-mn.y1,Vo=it.textBoxScale,jn=ue&&fe==="never"?bc:null;let en=null,pr=re==="never"?1:2,lu="never";Gi&&pr++;for(let Mr=0;Mr<pr;Mr++){for(let ka=Ms;ka<Uo;ka++){const Pn=h.textAnchorOffsets.get(ka);if(Gi&&Pn.textAnchor!==Gi)continue;const to=this.attemptAnchorPlacement(Pn,mn,ou,Ja,Vo,ge,ve,z,Re,T,Z,lu,it,h,Hh,y,b,jn,Be);if(to&&(en=to.placedGlyphBoxes,en&&en.placeable))return Pi=!0,Ri=to.shift,en}Gi?Gi=null:lu=re}return l&&!en&&(en={box:this.collisionIndex.placeCollisionBox(fa,"always",z,Re,T,ve,ge,y,Z.predicate,Be,void 0,gt).box,offscreen:!1,placeable:!1,occluded:!1}),en};da(()=>Ii(fa,Mt.iconBox,c.an.horizontal),()=>{const mn=Mt.verticalTextBox;return h.allowVerticalPlacement&&(!Oi||!Oi.placeable)&&it.numVerticalGlyphVertices>0&&mn?Ii(mn,Mt.verticalIconBox,c.an.vertical):{box:null,occluded:!0,offscreen:null}}),Oi&&(Pi=Oi.placeable,zi=Oi.offscreen);const Jn=lr(Oi&&Oi.placeable);if(!Pi&&this.prevPlacement){const mn=this.prevPlacement.variableOffsets[it.crossTileID];mn&&(this.variableOffsets[it.crossTileID]=mn,this.markUsedJustification(h,mn.anchor,it,Jn))}}}if(pi=Oi,Pi=pi&&pi.placeable,zi=pi&&pi.offscreen,it.useRuntimeCollisionCircles){const lr=h.text.placedSymbolArray.get(it.centerJustifiedTextSymbolIndex),da=c.ao(h.textSizeData,N,lr),Ms=m.get("text-padding");qn=this.collisionIndex.placeCollisionCircles(re,lr,h.lineVertexArray,h.glyphOffsetArray,da,T,A,l,ve,Z.predicate,it.collisionCircleDiameter,Ms,y,Be),qn.circles.length&&qn.collisionDetected&&!l&&c.w("Collisions detected, but collision boxes are not shown"),Pi=oe||qn.circles.length>0&&!qn.collisionDetected,zi=zi&&qn.offscreen}if(Mt.iconFeatureIndex&&(ha=Mt.iconFeatureIndex),Mt.iconBox){const lr=da=>this.collisionIndex.placeCollisionBox(da,fe,z,Re,T,ve,ge,b,Z.predicate,Be,ue&&Ri?Ri:void 0,gt);Zn&&Zn.placeable&&Mt.verticalIconBox?(or=lr(Mt.verticalIconBox),fn=or.placeable):(or=lr(Mt.iconBox),fn=or.placeable),zi=zi&&or.offscreen}const eo=ne||it.numHorizontalGlyphVertices===0&&it.numVerticalGlyphVertices===0,Al=ie||it.numIconVertices===0;eo||Al?Al?eo||(fn=fn&&Pi):Pi=fn&&Pi:fn=Pi=fn&&Pi;const jo=fn&&or.placeable;if(Pi&&pi.placeable&&this.collisionIndex.insertCollisionBox(pi.box,re,m.get("text-ignore-placement"),h.bucketInstanceId,Zn&&Zn.placeable&&Ss?Ss:Js,Z.ID),jo&&this.collisionIndex.insertCollisionBox(or.box,fe,m.get("icon-ignore-placement"),h.bucketInstanceId,ha,Z.ID),qn&&Pi&&this.collisionIndex.insertCollisionCircles(qn.circles,re,m.get("text-ignore-placement"),h.bucketInstanceId,Js,Z.ID),l&&this.storeCollisionData(h.bucketInstanceId,ii,Mt,pi,or,qn),it.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(h.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[it.crossTileID]=new Ur((Pi||Oe)&&!pi?.occluded,(fn||ze)&&!or?.occluded,zi||h.justReloaded),n[it.crossTileID]=!0};if(Te){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const it=h.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Mt=it.length-1;Mt>=0;--Mt){const ii=it[Mt];pt(h.symbolInstances.get(ii),h.collisionArrays[ii],ii)}}else for(let it=e.symbolInstanceStart;it<e.symbolInstanceEnd;it++)pt(h.symbolInstances.get(it),h.collisionArrays[it],it);h.justReloaded=!1}storeCollisionData(e,n,l,h,m,y){if(l.textBox||l.iconBox){let b,T;this.collisionBoxArrays.has(e)?b=this.collisionBoxArrays.get(e):(b=new Map,this.collisionBoxArrays.set(e,b)),b.has(n)?T=b.get(n):(T={text:null,icon:null},b.set(n,T)),l.textBox&&(T.text=h.box),l.iconBox&&(T.icon=m.box)}if(y){let b=this.collisionCircleArrays[e];b===void 0&&(b=this.collisionCircleArrays[e]=[]);for(let T=0;T<y.circles.length;T+=4)b.push(y.circles[T+0]-xn),b.push(y.circles[T+1]-xn),b.push(y.circles[T+2]),b.push(y.collisionDetected?1:0)}}markUsedJustification(e,n,l,h){let m;m=h===c.an.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[c.aF(n)];const y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const b of y)b>=0&&(e.text.placedSymbolArray.get(b).crossTileID=m>=0&&b!==m?0:l.crossTileID)}markUsedOrientation(e,n,l){const h=n===c.an.horizontal||n===c.an.horizontalOnly?n:0,m=n===c.an.vertical?n:0,y=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const b of y)e.text.placedSymbolArray.get(b).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let l=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const h=n?n.symbolFadeChange(e):1,m=n?n.opacities:{},y=n?n.variableOffsets:{},b=n?n.placedOrientations:{};for(const T in this.placements){const A=this.placements[T],z=m[T];z?(this.opacities[T]=new ra(z,h,A.text,A.icon),l=l||A.text!==z.text.placed||A.icon!==z.icon.placed):(this.opacities[T]=new ra(null,h,A.text,A.icon,A.skipFade),l=l||A.text||A.icon)}for(const T in m){const A=m[T];if(!this.opacities[T]){const z=new ra(A,h,!1,!1);z.isHidden()||(this.opacities[T]=z,l=l||A.text.placed||A.icon.placed)}}for(const T in y)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=y[T]);for(const T in b)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=b[T]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const l={};for(const h of n){const m=h.getBucket(e);m&&h.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,h.tileID,l,h.collisionBoxArray)}}updateBucketOpacities(e,n,l,h){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],y=m.layout,b=new ra(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),A=y.get("icon-allow-overlap"),z=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),O=y.get("text-rotation-alignment")==="map",L=y.get("text-pitch-alignment")==="map",N=y.get("icon-text-fit")!=="none",Z=new ra(null,0,T&&(A||!e.hasIconData()||y.get("icon-optional")),A&&(T||!e.hasTextData()||y.get("text-optional")),!0);!e.collisionArrays&&h&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(h);const ne=(re,oe,fe)=>{for(let le=0;le<oe/4;le++)re.opacityVertexArray.emplaceBack(fe);re.hasVisibleVertices=re.hasVisibleVertices||fe!==Yl},ie=this.collisionBoxArrays.get(e.bucketInstanceId);for(let re=0;re<e.symbolInstances.length;re++){const oe=e.symbolInstances.get(re),{numHorizontalGlyphVertices:fe,numVerticalGlyphVertices:le,crossTileID:ge}=oe;let ve=this.opacities[ge];l[ge]?ve=b:ve||(ve=Z,this.opacities[ge]=ve),l[ge]=!0;const ue=oe.numIconVertices>0,Te=this.placedOrientations[oe.crossTileID],Oe=Te===c.an.vertical,ze=Te===c.an.horizontal||Te===c.an.horizontalOnly;if(fe>0||le>0){const Be=Xl(ve.text);ne(e.text,fe,Oe?Yl:Be),ne(e.text,le,ze?Yl:Be);const gt=ve.text.isHidden();[oe.rightJustifiedTextSymbolIndex,oe.centerJustifiedTextSymbolIndex,oe.leftJustifiedTextSymbolIndex].forEach(Mt=>{Mt>=0&&(e.text.placedSymbolArray.get(Mt).hidden=gt||Oe?1:0)}),oe.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(oe.verticalPlacedTextSymbolIndex).hidden=gt||ze?1:0);const pt=this.variableOffsets[oe.crossTileID];pt&&this.markUsedJustification(e,pt.anchor,oe,Te);const it=this.placedOrientations[oe.crossTileID];it&&(this.markUsedJustification(e,"left",oe,it),this.markUsedOrientation(e,it,oe))}if(ue){const Be=Xl(ve.icon),gt=!(N&&oe.verticalPlacedIconSymbolIndex&&Oe);oe.placedIconSymbolIndex>=0&&(ne(e.icon,oe.numIconVertices,gt?Be:Yl),e.icon.placedSymbolArray.get(oe.placedIconSymbolIndex).hidden=ve.icon.isHidden()),oe.verticalPlacedIconSymbolIndex>=0&&(ne(e.icon,oe.numVerticalIconVertices,gt?Yl:Be),e.icon.placedSymbolArray.get(oe.verticalPlacedIconSymbolIndex).hidden=ve.icon.isHidden())}const Re=ie&&ie.has(re)?ie.get(re):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Be=e.collisionArrays[re];if(Be){let gt=new c.P(0,0);if(Be.textBox||Be.verticalTextBox){let pt=!0;if(z){const it=this.variableOffsets[ge];it?(gt=po(it.anchor,it.width,it.height,it.textOffset,it.textBoxScale),O&&gt._rotate(L?-this.transform.bearingInRadians:this.transform.bearingInRadians)):pt=!1}if(Be.textBox||Be.verticalTextBox){let it;Be.textBox&&(it=Oe),Be.verticalTextBox&&(it=ze),nl(e.textCollisionBox.collisionVertexArray,ve.text.placed,!pt||it,Re.text,gt.x,gt.y)}}if(Be.iconBox||Be.verticalIconBox){const pt=!!(!ze&&Be.verticalIconBox);let it;Be.iconBox&&(it=pt),Be.verticalIconBox&&(it=!pt),nl(e.iconCollisionBox.collisionVertexArray,ve.icon.placed,it,Re.icon,N?gt.x:0,N?gt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const l=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function nl(d,e,n,l,h,m){l&&l.length!==0||(l=[0,0,0,0]);const y=l[0]-xn,b=l[1]-xn,T=l[2]-xn,A=l[3]-xn;d.emplaceBack(e?1:0,n?1:0,h||0,m||0,y,b),d.emplaceBack(e?1:0,n?1:0,h||0,m||0,T,b),d.emplaceBack(e?1:0,n?1:0,h||0,m||0,T,A),d.emplaceBack(e?1:0,n?1:0,h||0,m||0,y,A)}const go=Math.pow(2,25),cs=Math.pow(2,24),Vr=Math.pow(2,17),zu=Math.pow(2,16),Oh=Math.pow(2,9),us=Math.pow(2,8),Ru=Math.pow(2,1);function Xl(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const e=d.placed?1:0,n=Math.floor(127*d.opacity);return n*go+e*cs+n*Vr+e*zu+n*Oh+e*us+n*Ru+e}const Yl=0;class aa{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,l,h,m){const y=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(y,h,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((b,T)=>b.sortKey-T.sortKey));this._currentPartIndex<y.length;)if(n.placeLayerBucketPart(y[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class Bc{constructor(e,n,l,h,m,y,b,T){this.placement=new mo(e,n,y,b,T),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,n,l){const h=K.now(),m=()=>!this._forceFullPlacement&&K.now()-h>2;for(;this._currentPlacementIndex>=0;){const y=n[e[this._currentPlacementIndex]],b=this.placement.collisionIndex.transform.zoom;if(y.type==="symbol"&&(!y.minzoom||y.minzoom<=b)&&(!y.maxzoom||y.maxzoom>b)){if(this._inProgressLayer||(this._inProgressLayer=new aa(y)),this._inProgressLayer.continuePlacement(l[y.source],this.placement,this._showCollisionBoxes,y,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const _o=512/c.$/2;class Kl{constructor(e,n,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const h=new Map;for(let m=0;m<n.length;m++){const y=n.get(m),b=y.key,T=h.get(b);T?T.push(y):h.set(b,[y])}for(const[m,y]of h){const b={positions:y.map(T=>({x:Math.floor(T.anchorX*_o),y:Math.floor(T.anchorY*_o)})),crossTileIDs:y.map(T=>T.crossTileID)};if(b.positions.length>128){const T=new c.aH(b.positions.length,16,Uint16Array);for(const{x:A,y:z}of b.positions)T.add(A,z);T.finish(),delete b.positions,b.index=T}this._symbolsByKey[m]=b}}getScaledCoordinates(e,n){const{x:l,y:h,z:m}=this.tileID.canonical,{x:y,y:b,z:T}=n.canonical,A=_o/Math.pow(2,T-m),z=(b*c.$+e.anchorY)*A,O=h*c.$*_o;return{x:Math.floor((y*c.$+e.anchorX)*A-l*c.$*_o),y:Math.floor(z-O)}}findMatches(e,n,l){const h=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let m=0;m<e.length;m++){const y=e.get(m);if(y.crossTileID)continue;const b=this._symbolsByKey[y.key];if(!b)continue;const T=this.getScaledCoordinates(y,n);if(b.index){const A=b.index.range(T.x-h,T.y-h,T.x+h,T.y+h).sort();for(const z of A){const O=b.crossTileIDs[z];if(!l[O]){l[O]=!0,y.crossTileID=O;break}}}else if(b.positions)for(let A=0;A<b.positions.length;A++){const z=b.positions[A],O=b.crossTileIDs[A];if(Math.abs(z.x-T.x)<=h&&Math.abs(z.y-T.y)<=h&&!l[O]){l[O]=!0,y.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ks{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Iu{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const l in this.indexes){const h=this.indexes[l],m={};for(const y in h){const b=h[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+n),m[b.tileID.key]=b}this.indexes[l]=m}this.lng=e}addBucket(e,n,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<n.symbolInstances.length;m++)n.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const h=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const y=this.indexes[m];if(Number(m)>e.overscaledZ)for(const b in y){const T=y[b];T.tileID.isChildOf(e)&&T.findMatches(n.symbolInstances,e,h)}else{const b=y[e.scaledTo(Number(m)).key];b&&b.findMatches(n.symbolInstances,e,h)}}for(let m=0;m<n.symbolInstances.length;m++){const y=n.symbolInstances.get(m);y.crossTileID||(y.crossTileID=l.generate(),h[y.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Kl(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const l of n.getCrossTileIDsLists())for(const h of l)delete this.usedCrossTileIDs[e][h]}removeStaleBuckets(e){let n=!1;for(const l in this.indexes){const h=this.indexes[l];for(const m in h)e[h[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[m]),delete h[m],n=!0)}return n}}class Wl{constructor(){this.layerIndexes={},this.crossTileIDs=new ks,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,l){let h=this.layerIndexes[e.id];h===void 0&&(h=this.layerIndexes[e.id]=new Iu);let m=!1;const y={};h.handleWrapJump(l);for(const b of n){const T=b.getBucket(e);T&&e.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(b.tileID,T,this.crossTileIDs)&&(m=!0),y[T.bucketInstanceId]=!0)}return h.removeStaleBuckets(y)&&(m=!0),m}pruneUnusedLayers(e){const n={};e.forEach(l=>{n[l]=!0});for(const l in this.layerIndexes)n[l]||delete this.layerIndexes[l]}}var hs="void main() {fragColor=vec4(1.0);}";const Ua={prelude:ci(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:ci("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:ci("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:ci(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:ci(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ci(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ci(hs,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:ci(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ci("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ci("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:ci(hs,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:ci(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:ci(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:ci(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ci(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ci(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ci(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:ci(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ci(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ci(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:ci(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ci(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ci(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ci("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ci("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ci("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:ci("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:ci(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:ci("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ci(d,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/in ([\w]+) ([\w]+)/g),h=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=m?m.concat(h):h,b={};return{fragmentSource:d=d.replace(n,(T,A,z,O,L)=>(b[L]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
in ${z} ${O} ${L};
#else
uniform ${z} ${O} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${z} ${O} ${L} = u_${L};
#endif
`)),vertexSource:e=e.replace(n,(T,A,z,O,L)=>{const N=O==="float"?"vec2":"vec4",Z=L.match(/color/)?"color":N;return b[L]?A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${z} ${N} a_${L};
out ${z} ${O} ${L};
#else
uniform ${z} ${O} u_${L};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${z} ${O} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
#else
    ${z} ${O} ${L} = u_${L};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
in ${z} ${N} a_${L};
#else
uniform ${z} ${O} u_${L};
#endif
`:Z==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${z} ${O} ${L} = a_${L};
#else
    ${z} ${O} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${z} ${O} ${L} = unpack_mix_${Z}(a_${L}, u_${L}_t);
#else
    ${z} ${O} ${L} = u_${L};
#endif
`}),staticAttributes:l,staticUniforms:y}}class Va{constructor(e,n,l){this.vertexBuffer=e,this.indexBuffer=n,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var wa=c.aI([{name:"a_pos",type:"Int16",components:2}]);const yo="#define PROJECTION_MERCATOR",Du="mercator";class rl{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Du}get shaderDefine(){return yo}get shaderPreludeCode(){return Ua.projectionMercator}get vertexShaderPreludeCode(){return Ua.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aJ.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,l,h,m){if(this._cachedMesh)return this._cachedMesh;const y=new c.aK;y.emplaceBack(0,0),y.emplaceBack(c.$,0),y.emplaceBack(0,c.$),y.emplaceBack(c.$,c.$);const b=e.createVertexBuffer(y,wa.members),T=c.aL.simpleSegment(0,0,4,2),A=new c.aM;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3);const z=e.createIndexBuffer(A);return this._cachedMesh=new Va(b,z,T),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Ar{constructor(e=0,n=0,l=0,h=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=l,this.right=h}interpolate(e,n,l){return n.top!=null&&e.top!=null&&(this.top=c.C.number(e.top,n.top,l)),n.bottom!=null&&e.bottom!=null&&(this.bottom=c.C.number(e.bottom,n.bottom,l)),n.left!=null&&e.left!=null&&(this.left=c.C.number(e.left,n.left,l)),n.right!=null&&e.right!=null&&(this.right=c.C.number(e.right,n.right,l)),this}getCenter(e,n){const l=c.ag((this.left+e-this.right)/2,0,e),h=c.ag((this.top+n-this.bottom)/2,0,n);return new c.P(l,h)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Ar(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ta(d,e){if(!d.renderWorldCopies||d.lngRange)return;const n=e.lng-d.center.lng;e.lng+=n>180?-360:n<-180?360:0}function ti(d){return Math.max(0,Math.floor(d))}class Ga{constructor(e,n,l,h,m,y){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=h??0,this._maxPitch=m??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ti(this._zoom),this._scale=c.ae(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Ar,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,l){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=ti(this._zoom),this._scale=c.ae(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Ar(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!l&&e.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=c.aN(e,-180,180)*Math.PI/180;var l,h,m,y,b,T,A,z,O;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=se(),l=this._rotationMatrix,m=-this._bearingInRadians,y=(h=this._rotationMatrix)[0],b=h[1],T=h[2],A=h[3],z=Math.sin(m),O=Math.cos(m),l[0]=y*O+T*z,l[1]=b*O+A*z,l[2]=y*-z+T*O,l[3]=b*-z+A*O)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=c.ag(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const n=e/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.aO(this._fovInRadians)}setFov(e){e=c.ag(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=c.ad(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.getConstrained(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=c.ae(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,n){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,l){this._unmodified=!1,this._edgeInsets.interpolate(e,n,l),this._constrain(),this._calcMatrices()}resize(e,n,l=!0){this._width=e,this._height=n,l&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new rn([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-c.ah,c.ah])}getConstrained(e,n){return this._callbacks.getConstrained(e,n)}getCameraQueryGeometry(e,n){if(n.length===1)return[n[0],e];{const{minX:l,minY:h,maxX:m,maxY:y}=c.a1.fromPoints(n).extend(e);return[new c.P(l,h),new c.P(m,h),new c.P(m,y),new c.P(l,y),new c.P(l,h)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:l}=this.getConstrained(this.center,this.zoom);this.setCenter(n),this.setZoom(l),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=c.af(new Float64Array(16));c.N(e,e,[this._width/2,-this._height/2,1]),c.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=c.af(new Float64Array(16)),c.N(e,e,[1,-1,1]),c.M(e,e,[-1,-1,0]),c.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,l,h){const m=l!==void 0?l:this.bearing,y=h=h!==void 0?h:this.pitch,b=c.a0.fromLngLat(e,n),T=-Math.cos(c.ad(y)),A=Math.sin(c.ad(y)),z=A*Math.sin(c.ad(m)),O=-A*Math.cos(c.ad(m));let L=this.elevation;const N=n-L;let Z;T*N>=0||Math.abs(T)<.1?(Z=1e4,L=n+Z*T):Z=-N/T;let ne,ie,re=c.aP(1,b.y),oe=0;do{if(oe+=1,oe>10)break;ie=Z/re,ne=new c.a0(b.x+z*ie,b.y+O*ie),re=1/ne.meterInMercatorCoordinateUnits()}while(Math.abs(Z-ie*re)>1e-12);return{center:ne.toLngLat(),elevation:L,zoom:c.aj(this.height/2/Math.tan(this.fovInRadians/2)/ie/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=c.ai(1,this.center.lat)*this.worldSize,l=this.cameraToCenterDistance/n,h=c.a0.fromLngLat(this.center,this.elevation),m=he(this.center,this.elevation,this.pitch,this.bearing,l);this._elevation=e;const y=this.calculateCenterFromCameraLngLatAlt(m.toLngLat(),c.aP(m.z,h.y),this.bearing,this.pitch);this._elevation=y.elevation,this._center=y.center,this.setZoom(y.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=c.ai(1,this.center.lat)*this.worldSize;return he(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/c.$,1/n/c.$]}}class Ql{constructor(e,n){this.min=e,this.max=n,this.center=c.aQ([],c.aR([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],l=c.aS(this.min),h=c.aS(this.max);for(let m=0;m<n.length;m++)l[m]=n[m]?this.min[m]:this.center[m],h[m]=n[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new Ql(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let n=!0;for(let l=0;l<e.planes.length;l++){const h=this.intersectsPlane(e.planes[l]);if(h===0)return 0;h===1&&(n=!1)}return n?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let n=e[3],l=e[3];for(let h=0;h<3;h++)e[h]>0?(n+=e[h]*this.min[h],l+=e[h]*this.max[h]):(l+=e[h]*this.min[h],n+=e[h]*this.max[h]);return n>=0?2:l<0?0:1}}class Jl{distanceToTile2d(e,n,l,h){const m=h.distanceX([e,n]),y=h.distanceY([e,n]);return Math.hypot(m,y)}getWrap(e,n,l){return l}getTileBoundingVolume(e,n,l,h){var m,y;let b=l,T=l;if(h?.terrain){const z=new c.Z(e.z,n,e.z,e.x,e.y),O=h.terrain.getMinMaxElevation(z);b=(m=O.minElevation)!==null&&m!==void 0?m:l,T=(y=O.maxElevation)!==null&&y!==void 0?y:l}const A=1<<e.z;return new Ql([n+e.x/A,e.y/A,b],[n+(e.x+1)/A,(e.y+1)/A,T])}allowVariableZoom(e,n){const l=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,h=c.ag(78.5-l/2,0,60);return!!n.terrain||e.pitch>h}allowWorldCopies(){return!0}prepareNextFrame(){}}class nr{constructor(e,n,l){this.points=e,this.planes=n,this.aabb=l}static fromInvProjectionMatrix(e,n=1,l=0,h,m){const y=m?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],b=Math.pow(2,l),T=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(L=>function(N,Z,ne,ie){const re=c.av([],N,Z),oe=1/re[3]/ne*ie;return c.aX(re,re,[oe,oe,1/re[3],oe])}(L,e,n,b));h&&function(L,N,Z,ne){const ie=ne?4:0,re=ne?0:4;let oe=0;const fe=[],le=[];for(let ue=0;ue<4;ue++){const Te=c.aT([],L[ue+re],L[ue+ie]),Oe=c.aY(Te);c.aQ(Te,Te,1/Oe),fe.push(Oe),le.push(Te)}for(let ue=0;ue<4;ue++){const Te=c.aZ(L[ue+ie],le[ue],Z);oe=Te!==null&&Te>=0?Math.max(oe,Te):Math.max(oe,fe[ue])}const ge=function(ue,Te){const Oe=c.aT([],ue[Te[0]],ue[Te[1]]),ze=c.aT([],ue[Te[2]],ue[Te[1]]),Re=[0,0,0,0];return c.aU(Re,c.aV([],Oe,ze)),Re[3]=-c.aW(Re,ue[Te[0]]),Re}(L,N),ve=function(ue,Te){const Oe=c.a_(ue),ze=c.a$([],ue,1/Oe),Re=c.aT([],Te,c.aQ([],ze,c.aW(Te,ze))),Be=c.a_(Re);if(Be>0){const gt=Math.sqrt(1-ze[3]*ze[3]),pt=c.aQ([],ze,-ze[3]),it=c.aR([],pt,c.aQ([],Re,gt/Be));return c.b0(Te,it)}return null}(Z,ge);if(ve!==null){const ue=ve/c.aW(le[0],ge);oe=Math.min(oe,ue)}for(let ue=0;ue<4;ue++){const Te=Math.min(oe,fe[ue]);L[ue+re]=[L[ue+ie][0]+le[ue][0]*Te,L[ue+ie][1]+le[ue][1]*Te,L[ue+ie][2]+le[ue][2]*Te,1]}}(T,y[0],h,m);const A=y.map(L=>{const N=c.aT([],T[L[0]],T[L[1]]),Z=c.aT([],T[L[2]],T[L[1]]),ne=c.aU([],c.aV([],N,Z)),ie=-c.aW(ne,T[L[1]]);return ne.concat(ie)}),z=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],O=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const L of T)for(let N=0;N<3;N++)z[N]=Math.min(z[N],L[N]),O[N]=Math.max(O[N],L[N]);return new nr(T,A,new Ql(z,O))}}class cn{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,n){}constructor(e,n,l,h,m){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Ga({calcMatrices:()=>{this._calcMatrices()},getConstrained:(y,b)=>this.getConstrained(y,b)},e,n,l,h,m),this._coveringTilesDetailsProvider=new Jl}clone(){const e=new cn;return e.apply(this),e}apply(e,n,l){this._helper.apply(e,n,l)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new c.b1(0,e)];if(this._helper._renderWorldCopies){const l=this.screenPointToMercatorCoordinate(new c.P(0,0)),h=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),m=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),y=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),b=Math.floor(Math.min(l.x,h.x,m.x,y.x)),T=Math.floor(Math.max(l.x,h.x,m.x,y.x)),A=1;for(let z=b-A;z<=T+A;z++)z!==0&&n.push(new c.b1(z,e))}return n}getCameraFrustum(){return nr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const n=this.screenPointToLocation(this.centerPoint,e),l=e?e.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(l)}setLocationAtPoint(e,n){const l=c.ai(this.elevation,this.center.lat),h=this.screenPointToMercatorCoordinateAtZ(n,l),m=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,l),y=c.a0.fromLngLat(e),b=new c.a0(y.x-(h.x-m.x),y.y-(h.y-m.y));this.setCenter(b?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(c.a0.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(c.a0.fromLngLat(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l!=null)return l}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const l=n||0,h=[e.x,e.y,0,1],m=[e.x,e.y,1,1];c.av(h,h,this._pixelMatrixInverse),c.av(m,m,this._pixelMatrixInverse);const y=h[3],b=m[3],T=h[1]/y,A=m[1]/b,z=h[2]/y,O=m[2]/b,L=z===O?0:(l-z)/(O-z);return new c.a0(c.C.number(h[0]/y,m[0]/b,L)/this.worldSize,c.C.number(T,A,L)/this.worldSize,l)}coordinatePoint(e,n=0,l=this._pixelMatrix){const h=[e.x*this.worldSize,e.y*this.worldSize,n,1];return c.av(h,h,l),new c.P(h[0]/h[3],h[1]/h[3])}getBounds(){const e=Math.max(0,this._helper._height/2-Y(this));return new rn().extend(this.screenPointToLocation(new c.P(0,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,e))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(e,n){return n?n.pointCoordinate(e)!=null:e.y>this.height/2-Y(this)}calculatePosMatrix(e,n=!1,l){var h;const m=(h=e.key)!==null&&h!==void 0?h:c.b2(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),y=n?this._alignedPosMatrixCache:this._posMatrixCache;if(y.has(m)){const A=y.get(m);return l?A.f32:A.f64}const b=te(e,this.worldSize);c.O(b,n?this._alignedProjMatrix:this._viewProjMatrix,b);const T={f64:b,f32:new Float32Array(b)};return y.set(m,T),l?T.f32:T.f64}calculateFogMatrix(e){const n=e.key,l=this._fogMatrixCacheF32;if(l.has(n))return l.get(n);const h=te(e,this.worldSize);return c.O(h,this._fogMatrix,h),l.set(n,new Float32Array(h)),l.get(n)}getConstrained(e,n){n=c.ag(+n,this.minZoom,this.maxZoom);const l={center:new c.S(e.lng,e.lat),zoom:n};let h=this._helper._lngRange;if(!this._helper._renderWorldCopies&&h===null){const fe=179.9999999999;h=[-fe,fe]}const m=this.tileSize*c.ae(l.zoom);let y=0,b=m,T=0,A=m,z=0,O=0;const{x:L,y:N}=this.size;if(this._helper._latRange){const fe=this._helper._latRange;y=c.U(fe[1])*m,b=c.U(fe[0])*m,b-y<N&&(z=N/(b-y))}h&&(T=c.aN(c.V(h[0])*m,0,m),A=c.aN(c.V(h[1])*m,0,m),A<T&&(A+=m),A-T<L&&(O=L/(A-T)));const{x:Z,y:ne}=Ce(m,e);let ie,re;const oe=Math.max(O||0,z||0);if(oe){const fe=new c.P(O?(A+T)/2:Z,z?(b+y)/2:ne);return l.center=H(m,fe).wrap(),l.zoom+=c.aj(oe),l}if(this._helper._latRange){const fe=N/2;ne-fe<y&&(re=y+fe),ne+fe>b&&(re=b-fe)}if(h){const fe=(T+A)/2;let le=Z;this._helper._renderWorldCopies&&(le=c.aN(Z,fe-m/2,fe+m/2));const ge=L/2;le-ge<T&&(ie=T+ge),le+ge>A&&(ie=A-ge)}if(ie!==void 0||re!==void 0){const fe=new c.P(ie??Z,re??ne);l.center=H(m,fe).wrap()}return l}calculateCenterFromCameraLngLatAlt(e,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,h)}_calculateNearFarZIfNeeded(e,n,l){if(!this._helper.autoCalculateNearFarZ)return;const h=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),m=e-h*this._helper._pixelPerMeter/Math.cos(n),y=h<0?m:e,b=Math.PI/2+this.pitchInRadians,T=c.ad(this.fov)*(Math.abs(Math.cos(c.ad(this.roll)))*this.height+Math.abs(Math.sin(c.ad(this.roll)))*this.width)/this.height*(.5+l.y/this.height),A=Math.sin(T)*y/Math.sin(c.ag(Math.PI-b-T,.01,Math.PI-.01)),z=Y(this),O=Math.atan(z/this._helper.cameraToCenterDistance),L=c.ad(.75),N=O>L?2*O*(.5+l.y/(2*z)):L,Z=Math.sin(N)*y/Math.sin(c.ag(Math.PI-b-N,.01,Math.PI-.01)),ne=Math.min(A,Z);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*ne+y),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=Ce(this.worldSize,this.center),l=n.x,h=n.y;this._helper._pixelPerMeter=c.ai(1,this.center.lat)*this.worldSize;const m=c.ad(Math.min(this.pitch,os)),y=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(m));let b;this._calculateNearFarZIfNeeded(y,m,e),b=new Float64Array(16),c.b3(b,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.ap(this._invProjMatrix,b),b[8]=2*-e.x/this._helper._width,b[9]=2*e.y/this._helper._height,this._projectionMatrix=c.b4(b),c.N(b,b,[1,-1,1]),c.M(b,b,[0,0,-this._helper.cameraToCenterDistance]),c.b5(b,b,-this.rollInRadians),c.b6(b,b,this.pitchInRadians),c.b5(b,b,-this.bearingInRadians),c.M(b,b,[-l,-h,0]),this._mercatorMatrix=c.N([],b,[this.worldSize,this.worldSize,this.worldSize]),c.N(b,b,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,b),c.M(b,b,[0,0,-this.elevation]),this._viewProjMatrix=b,this._invViewProjMatrix=c.ap([],b);const T=[0,0,-1,1];c.av(T,T,this._invViewProjMatrix),this._cameraPosition=[T[0]/T[3],T[1]/T[3],T[2]/T[3]],this._fogMatrix=new Float64Array(16),c.b3(this._fogMatrix,this.fovInRadians,this.width/this.height,y,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,c.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.b5(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.b6(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.b5(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.M(this._fogMatrix,this._fogMatrix,[-l,-h,0]),c.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,b);const A=this._helper._width%2/2,z=this._helper._height%2/2,O=Math.cos(this.bearingInRadians),L=Math.sin(-this.bearingInRadians),N=l-Math.round(l)+O*A+L*z,Z=h-Math.round(h)+O*z+L*A,ne=new Float64Array(b);if(c.M(ne,ne,[N>.5?N-1:N,Z>.5?Z-1:Z,0]),this._alignedProjMatrix=ne,b=c.ap(new Float64Array(16),this._pixelMatrix),!b)throw new Error("failed to invert matrix");this._pixelMatrixInverse=b,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new c.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return c.av(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=c.ai(1,this.center.lat)*this.worldSize;return he(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const l=c.a0.fromLngLat(e),h=[l.x*this.worldSize,l.y*this.worldSize,n,1];return c.av(h,h,this._viewProjMatrix),h[2]/h[3]}getProjectionData(e){const{overscaledTileID:n,aligned:l,applyTerrainMatrix:h}=e,m=this._helper.getMercatorTileCoordinates(n),y=n?this.calculatePosMatrix(n,l,!0):null;let b;return b=n&&n.terrainRttPosMatrix32f&&h?n.terrainRttPosMatrix32f:y||c.b7(),{mainMatrix:b,tileMercatorCoords:m,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:b}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,n,l){return 1}transformLightDirection(e){return c.aS(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,l,h){const m=this.calculatePosMatrix(l);let y;h?(y=[e,n,h(e,n),1],c.av(y,y,m)):(y=[e,n,0,1],Ds(y,y,m));const b=y[3];return{point:new c.P(y[0]/b,y[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}populateCache(e){for(const n of e)this.calculatePosMatrix(n)}getMatrixForModel(e,n){const l=c.a0.fromLngLat(e,n),h=l.meterInMercatorCoordinateUnits(),m=c.b8();return c.M(m,m,[l.x,l.y,l.z]),c.b5(m,m,Math.PI),c.b6(m,m,Math.PI/2),c.N(m,m,[-h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const n=new c.Z(0,0,0,0,0),l=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),h=te(n,this.worldSize);c.O(h,this._viewProjMatrix,h),l.tileMercatorCoords=[0,0,1,1];const m=[c.$,c.$,this.worldSize/this._helper.pixelsPerMeter],y=c.b9();return c.N(y,h,m),l.fallbackMatrix=y,l.mainMatrix=y,l}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function un(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function On(d){if(d.useSlerp)if(d.k<1){const e=c.ba(d.startEulerAngles.roll,d.startEulerAngles.pitch,d.startEulerAngles.bearing),n=c.ba(d.endEulerAngles.roll,d.endEulerAngles.pitch,d.endEulerAngles.bearing),l=new Float64Array(4);c.bb(l,e,n,d.k);const h=c.bc(l);d.tr.setRoll(h.roll),d.tr.setPitch(h.pitch),d.tr.setBearing(h.bearing)}else d.tr.setRoll(d.endEulerAngles.roll),d.tr.setPitch(d.endEulerAngles.pitch),d.tr.setBearing(d.endEulerAngles.bearing);else d.tr.setRoll(c.C.number(d.startEulerAngles.roll,d.endEulerAngles.roll,d.k)),d.tr.setPitch(c.C.number(d.startEulerAngles.pitch,d.endEulerAngles.pitch,d.k)),d.tr.setBearing(c.C.number(d.startEulerAngles.bearing,d.endEulerAngles.bearing,d.k))}function Bi(d,e,n,l,h){const m=h.padding,y=Ce(h.worldSize,n.getNorthWest()),b=Ce(h.worldSize,n.getNorthEast()),T=Ce(h.worldSize,n.getSouthEast()),A=Ce(h.worldSize,n.getSouthWest()),z=c.ad(-l),O=y.rotate(z),L=b.rotate(z),N=T.rotate(z),Z=A.rotate(z),ne=new c.P(Math.max(O.x,L.x,Z.x,N.x),Math.max(O.y,L.y,Z.y,N.y)),ie=new c.P(Math.min(O.x,L.x,Z.x,N.x),Math.min(O.y,L.y,Z.y,N.y)),re=ne.sub(ie),oe=(h.width-(m.left+m.right+e.left+e.right))/re.x,fe=(h.height-(m.top+m.bottom+e.top+e.bottom))/re.y;if(fe<0||oe<0)return void un();const le=Math.min(c.aj(h.scale*Math.min(oe,fe)),d.maxZoom),ge=c.P.convert(d.offset),ve=new c.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(c.ad(l)),ue=ge.add(ve).mult(h.scale/c.ae(le));return{center:H(h.worldSize,y.add(T).div(2).sub(ue)),zoom:le,bearing:l}}class Sa{get useGlobeControls(){return!1}handlePanInertia(e,n){return{easingOffset:e,easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(e,n){e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta),e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta)}handleMapControlsPan(e,n,l){e.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(l,e.around)}cameraForBoxAndBearing(e,n,l,h,m){return Bi(e,n,l,h,m)}handleJumpToCenterZoom(e,n){e.zoom!==(n.zoom!==void 0?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),n.center!==void 0&&e.setCenter(c.S.convert(n.center))}handleEaseTo(e,n){const l=e.zoom,h=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},b=n.zoom!==void 0,T=!e.isPaddingEqual(n.padding);let A=!1;const z=b?+n.zoom:e.zoom;let O=e.centerPoint.add(n.offsetAsPoint);const L=e.screenPointToLocation(O),{center:N,zoom:Z}=e.getConstrained(c.S.convert(n.center||L),z??l);Ta(e,N);const ne=Ce(e.worldSize,L),ie=Ce(e.worldSize,N).sub(ne),re=c.ae(Z-l);return A=Z!==l,{easeFunc:oe=>{if(A&&e.setZoom(c.C.number(l,Z,oe)),c.bd(m,y)||On({startEulerAngles:m,endEulerAngles:y,tr:e,k:oe,useSlerp:m.roll!=y.roll}),T&&(e.interpolatePadding(h,n.padding,oe),O=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const fe=c.ae(e.zoom-l),le=Z>l?Math.min(2,re):Math.max(.5,re),ge=Math.pow(le,1-oe),ve=H(e.worldSize,ne.add(ie.mult(oe*ge)).mult(fe));e.setLocationAtPoint(e.renderWorldCopies?ve.wrap():ve,O)}},isZooming:A,elevationCenter:N}}handleFlyTo(e,n){const l=n.zoom!==void 0,h=e.zoom,m=e.getConstrained(c.S.convert(n.center||n.locationAtOffset),l?+n.zoom:h),y=m.center,b=m.zoom;Ta(e,y);const T=Ce(e.worldSize,n.locationAtOffset),A=Ce(e.worldSize,y).sub(T),z=A.mag(),O=c.ae(b-h);let L;if(n.minZoom!==void 0){const N=Math.min(+n.minZoom,h,b),Z=e.getConstrained(y,N).zoom;L=c.ae(Z-h)}return{easeFunc:(N,Z,ne,ie)=>{e.setZoom(N===1?b:h+c.aj(Z));const re=N===1?y:H(e.worldSize,T.add(A.mult(ne)).mult(Z));e.setLocationAtPoint(e.renderWorldCopies?re.wrap():re,ie)},scaleOfZoom:O,targetCenter:y,scaleOfMinZoom:L,pixelPathLength:z}}}class hi{constructor(e,n,l){this.blendFunction=e,this.blendColor=n,this.mask=l}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,c.be.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,c.be.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],c.be.transparent,[!0,!0,!0,!0]);const rr=2305;class Kt{constructor(e,n,l){this.enable=e,this.mode=n,this.frontFace=l}}Kt.disabled=new Kt(!1,1029,rr),Kt.backCCW=new Kt(!0,1029,rr),Kt.frontCCW=new Kt(!0,1028,rr);class Qt{constructor(e,n,l){this.func=e,this.mask=n,this.range=l}}Qt.ReadOnly=!1,Qt.ReadWrite=!0,Qt.disabled=new Qt(519,Qt.ReadOnly,[0,1]);const Za=7680;class Vt{constructor(e,n,l,h,m,y){this.test=e,this.ref=n,this.mask=l,this.fail=h,this.depthFail=m,this.pass=y}}Vt.disabled=new Vt({func:519,mask:0},0,0,Za,Za,Za);const Bn=new WeakMap;function Mn(d){var e;if(Bn.has(d))return Bn.get(d);{const n=(e=d.getParameter(d.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Bn.set(d,n),n}}class fs{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,l=n.gl;this._texFormat=l.RGBA,this._texType=l.UNSIGNED_BYTE;const h=new c.aK;h.emplaceBack(-1,-1),h.emplaceBack(2,-1),h.emplaceBack(-1,2);const m=new c.aM;m.emplaceBack(0,1,2),this._fullscreenTriangle=new Va(n.createVertexBuffer(h,wa.members),n.createIndexBuffer(m),c.aL.simpleSegment(0,0,h.length,m.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(l.TEXTURE1);const y=l.createTexture();l.bindTexture(l.TEXTURE_2D,y),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(y),Mn(l)&&(this._pbo=l.createBuffer(),l.bindBuffer(l.PIXEL_PACK_BUFFER,this._pbo),l.bufferData(l.PIXEL_PACK_BUFFER,4,l.STREAM_READ),l.bindBuffer(l.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,n){const l=this._updateCount;return this._readbackQueue?l>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():l>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,n=e.gl;e.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const l=this._cachedRenderContext.context,h=l.gl;if(this._bindFramebuffer(),l.viewport.set([0,0,this._texWidth,this._texHeight]),l.clear({color:c.be.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(l,h.TRIANGLES,Qt.disabled,Vt.disabled,hi.unblended,Kt.disabled,((m,y)=>({u_input:m,u_output_expected:y}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Mn(h)){h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.readBuffer(h.COLOR_ATTACHMENT0),h.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),h.bindBuffer(h.PIXEL_PACK_BUFFER,null);const m=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0);h.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:m}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Mn(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=fs._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let n=0;return n+=e[0]/256,n+=e[1]/65536,n+=e[2]/16777216,e[3]<127&&(n=-n),n/128}}const Kn=c.$/128;function Lu(d,e){const n=d.granularity!==void 0?Math.max(d.granularity,1):1,l=n+(d.generateBorders?2:0),h=n+(d.extendToNorthPole||d.generateBorders?1:0)+(d.extendToSouthPole||d.generateBorders?1:0),m=l+1,y=h+1,b=d.generateBorders?-1:0,T=d.generateBorders||d.extendToNorthPole?-1:0,A=n+(d.generateBorders?1:0),z=n+(d.generateBorders||d.extendToSouthPole?1:0),O=m*y,L=l*h*6,N=m*y>65536;if(N&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const Z=N||e==="32bit",ne=new Int16Array(2*O);let ie=0;for(let fe=T;fe<=z;fe++)for(let le=b;le<=A;le++){let ge=le/n*c.$;le===-1&&(ge=-Kn),le===n+1&&(ge=c.$+Kn);let ve=fe/n*c.$;fe===-1&&(ve=d.extendToNorthPole?c.bg:-Kn),fe===n+1&&(ve=d.extendToSouthPole?c.bh:c.$+Kn),ne[ie++]=ge,ne[ie++]=ve}const re=Z?new Uint32Array(L):new Uint16Array(L);let oe=0;for(let fe=0;fe<h;fe++)for(let le=0;le<l;le++){const ge=le+1+fe*m,ve=le+(fe+1)*m,ue=le+1+(fe+1)*m;re[oe++]=le+fe*m,re[oe++]=ve,re[oe++]=ge,re[oe++]=ge,re[oe++]=ve,re[oe++]=ue}return{vertices:ne.buffer.slice(0),indices:re.buffer.slice(0),uses32bitIndices:Z}}const sa=new c.aJ({fill:new c.bi(128,2),line:new c.bi(512,0),tile:new c.bi(128,32),stencil:new c.bi(128,1),circle:3});class Nc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Ua.projectionGlobe}get vertexShaderPreludeCode(){return Ua.projectionMercator.vertexSource}get subdivisionGranularity(){return sa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new fs(e));const n=c.U(this._errorQueryLatitudeDegrees),l=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,h=this._errorMeasurement.updateErrorLoop(n,l),m=K.now();h!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=h,this._errorMeasurementLastChangeTime=m);const y=Math.min(Math.max((m-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bj(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bk(y))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,n,l,h,m){const y=(m==="stencil"?sa.stencil:sa.tile).getGranularityForZoomLevel(n.z);return this._getMesh(e,{granularity:y,generateBorders:l,extendToNorthPole:n.y===0&&h,extendToSouthPole:n.y===(1<<n.z)-1&&h})}_getMesh(e,n){const l=this._getMeshKey(n);if(l in this._tileMeshCache)return this._tileMeshCache[l];const h=function(m,y){const b=Lu(y,"16bit"),T=c.aK.deserialize({arrayBuffer:b.vertices,length:b.vertices.byteLength/2/2}),A=c.aM.deserialize({arrayBuffer:b.indices,length:b.indices.byteLength/2/3});return new Va(m.createVertexBuffer(T,wa.members),m.createIndexBuffer(A),c.aL.simpleSegment(0,0,T.length,A.length))}(e,n);return this._tileMeshCache[l]=h,h}recalculate(e){}hasTransition(){const e=K.now();let n=!1;return n=n||(e-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const al=new c.r({type:new c.D(c.v.projection.type)});class Os extends c.E{constructor(e){super(),this._transitionable=new c.t(al),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.F(0)),this._mercatorProjection=new rl,this._verticalPerspectiveProjection=new Nc}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof c.bl){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,n,l,h,m){return this.currentProjection.getMeshFromTileID(e,n,l,h,m)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function sl(d){const e=ol(d.worldSize,d.center.lat);return 2*Math.PI*e}function Ma(d,e,n,l,h){const m=1/(1<<h),y=e/c.$*m+l*m,b=c.bn((d/c.$*m+n*m)*Math.PI*2+Math.PI,2*Math.PI),T=2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI,A=Math.cos(T),z=new Float64Array(3);return z[0]=Math.sin(b)*A,z[1]=Math.sin(T),z[2]=Math.cos(b)*A,z}function Wn(d){return function(e,n){const l=Math.cos(n),h=new Float64Array(3);return h[0]=Math.sin(e)*l,h[1]=Math.sin(n),h[2]=Math.cos(e)*l,h}(d.lng*Math.PI/180,d.lat*Math.PI/180)}function ol(d,e){return d/(2*Math.PI)/Math.cos(e*Math.PI/180)}function vo(d){const e=Math.asin(d[1])/Math.PI*180,n=Math.sqrt(d[0]*d[0]+d[2]*d[2]);if(n>1e-6){const l=d[0]/n,h=Math.acos(d[2]/n),m=(l>0?h:-h)/Math.PI*180;return new c.S(c.aN(m,-180,180),e)}return new c.S(0,e)}function ll(d){return Math.cos(d*Math.PI/180)}function Nn(d,e){const n=ll(d),l=ll(e);return c.aj(l/n)}function ec(d,e){const n=d.rotate(e.bearingInRadians),l=e.zoom+Nn(e.center.lat,0),h=c.bj(1/ll(e.center.lat),1/ll(Math.min(Math.abs(e.center.lat),60)),c.bm(l,7,3,0,1)),m=360/sl({worldSize:e.worldSize,center:{lat:e.center.lat}});return new c.S(e.center.lng-n.x*m*h,c.ag(e.center.lat+n.y*m,-c.ah,c.ah))}function cl(d){const e=.5*d,n=Math.sin(e),l=Math.cos(e);return Math.log(n+l)-Math.log(l-n)}function ul(d,e,n,l){const h=d.lat+n*l;if(Math.abs(n)>1){const m=(Math.sign(d.lat+n)!==Math.sign(d.lat)?-Math.abs(d.lat):Math.abs(d.lat))*Math.PI/180,y=Math.abs(d.lat+n)*Math.PI/180,b=cl(m+l*(y-m)),T=cl(m),A=cl(y);return new c.S(d.lng+e*((b-T)/(A-T)),h)}return new c.S(d.lng+e*l,h)}class Bh{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,n,l,h){const m=`${e.z}_${e.x}_${e.y}_${h?.terrain?"t":""}`,y=this._cache.get(m);if(y)return y;const b=this._cachePrevious.get(m);if(b)return this._cache.set(m,b),b;const T=this._boundingVolumeFactory(e,n,l,h);return this._cache.set(m,T),this._hadAnyChanges=!0,T}}class Bs{constructor(e,n,l,h){this.min=l,this.max=h,this.points=e,this.planes=n}static fromAabb(e,n){const l=[];for(let h=0;h<8;h++)l.push([1&~h?e[0]:n[0],(h>>1&1)==1?n[1]:e[1],(h>>2&1)==1?n[2]:e[2]]);return new Bs(l,[[-1,0,0,n[0]],[1,0,0,-e[0]],[0,-1,0,n[1]],[0,1,0,-e[1]],[0,0,-1,n[2]],[0,0,1,-e[2]]],e,n)}static fromCenterSizeAngles(e,n,l){const h=c.bq([],l[0],l[1],l[2]),m=c.br([],[n[0],0,0],h),y=c.br([],[0,n[1],0],h),b=c.br([],[0,0,n[2]],h),T=[...e],A=[...e];for(let O=0;O<8;O++)for(let L=0;L<3;L++){const N=e[L]+m[L]*(1&~O?-1:1)+y[L]*((O>>1&1)==1?1:-1)+b[L]*((O>>2&1)==1?1:-1);T[L]=Math.min(T[L],N),A[L]=Math.max(A[L],N)}const z=[];for(let O=0;O<8;O++){const L=[...e];c.aR(L,L,c.aQ([],m,1&~O?-1:1)),c.aR(L,L,c.aQ([],y,(O>>1&1)==1?1:-1)),c.aR(L,L,c.aQ([],b,(O>>2&1)==1?1:-1)),z.push(L)}return new Bs(z,[[...m,-c.aW(m,z[0])],[...y,-c.aW(y,z[0])],[...b,-c.aW(b,z[0])],[-m[0],-m[1],-m[2],-c.aW(m,z[7])],[-y[0],-y[1],-y[2],-c.aW(y,z[7])],[-b[0],-b[1],-b[2],-c.aW(b,z[7])]],T,A)}intersectsFrustum(e){let n=!0;const l=this.points.length,h=this.planes.length,m=e.planes.length,y=e.points.length;for(let b=0;b<m;b++){const T=e.planes[b];let A=0;for(let z=0;z<l;z++){const O=this.points[z];T[0]*O[0]+T[1]*O[1]+T[2]*O[2]+T[3]>=0&&A++}if(A===0)return 0;A<l&&(n=!1)}if(n)return 2;for(let b=0;b<h;b++){const T=this.planes[b];let A=0;for(let z=0;z<y;z++){const O=e.points[z];T[0]*O[0]+T[1]*O[1]+T[2]*O[2]+T[3]>=0&&A++}if(A===0)return 0}return 1}intersectsPlane(e){const n=this.points.length;let l=0;for(let h=0;h<n;h++){const m=this.points[h];e[0]*m[0]+e[1]*m[1]+e[2]*m[2]+e[3]>=0&&l++}return l===n?2:l===0?0:1}}function tc(d,e,n){const l=d-e;return l<0?-l:Math.max(0,l-n)}function ku(d,e,n,l,h){const m=d-n;let y;return y=m<0?Math.min(-m,1+m-h):m>1?Math.min(Math.max(m-h,0),1-m):0,Math.max(y,tc(e,l,h))}class If{constructor(){this._boundingVolumeCache=new Bh(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,n,l,h){const m=1<<l.z,y=1/m,b=l.x/m,T=l.y/m;let A=2;return A=Math.min(A,ku(e,n,b,T,y)),A=Math.min(A,ku(e,n,b+.5,-T-y,y)),A=Math.min(A,ku(e,n,b+.5,2-T-y,y)),A}getWrap(e,n,l){const h=1<<n.z,m=1/h,y=n.x/h,b=tc(e.x,y,m),T=tc(e.x,y-1,m),A=tc(e.x,y+1,m),z=Math.min(b,T,A);return z===A?1:z===T?-1:0}allowVariableZoom(e,n){return qe(e,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,n,l,h){return this._boundingVolumeCache.getTileBoundingVolume(e,n,l,h)}_computeTileBoundingVolume(e,n,l,h){var m,y;let b=l,T=l;if(h?.terrain){const A=new c.Z(e.z,n,e.z,e.x,e.y),z=h.terrain.getMinMaxElevation(A);b=(m=z.minElevation)!==null&&m!==void 0?m:l,T=(y=z.maxElevation)!==null&&y!==void 0?y:l}if(b/=c.bt,T/=c.bt,b+=1,T+=1,e.z<=0)return Bs.fromAabb([-T,-T,-T],[T,T,T]);if(e.z===1)return Bs.fromAabb([e.x===0?-T:0,e.y===0?0:-T,-T],[e.x===0?0:T,e.y===0?T:0,T]);{const A=[Ma(0,0,e.x,e.y,e.z),Ma(c.$,0,e.x,e.y,e.z),Ma(c.$,c.$,e.x,e.y,e.z),Ma(0,c.$,e.x,e.y,e.z)],z=[];for(const Re of A)z.push(c.aQ([],Re,T));if(T!==b)for(const Re of A)z.push(c.aQ([],Re,b));e.y===0&&z.push([0,1,0]),e.y===(1<<e.z)-1&&z.push([0,-1,0]);const O=[1,1,1],L=[-1,-1,-1];for(const Re of z)for(let Be=0;Be<3;Be++)O[Be]=Math.min(O[Be],Re[Be]),L[Be]=Math.max(L[Be],Re[Be]);const N=Ma(c.$/2,c.$/2,e.x,e.y,e.z),Z=c.aV([],[0,1,0],N);c.aU(Z,Z);const ne=c.aV([],N,Z);c.aU(ne,ne);const ie=c.aV([],A[2],A[1]);c.aU(ie,ie);const re=c.aV([],A[0],A[3]);c.aU(re,re),z.push(c.aQ([],N,T)),e.y>=(1<<e.z)/2&&z.push(c.aQ([],Ma(c.$/2,0,e.x,e.y,e.z),T)),e.y<(1<<e.z)/2&&z.push(c.aQ([],Ma(c.$/2,c.$,e.x,e.y,e.z),T));const oe=ar(N,z),fe=ar(ne,z),le=[-N[0],-N[1],-N[2],oe.max],ge=[N[0],N[1],N[2],-oe.min],ve=[-ne[0],-ne[1],-ne[2],fe.max],ue=[ne[0],ne[1],ne[2],-fe.min],Te=[...ie,0],Oe=[...re,0],ze=[];return e.y===0?ze.push(c.bs(Oe,Te,le),c.bs(Oe,Te,ge)):ze.push(c.bs(ve,Te,le),c.bs(ve,Te,ge),c.bs(ve,Oe,le),c.bs(ve,Oe,ge)),e.y===(1<<e.z)-1?ze.push(c.bs(Oe,Te,le),c.bs(Oe,Te,ge)):ze.push(c.bs(ue,Te,le),c.bs(ue,Te,ge),c.bs(ue,Oe,le),c.bs(ue,Oe,ge)),new Bs(ze,[le,ge,ve,ue,Te,Oe],O,L)}}}function ar(d,e){let n=1/0,l=-1/0;for(const h of e){const m=c.aW(d,h);n=Math.min(n,m),l=Math.max(l,m)}return{min:n,max:l}}class hl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n){this._helper.resize(e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=c.bu(),this._projectionMatrix=c.b8(),this._globeViewProjMatrix32f=c.b7(),this._globeViewProjMatrixNoCorrection=c.b8(),this._globeViewProjMatrixNoCorrectionInverted=c.b8(),this._globeProjMatrixInverted=c.b8(),this._cameraPosition=c.bo(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Ga({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._coveringTilesDetailsProvider=new If}clone(){const e=new hl;return e.apply(this),e}apply(e,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=c.bo();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:n,applyGlobeMatrix:l}=e,h=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:h,clippingPlane:this._cachedClippingPlane,projectionTransition:l?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,l=this.cameraToCenterDistance/e,h=Math.sin(n)*l,m=Math.cos(n)*l+1,y=1/Math.sqrt(h*h+m*m)*1;let b=-h,T=m;const A=Math.sqrt(b*b+T*T);b/=A,T/=A;const z=[0,b,T];c.bv(z,z,[0,0,0],-this.bearingInRadians),c.bw(z,z,[0,0,0],-1*this.center.lat*Math.PI/180),c.bx(z,z,[0,0,0],this.center.lng*Math.PI/180);const O=1/c.aY(z);return c.aQ(z,z,O),[...z,-y*O]}isLocationOccluded(e){return!this.isSurfacePointVisible(Wn(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,l=this._helper._center.lat*Math.PI/180,h=Math.cos(l),m=[Math.sin(n)*h,Math.sin(l),Math.cos(n)*h],y=[m[2],0,-m[0]],b=[0,0,0];c.aV(b,y,m),c.aU(y,y),c.aU(b,b);const T=[0,0,0];return c.aU(T,[y[0]*e[0]+b[0]*e[1]+m[0]*e[2],y[1]*e[0]+b[1]*e[1]+m[1]*e[2],y[2]*e[0]+b[2]*e[1]+m[2]*e[2]]),T}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,l){const h=function(b,T,A){const z=1/(1<<A.z);return new c.a0(b/c.$*z+A.x*z,T/c.$*z+A.y*z)}(e,n,l.canonical),m=(y=h.y,[c.bn(h.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-y*Math.PI*2))-.5*Math.PI]);var y;return this.getCircleRadiusCorrection()/Math.cos(m[1])}projectTileCoordinates(e,n,l,h){const m=l.canonical,y=Ma(e,n,m.x,m.y,m.z),b=1+(h?h(e,n):0)/c.bt,T=[y[0]*b,y[1]*b,y[2]*b,1];c.av(T,T,this._globeViewProjMatrixNoCorrection);const A=this._cachedClippingPlane,z=A[0]*y[0]+A[1]*y[1]+A[2]*y[2]+A[3]<0;return{point:new c.P(T[0]/T[3],T[1]/T[3]),signedDistanceFromCamera:T[3],isOccluded:z}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=ol(this.worldSize,this.center.lat),n=c.b9(),l=c.b9();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),c.b3(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const h=this.centerOffset;n[8]=2*-h.x/this._helper._width,n[9]=2*h.y/this._helper._height,this._projectionMatrix=c.b4(n),this._globeProjMatrixInverted=c.b9(),c.ap(this._globeProjMatrixInverted,n),c.M(n,n,[0,0,-this.cameraToCenterDistance]),c.b5(n,n,this.rollInRadians),c.b6(n,n,-this.pitchInRadians),c.b5(n,n,this.bearingInRadians),c.M(n,n,[0,0,-e]);const m=c.bo();m[0]=e,m[1]=e,m[2]=e,c.b6(l,n,this.center.lat*Math.PI/180),c.by(l,l,-this.center.lng*Math.PI/180),c.N(l,l,m),this._globeViewProjMatrixNoCorrection=l,c.b6(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.by(n,n,-this.center.lng*Math.PI/180),c.N(n,n,m),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=c.b9(),c.ap(this._globeViewProjMatrixNoCorrectionInverted,l);const y=c.bo();this._cameraPosition=c.bo(),this._cameraPosition[2]=this.cameraToCenterDistance/e,c.bv(this._cameraPosition,this._cameraPosition,y,-this.rollInRadians),c.bw(this._cameraPosition,this._cameraPosition,y,this.pitchInRadians),c.bv(this._cameraPosition,this._cameraPosition,y,-this.bearingInRadians),c.aR(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bw(this._cameraPosition,this._cameraPosition,y,-this.center.lat*Math.PI/180),c.bx(this._cameraPosition,this._cameraPosition,y,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const b=c.b4(this._globeViewProjMatrixNoCorrectionInverted);c.N(b,b,[1,1,-1]),this._cachedFrustum=nr.fromInvProjectionMatrix(b,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){c.w("calculateFogMatrix is not supported on globe projection.");const n=c.b9();return c.af(n),n}getVisibleUnwrappedCoordinates(e){return[new c.b1(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const l=Wn(e);c.aQ(l,l,1+n/c.bt);const h=c.bu();return c.av(h,[l[0],l[1],l[2],1],this._globeViewProjMatrixNoCorrection),h[2]/h[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,l=[new c.P(0,0),new c.P(e,0),new c.P(this.width,0),new c.P(this.width,n),new c.P(this.width,this.height),new c.P(e,this.height),new c.P(0,this.height),new c.P(0,n)],h=[];for(const O of l)h.push(this.unprojectScreenPoint(O));let m=0,y=0,b=0,T=0;const A=this.center;for(const O of h){const L=c.bz(A.lng,O.lng),N=c.bz(A.lat,O.lat);L<y&&(y=L),L>m&&(m=L),N<T&&(T=N),N>b&&(b=N)}const z=[A.lng+y,A.lat+T,A.lng+m,A.lat+b];return this.isSurfacePointOnScreen([0,1,0])&&(z[3]=90,z[0]=-180,z[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(z[1]=-90,z[0]=-180,z[2]=180),new rn(z)}getConstrained(e,n){const l=c.ag(e.lat,-c.ah,c.ah),h=c.ag(+n,this.minZoom+Nn(0,l),this.maxZoom);return{center:new c.S(e.lng,l),zoom:h}}calculateCenterFromCameraLngLatAlt(e,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,h)}setLocationAtPoint(e,n){const l=Wn(this.unprojectScreenPoint(n)),h=Wn(e),m=c.bo();c.bA(m);const y=c.bo();c.bx(y,l,m,-this.center.lng*Math.PI/180),c.bw(y,y,m,this.center.lat*Math.PI/180);const b=h[0]*h[0]+h[2]*h[2],T=y[0]*y[0];if(b<T)return;const A=Math.sqrt(b-T),z=-A,O=c.bB(h[0],h[2],y[0],A),L=c.bB(h[0],h[2],y[0],z),N=c.bo();c.bx(N,h,m,-O);const Z=c.bB(N[1],N[2],y[1],y[2]),ne=c.bo();c.bx(ne,h,m,-L);const ie=c.bB(ne[1],ne[2],y[1],y[2]),re=.5*Math.PI,oe=Z>=-re&&Z<=re,fe=ie>=-re&&ie<=re;let le,ge;if(oe&&fe){const Oe=this.center.lng*Math.PI/180,ze=this.center.lat*Math.PI/180;c.bC(O,Oe)+c.bC(Z,ze)<c.bC(L,Oe)+c.bC(ie,ze)?(le=O,ge=Z):(le=L,ge=ie)}else if(oe)le=O,ge=Z;else{if(!fe)return;le=L,ge=ie}const ve=le/Math.PI*180,ue=ge/Math.PI*180,Te=this.center.lat;this.setCenter(new c.S(ve,c.ag(ue,-90,90))),this.setZoom(this.zoom+Nn(Te,this.center.lat))}locationToScreenPoint(e,n){const l=Wn(e);if(n){const h=n.getElevationForLngLatZoom(e,this._helper._tileZoom);c.aQ(l,l,1+h/c.bt)}return this._projectSurfacePointToScreen(l)}_projectSurfacePointToScreen(e){const n=c.bu();return c.av(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new c.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const l=n.pointCoordinate(e);if(l)return l}return c.a0.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,n){var l;return(l=this.screenPointToMercatorCoordinate(e,n))===null||l===void 0?void 0:l.toLngLat()}isPointOnMapSurface(e,n){const l=this._cameraPosition,h=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(l,h)}getRayDirectionFromPixel(e){const n=c.bu();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,c.av(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const l=c.bo();l[0]=n[0]-this._cameraPosition[0],l[1]=n[1]-this._cameraPosition[1],l[2]=n[2]-this._cameraPosition[2];const h=c.bo();return c.aU(h,l),h}isSurfacePointVisible(e){const n=this._cachedClippingPlane;return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=c.bu();return c.av(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const l=c.aW(e,n),h=c.bo(),m=c.bo();c.aQ(m,n,l),c.aT(h,e,m);const y=1-c.aW(h,h);if(y<0)return null;const b=c.aW(e,e)-1,T=-l+(l<0?1:-1)*Math.sqrt(y),A=b/T,z=T;return{tMin:Math.min(A,z),tMax:Math.max(A,z)}}unprojectScreenPoint(e){const n=this._cameraPosition,l=this.getRayDirectionFromPixel(e),h=this.rayPlanetIntersection(n,l);if(h){const z=c.bo();c.aR(z,n,[l[0]*h.tMin,l[1]*h.tMin,l[2]*h.tMin]);const O=c.bo();return c.aU(O,z),vo(O)}const m=this._cachedClippingPlane,y=m[0]*l[0]+m[1]*l[1]+m[2]*l[2],b=-c.b0(m,n)/y,T=c.bo();if(b>0)c.aR(T,n,[l[0]*b,l[1]*b,l[2]*b]);else{const z=c.bo();c.aR(z,n,[2*l[0],2*l[1],2*l[2]]);const O=c.b0(this._cachedClippingPlane,z);c.aT(T,z,[this._cachedClippingPlane[0]*O,this._cachedClippingPlane[1]*O,this._cachedClippingPlane[2]*O])}const A=function(z){const O=c.bo();return O[0]=z[0]*-z[3],O[1]=z[1]*-z[3],O[2]=z[2]*-z[3],{center:O,radius:Math.sqrt(1-z[3]*z[3])}}(m);return vo(function(z,O,L){const N=c.bo();c.aT(N,L,z);const Z=c.bo();return c.bp(Z,z,N,O/c.a_(N)),Z}(A.center,A.radius,T))}getMatrixForModel(e,n){const l=c.S.convert(e),h=1/c.bt,m=c.b8();return c.by(m,m,l.lng/180*Math.PI),c.b6(m,m,-l.lat/180*Math.PI),c.M(m,m,[0,0,1+n/c.bt]),c.b6(m,m,.5*Math.PI),c.N(m,m,[h,h,h]),m}getProjectionDataForCustomLayer(e=!0){const n=this.getProjectionData({overscaledTileID:new c.Z(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class Gr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,l){return this._helper.interpolatePadding(e,n,l)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,l=!0){this._helper.resize(e,n,l)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,n){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Ga({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._globeness=1,this._mercatorTransform=new cn,this._verticalPerspectiveTransform=new hl}clone(){const e=new Gr;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const n=this._mercatorTransform.getProjectionData(e),l=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?l.mainMatrix:n.mainMatrix,clippingPlane:l.clippingPlane,tileMercatorCoords:l.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return c.bj(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bj(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,l){const h=this._mercatorTransform.getPitchedTextCorrection(e,n,l),m=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,l);return c.bj(h,m,this._globeness)}projectTileCoordinates(e,n,l,h){return this.currentTransform.projectTileCoordinates(e,n,l,h)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){return this.currentTransform.lngLatToCameraDepth(e,n)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,n){return this.currentTransform.getConstrained(e,n)}calculateCenterFromCameraLngLatAlt(e,n,l,h){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,l,h)}setLocationAtPoint(e,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,n){return this.currentTransform.locationToScreenPoint(e,n)}screenPointToMercatorCoordinate(e,n){return this.currentTransform.screenPointToMercatorCoordinate(e,n)}screenPointToLocation(e,n){return this.currentTransform.screenPointToLocation(e,n)}isPointOnMapSurface(e,n){return this.currentTransform.isPointOnMapSurface(e,n)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,n){return this.currentTransform.getMatrixForModel(e,n)}getProjectionDataForCustomLayer(e=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return n;const l=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return l.fallbackMatrix=n.mainMatrix,l}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Pr{get useGlobeControls(){return!0}handlePanInertia(e,n){const l=ec(e,n);return Math.abs(l.lng-n.center.lng)>180&&(l.lng=n.center.lng+179.5*Math.sign(l.lng-n.center.lng)),{easingCenter:l,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const l=e.around,h=n.screenPointToLocation(l);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const m=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const y=n.zoom-m;if(y===0)return;const b=c.bz(n.center.lng,h.lng),T=b/(Math.abs(b/180)+1),A=c.bz(n.center.lat,h.lat),z=n.getRayDirectionFromPixel(l),O=n.cameraPosition,L=-1*c.aW(O,z),N=c.bo();c.aR(N,O,[z[0]*L,z[1]*L,z[2]*L]);const Z=c.aY(N)-1,ne=Math.exp(.5*-Math.max(Z-.3,0)),ie=ol(n.worldSize,n.center.lat)/Math.min(n.width,n.height),re=c.bm(ie,.9,.5,1,.25),oe=(1-c.ae(-y))*Math.min(ne,re),fe=n.center.lat,le=n.zoom,ge=new c.S(n.center.lng+T*oe,c.ag(n.center.lat+A*oe,-c.ah,c.ah));n.setLocationAtPoint(h,l);const ve=n.center,ue=c.bm(Math.abs(b),45,85,0,1),Te=c.bm(ie,.75,.35,0,1),Oe=Math.pow(Math.max(ue,Te),.25),ze=c.bz(ve.lng,ge.lng),Re=c.bz(ve.lat,ge.lat);n.setCenter(new c.S(ve.lng+ze*Oe,ve.lat+Re*Oe).wrap()),n.setZoom(le+Nn(fe,n.center.lat))}handleMapControlsPan(e,n,l){if(!e.panDelta)return;const h=n.center.lat,m=n.zoom;n.setCenter(ec(e.panDelta,n).wrap()),n.setZoom(m+Nn(h,n.center.lat))}cameraForBoxAndBearing(e,n,l,h,m){const y=Bi(e,n,l,h,m),b=n.left/m.width*2-1,T=(m.width-n.right)/m.width*2-1,A=n.top/m.height*-2+1,z=(m.height-n.bottom)/m.height*-2+1,O=c.bz(l.getWest(),l.getEast())<0,L=O?l.getEast():l.getWest(),N=O?l.getWest():l.getEast(),Z=Math.max(l.getNorth(),l.getSouth()),ne=Math.min(l.getNorth(),l.getSouth()),ie=L+.5*c.bz(L,N),re=Z+.5*c.bz(Z,ne),oe=m.clone();oe.setCenter(y.center),oe.setBearing(y.bearing),oe.setPitch(0),oe.setRoll(0),oe.setZoom(y.zoom);const fe=oe.modelViewProjectionMatrix,le=[Wn(l.getNorthWest()),Wn(l.getNorthEast()),Wn(l.getSouthWest()),Wn(l.getSouthEast()),Wn(new c.S(N,re)),Wn(new c.S(L,re)),Wn(new c.S(ie,Z)),Wn(new c.S(ie,ne))],ge=Wn(y.center);let ve=Number.POSITIVE_INFINITY;for(const ue of le)b<0&&(ve=Pr.getLesserNonNegativeNonNull(ve,Pr.solveVectorScale(ue,ge,fe,"x",b))),T>0&&(ve=Pr.getLesserNonNegativeNonNull(ve,Pr.solveVectorScale(ue,ge,fe,"x",T))),A>0&&(ve=Pr.getLesserNonNegativeNonNull(ve,Pr.solveVectorScale(ue,ge,fe,"y",A))),z<0&&(ve=Pr.getLesserNonNegativeNonNull(ve,Pr.solveVectorScale(ue,ge,fe,"y",z)));if(Number.isFinite(ve)&&ve!==0)return y.zoom=oe.zoom+c.aj(ve),y;un()}handleJumpToCenterZoom(e,n){const l=e.center.lat,h=e.getConstrained(n.center?c.S.convert(n.center):e.center,e.zoom).center;e.setCenter(h.wrap());const m=n.zoom!==void 0?+n.zoom:e.zoom+Nn(l,h.lat);e.zoom!==m&&e.setZoom(m)}handleEaseTo(e,n){const l=e.zoom,h=e.center,m=e.padding,y={roll:e.roll,pitch:e.pitch,bearing:e.bearing},b={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},T=n.zoom!==void 0,A=!e.isPaddingEqual(n.padding);let z=!1;const O=n.center?c.S.convert(n.center):h,L=e.getConstrained(O,l).center;Ta(e,L);const N=e.clone();N.setCenter(L),N.setZoom(T?+n.zoom:l+Nn(h.lat,O.lat)),N.setBearing(n.bearing);const Z=new c.P(c.ag(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),c.ag(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));N.setLocationAtPoint(L,Z);const ne=(n.offset&&n.offsetAsPoint.mag())>0?N.center:L,ie=T?+n.zoom:l+Nn(h.lat,ne.lat),re=l+Nn(h.lat,0),oe=ie+Nn(ne.lat,0),fe=c.bz(h.lng,ne.lng),le=c.bz(h.lat,ne.lat),ge=c.ae(oe-re);return z=ie!==l,{easeFunc:ve=>{if(c.bd(y,b)||On({startEulerAngles:y,endEulerAngles:b,tr:e,k:ve,useSlerp:y.roll!=b.roll}),A&&e.interpolatePadding(m,n.padding,ve),n.around)c.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const ue=oe>re?Math.min(2,ge):Math.max(.5,ge),Te=Math.pow(ue,1-ve),Oe=ul(h,fe,le,ve*Te);e.setCenter(Oe.wrap())}if(z){const ue=c.C.number(re,oe,ve)+Nn(0,e.center.lat);e.setZoom(ue)}},isZooming:z,elevationCenter:ne}}handleFlyTo(e,n){const l=n.zoom!==void 0,h=e.center,m=e.zoom,y=e.padding,b=!e.isPaddingEqual(n.padding),T=e.getConstrained(c.S.convert(n.center||n.locationAtOffset),m).center,A=l?+n.zoom:e.zoom+Nn(e.center.lat,T.lat),z=e.clone();z.setCenter(T),z.setZoom(A),z.setBearing(n.bearing);const O=new c.P(c.ag(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),c.ag(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));z.setLocationAtPoint(T,O);const L=z.center;Ta(e,L);const N=function(le,ge,ve){const ue=Wn(ge),Te=Wn(ve),Oe=c.aW(ue,Te),ze=Math.acos(Oe),Re=sl(le);return ze/(2*Math.PI)*Re}(e,h,L),Z=m+Nn(h.lat,0),ne=A+Nn(L.lat,0),ie=c.ae(ne-Z);let re;if(typeof n.minZoom=="number"){const le=+n.minZoom+Nn(L.lat,0),ge=Math.min(le,Z,ne)+Nn(0,L.lat),ve=e.getConstrained(L,ge).zoom+Nn(L.lat,0);re=c.ae(ve-Z)}const oe=c.bz(h.lng,L.lng),fe=c.bz(h.lat,L.lat);return{easeFunc:(le,ge,ve,ue)=>{const Te=ul(h,oe,fe,ve);b&&e.interpolatePadding(y,n.padding,le);const Oe=le===1?L:Te;e.setCenter(Oe.wrap());const ze=Z+c.aj(ge);e.setZoom(le===1?A:ze+Nn(0,Oe.lat))},scaleOfZoom:ie,targetCenter:L,scaleOfMinZoom:re,pixelPathLength:N}}static solveVectorScale(e,n,l,h,m){const y=h==="x"?[l[0],l[4],l[8],l[12]]:[l[1],l[5],l[9],l[13]],b=[l[3],l[7],l[11],l[15]],T=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],A=e[0]*b[0]+e[1]*b[1]+e[2]*b[2],z=n[0]*y[0]+n[1]*y[1]+n[2]*y[2],O=n[0]*b[0]+n[1]*b[1]+n[2]*b[2];return z+m*A===T+m*O||b[3]*(T-z)+y[3]*(O-A)+T*O==z*A?null:(z+y[3]-m*O-m*b[3])/(z-T-m*O+m*A)}static getLesserNonNegativeNonNull(e,n){return n!==null&&n>=0&&n<e?n:e}}class Fc{constructor(e){this._globe=e,this._mercatorCameraHelper=new Sa,this._verticalPerspectiveCameraHelper=new Pr}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,n){return this.currentHelper.handlePanInertia(e,n)}handleMapControlsRollPitchBearingZoom(e,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,n)}handleMapControlsPan(e,n,l){this.currentHelper.handleMapControlsPan(e,n,l)}cameraForBoxAndBearing(e,n,l,h,m){return this.currentHelper.cameraForBoxAndBearing(e,n,l,h,m)}handleJumpToCenterZoom(e,n){this.currentHelper.handleJumpToCenterZoom(e,n)}handleEaseTo(e,n){return this.currentHelper.handleEaseTo(e,n)}handleFlyTo(e,n){return this.currentHelper.handleFlyTo(e,n)}}const ic=(d,e)=>c.y(d,e&&e.filter(n=>n.identifier!=="source.canvas")),fl=c.bD();class Ou extends c.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const h=this.sourceCaches[l].getSource().type;h!=="vector"&&h!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new Ft(Ht(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,h)=>this.getGlyphs(l,h)),this.dispatcher.registerMessageHandler("GI",(l,h)=>this.getImages(l,h)),this.imageManager=new Jt,this.imageManager.setEventedParent(this),this.glyphManager=new Ci(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new qt(256,512),this.crossTileSymbolIndex=new Wl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.bE,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",c.bF()),an().on(ss,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const h=this.sourceCaches[l.sourceId];if(!h)return;const m=h.getSource();if(m&&m.vectorLayerIds)for(const y in this._layers){const b=this._layers[y];b.source===m.id&&this._validateLayer(b)}})}setGlobalStateProperty(e,n){var l,h,m;this._checkLoaded();const y=n===null?(m=(h=(l=this.stylesheet.state)===null||l===void 0?void 0:l[e])===null||h===void 0?void 0:h.default)!==null&&m!==void 0?m:null:n;if(c.bG(y,this._globalState[e]))return this;this._globalState[e]=y;const b=this._findGlobalStateAffectedSources([e]);for(const T in this.sourceCaches)b.has(T)&&(this._reloadSource(T),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const n=[];for(const h in e)!c.bG(this._globalState[h],e[h].default)&&(n.push(h),this._globalState[h]=e[h].default);const l=this._findGlobalStateAffectedSources(n);for(const h in this.sourceCaches)l.has(h)&&(this._reloadSource(h),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const n=new Set;for(const l in this._layers){const h=this._layers[l],m=h.getLayoutAffectingGlobalStateRefs();for(const y of e)m.has(y)&&n.add(h.source)}return n}loadURL(e,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const h=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;c.j(h,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,n,l)}).catch(y=>{this._loadStyleRequest=null,y&&!m.signal.aborted&&this.fire(new c.k(y))})}loadJSON(e,n={},l){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,K.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,l)}).catch(()=>{})}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(fl,{validate:!1})}_load(e,n,l){var h,m,y;const b=n.transformStyle?n.transformStyle(l,e):e;if(!n.validate||!ic(this,c.z(b))){this._loaded=!0,this.stylesheet=b;for(const T in b.sources)this.addSource(T,b.sources[T],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new We(this.stylesheet.light),this._setProjectionInternal(((h=this.stylesheet.projection)===null||h===void 0?void 0:h.type)||"mercator"),this.sky=new _t(this.stylesheet.sky),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.setGlobalState((y=this.stylesheet.state)!==null&&y!==void 0?y:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){const e=c.bH(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(n=>n.id),this._layers={},this._serializedLayers=null;for(const n of e){const l=c.bI(n);l.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=l}}_loadSprite(e,n=!1,l=void 0){let h;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,y,b,T){return c._(this,void 0,void 0,function*(){const A=Ye(m),z=b>1?"@2x":"",O={},L={};for(const{id:N,url:Z}of A){const ne=y.transformRequest(vt(Z,z,".json"),"SpriteJSON");O[N]=c.j(ne,T);const ie=y.transformRequest(vt(Z,z,".png"),"SpriteImage");L[N]=Je.getImage(ie,T)}return yield Promise.all([...Object.values(O),...Object.values(L)]),function(N,Z){return c._(this,void 0,void 0,function*(){const ne={};for(const ie in N){ne[ie]={};const re=K.getImageCanvasContext((yield Z[ie]).data),oe=(yield N[ie]).data;for(const fe in oe){const{width:le,height:ge,x:ve,y:ue,sdf:Te,pixelRatio:Oe,stretchX:ze,stretchY:Re,content:Be,textFitWidth:gt,textFitHeight:pt}=oe[fe];ne[ie][fe]={data:null,pixelRatio:Oe,sdf:Te,stretchX:ze,stretchY:Re,content:Be,textFitWidth:gt,textFitHeight:pt,spriteData:{width:le,height:ge,x:ve,y:ue,context:re}}}}return ne})}(O,L)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const y in m){this._spritesImagesIds[y]=[];const b=this._spritesImagesIds[y]?this._spritesImagesIds[y].filter(T=>!(T in m)):[];for(const T of b)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in m[y]){const A=y==="default"?T:`${y}:${T}`;this._spritesImagesIds[y].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,m[y][T],!1):this.imageManager.addImage(A,m[y][T]),n&&(this._changedImages[A]=!0)}}}).catch(m=>{this._spriteRequest=null,h=m,this.fire(new c.k(h))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),l&&l(h)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const l=e.sourceLayer;if(!l)return;const h=n.getSource();(h.type==="geojson"||h.vectorLayerIds&&h.vectorLayerIds.indexOf(l)===-1)&&this.fire(new c.k(new Error(`Source layer "${l}" does not exist on source "${h.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?c.bJ(l):l);const h=[];for(const m of e)if(l[m]){const y=n?c.bJ(l[m]):l[m];h.push(y)}return h}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const l of n){const h=this._layers[l];h.type!=="custom"&&(e[l]=h.serialize())}return e}hasTransitions(){var e,n,l;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((l=this.projection)===null||l===void 0)&&l.hasTransition())return!0;for(const h in this.sourceCaches)if(this.sourceCaches[h].hasTransition())return!0;for(const h in this._layers)if(this._layers[h].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const h=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(h.length||m.length)&&this._updateWorkerLayers(h,m);for(const y in this._updatedSources){const b=this._updatedSources[y];if(b==="reload")this._reloadSource(y);else{if(b!=="clear")throw new Error(`Invalid action ${b}`);this._clearSource(y)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const h in this.sourceCaches){const m=this.sourceCaches[h];l[h]=m.used,m.used=!1}for(const h of this._order){const m=this._layers[h];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const h in l){const m=this.sourceCaches[h];!!l[h]!=!!m.used&&m.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:h}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var l;this._checkLoaded();const h=this.serialize();if(e=n.transformStyle?n.transformStyle(h,e):e,((l=n.validate)===null||l===void 0||l)&&ic(this,c.z(e)))return!1;(e=c.bJ(e)).layers=c.bH(e.layers);const m=c.bK(h,e),y=this._getOperationsToPerform(m);if(y.unimplemented.length>0)throw new Error(`Unimplemented: ${y.unimplemented.join(", ")}.`);if(y.operations.length===0)return!1;for(const b of y.operations)b();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],l=[];for(const h of e)switch(h.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push(()=>this.addLayer.apply(this,h.args));break;case"removeLayer":n.push(()=>this.removeLayer.apply(this,h.args));break;case"setPaintProperty":n.push(()=>this.setPaintProperty.apply(this,h.args));break;case"setLayoutProperty":n.push(()=>this.setLayoutProperty.apply(this,h.args));break;case"setFilter":n.push(()=>this.setFilter.apply(this,h.args));break;case"addSource":n.push(()=>this.addSource.apply(this,h.args));break;case"removeSource":n.push(()=>this.removeSource.apply(this,h.args));break;case"setLayerZoomRange":n.push(()=>this.setLayerZoomRange.apply(this,h.args));break;case"setLight":n.push(()=>this.setLight.apply(this,h.args));break;case"setGeoJSONSourceData":n.push(()=>this.setGeoJSONSourceData.apply(this,h.args));break;case"setGlyphs":n.push(()=>this.setGlyphs.apply(this,h.args));break;case"setSprite":n.push(()=>this.setSprite.apply(this,h.args));break;case"setTerrain":n.push(()=>this.map.setTerrain.apply(this,h.args));break;case"setSky":n.push(()=>this.setSky.apply(this,h.args));break;case"setProjection":this.setProjection.apply(this,h.args);break;case"setGlobalState":n.push(()=>this.setGlobalState.apply(this,h.args));break;case"setTransition":n.push(()=>{});break;default:l.push(h.command)}return{operations:n,unimplemented:l}}addImage(e,n){if(this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new c.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c.z.source,`sources.${e}`,n,null,l))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const h=this.sourceCaches[e]=new Ke(e,n,this.dispatcher);h.style=this,h.setEventedParent(this,()=>({isSourceLoaded:h.loaded(),source:h.serialize(),sourceId:e})),h.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new c.k(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,l={}){this._checkLoaded();const h=e.id;if(this.getLayer(h))return void this.fire(new c.k(new Error(`Layer "${h}" already exists on this map.`)));let m;if(e.type==="custom"){if(ic(this,c.bL(e)))return;m=c.bI(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(h,e.source),e=c.bJ(e),e=c.e(e,{source:h})),this._validate(c.z.layer,`layers.${h}`,e,{arrayIndex:-1},l))return;m=c.bI(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:h}})}const y=n?this._order.indexOf(n):this._order.length;if(n&&y===-1)this.fire(new c.k(new Error(`Cannot add layer "${h}" before non-existing layer "${n}".`)));else{if(this._order.splice(y,0,h),this._layerOrderChanged=!0,this._layers[h]=m,this._removedLayers[h]&&m.source&&m.type!=="custom"){const b=this._removedLayers[h];delete this._removedLayers[h],b.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new c.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const l=this._order.indexOf(e);this._order.splice(l,1);const h=n?this._order.indexOf(n):this._order.length;n&&h===-1?this.fire(new c.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(h,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,l){this._checkLoaded();const h=this.getLayer(e);h?h.minzoom===n&&h.maxzoom===l||(n!=null&&(h.minzoom=n),l!=null&&(h.maxzoom=l),this._updateLayer(h)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,l={}){this._checkLoaded();const h=this.getLayer(e);if(h){if(!c.bG(h.filter,n))return n==null?(h.setFilter(void 0),void this._updateLayer(h)):void(this._validate(c.z.filter,`layers.${h.id}.filter`,n,null,l)||(h.setFilter(c.bJ(n)),this._updateLayer(h)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return c.bJ(this.getLayer(e).filter)}setLayoutProperty(e,n,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?c.bG(m.getLayoutProperty(n),l)||(m.setLayoutProperty(n,l,h),this._updateLayer(m)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const l=this.getLayer(e);if(l)return l.getLayoutProperty(n);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,l,h={}){this._checkLoaded();const m=this.getLayer(e);m?c.bG(m.getPaintProperty(n),l)||(m.setPaintProperty(n,l,h)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new c.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const l=e.source,h=e.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const y=m.getSource().type;y==="geojson"&&h?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):y!=="vector"||h?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),m.setFeatureState(h,e.id,n)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const l=e.source,h=this.sourceCaches[l];if(h===void 0)return void this.fire(new c.k(new Error(`The source '${l}' does not exist in the map's style.`)));const m=h.getSource().type,y=m==="vector"?e.sourceLayer:void 0;m!=="vector"||y?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):h.removeFeatureState(y,e.id,n):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,l=e.sourceLayer,h=this.sourceCaches[n];if(h!==void 0)return h.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),h.getFeatureState(l,e.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=c.bM(this.sourceCaches,m=>m.serialize()),n=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,h=this.stylesheet;return c.bN({version:h.version,name:h.name,metadata:h.metadata,light:h.light,sky:h.sky,center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,sprite:h.sprite,glyphs:h.glyphs,transition:h.transition,projection:h.projection,sources:e,layers:n,terrain:l},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=y=>this._layers[y].type==="fill-extrusion",l={},h=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b)){l[b]=y;for(const T of e){const A=T[b];if(A)for(const z of A)h.push(z)}}}h.sort((y,b)=>b.intersectionZ-y.intersectionZ);const m=[];for(let y=this._order.length-1;y>=0;y--){const b=this._order[y];if(n(b))for(let T=h.length-1;T>=0;T--){const A=h[T].feature;if(l[A.layer.id]<y)break;m.push(A),h.pop()}else for(const T of e){const A=T[b];if(A)for(const z of A)m.push(z.feature)}}return m}queryRenderedFeatures(e,n,l){n&&n.filter&&this._validate(c.z.filter,"queryRenderedFeatures.filter",n.filter,null,n);const h={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const A of n.layers){const z=this._layers[A];if(!z)return this.fire(new c.k(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];h[z.source]=!0}}const m=[];n.availableImages=this._availableImages;const y=this._serializedAllLayers(),b=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,T=Object.assign(Object.assign({},n),{layers:b});for(const A in this.sourceCaches)n.layers&&!h[A]||m.push(Ki(this.sourceCaches[A],this._layers,y,e,T,l,this.map.terrain?(z,O,L)=>this.map.terrain.getElevation(z,O,L):void 0));return this.placement&&m.push(function(A,z,O,L,N,Z,ne){const ie={},re=Z.queryRenderedSymbols(L),oe=[];for(const fe of Object.keys(re).map(Number))oe.push(ne[fe]);oe.sort(uo);for(const fe of oe){const le=fe.featureIndex.lookupSymbolFeatures(re[fe.bucketInstanceId],z,fe.bucketIndex,fe.sourceLayerIndex,N.filter,N.layers,N.availableImages,A);for(const ge in le){const ve=ie[ge]=ie[ge]||[],ue=le[ge];ue.sort((Te,Oe)=>{const ze=fe.featureSortOrder;if(ze){const Re=ze.indexOf(Te.featureIndex);return ze.indexOf(Oe.featureIndex)-Re}return Oe.featureIndex-Te.featureIndex});for(const Te of ue)ve.push(Te)}}return function(fe,le,ge){for(const ve in fe)for(const ue of fe[ve])cr(ue,ge[le[ve].source]);return fe}(ie,A,O)}(this._layers,y,this.sourceCaches,e,T,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,n){n&&n.filter&&this._validate(c.z.filter,"querySourceFeatures.filter",n.filter,null,n);const l=this.sourceCaches[e];return l?function(h,m){const y=h.getRenderableIds().map(A=>h.getTileByID(A)),b=[],T={};for(let A=0;A<y.length;A++){const z=y[A],O=z.tileID.canonical.key;T[O]||(T[O]=!0,z.querySourceFeatures(b,m))}return b}(l,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const l=this.light.getLight();let h=!1;for(const y in e)if(!c.bG(e[y],l[y])){h=!0;break}if(!h)return;const m={now:K.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(m)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){this._checkLoaded();const l=this.getSky();let h=!1;if(!e&&!l)return;if(e&&!l)h=!0;else if(!e&&l)h=!0;else for(const y in e)if(!c.bG(e[y],l[y])){h=!0;break}if(!h)return;const m={now:K.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(m)}_setProjectionInternal(e){const n=function(l){if(Array.isArray(l)){const h=new Os({type:l});return{projection:h,transform:new Gr,cameraHelper:new Fc(h)}}switch(l){case"mercator":return{projection:new rl,transform:new cn,cameraHelper:new Sa};case"globe":{const h=new Os({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:h,transform:new Gr,cameraHelper:new Fc(h)}}case"vertical-perspective":return{projection:new Nc,transform:new hl,cameraHelper:new Pr};default:return c.w(`Unknown projection name: ${l}. Falling back to mercator projection.`),{projection:new rl,transform:new cn,cameraHelper:new Sa}}}(e);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const l in this.sourceCaches)this.sourceCaches[l].reload()}_validate(e,n,l,h,m={}){return(!m||m.validate!==!1)&&ic(this,e.call(c.z,c.e({key:n,style:this.serialize(),value:l,styleSpec:c.v},h)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),an().off(ss,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const l=this.sourceCaches[n];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,l,h,m=!1){let y=!1,b=!1;const T={};for(const A of this._order){const z=this._layers[A];if(z.type!=="symbol")continue;if(!T[z.source]){const L=this.sourceCaches[z.source];T[z.source]=L.getRenderableIds(!0).map(N=>L.getTileByID(N)).sort((N,Z)=>Z.tileID.overscaledZ-N.tileID.overscaledZ||(N.tileID.isLessThan(Z.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(z,T[z.source],e.center.lng);y=y||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(K.now(),e.zoom))&&(this.pauseablePlacement=new Bc(e,this.map.terrain,this._order,m,n,l,h,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(K.now()),b=!0),y&&this.pauseablePlacement.placement.setStale()),b||y)for(const A of this._order){const z=this._layers[A];z.type==="symbol"&&this.placement.updateLayerOpacities(z,T[z.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(K.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return c._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const h=this.sourceCaches[n.source];return h&&h.setDependencies(n.tileID.key,n.type,n.icons),l})}getGlyphs(e,n){return c._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(n.stacks),h=this.sourceCaches[n.source];return h&&h.setDependencies(n.tileID.key,n.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(c.z.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,l={},h){this._checkLoaded();const m=[{id:e,url:n}],y=[...Ye(this.stylesheet.sprite),...m];this._validate(c.z.sprite,"sprite",y,null,l)||(this.stylesheet.sprite=y,this._loadSprite(m,!0,h))}removeSprite(e){this._checkLoaded();const n=Ye(this.stylesheet.sprite);if(n.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;n.splice(n.findIndex(l=>l.id===e),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ye(this.stylesheet.sprite)}setSprite(e,n={},l){this._checkLoaded(),e&&this._validate(c.z.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Df=c.aI([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Lf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,l,h,m,y,b,T,A){this.context=e;let z=this.boundPaintVertexBuffers.length!==h.length;for(let O=0;!z&&O<h.length;O++)this.boundPaintVertexBuffers[O]!==h[O]&&(z=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==l||z||this.boundIndexBuffer!==m||this.boundVertexOffset!==y||this.boundDynamicVertexBuffer!==b||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==A?this.freshBind(n,l,h,m,y,b,T,A):(e.bindVertexArray.set(this.vao),b&&b.bind(),m&&m.dynamicDraw&&m.bind(),T&&T.bind(),A&&A.bind())}freshBind(e,n,l,h,m,y,b,T){const A=e.numAttributes,z=this.context,O=z.gl;this.vao&&this.destroy(),this.vao=z.createVertexArray(),z.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=y,this.boundDynamicVertexBuffer2=b,this.boundDynamicVertexBuffer3=T,n.enableAttributes(O,e);for(const L of l)L.enableAttributes(O,e);y&&y.enableAttributes(O,e),b&&b.enableAttributes(O,e),T&&T.enableAttributes(O,e),n.bind(),n.setVertexAttribPointers(O,e,m);for(const L of l)L.bind(),L.setVertexAttribPointers(O,e,m);y&&(y.bind(),y.setVertexAttribPointers(O,e,m)),h&&h.bind(),b&&(b.bind(),b.setVertexAttribPointers(O,e,m)),T&&(T.bind(),T.setVertexAttribPointers(O,e,m)),z.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const kf=(d,e,n,l,h)=>({u_texture:0,u_ele_delta:d,u_fog_matrix:e,u_fog_color:n?n.properties.get("fog-color"):c.be.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:h?0:n?n.calculateFogBlendOpacity(l):0,u_horizon_color:n?n.properties.get("horizon-color"):c.be.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:h?1:0}),Of={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function jc(d){const e=[];for(let n=0;n<d.length;n++){if(d[n]===null)continue;const l=d[n].split(" ");e.push(l.pop())}return e}class Uc{constructor(e,n,l,h,m,y,b,T,A=[]){const z=e.gl;this.program=z.createProgram();const O=jc(n.staticAttributes),L=l?l.getBinderAttributes():[],N=O.concat(L),Z=Ua.prelude.staticUniforms?jc(Ua.prelude.staticUniforms):[],ne=b.staticUniforms?jc(b.staticUniforms):[],ie=n.staticUniforms?jc(n.staticUniforms):[],re=l?l.getBinderUniforms():[],oe=Z.concat(ne).concat(ie).concat(re),fe=[];for(const ze of oe)fe.indexOf(ze)<0&&fe.push(ze);const le=l?l.defines():[];Mn(z)&&le.unshift("#version 300 es"),m&&le.push("#define OVERDRAW_INSPECTOR;"),y&&le.push("#define TERRAIN3D;"),T&&le.push(T),A&&le.push(...A);let ge=le.concat(Ua.prelude.fragmentSource,b.fragmentSource,n.fragmentSource).join(`
`),ve=le.concat(Ua.prelude.vertexSource,b.vertexSource,n.vertexSource).join(`
`);Mn(z)||(ge=function(ze){return ze.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(ge),ve=function(ze){return ze.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(ve));const ue=z.createShader(z.FRAGMENT_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(ue,ge),z.compileShader(ue),!z.getShaderParameter(ue,z.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${z.getShaderInfoLog(ue)}`);z.attachShader(this.program,ue);const Te=z.createShader(z.VERTEX_SHADER);if(z.isContextLost())return void(this.failedToCreate=!0);if(z.shaderSource(Te,ve),z.compileShader(Te),!z.getShaderParameter(Te,z.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${z.getShaderInfoLog(Te)}`);z.attachShader(this.program,Te),this.attributes={};const Oe={};this.numAttributes=N.length;for(let ze=0;ze<this.numAttributes;ze++)N[ze]&&(z.bindAttribLocation(this.program,ze,N[ze]),this.attributes[N[ze]]=ze);if(z.linkProgram(this.program),!z.getProgramParameter(this.program,z.LINK_STATUS))throw new Error(`Program failed to link: ${z.getProgramInfoLog(this.program)}`);z.deleteShader(Te),z.deleteShader(ue);for(let ze=0;ze<fe.length;ze++){const Re=fe[ze];if(Re&&!Oe[Re]){const Be=z.getUniformLocation(this.program,Re);Be&&(Oe[Re]=Be)}}this.fixedUniforms=h(e,Oe),this.terrainUniforms=((ze,Re)=>({u_depth:new c.bO(ze,Re.u_depth),u_terrain:new c.bO(ze,Re.u_terrain),u_terrain_dim:new c.bf(ze,Re.u_terrain_dim),u_terrain_matrix:new c.bQ(ze,Re.u_terrain_matrix),u_terrain_unpack:new c.bR(ze,Re.u_terrain_unpack),u_terrain_exaggeration:new c.bf(ze,Re.u_terrain_exaggeration)}))(e,Oe),this.projectionUniforms=((ze,Re)=>({u_projection_matrix:new c.bQ(ze,Re.u_projection_matrix),u_projection_tile_mercator_coords:new c.bR(ze,Re.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.bR(ze,Re.u_projection_clipping_plane),u_projection_transition:new c.bf(ze,Re.u_projection_transition),u_projection_fallback_matrix:new c.bQ(ze,Re.u_projection_fallback_matrix)}))(e,Oe),this.binderUniforms=l?l.getUniforms(e,Oe):[]}draw(e,n,l,h,m,y,b,T,A,z,O,L,N,Z,ne,ie,re,oe,fe){const le=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(h),e.setColorMode(m),e.setCullFace(y),T){e.activeTexture.set(le.TEXTURE2),le.bindTexture(le.TEXTURE_2D,T.depthTexture),e.activeTexture.set(le.TEXTURE3),le.bindTexture(le.TEXTURE_2D,T.texture);for(const ve in this.terrainUniforms)this.terrainUniforms[ve].set(T[ve])}if(A)for(const ve in A)this.projectionUniforms[Of[ve]].set(A[ve]);if(b)for(const ve in this.fixedUniforms)this.fixedUniforms[ve].set(b[ve]);ie&&ie.setUniforms(e,this.binderUniforms,Z,{zoom:ne});let ge=0;switch(n){case le.LINES:ge=2;break;case le.TRIANGLES:ge=3;break;case le.LINE_STRIP:ge=1}for(const ve of N.get()){const ue=ve.vaos||(ve.vaos={});(ue[z]||(ue[z]=new Lf)).bind(e,this,O,ie?ie.getPaintVertexBuffers():[],L,ve.vertexOffset,re,oe,fe),le.drawElements(n,ve.primitiveLength*ge,le.UNSIGNED_SHORT,ve.primitiveOffset*ge*2)}}}function dl(d,e,n){const l=1/c.aB(n,1,e.transform.tileZoom),h=Math.pow(2,n.tileID.overscaledZ),m=n.tileSize*Math.pow(2,e.transform.tileZoom)/h,y=m*(n.tileID.canonical.x+n.tileID.wrap*h),b=m*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[l,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const ds=(d,e,n,l)=>{const h=d.style.light,m=h.properties.get("position"),y=[m.x,m.y,m.z],b=c.bU();h.properties.get("anchor")==="viewport"&&c.bV(b,d.transform.bearingInRadians),c.bW(y,y,b);const T=d.transform.transformLightDirection(y),A=h.properties.get("color");return{u_lightpos:y,u_lightpos_globe:T,u_lightintensity:h.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+e,u_opacity:n,u_fill_translate:l}},Bu=(d,e,n,l,h,m,y)=>c.e(ds(d,e,n,l),dl(m,d,y),{u_height_factor:-Math.pow(2,h.overscaledZ)/y.tileSize/8}),nc=(d,e,n,l)=>c.e(dl(e,d,n),{u_fill_translate:l}),Ea=(d,e)=>({u_world:d,u_fill_translate:e}),Nh=(d,e,n,l,h)=>c.e(nc(d,e,n,h),{u_world:l}),Vc=(d,e,n,l,h)=>{const m=d.transform;let y,b,T=0;if(n.paint.get("circle-pitch-alignment")==="map"){const A=c.aB(e,1,m.zoom);y=!0,b=[A,A],T=A/(c.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*h}else y=!1,b=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+y,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:b,u_globe_extrude_scale:T,u_translate:l}},pl=d=>({u_pixel_extrude_scale:[1/d.width,1/d.height]}),qa=d=>({u_viewport_size:[d.width,d.height]}),Fh=(d,e=1)=>({u_color:d,u_overlay:0,u_overlay_scale:e}),rc=(d,e,n,l)=>{const h=c.aB(d,1,e)/(c.$*Math.pow(2,d.tileID.overscaledZ))*2*Math.PI*l;return{u_extrude_scale:c.aB(d,1,e),u_intensity:n,u_globe_extrude_scale:h}},jh=(d,e,n,l)=>{const h=c.L();c.bX(h,0,d.width,d.height,0,0,1);const m=d.context.gl;return{u_matrix:h,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:n,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}},xo=(d,e,n)=>{const l=n.paint.get("hillshade-accent-color");let h;switch(n.paint.get("hillshade-method")){case"basic":h=4;break;case"combined":h=1;break;case"igor":h=2;break;case"multidirectional":h=3;break;default:h=0}const m=n.getIlluminationProperties();for(let y=0;y<m.directionRadians.length;y++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(m.directionRadians[y]+=d.transform.bearingInRadians);return{u_image:0,u_latrange:ml(0,e.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:m.altitudeRadians,u_azimuths:m.directionRadians,u_accent:l,u_method:h,u_highlights:m.highlightColor,u_shadows:m.shadowColor}},Uh=(d,e)=>{const n=e.stride,l=c.L();return c.bX(l,0,c.$,-c.$,0,0,1),c.M(l,l,[0,-c.$,0]),{u_matrix:l,u_image:1,u_dimension:[n,n],u_zoom:d.overscaledZ,u_unpack:e.getUnpackVector()}};function ml(d,e){const n=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new c.a0(0,l/n).toLngLat().lat,new c.a0(0,(l+1)/n).toLngLat().lat]}const ac=(d,e,n=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:d.paint.get("color-relief-opacity")}),Gc=(d,e,n,l)=>{const h=d.transform;return{u_translation:oc(d,e,n),u_ratio:l/c.aB(e,1,h.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},gl=(d,e,n,l,h)=>c.e(Gc(d,e,n,l),{u_image:0,u_image_height:h}),Nu=(d,e,n,l,h)=>{const m=d.transform,y=sc(e,m);return{u_translation:oc(d,e,n),u_texsize:e.imageAtlasTexture.size,u_ratio:l/c.aB(e,1,m.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[y,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Fu=(d,e,n,l,h,m)=>{const y=d.lineAtlas,b=sc(e,d.transform),T=n.layout.get("line-cap")==="round",A=y.getDash(h.from,T),z=y.getDash(h.to,T),O=A.width*m.fromScale,L=z.width*m.toScale;return c.e(Gc(d,e,n,l),{u_patternscale_a:[b/O,-A.height/2],u_patternscale_b:[b/L,-z.height/2],u_sdfgamma:y.width/(256*Math.min(O,L)*d.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:z.y,u_mix:m.t})};function sc(d,e){return 1/c.aB(d,1,e.tileZoom)}function oc(d,e,n){return c.aC(d.transform,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const Ns=(d,e,n,l,h)=>{return{u_tl_parent:d,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*l.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:l.paint.get("raster-brightness-min"),u_brightness_high:l.paint.get("raster-brightness-max"),u_saturation_factor:(y=l.paint.get("raster-saturation"),y>0?1-1/(1.001-y):-y),u_contrast_factor:(m=l.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:ju(l.paint.get("raster-hue-rotate")),u_coords_top:[h[0].x,h[0].y,h[1].x,h[1].y],u_coords_bottom:[h[3].x,h[3].y,h[2].x,h[2].y]};var m,y};function ju(d){d*=Math.PI/180;const e=Math.sin(d),n=Math.cos(d);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Zc=(d,e,n,l,h,m,y,b,T,A,z,O,L)=>{const N=y.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:N.cameraToCenterDistance,u_pitch:N.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:N.width/N.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_label_plane_matrix:b,u_coord_matrix:T,u_is_text:+z,u_pitch_with_map:+l,u_is_along_line:h,u_is_variable_anchor:m,u_texsize:O,u_texture:0,u_translation:A,u_pitched_scale:L}},_l=(d,e,n,l,h,m,y,b,T,A,z,O,L,N)=>{const Z=y.transform;return c.e(Zc(d,e,n,l,h,m,y,b,T,A,z,O,N),{u_gamma_scale:l?Math.cos(Z.pitch*Math.PI/180)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:y.pixelRatio,u_is_halo:1})},Bf=(d,e,n,l,h,m,y,b,T,A,z,O,L)=>c.e(_l(d,e,n,l,h,m,y,b,T,A,!0,z,0,L),{u_texsize_icon:O,u_texture_icon:1}),qc=(d,e)=>({u_opacity:d,u_color:e}),Nf=(d,e,n,l,h)=>c.e(function(m,y,b,T){const A=b.imageManager.getPattern(m.from.toString()),z=b.imageManager.getPattern(m.to.toString()),{width:O,height:L}=b.imageManager.getPixelSize(),N=Math.pow(2,T.tileID.overscaledZ),Z=T.tileSize*Math.pow(2,b.transform.tileZoom)/N,ne=Z*(T.tileID.canonical.x+T.tileID.wrap*N),ie=Z*T.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:z.tl,u_pattern_br_b:z.br,u_texsize:[O,L],u_mix:y.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:z.displaySize,u_scale_a:y.fromScale,u_scale_b:y.toScale,u_tile_units_to_pixels:1/c.aB(T,1,b.transform.tileZoom),u_pixel_coord_upper:[ne>>16,ie>>16],u_pixel_coord_lower:[65535&ne,65535&ie]}}(n,h,e,l),{u_opacity:d}),Vh=(d,e)=>{},zr={fillExtrusion:(d,e)=>({u_lightpos:new c.bS(d,e.u_lightpos),u_lightpos_globe:new c.bS(d,e.u_lightpos_globe),u_lightintensity:new c.bf(d,e.u_lightintensity),u_lightcolor:new c.bS(d,e.u_lightcolor),u_vertical_gradient:new c.bf(d,e.u_vertical_gradient),u_opacity:new c.bf(d,e.u_opacity),u_fill_translate:new c.bT(d,e.u_fill_translate)}),fillExtrusionPattern:(d,e)=>({u_lightpos:new c.bS(d,e.u_lightpos),u_lightpos_globe:new c.bS(d,e.u_lightpos_globe),u_lightintensity:new c.bf(d,e.u_lightintensity),u_lightcolor:new c.bS(d,e.u_lightcolor),u_vertical_gradient:new c.bf(d,e.u_vertical_gradient),u_height_factor:new c.bf(d,e.u_height_factor),u_opacity:new c.bf(d,e.u_opacity),u_fill_translate:new c.bT(d,e.u_fill_translate),u_image:new c.bO(d,e.u_image),u_texsize:new c.bT(d,e.u_texsize),u_pixel_coord_upper:new c.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(d,e.u_pixel_coord_lower),u_scale:new c.bS(d,e.u_scale),u_fade:new c.bf(d,e.u_fade)}),fill:(d,e)=>({u_fill_translate:new c.bT(d,e.u_fill_translate)}),fillPattern:(d,e)=>({u_image:new c.bO(d,e.u_image),u_texsize:new c.bT(d,e.u_texsize),u_pixel_coord_upper:new c.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(d,e.u_pixel_coord_lower),u_scale:new c.bS(d,e.u_scale),u_fade:new c.bf(d,e.u_fade),u_fill_translate:new c.bT(d,e.u_fill_translate)}),fillOutline:(d,e)=>({u_world:new c.bT(d,e.u_world),u_fill_translate:new c.bT(d,e.u_fill_translate)}),fillOutlinePattern:(d,e)=>({u_world:new c.bT(d,e.u_world),u_image:new c.bO(d,e.u_image),u_texsize:new c.bT(d,e.u_texsize),u_pixel_coord_upper:new c.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(d,e.u_pixel_coord_lower),u_scale:new c.bS(d,e.u_scale),u_fade:new c.bf(d,e.u_fade),u_fill_translate:new c.bT(d,e.u_fill_translate)}),circle:(d,e)=>({u_camera_to_center_distance:new c.bf(d,e.u_camera_to_center_distance),u_scale_with_map:new c.bO(d,e.u_scale_with_map),u_pitch_with_map:new c.bO(d,e.u_pitch_with_map),u_extrude_scale:new c.bT(d,e.u_extrude_scale),u_device_pixel_ratio:new c.bf(d,e.u_device_pixel_ratio),u_globe_extrude_scale:new c.bf(d,e.u_globe_extrude_scale),u_translate:new c.bT(d,e.u_translate)}),collisionBox:(d,e)=>({u_pixel_extrude_scale:new c.bT(d,e.u_pixel_extrude_scale)}),collisionCircle:(d,e)=>({u_viewport_size:new c.bT(d,e.u_viewport_size)}),debug:(d,e)=>({u_color:new c.bP(d,e.u_color),u_overlay:new c.bO(d,e.u_overlay),u_overlay_scale:new c.bf(d,e.u_overlay_scale)}),depth:Vh,clippingMask:Vh,heatmap:(d,e)=>({u_extrude_scale:new c.bf(d,e.u_extrude_scale),u_intensity:new c.bf(d,e.u_intensity),u_globe_extrude_scale:new c.bf(d,e.u_globe_extrude_scale)}),heatmapTexture:(d,e)=>({u_matrix:new c.bQ(d,e.u_matrix),u_world:new c.bT(d,e.u_world),u_image:new c.bO(d,e.u_image),u_color_ramp:new c.bO(d,e.u_color_ramp),u_opacity:new c.bf(d,e.u_opacity)}),hillshade:(d,e)=>({u_image:new c.bO(d,e.u_image),u_latrange:new c.bT(d,e.u_latrange),u_exaggeration:new c.bf(d,e.u_exaggeration),u_altitudes:new c.bZ(d,e.u_altitudes),u_azimuths:new c.bZ(d,e.u_azimuths),u_accent:new c.bP(d,e.u_accent),u_method:new c.bO(d,e.u_method),u_shadows:new c.bY(d,e.u_shadows),u_highlights:new c.bY(d,e.u_highlights)}),hillshadePrepare:(d,e)=>({u_matrix:new c.bQ(d,e.u_matrix),u_image:new c.bO(d,e.u_image),u_dimension:new c.bT(d,e.u_dimension),u_zoom:new c.bf(d,e.u_zoom),u_unpack:new c.bR(d,e.u_unpack)}),colorRelief:(d,e)=>({u_image:new c.bO(d,e.u_image),u_unpack:new c.bR(d,e.u_unpack),u_dimension:new c.bT(d,e.u_dimension),u_elevation_stops:new c.bO(d,e.u_elevation_stops),u_color_stops:new c.bO(d,e.u_color_stops),u_color_ramp_size:new c.bO(d,e.u_color_ramp_size),u_opacity:new c.bf(d,e.u_opacity)}),line:(d,e)=>({u_translation:new c.bT(d,e.u_translation),u_ratio:new c.bf(d,e.u_ratio),u_device_pixel_ratio:new c.bf(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.bT(d,e.u_units_to_pixels)}),lineGradient:(d,e)=>({u_translation:new c.bT(d,e.u_translation),u_ratio:new c.bf(d,e.u_ratio),u_device_pixel_ratio:new c.bf(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.bT(d,e.u_units_to_pixels),u_image:new c.bO(d,e.u_image),u_image_height:new c.bf(d,e.u_image_height)}),linePattern:(d,e)=>({u_translation:new c.bT(d,e.u_translation),u_texsize:new c.bT(d,e.u_texsize),u_ratio:new c.bf(d,e.u_ratio),u_device_pixel_ratio:new c.bf(d,e.u_device_pixel_ratio),u_image:new c.bO(d,e.u_image),u_units_to_pixels:new c.bT(d,e.u_units_to_pixels),u_scale:new c.bS(d,e.u_scale),u_fade:new c.bf(d,e.u_fade)}),lineSDF:(d,e)=>({u_translation:new c.bT(d,e.u_translation),u_ratio:new c.bf(d,e.u_ratio),u_device_pixel_ratio:new c.bf(d,e.u_device_pixel_ratio),u_units_to_pixels:new c.bT(d,e.u_units_to_pixels),u_patternscale_a:new c.bT(d,e.u_patternscale_a),u_patternscale_b:new c.bT(d,e.u_patternscale_b),u_sdfgamma:new c.bf(d,e.u_sdfgamma),u_image:new c.bO(d,e.u_image),u_tex_y_a:new c.bf(d,e.u_tex_y_a),u_tex_y_b:new c.bf(d,e.u_tex_y_b),u_mix:new c.bf(d,e.u_mix)}),raster:(d,e)=>({u_tl_parent:new c.bT(d,e.u_tl_parent),u_scale_parent:new c.bf(d,e.u_scale_parent),u_buffer_scale:new c.bf(d,e.u_buffer_scale),u_fade_t:new c.bf(d,e.u_fade_t),u_opacity:new c.bf(d,e.u_opacity),u_image0:new c.bO(d,e.u_image0),u_image1:new c.bO(d,e.u_image1),u_brightness_low:new c.bf(d,e.u_brightness_low),u_brightness_high:new c.bf(d,e.u_brightness_high),u_saturation_factor:new c.bf(d,e.u_saturation_factor),u_contrast_factor:new c.bf(d,e.u_contrast_factor),u_spin_weights:new c.bS(d,e.u_spin_weights),u_coords_top:new c.bR(d,e.u_coords_top),u_coords_bottom:new c.bR(d,e.u_coords_bottom)}),symbolIcon:(d,e)=>({u_is_size_zoom_constant:new c.bO(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bO(d,e.u_is_size_feature_constant),u_size_t:new c.bf(d,e.u_size_t),u_size:new c.bf(d,e.u_size),u_camera_to_center_distance:new c.bf(d,e.u_camera_to_center_distance),u_pitch:new c.bf(d,e.u_pitch),u_rotate_symbol:new c.bO(d,e.u_rotate_symbol),u_aspect_ratio:new c.bf(d,e.u_aspect_ratio),u_fade_change:new c.bf(d,e.u_fade_change),u_label_plane_matrix:new c.bQ(d,e.u_label_plane_matrix),u_coord_matrix:new c.bQ(d,e.u_coord_matrix),u_is_text:new c.bO(d,e.u_is_text),u_pitch_with_map:new c.bO(d,e.u_pitch_with_map),u_is_along_line:new c.bO(d,e.u_is_along_line),u_is_variable_anchor:new c.bO(d,e.u_is_variable_anchor),u_texsize:new c.bT(d,e.u_texsize),u_texture:new c.bO(d,e.u_texture),u_translation:new c.bT(d,e.u_translation),u_pitched_scale:new c.bf(d,e.u_pitched_scale)}),symbolSDF:(d,e)=>({u_is_size_zoom_constant:new c.bO(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bO(d,e.u_is_size_feature_constant),u_size_t:new c.bf(d,e.u_size_t),u_size:new c.bf(d,e.u_size),u_camera_to_center_distance:new c.bf(d,e.u_camera_to_center_distance),u_pitch:new c.bf(d,e.u_pitch),u_rotate_symbol:new c.bO(d,e.u_rotate_symbol),u_aspect_ratio:new c.bf(d,e.u_aspect_ratio),u_fade_change:new c.bf(d,e.u_fade_change),u_label_plane_matrix:new c.bQ(d,e.u_label_plane_matrix),u_coord_matrix:new c.bQ(d,e.u_coord_matrix),u_is_text:new c.bO(d,e.u_is_text),u_pitch_with_map:new c.bO(d,e.u_pitch_with_map),u_is_along_line:new c.bO(d,e.u_is_along_line),u_is_variable_anchor:new c.bO(d,e.u_is_variable_anchor),u_texsize:new c.bT(d,e.u_texsize),u_texture:new c.bO(d,e.u_texture),u_gamma_scale:new c.bf(d,e.u_gamma_scale),u_device_pixel_ratio:new c.bf(d,e.u_device_pixel_ratio),u_is_halo:new c.bO(d,e.u_is_halo),u_translation:new c.bT(d,e.u_translation),u_pitched_scale:new c.bf(d,e.u_pitched_scale)}),symbolTextAndIcon:(d,e)=>({u_is_size_zoom_constant:new c.bO(d,e.u_is_size_zoom_constant),u_is_size_feature_constant:new c.bO(d,e.u_is_size_feature_constant),u_size_t:new c.bf(d,e.u_size_t),u_size:new c.bf(d,e.u_size),u_camera_to_center_distance:new c.bf(d,e.u_camera_to_center_distance),u_pitch:new c.bf(d,e.u_pitch),u_rotate_symbol:new c.bO(d,e.u_rotate_symbol),u_aspect_ratio:new c.bf(d,e.u_aspect_ratio),u_fade_change:new c.bf(d,e.u_fade_change),u_label_plane_matrix:new c.bQ(d,e.u_label_plane_matrix),u_coord_matrix:new c.bQ(d,e.u_coord_matrix),u_is_text:new c.bO(d,e.u_is_text),u_pitch_with_map:new c.bO(d,e.u_pitch_with_map),u_is_along_line:new c.bO(d,e.u_is_along_line),u_is_variable_anchor:new c.bO(d,e.u_is_variable_anchor),u_texsize:new c.bT(d,e.u_texsize),u_texsize_icon:new c.bT(d,e.u_texsize_icon),u_texture:new c.bO(d,e.u_texture),u_texture_icon:new c.bO(d,e.u_texture_icon),u_gamma_scale:new c.bf(d,e.u_gamma_scale),u_device_pixel_ratio:new c.bf(d,e.u_device_pixel_ratio),u_is_halo:new c.bO(d,e.u_is_halo),u_translation:new c.bT(d,e.u_translation),u_pitched_scale:new c.bf(d,e.u_pitched_scale)}),background:(d,e)=>({u_opacity:new c.bf(d,e.u_opacity),u_color:new c.bP(d,e.u_color)}),backgroundPattern:(d,e)=>({u_opacity:new c.bf(d,e.u_opacity),u_image:new c.bO(d,e.u_image),u_pattern_tl_a:new c.bT(d,e.u_pattern_tl_a),u_pattern_br_a:new c.bT(d,e.u_pattern_br_a),u_pattern_tl_b:new c.bT(d,e.u_pattern_tl_b),u_pattern_br_b:new c.bT(d,e.u_pattern_br_b),u_texsize:new c.bT(d,e.u_texsize),u_mix:new c.bf(d,e.u_mix),u_pattern_size_a:new c.bT(d,e.u_pattern_size_a),u_pattern_size_b:new c.bT(d,e.u_pattern_size_b),u_scale_a:new c.bf(d,e.u_scale_a),u_scale_b:new c.bf(d,e.u_scale_b),u_pixel_coord_upper:new c.bT(d,e.u_pixel_coord_upper),u_pixel_coord_lower:new c.bT(d,e.u_pixel_coord_lower),u_tile_units_to_pixels:new c.bf(d,e.u_tile_units_to_pixels)}),terrain:(d,e)=>({u_texture:new c.bO(d,e.u_texture),u_ele_delta:new c.bf(d,e.u_ele_delta),u_fog_matrix:new c.bQ(d,e.u_fog_matrix),u_fog_color:new c.bP(d,e.u_fog_color),u_fog_ground_blend:new c.bf(d,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.bf(d,e.u_fog_ground_blend_opacity),u_horizon_color:new c.bP(d,e.u_horizon_color),u_horizon_fog_blend:new c.bf(d,e.u_horizon_fog_blend),u_is_globe_mode:new c.bf(d,e.u_is_globe_mode)}),terrainDepth:(d,e)=>({u_ele_delta:new c.bf(d,e.u_ele_delta)}),terrainCoords:(d,e)=>({u_texture:new c.bO(d,e.u_texture),u_terrain_coords_id:new c.bf(d,e.u_terrain_coords_id),u_ele_delta:new c.bf(d,e.u_ele_delta)}),projectionErrorMeasurement:(d,e)=>({u_input:new c.bf(d,e.u_input),u_output_expected:new c.bf(d,e.u_output_expected)}),atmosphere:(d,e)=>({u_sun_pos:new c.bS(d,e.u_sun_pos),u_atmosphere_blend:new c.bf(d,e.u_atmosphere_blend),u_globe_position:new c.bS(d,e.u_globe_position),u_globe_radius:new c.bf(d,e.u_globe_radius),u_inv_proj_matrix:new c.bQ(d,e.u_inv_proj_matrix)}),sky:(d,e)=>({u_sky_color:new c.bP(d,e.u_sky_color),u_horizon_color:new c.bP(d,e.u_horizon_color),u_horizon:new c.bT(d,e.u_horizon),u_horizon_normal:new c.bT(d,e.u_horizon_normal),u_sky_horizon_blend:new c.bf(d,e.u_sky_horizon_blend),u_sky_blend:new c.bf(d,e.u_sky_blend)})};class yl{constructor(e,n,l){this.context=e;const h=e.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Uu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $c{constructor(e,n,l,h){this.length=n.length,this.attributes=l,this.itemSize=n.bytesPerElement,this.dynamicDraw=h,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let l=0;l<this.attributes.length;l++){const h=n.attributes[this.attributes[l].name];h!==void 0&&e.enableVertexAttribArray(h)}}setVertexAttribPointers(e,n,l){for(let h=0;h<this.attributes.length;h++){const m=this.attributes[h],y=n.attributes[m.name];y!==void 0&&e.vertexAttribPointer(y,m.components,e[Uu[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class lc extends bi{getDefault(){return c.be.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ca extends bi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Vu extends bi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Fs extends bi{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class cc extends bi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class vl extends bi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class uc extends bi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class js extends bi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class ps extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class xl extends bi{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Gu extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class Gh extends bi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class bo extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class Zu extends bi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Zh extends bi{getDefault(){return c.be.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class qu extends bi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Hc extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Xc extends bi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Yc extends bi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Kc extends bi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Us extends bi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class wo extends bi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class hr extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Zr extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class qr extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class $r extends bi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Vs extends bi{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ms extends bi{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const l=this.gl;Mn(l)?l.bindVertexArray(e):(n=l.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class To extends bi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class So extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Mo extends bi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Aa extends bi{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class $u extends Aa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class gs extends Aa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Pa extends Aa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Hu="Framebuffer is not complete";class xr{constructor(e,n,l,h,m){this.context=e,this.width=n,this.height=l;const y=e.gl,b=this.framebuffer=y.createFramebuffer();if(this.colorAttachment=new $u(e,b),h)this.depthAttachment=m?new Pa(e,b):new gs(e,b);else if(m)throw new Error("Stencil cannot be set without depth");if(y.checkFramebufferStatus(y.FRAMEBUFFER)!==y.FRAMEBUFFER_COMPLETE)throw new Error(Hu)}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class si{constructor(e){var n,l;if(this.gl=e,this.clearColor=new lc(this),this.clearDepth=new Ca(this),this.clearStencil=new Vu(this),this.colorMask=new Fs(this),this.depthMask=new cc(this),this.stencilMask=new vl(this),this.stencilFunc=new uc(this),this.stencilOp=new js(this),this.stencilTest=new ps(this),this.depthRange=new xl(this),this.depthTest=new Gu(this),this.depthFunc=new Gh(this),this.blend=new bo(this),this.blendFunc=new Zu(this),this.blendColor=new Zh(this),this.blendEquation=new qu(this),this.cullFace=new Hc(this),this.cullFaceSide=new Xc(this),this.frontFace=new Yc(this),this.program=new Kc(this),this.activeTexture=new Us(this),this.viewport=new wo(this),this.bindFramebuffer=new hr(this),this.bindRenderbuffer=new Zr(this),this.bindTexture=new qr(this),this.bindVertexBuffer=new $r(this),this.bindElementBuffer=new Vs(this),this.bindVertexArray=new ms(this),this.pixelStoreUnpack=new To(this),this.pixelStoreUnpackPremultiplyAlpha=new So(this),this.pixelStoreUnpackFlipY=new Mo(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Mn(e)){this.HALF_FLOAT=e.HALF_FLOAT;const h=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:h?.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:h?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const h=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=h?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new yl(this,e,n)}createVertexBuffer(e,n,l){return new $c(this,e,n,l)}createRenderbuffer(e,n,l){const h=this.gl,m=h.createRenderbuffer();return this.bindRenderbuffer.set(m),h.renderbufferStorage(h.RENDERBUFFER,e,n,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,n,l,h){return new xr(this,e,n,l,h)}clear({color:e,depth:n,stencil:l}){const h=this.gl;let m=0;e&&(m|=h.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(m|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),l!==void 0&&(m|=h.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),h.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){c.bG(e.blendFunction,hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Mn(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return Mn(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let br;function Xu(d,e,n,l,h){const m=d.context,y=d.transform,b=m.gl,T=d.useProgram("collisionBox"),A=[];let z=0,O=0;for(let re=0;re<l.length;re++){const oe=l[re],fe=e.getTile(oe).getBucket(n);if(!fe)continue;const le=h?fe.textCollisionBox:fe.iconCollisionBox,ge=fe.collisionCircleArray;ge.length>0&&(A.push({circleArray:ge,circleOffset:O,coord:oe}),z+=ge.length/4,O=z),le&&T.draw(m,b.LINES,Qt.disabled,Vt.disabled,d.colorModeForRenderPass(),Kt.disabled,pl(d.transform),d.style.map.terrain&&d.style.map.terrain.getTerrainData(oe),y.getProjectionData({overscaledTileID:oe,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,null,d.transform.zoom,null,null,le.collisionVertexBuffer)}if(!h||!A.length)return;const L=d.useProgram("collisionCircle"),N=new c.b_;N.resize(4*z),N._trim();let Z=0;for(const re of A)for(let oe=0;oe<re.circleArray.length/4;oe++){const fe=4*oe,le=re.circleArray[fe+0],ge=re.circleArray[fe+1],ve=re.circleArray[fe+2],ue=re.circleArray[fe+3];N.emplace(Z++,le,ge,ve,ue,0),N.emplace(Z++,le,ge,ve,ue,1),N.emplace(Z++,le,ge,ve,ue,2),N.emplace(Z++,le,ge,ve,ue,3)}(!br||br.length<2*z)&&(br=function(re){const oe=2*re,fe=new c.c0;fe.resize(oe),fe._trim();for(let le=0;le<oe;le++){const ge=6*le;fe.uint16[ge+0]=4*le+0,fe.uint16[ge+1]=4*le+1,fe.uint16[ge+2]=4*le+2,fe.uint16[ge+3]=4*le+2,fe.uint16[ge+4]=4*le+3,fe.uint16[ge+5]=4*le+0}return fe}(z));const ne=m.createIndexBuffer(br,!0),ie=m.createVertexBuffer(N,c.b$.members,!0);for(const re of A){const oe=qa(d.transform);L.draw(m,b.TRIANGLES,Qt.disabled,Vt.disabled,d.colorModeForRenderPass(),Kt.disabled,oe,d.style.map.terrain&&d.style.map.terrain.getTerrainData(re.coord),null,n.id,ie,ne,c.aL.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,d.transform.zoom,null,null,null)}ie.destroy(),ne.destroy()}const hc=c.af(new Float32Array(16));function za(d,e,n,l,h,m){const{horizontalAlign:y,verticalAlign:b}=c.aG(d);return new c.P((-(y-.5)*e/h+l[0])*m,(-(b-.5)*n/h+l[1])*m)}function Yu(d,e,n,l,h,m){const y=e.tileAnchorPoint.add(new c.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let b=l.mult(m);n||(b=b.rotate(-h));const T=y.add(b);return fi(T.x,T.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(n){const b=mt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(d),T=Math.atan(b.y/b.x)+(b.x<0?Math.PI:0);return d.add(l.rotate(T))}return d.add(l)}function Ku(d,e,n,l,h,m,y,b,T,A,z,O){const L=d.text.placedSymbolArray,N=d.text.dynamicLayoutVertexArray,Z=d.icon.dynamicLayoutVertexArray,ne={};N.clear();for(let ie=0;ie<L.length;ie++){const re=L.get(ie),oe=re.hidden||!re.crossTileID||d.allowVerticalPlacement&&!re.placedOrientation?null:l[re.crossTileID];if(oe){const fe=new c.P(re.anchorX,re.anchorY),le={getElevation:O,width:h.width,height:h.height,pitchedLabelPlaneMatrix:m,pitchWithMap:n,transform:h,tileAnchorPoint:fe,translation:A,unwrappedTileID:z},ge=n?Ot(fe.x,fe.y,le):mt(fe.x,fe.y,le),ve=Ut(h.cameraToCenterDistance,ge.signedDistanceFromCamera);let ue=c.ao(d.textSizeData,b,re)*ve/c.aA;n&&(ue*=d.tilePixelRatio/y);const{width:Te,height:Oe,anchor:ze,textOffset:Re,textBoxScale:Be}=oe,gt=za(ze,Te,Oe,Re,Be,ue),pt=h.getPitchedTextCorrection(fe.x+A[0],fe.y+A[1],z),it=Yu(ge.point,le,e,gt,-h.bearingInRadians,pt),Mt=d.allowVerticalPlacement&&re.placedOrientation===c.an.vertical?Math.PI/2:0;for(let ii=0;ii<re.numGlyphs;ii++)c.au(N,it,Mt);T&&re.associatedIconIndex>=0&&(ne[re.associatedIconIndex]={shiftedAnchor:it,angle:Mt})}else ls(re.numGlyphs,N)}if(T){Z.clear();const ie=d.icon.placedSymbolArray;for(let re=0;re<ie.length;re++){const oe=ie.get(re);if(oe.hidden)ls(oe.numGlyphs,Z);else{const fe=ne[re];if(fe)for(let le=0;le<oe.numGlyphs;le++)c.au(Z,fe.shiftedAnchor,fe.angle);else ls(oe.numGlyphs,Z)}}d.icon.dynamicLayoutVertexBuffer.updateData(Z)}d.text.dynamicLayoutVertexBuffer.updateData(N)}function Eo(d,e,n){return n.iconsInText&&e?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Co(d,e,n,l,h,m,y,b,T,A,z,O,L){const N=d.context,Z=N.gl,ne=d.transform,ie=b==="map",re=T==="map",oe=b!=="viewport"&&n.layout.get("symbol-placement")!=="point",fe=ie&&!re&&!oe,le=!n.layout.get("symbol-sort-key").isConstant();let ge=!1;const ve=d.getDepthModeForSublayer(0,Qt.ReadOnly),ue=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=[],Oe=ne.getCircleRadiusCorrection();for(const ze of l){const Re=e.getTile(ze),Be=Re.getBucket(n);if(!Be)continue;const gt=h?Be.text:Be.icon;if(!gt||!gt.segments.get().length||!gt.hasVisibleVertices)continue;const pt=gt.programConfigurations.get(n.id),it=h||Be.sdfIcons,Mt=h?Be.textSizeData:Be.iconSizeData,ii=re||ne.pitch!==0,yi=d.useProgram(Eo(it,h,Be),pt),ln=c.am(Mt,ne.zoom),Pi=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ze);let fn,zi,Ri,Oi,Zn=[0,0],pi=null;if(h)zi=Re.glyphAtlasTexture,Ri=Z.LINEAR,fn=Re.glyphAtlasTexture.size,Be.iconsInText&&(Zn=Re.imageAtlasTexture.size,pi=Re.imageAtlasTexture,Oi=ii||d.options.rotating||d.options.zooming||Mt.kind==="composite"||Mt.kind==="camera"?Z.LINEAR:Z.NEAREST);else{const Gi=n.layout.get("icon-size").constantOr(0)!==1||Be.iconsNeedLinear;zi=Re.imageAtlasTexture,Ri=it||d.options.rotating||d.options.zooming||Gi||ii?Z.LINEAR:Z.NEAREST,fn=Re.imageAtlasTexture.size}const qn=c.aB(Re,1,d.transform.zoom),or=Bt(ie,d.transform,qn),Js=c.L();c.ap(Js,or);const Ss=ai(re,ie,d.transform,qn),ha=c.aC(ne,Re,m,y),fa=ne.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!L,applyTerrainMatrix:!0}),eo=ue&&Be.hasTextData(),Al=n.layout.get("icon-text-fit")!=="none"&&eo&&Be.hasIconData();if(oe){const Gi=d.style.map.terrain?(Jn,mn)=>d.style.map.terrain.getElevation(ze,Jn,mn):null,Ii=n.layout.get("text-rotation-alignment")==="map";Yn(Be,d,h,or,Js,re,A,Ii,ze.toUnwrapped(),ne.width,ne.height,ha,Gi)}const jo=h&&ue||Al,lr=oe||jo?hc:re?or:d.transform.clipSpaceToPixelsMatrix,da=it&&n.paint.get(h?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ms;Ms=it?Be.iconsInText?Bf(Mt.kind,ln,fe,re,oe,jo,d,lr,Ss,ha,fn,Zn,Oe):_l(Mt.kind,ln,fe,re,oe,jo,d,lr,Ss,ha,h,fn,0,Oe):Zc(Mt.kind,ln,fe,re,oe,jo,d,lr,Ss,ha,h,fn,Oe);const Uo={program:yi,buffers:gt,uniformValues:Ms,projectionData:fa,atlasTexture:zi,atlasTextureIcon:pi,atlasInterpolation:Ri,atlasInterpolationIcon:Oi,isSDF:it,hasHalo:da};if(le&&Be.canOverlap){ge=!0;const Gi=gt.segments.get();for(const Ii of Gi)Te.push({segments:new c.aL([Ii]),sortKey:Ii.sortKey,state:Uo,terrainData:Pi})}else Te.push({segments:gt.segments,sortKey:0,state:Uo,terrainData:Pi})}ge&&Te.sort((ze,Re)=>ze.sortKey-Re.sortKey);for(const ze of Te){const Re=ze.state;if(N.activeTexture.set(Z.TEXTURE0),Re.atlasTexture.bind(Re.atlasInterpolation,Z.CLAMP_TO_EDGE),Re.atlasTextureIcon&&(N.activeTexture.set(Z.TEXTURE1),Re.atlasTextureIcon&&Re.atlasTextureIcon.bind(Re.atlasInterpolationIcon,Z.CLAMP_TO_EDGE)),Re.isSDF){const Be=Re.uniformValues;Re.hasHalo&&(Be.u_is_halo=1,Ao(Re.buffers,ze.segments,n,d,Re.program,ve,z,O,Be,Re.projectionData,ze.terrainData)),Be.u_is_halo=0}Ao(Re.buffers,ze.segments,n,d,Re.program,ve,z,O,Re.uniformValues,Re.projectionData,ze.terrainData)}}function Ao(d,e,n,l,h,m,y,b,T,A,z){const O=l.context;h.draw(O,O.gl.TRIANGLES,m,y,b,Kt.backCCW,T,z,A,n.id,d.layoutVertexBuffer,d.indexBuffer,e,n.paint,l.transform.zoom,d.programConfigurations.get(n.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function Po(d,e,n,l,h){const m=d.context,y=m.gl,b=Vt.disabled,T=new hi([y.ONE,y.ONE],c.be.transparent,[!0,!0,!0,!0]),A=e.getBucket(n);if(!A)return;const z=l.key;let O=n.heatmapFbos.get(z);O||(O=fr(m,e.tileSize,e.tileSize),n.heatmapFbos.set(z,O)),m.bindFramebuffer.set(O.framebuffer),m.viewport.set([0,0,e.tileSize,e.tileSize]),m.clear({color:c.be.transparent});const L=A.programConfigurations.get(n.id),N=d.useProgram("heatmap",L,!h),Z=d.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ne=d.style.map.terrain.getTerrainData(l);N.draw(m,y.TRIANGLES,Qt.disabled,b,T,Kt.disabled,rc(e,d.transform.zoom,n.paint.get("heatmap-intensity"),1),ne,Z,n.id,A.layoutVertexBuffer,A.indexBuffer,A.segments,n.paint,d.transform.zoom,L)}function wr(d,e,n,l,h){const m=d.context,y=m.gl,b=d.transform;m.setColorMode(d.colorModeForRenderPass());const T=$a(m,e),A=n.key,z=e.heatmapFbos.get(A);if(!z)return;m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,z.colorAttachment.get()),m.activeTexture.set(y.TEXTURE1),T.bind(y.LINEAR,y.CLAMP_TO_EDGE);const O=b.getProjectionData({overscaledTileID:n,applyTerrainMatrix:h,applyGlobeMatrix:!l});d.useProgram("heatmapTexture").draw(m,y.TRIANGLES,Qt.disabled,Vt.disabled,d.colorModeForRenderPass(),Kt.disabled,jh(d,e,0,1),null,O,e.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments,e.paint,b.zoom),z.destroy(),e.heatmapFbos.delete(A)}function fr(d,e,n){var l,h;const m=d.gl,y=m.createTexture();m.bindTexture(m.TEXTURE_2D,y),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const b=(l=d.HALF_FLOAT)!==null&&l!==void 0?l:m.UNSIGNED_BYTE,T=(h=d.RGBA16F)!==null&&h!==void 0?h:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,T,e,n,0,m.RGBA,b,null);const A=d.createFramebuffer(e,n,!1,!1);return A.colorAttachment.set(y),A}function $a(d,e){return e.colorRampTexture||(e.colorRampTexture=new c.T(d,e.colorRamp,d.gl.RGBA)),e.colorRampTexture}function Ra(d,e,n,l,h){if(!n||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let y=m[n.to.toString()],b=m[n.from.toString()];if(!y&&b&&(y=b),!b&&y&&(b=y),!y||!b){const T=h.getPaintProperty(e);y=m[T],b=m[T]}y&&b&&d.setConstantPatternPositions(y,b)}function Hr(d,e,n,l,h,m,y,b){const T=d.context.gl,A="fill-pattern",z=n.paint.get(A),O=z&&z.constantOr(1),L=n.getCrossfadeParameters();let N,Z,ne,ie,re;const oe=d.transform,fe=n.paint.get("fill-translate"),le=n.paint.get("fill-translate-anchor");y?(Z=O&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",N=T.LINES):(Z=O?"fillPattern":"fill",N=T.TRIANGLES);const ge=z.constantOr(null);for(const ve of l){const ue=e.getTile(ve);if(O&&!ue.patternsLoaded())continue;const Te=ue.getBucket(n);if(!Te)continue;const Oe=Te.programConfigurations.get(n.id),ze=d.useProgram(Z,Oe),Re=d.style.map.terrain&&d.style.map.terrain.getTerrainData(ve);O&&(d.context.activeTexture.set(T.TEXTURE0),ue.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),Oe.updatePaintBuffers(L)),Ra(Oe,A,ge,ue,n);const Be=oe.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!b,applyTerrainMatrix:!0}),gt=c.aC(oe,ue,fe,le);if(y){ie=Te.indexBuffer2,re=Te.segments2;const it=[T.drawingBufferWidth,T.drawingBufferHeight];ne=Z==="fillOutlinePattern"&&O?Nh(d,L,ue,it,gt):Ea(it,gt)}else ie=Te.indexBuffer,re=Te.segments,ne=O?nc(d,L,ue,gt):{u_fill_translate:gt};const pt=d.stencilModeForClipping(ve);ze.draw(d.context,N,h,pt,m,Kt.backCCW,ne,Re,Be,n.id,Te.layoutVertexBuffer,ie,re,n.paint,d.transform.zoom,Oe)}}function oa(d,e,n,l,h,m,y,b){const T=d.context,A=T.gl,z="fill-extrusion-pattern",O=n.paint.get(z),L=O.constantOr(1),N=n.getCrossfadeParameters(),Z=n.paint.get("fill-extrusion-opacity"),ne=O.constantOr(null),ie=d.transform;for(const re of l){const oe=e.getTile(re),fe=oe.getBucket(n);if(!fe)continue;const le=d.style.map.terrain&&d.style.map.terrain.getTerrainData(re),ge=fe.programConfigurations.get(n.id),ve=d.useProgram(L?"fillExtrusionPattern":"fillExtrusion",ge);L&&(d.context.activeTexture.set(A.TEXTURE0),oe.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),ge.updatePaintBuffers(N));const ue=ie.getProjectionData({overscaledTileID:re,applyGlobeMatrix:!b,applyTerrainMatrix:!0});Ra(ge,z,ne,oe,n);const Te=c.aC(ie,oe,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Oe=n.paint.get("fill-extrusion-vertical-gradient"),ze=L?Bu(d,Oe,Z,Te,re,N,oe):ds(d,Oe,Z,Te);ve.draw(T,T.gl.TRIANGLES,h,m,y,Kt.backCCW,ze,le,ue,n.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,n.paint,d.transform.zoom,ge,d.style.map.terrain&&fe.centroidVertexBuffer)}}function zo(d,e,n,l,h,m,y,b,T){var A;const z=d.style.projection,O=d.context,L=d.transform,N=O.gl,Z=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],ne=d.useProgram("hillshade",null,!1,Z),ie=!d.options.moving;for(const re of l){const oe=e.getTile(re),fe=oe.fbo;if(!fe)continue;const le=z.getMeshFromTileID(O,re.canonical,b,!0,"raster"),ge=(A=d.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(re);O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,fe.colorAttachment.get());const ve=L.getProjectionData({overscaledTileID:re,aligned:ie,applyGlobeMatrix:!T,applyTerrainMatrix:!0});ne.draw(O,N.TRIANGLES,m,h[re.overscaledZ],y,Kt.backCCW,xo(d,oe,n),ge,ve,n.id,le.vertexBuffer,le.indexBuffer,le.segments)}}function Ro(d,e,n,l,h,m,y,b,T){var A;const z=d.style.projection,O=d.context,L=d.transform,N=O.gl,Z=d.useProgram("colorRelief"),ne=!d.options.moving;let ie=!0,re=0;for(const oe of l){const fe=e.getTile(oe),le=fe.dem;if(ie){const ze=N.getParameter(N.MAX_TEXTURE_SIZE),{elevationTexture:Re,colorTexture:Be}=n.getColorRampTextures(O,ze,le.getUnpackVector());O.activeTexture.set(N.TEXTURE1),Re.bind(N.NEAREST,N.CLAMP_TO_EDGE),O.activeTexture.set(N.TEXTURE4),Be.bind(N.LINEAR,N.CLAMP_TO_EDGE),ie=!1,re=Re.size[0]}if(!le||!le.data)continue;const ge=le.stride,ve=le.getPixels();if(O.activeTexture.set(N.TEXTURE0),O.pixelStoreUnpackPremultiplyAlpha.set(!1),fe.demTexture=fe.demTexture||d.getTileTexture(ge),fe.demTexture){const ze=fe.demTexture;ze.update(ve,{premultiply:!1}),ze.bind(N.LINEAR,N.CLAMP_TO_EDGE)}else fe.demTexture=new c.T(O,ve,N.RGBA,{premultiply:!1}),fe.demTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE);const ue=z.getMeshFromTileID(O,oe.canonical,b,!0,"raster"),Te=(A=d.style.map.terrain)===null||A===void 0?void 0:A.getTerrainData(oe),Oe=L.getProjectionData({overscaledTileID:oe,aligned:ne,applyGlobeMatrix:!T,applyTerrainMatrix:!0});Z.draw(O,N.TRIANGLES,m,h[oe.overscaledZ],y,Kt.backCCW,ac(n,fe.dem,re),Te,Oe,n.id,ue.vertexBuffer,ue.indexBuffer,ue.segments)}}const fc=[new c.P(0,0),new c.P(c.$,0),new c.P(c.$,c.$),new c.P(0,c.$)];function bn(d,e,n,l,h,m,y,b,T=!1,A=!1){const z=l[l.length-1].overscaledZ,O=d.context,L=O.gl,N=d.useProgram("raster"),Z=d.transform,ne=d.style.projection,ie=d.colorModeForRenderPass(),re=!d.options.moving;for(const oe of l){const fe=d.getDepthModeForSublayer(oe.overscaledZ-z,n.paint.get("raster-opacity")===1?Qt.ReadWrite:Qt.ReadOnly,L.LESS),le=e.getTile(oe);le.registerFadeDuration(n.paint.get("raster-fade-duration"));const ge=e.findLoadedParent(oe,0),ve=e.findLoadedSibling(oe),ue=wn(le,ge||ve||null,e,n,d.transform,d.style.map.terrain);let Te,Oe;const ze=n.paint.get("raster-resampling")==="nearest"?L.NEAREST:L.LINEAR;O.activeTexture.set(L.TEXTURE0),le.texture.bind(ze,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),O.activeTexture.set(L.TEXTURE1),ge?(ge.texture.bind(ze,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),Te=Math.pow(2,ge.tileID.overscaledZ-le.tileID.overscaledZ),Oe=[le.tileID.canonical.x*Te%1,le.tileID.canonical.y*Te%1]):le.texture.bind(ze,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST),le.texture.useMipmap&&O.extTextureFilterAnisotropic&&d.transform.pitch>20&&L.texParameterf(L.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax);const Re=d.style.map.terrain&&d.style.map.terrain.getTerrainData(oe),Be=Z.getProjectionData({overscaledTileID:oe,aligned:re,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),gt=Ns(Oe||[0,0],Te||1,ue,n,b),pt=ne.getMeshFromTileID(O,oe.canonical,m,y,"raster");N.draw(O,L.TRIANGLES,fe,h?h[oe.overscaledZ]:Vt.disabled,ie,T?Kt.frontCCW:Kt.backCCW,gt,Re,Be,n.id,pt.vertexBuffer,pt.indexBuffer,pt.segments)}}function wn(d,e,n,l,h,m){const y=l.paint.get("raster-fade-duration");if(!m&&y>0){const b=K.now(),T=(b-d.timeAdded)/y,A=e?(b-e.timeAdded)/y:-1,z=n.getSource(),O=qe(h,{tileSize:z.tileSize,roundZoom:z.roundZoom}),L=!e||Math.abs(e.tileID.overscaledZ-O)>Math.abs(d.tileID.overscaledZ-O),N=L&&d.refreshedUponExpiration?1:c.ag(L?T:1-A,0,1);return d.refreshedUponExpiration&&T>=1&&(d.refreshedUponExpiration=!1),e?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}const Si=new c.be(1,0,0,1),Ha=new c.be(0,1,0,1),la=new c.be(0,0,1,1),Wc=new c.be(1,0,1,1),Gs=new c.be(0,1,1,1);function bl(d,e,n,l){Zs(d,0,e+n/2,d.transform.width,n,l)}function dc(d,e,n,l){Zs(d,e-n/2,0,n,d.transform.height,l)}function Zs(d,e,n,l,h,m){const y=d.context,b=y.gl;b.enable(b.SCISSOR_TEST),b.scissor(e*d.pixelRatio,n*d.pixelRatio,l*d.pixelRatio,h*d.pixelRatio),y.clear({color:m}),b.disable(b.SCISSOR_TEST)}function wl(d,e,n){const l=d.context,h=l.gl,m=d.useProgram("debug"),y=Qt.disabled,b=Vt.disabled,T=d.colorModeForRenderPass(),A="$debug",z=d.style.map.terrain&&d.style.map.terrain.getTerrainData(n);l.activeTexture.set(h.TEXTURE0);const O=e.getTileByID(n.key).latestRawTileData,L=Math.floor((O&&O.byteLength||0)/1024),N=e.getTile(n).tileSize,Z=512/Math.min(N,512)*(n.overscaledZ/d.transform.zoom)*.5;let ne=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(ne+=` => ${n.overscaledZ}`),function(re,oe){re.initDebugOverlayCanvas();const fe=re.debugOverlayCanvas,le=re.context.gl,ge=re.debugOverlayCanvas.getContext("2d");ge.clearRect(0,0,fe.width,fe.height),ge.shadowColor="white",ge.shadowBlur=2,ge.lineWidth=1.5,ge.strokeStyle="white",ge.textBaseline="top",ge.font="bold 36px Open Sans, sans-serif",ge.fillText(oe,5,5),ge.strokeText(oe,5,5),re.debugOverlayTexture.update(fe),re.debugOverlayTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE)}(d,`${ne} ${L}kB`);const ie=d.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(l,h.TRIANGLES,y,b,hi.alphaBlended,Kt.disabled,Fh(c.be.transparent,Z),null,ie,A,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),m.draw(l,h.LINE_STRIP,y,b,T,Kt.disabled,Fh(c.be.red),z,ie,A,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function hn(d,e,n,l){const{isRenderingGlobe:h}=l,m=d.context,y=m.gl,b=d.transform,T=d.colorModeForRenderPass(),A=d.getDepthModeFor3D(),z=d.useProgram("terrain");m.bindFramebuffer.set(null),m.viewport.set([0,0,d.width,d.height]);for(const O of n){const L=e.getTerrainMesh(O.tileID),N=d.renderToTexture.getTexture(O),Z=e.getTerrainData(O.tileID);m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,N.texture);const ne=e.getMeshFrameDelta(b.zoom),ie=b.calculateFogMatrix(O.tileID.toUnwrapped()),re=kf(ne,ie,d.style.sky,b.pitch,h),oe=b.getProjectionData({overscaledTileID:O.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});z.draw(m,y.TRIANGLES,A,Vt.disabled,T,Kt.backCCW,re,Z,oe,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}function ca(d,e){if(!e.mesh){const n=new c.aK;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const l=new c.aM;l.emplaceBack(0,1,2),l.emplaceBack(0,2,3),e.mesh=new Va(d.createVertexBuffer(n,wa.members),d.createIndexBuffer(l),c.aL.simpleSegment(0,0,n.length,l.length))}return e.mesh}class Rr{constructor(e,n){this.context=new si(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.af(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Ke.maxUnderzooming+Ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Wl}resize(e,n,l){if(this.width=Math.floor(e*l),this.height=Math.floor(n*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style._order)this.style._layers[h].resize()}setup(){const e=this.context,n=new c.aK;n.emplaceBack(0,0),n.emplaceBack(c.$,0),n.emplaceBack(0,c.$),n.emplaceBack(c.$,c.$),this.tileExtentBuffer=e.createVertexBuffer(n,wa.members),this.tileExtentSegments=c.aL.simpleSegment(0,0,4,2);const l=new c.aK;l.emplaceBack(0,0),l.emplaceBack(c.$,0),l.emplaceBack(0,c.$),l.emplaceBack(c.$,c.$),this.debugBuffer=e.createVertexBuffer(l,wa.members),this.debugSegments=c.aL.simpleSegment(0,0,4,5);const h=new c.c5;h.emplaceBack(0,0,0,0),h.emplaceBack(c.$,0,c.$,0),h.emplaceBack(0,c.$,0,c.$),h.emplaceBack(c.$,c.$,c.$,c.$),this.rasterBoundsBuffer=e.createVertexBuffer(h,Df.members),this.rasterBoundsSegments=c.aL.simpleSegment(0,0,4,2);const m=new c.aK;m.emplaceBack(0,0),m.emplaceBack(c.$,0),m.emplaceBack(0,c.$),m.emplaceBack(c.$,c.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(m,wa.members),this.rasterBoundsSegmentsPosOnly=c.aL.simpleSegment(0,0,4,5);const y=new c.aK;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(y,wa.members),this.viewportSegments=c.aL.simpleSegment(0,0,4,2);const b=new c.c6;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const T=new c.aM;T.emplaceBack(1,0,2),T.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(T);const A=this.context.gl;this.stencilClearMode=new Vt({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.tileExtentMesh=new Va(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=c.L();c.bX(l,0,this.width,this.height,0,0,1),c.N(l,l,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const h={mainMatrix:l,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:l};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,Qt.disabled,this.stencilClearMode,hi.disabled,Kt.disabled,null,null,h,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,l){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source,this.nextStencilID+n.length>256&&this.clearStencil();const h=this.context;h.setColorMode(hi.disabled),h.setDepthMode(Qt.disabled);const m={};for(const y of n)m[y.key]=this.nextStencilID++;this._renderTileMasks(m,n,l,!0),this._renderTileMasks(m,n,l,!1),this._tileClippingMaskIDs=m}_renderTileMasks(e,n,l,h){const m=this.context,y=m.gl,b=this.style.projection,T=this.transform,A=this.useProgram("clippingMask");for(const z of n){const O=e[z.key],L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),N=b.getMeshFromTileID(this.context,z.canonical,h,!0,"stencil"),Z=T.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!l,applyTerrainMatrix:!0});A.draw(m,y.TRIANGLES,Qt.disabled,new Vt({func:y.ALWAYS,mask:0},O,255,y.KEEP,y.KEEP,y.REPLACE),hi.disabled,l?Kt.disabled:Kt.backCCW,null,L,Z,"$clipping",N.vertexBuffer,N.indexBuffer,N.segments)}}_renderTilesDepthBuffer(){const e=this.context,n=e.gl,l=this.style.projection,h=this.transform,m=this.useProgram("depth"),y=this.getDepthModeFor3D(),b=Ue(h,{tileSize:h.tileSize});for(const T of b){const A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),z=l.getMeshFromTileID(this.context,T.canonical,!0,!0,"raster"),O=h.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!0,applyTerrainMatrix:!0});m.draw(e,n.TRIANGLES,y,Vt.disabled,hi.disabled,Kt.backCCW,null,A,O,"$clipping",z.vertexBuffer,z.indexBuffer,z.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new Vt({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new Vt({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const n=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const y={};for(let b=0;b<m;b++)y[b+h]=new Vt({func:n.GEQUAL,mask:255},b+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=m,[y,l]}return[{[h]:Vt.disabled},l]}stencilConfigForOverlapTwoPass(e){const n=this.context.gl,l=e.sort((y,b)=>b.overscaledZ-y.overscaledZ),h=l[l.length-1].overscaledZ,m=l[0].overscaledZ-h+1;if(this.clearStencil(),m>1){const y={},b={};for(let T=0;T<m;T++)y[T+h]=new Vt({func:n.GREATER,mask:255},m+1+T,255,n.KEEP,n.KEEP,n.REPLACE),b[T+h]=new Vt({func:n.GREATER,mask:255},1+T,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*m+1,[y,b,l]}return this.nextStencilID=3,[{[h]:new Vt({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[h]:new Vt({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new hi([e.CONSTANT_COLOR,e.ONE],new c.be(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hi.unblended:hi.alphaBlended}getDepthModeForSublayer(e,n,l){if(!this.opaquePassEnabledForLayer())return Qt.disabled;const h=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Qt(l||this.context.gl.LEQUAL,n,[h,h])}getDepthModeFor3D(){return new Qt(this.context.gl.LEQUAL,Qt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var l,h;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(K.now()),this.imageManager.beginFrame();const m=this.style._order,y=this.style.sourceCaches,b={},T={},A={},z={isRenderingToTexture:!1,isRenderingGlobe:((l=e.projection)===null||l===void 0?void 0:l.transitionState)>0};for(const L in y){const N=y[L];N.used&&N.prepare(this.context),b[L]=N.getVisibleCoordinates(!1),T[L]=b[L].slice().reverse(),A[L]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<m.length;L++)if(this.style._layers[m[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of m){const N=this.style._layers[L];if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const Z=T[N.source];(N.type==="custom"||Z.length)&&this.renderLayer(this,y[N.source],N,Z,z)}if((h=this.style.projection)===null||h===void 0||h.updateGPUdependent({context:this.context,useProgram:L=>this.useProgram(L)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?c.be.black:c.be.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(L,N){const Z=L.context,ne=Z.gl,ie=((ve,ue,Te)=>{const Oe=Math.cos(ue.rollInRadians),ze=Math.sin(ue.rollInRadians),Re=Y(ue),Be=ue.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ve.properties.get("sky-color"),u_horizon_color:ve.properties.get("horizon-color"),u_horizon:[(ue.width/2-Re*ze)*Te,(ue.height/2+Re*Oe)*Te],u_horizon_normal:[-ze,Oe],u_sky_horizon_blend:ve.properties.get("sky-horizon-blend")*ue.height/2*Te,u_sky_blend:Be}})(N,L.style.map.transform,L.pixelRatio),re=new Qt(ne.LEQUAL,Qt.ReadWrite,[0,1]),oe=Vt.disabled,fe=L.colorModeForRenderPass(),le=L.useProgram("sky"),ge=ca(Z,N);le.draw(Z,ne.TRIANGLES,re,oe,fe,Kt.disabled,ie,null,void 0,"sky",ge.vertexBuffer,ge.indexBuffer,ge.segments)}(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[m[this.currentLayer]],N=y[L.source],Z=b[L.source];this._renderTileClippingMasks(L,Z,!1),this.renderLayer(this,N,L,Z,z)}this.renderPass="translucent";let O=!1;for(this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const L=this.style._layers[m[this.currentLayer]],N=y[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L,z))continue;this.opaquePassEnabledForLayer()||O||(O=!0,z.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const Z=(L.type==="symbol"?A:T)[L.source];this._renderTileClippingMasks(L,b[L.source],!!this.renderToTexture),this.renderLayer(this,N,L,Z,z)}if(z.isRenderingGlobe&&function(L,N,Z){const ne=L.context,ie=ne.gl,re=L.useProgram("atmosphere"),oe=new Qt(ie.LEQUAL,Qt.ReadOnly,[0,1]),fe=L.transform,le=function(Be,gt){const pt=Be.properties.get("position"),it=[-pt.x,-pt.y,-pt.z],Mt=c.af(new Float64Array(16));return Be.properties.get("anchor")==="map"&&(c.b5(Mt,Mt,gt.rollInRadians),c.b6(Mt,Mt,-gt.pitchInRadians),c.b5(Mt,Mt,gt.bearingInRadians),c.b6(Mt,Mt,gt.center.lat*Math.PI/180),c.by(Mt,Mt,-gt.center.lng*Math.PI/180)),c.c4(it,it,Mt),it}(Z,L.transform),ge=fe.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ve=N.properties.get("atmosphere-blend")*ge.projectionTransition;if(ve===0)return;const ue=ol(fe.worldSize,fe.center.lat),Te=fe.inverseProjectionMatrix,Oe=new Float64Array(4);Oe[3]=1,c.av(Oe,Oe,fe.modelViewProjectionMatrix),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1,c.av(Oe,Oe,Te),Oe[0]/=Oe[3],Oe[1]/=Oe[3],Oe[2]/=Oe[3],Oe[3]=1;const ze=((Be,gt,pt,it,Mt)=>({u_sun_pos:Be,u_atmosphere_blend:gt,u_globe_position:pt,u_globe_radius:it,u_inv_proj_matrix:Mt}))(le,ve,[Oe[0],Oe[1],Oe[2]],ue,Te),Re=ca(ne,N);re.draw(ne,ie.TRIANGLES,oe,Vt.disabled,hi.alphaBlended,Kt.disabled,ze,null,null,"atmosphere",Re.vertexBuffer,Re.indexBuffer,Re.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const L=function(N,Z){let ne=null;const ie=Object.values(N._layers).flatMap(le=>le.source&&!le.isHidden(Z)?[N.sourceCaches[le.source]]:[]),re=ie.filter(le=>le.getSource().type==="vector"),oe=ie.filter(le=>le.getSource().type!=="vector"),fe=le=>{(!ne||ne.getSource().maxzoom<le.getSource().maxzoom)&&(ne=le)};return re.forEach(le=>fe(le)),ne||oe.forEach(le=>fe(le)),ne}(this.style,this.transform.zoom);L&&function(N,Z,ne){for(let ie=0;ie<ne.length;ie++)wl(N,Z,ne[ie])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const N=L.transform.padding;bl(L,L.transform.height-(N.top||0),3,Si),bl(L,N.bottom||0,3,Ha),dc(L,N.left||0,3,la),dc(L,L.transform.width-(N.right||0),3,Wc);const Z=L.transform.centerPoint;(function(ne,ie,re,oe){Zs(ne,ie-1,re-10,2,20,oe),Zs(ne,ie-10,re-1,20,2,oe)})(L,Z.x,L.transform.height-Z.y,Gs)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let h=this.terrainFacilitator.dirty;h||(h=e?!c.c7(n,l):!c.c8(n,l)),h||(h=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),h&&(c.c9(n,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,y){const b=m.context,T=b.gl,A=m.transform,z=hi.unblended,O=new Qt(T.LEQUAL,Qt.ReadWrite,[0,1]),L=y.sourceCache.getRenderableTiles(),N=m.useProgram("terrainDepth");b.bindFramebuffer.set(y.getFramebuffer("depth").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:c.be.transparent,depth:1});for(const Z of L){const ne=y.getTerrainMesh(Z.tileID),ie=y.getTerrainData(Z.tileID),re=A.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),oe={u_ele_delta:y.getMeshFrameDelta(A.zoom)};N.draw(b,T.TRIANGLES,O,Vt.disabled,z,Kt.backCCW,oe,ie,re,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,y){const b=m.context,T=b.gl,A=m.transform,z=hi.unblended,O=new Qt(T.LEQUAL,Qt.ReadWrite,[0,1]),L=y.getCoordsTexture(),N=y.sourceCache.getRenderableTiles(),Z=m.useProgram("terrainCoords");b.bindFramebuffer.set(y.getFramebuffer("coords").framebuffer),b.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),b.clear({color:c.be.transparent,depth:1}),y.coordsIndex=[];for(const ne of N){const ie=y.getTerrainMesh(ne.tileID),re=y.getTerrainData(ne.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,L.texture);const oe={u_terrain_coords_id:(255-y.coordsIndex.length)/255,u_texture:0,u_ele_delta:y.getMeshFrameDelta(A.zoom)},fe=A.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Z.draw(b,T.TRIANGLES,O,Vt.disabled,z,Kt.backCCW,oe,re,fe,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments),y.coordsIndex.push(ne.tileID.key)}b.bindFramebuffer.set(null),b.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,n,l,h,m){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||(h||[]).length)&&(this.id=l.id,c.ca(l)?function(y,b,T,A,z,O){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:L}=O,N=Vt.disabled,Z=y.colorModeForRenderPass();(T._unevaluatedLayout.hasValue("text-variable-anchor")||T._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,ie,re,oe,fe,le,ge,ve,ue){const Te=ie.transform,Oe=ie.style.map.terrain,ze=fe==="map",Re=le==="map";for(const Be of ne){const gt=oe.getTile(Be),pt=gt.getBucket(re);if(!pt||!pt.text||!pt.text.segments.get().length)continue;const it=c.am(pt.textSizeData,Te.zoom),Mt=c.aB(gt,1,ie.transform.zoom),ii=Bt(ze,ie.transform,Mt),yi=re.layout.get("icon-text-fit")!=="none"&&pt.hasIconData();if(it){const ln=Math.pow(2,Te.zoom-gt.tileID.overscaledZ),Pi=Oe?(fn,zi)=>Oe.getElevation(Be,fn,zi):null;Ku(pt,ze,Re,ue,Te,ii,ln,it,yi,c.aC(Te,gt,ge,ve),Be.toUnwrapped(),Pi)}}}(A,y,T,b,T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),z),T.paint.get("icon-opacity").constantOr(1)!==0&&Co(y,b,T,A,!1,T.paint.get("icon-translate"),T.paint.get("icon-translate-anchor"),T.layout.get("icon-rotation-alignment"),T.layout.get("icon-pitch-alignment"),T.layout.get("icon-keep-upright"),N,Z,L),T.paint.get("text-opacity").constantOr(1)!==0&&Co(y,b,T,A,!0,T.paint.get("text-translate"),T.paint.get("text-translate-anchor"),T.layout.get("text-rotation-alignment"),T.layout.get("text-pitch-alignment"),T.layout.get("text-keep-upright"),N,Z,L),b.map.showCollisionBoxes&&(Xu(y,b,T,A,!0),Xu(y,b,T,A,!1))}(e,n,l,h,this.style.placement.variableOffsets,m):c.cb(l)?function(y,b,T,A,z){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:O}=z,L=T.paint.get("circle-opacity"),N=T.paint.get("circle-stroke-width"),Z=T.paint.get("circle-stroke-opacity"),ne=!T.layout.get("circle-sort-key").isConstant();if(L.constantOr(1)===0&&(N.constantOr(1)===0||Z.constantOr(1)===0))return;const ie=y.context,re=ie.gl,oe=y.transform,fe=y.getDepthModeForSublayer(0,Qt.ReadOnly),le=Vt.disabled,ge=y.colorModeForRenderPass(),ve=[],ue=oe.getCircleRadiusCorrection();for(let Te=0;Te<A.length;Te++){const Oe=A[Te],ze=b.getTile(Oe),Re=ze.getBucket(T);if(!Re)continue;const Be=T.paint.get("circle-translate"),gt=T.paint.get("circle-translate-anchor"),pt=c.aC(oe,ze,Be,gt),it=Re.programConfigurations.get(T.id),Mt=y.useProgram("circle",it),ii=Re.layoutVertexBuffer,yi=Re.indexBuffer,ln=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Oe),Pi={programConfiguration:it,program:Mt,layoutVertexBuffer:ii,indexBuffer:yi,uniformValues:Vc(y,ze,T,pt,ue),terrainData:ln,projectionData:oe.getProjectionData({overscaledTileID:Oe,applyGlobeMatrix:!O,applyTerrainMatrix:!0})};if(ne){const fn=Re.segments.get();for(const zi of fn)ve.push({segments:new c.aL([zi]),sortKey:zi.sortKey,state:Pi})}else ve.push({segments:Re.segments,sortKey:0,state:Pi})}ne&&ve.sort((Te,Oe)=>Te.sortKey-Oe.sortKey);for(const Te of ve){const{programConfiguration:Oe,program:ze,layoutVertexBuffer:Re,indexBuffer:Be,uniformValues:gt,terrainData:pt,projectionData:it}=Te.state;ze.draw(ie,re.TRIANGLES,fe,le,ge,Kt.backCCW,gt,pt,it,T.id,Re,Be,Te.segments,T.paint,y.transform.zoom,Oe)}}(e,n,l,h,m):c.cc(l)?function(y,b,T,A,z){if(T.paint.get("heatmap-opacity")===0)return;const O=y.context,{isRenderingToTexture:L,isRenderingGlobe:N}=z;if(y.style.map.terrain){for(const Z of A){const ne=b.getTile(Z);b.hasRenderableParent(Z)||(y.renderPass==="offscreen"?Po(y,ne,T,Z,N):y.renderPass==="translucent"&&wr(y,T,Z,L,N))}O.viewport.set([0,0,y.width,y.height])}else y.renderPass==="offscreen"?function(Z,ne,ie,re){const oe=Z.context,fe=oe.gl,le=Z.transform,ge=Vt.disabled,ve=new hi([fe.ONE,fe.ONE],c.be.transparent,[!0,!0,!0,!0]);(function(ue,Te,Oe){const ze=ue.gl;ue.activeTexture.set(ze.TEXTURE1),ue.viewport.set([0,0,Te.width/4,Te.height/4]);let Re=Oe.heatmapFbos.get(c.c1);Re?(ze.bindTexture(ze.TEXTURE_2D,Re.colorAttachment.get()),ue.bindFramebuffer.set(Re.framebuffer)):(Re=fr(ue,Te.width/4,Te.height/4),Oe.heatmapFbos.set(c.c1,Re))})(oe,Z,ie),oe.clear({color:c.be.transparent});for(let ue=0;ue<re.length;ue++){const Te=re[ue];if(ne.hasRenderableParent(Te))continue;const Oe=ne.getTile(Te),ze=Oe.getBucket(ie);if(!ze)continue;const Re=ze.programConfigurations.get(ie.id),Be=Z.useProgram("heatmap",Re),gt=le.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),pt=le.getCircleRadiusCorrection();Be.draw(oe,fe.TRIANGLES,Qt.disabled,ge,ve,Kt.backCCW,rc(Oe,le.zoom,ie.paint.get("heatmap-intensity"),pt),null,gt,ie.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,ie.paint,le.zoom,Re)}oe.viewport.set([0,0,Z.width,Z.height])}(y,b,T,A):y.renderPass==="translucent"&&function(Z,ne){const ie=Z.context,re=ie.gl;ie.setColorMode(Z.colorModeForRenderPass());const oe=ne.heatmapFbos.get(c.c1);oe&&(ie.activeTexture.set(re.TEXTURE0),re.bindTexture(re.TEXTURE_2D,oe.colorAttachment.get()),ie.activeTexture.set(re.TEXTURE1),$a(ie,ne).bind(re.LINEAR,re.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(ie,re.TRIANGLES,Qt.disabled,Vt.disabled,Z.colorModeForRenderPass(),Kt.disabled,jh(Z,ne,0,1),null,null,ne.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,ne.paint,Z.transform.zoom))}(y,T)}(e,n,l,h,m):c.cd(l)?function(y,b,T,A,z){if(y.renderPass!=="translucent")return;const{isRenderingToTexture:O}=z,L=T.paint.get("line-opacity"),N=T.paint.get("line-width");if(L.constantOr(1)===0||N.constantOr(1)===0)return;const Z=y.getDepthModeForSublayer(0,Qt.ReadOnly),ne=y.colorModeForRenderPass(),ie=T.paint.get("line-dasharray"),re=T.paint.get("line-pattern"),oe=re.constantOr(1),fe=T.paint.get("line-gradient"),le=T.getCrossfadeParameters(),ge=oe?"linePattern":ie?"lineSDF":fe?"lineGradient":"line",ve=y.context,ue=ve.gl,Te=y.transform;let Oe=!0;for(const ze of A){const Re=b.getTile(ze);if(oe&&!Re.patternsLoaded())continue;const Be=Re.getBucket(T);if(!Be)continue;const gt=Be.programConfigurations.get(T.id),pt=y.context.program.get(),it=y.useProgram(ge,gt),Mt=Oe||it.program!==pt,ii=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ze),yi=re.constantOr(null);if(yi&&Re.imageAtlas){const Ri=Re.imageAtlas,Oi=Ri.patternPositions[yi.to.toString()],Zn=Ri.patternPositions[yi.from.toString()];Oi&&Zn&&gt.setConstantPatternPositions(Oi,Zn)}const ln=Te.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!O,applyTerrainMatrix:!0}),Pi=Te.getPixelScale(),fn=oe?Nu(y,Re,T,Pi,le):ie?Fu(y,Re,T,Pi,ie,le):fe?gl(y,Re,T,Pi,Be.lineClipsArray.length):Gc(y,Re,T,Pi);if(oe)ve.activeTexture.set(ue.TEXTURE0),Re.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),gt.updatePaintBuffers(le);else if(ie&&(Mt||y.lineAtlas.dirty))ve.activeTexture.set(ue.TEXTURE0),y.lineAtlas.bind(ve);else if(fe){const Ri=Be.gradients[T.id];let Oi=Ri.texture;if(T.gradientVersion!==Ri.version){let Zn=256;if(T.stepInterpolant){const pi=b.getSource().maxzoom,qn=ze.canonical.z===pi?Math.ceil(1<<y.transform.maxZoom-ze.canonical.z):1;Zn=c.ag(c.c2(Be.maxLineLength/c.$*1024*qn),256,ve.maxTextureSize)}Ri.gradient=c.c3({expression:T.gradientExpression(),evaluationKey:"lineProgress",resolution:Zn,image:Ri.gradient||void 0,clips:Be.lineClipsArray}),Ri.texture?Ri.texture.update(Ri.gradient):Ri.texture=new c.T(ve,Ri.gradient,ue.RGBA),Ri.version=T.gradientVersion,Oi=Ri.texture}ve.activeTexture.set(ue.TEXTURE0),Oi.bind(T.stepInterpolant?ue.NEAREST:ue.LINEAR,ue.CLAMP_TO_EDGE)}const zi=y.stencilModeForClipping(ze);it.draw(ve,ue.TRIANGLES,Z,zi,ne,Kt.disabled,fn,ii,ln,T.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,T.paint,y.transform.zoom,gt,Be.layoutVertexBuffer2),Oe=!1}}(e,n,l,h,m):c.ce(l)?function(y,b,T,A,z){const O=T.paint.get("fill-color"),L=T.paint.get("fill-opacity");if(L.constantOr(1)===0)return;const{isRenderingToTexture:N}=z,Z=y.colorModeForRenderPass(),ne=T.paint.get("fill-pattern"),ie=y.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&O.constantOr(c.be.transparent).a===1&&L.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===ie){const re=y.getDepthModeForSublayer(1,y.renderPass==="opaque"?Qt.ReadWrite:Qt.ReadOnly);Hr(y,b,T,A,re,Z,!1,N)}if(y.renderPass==="translucent"&&T.paint.get("fill-antialias")){const re=y.getDepthModeForSublayer(T.getPaintProperty("fill-outline-color")?2:0,Qt.ReadOnly);Hr(y,b,T,A,re,Z,!0,N)}}(e,n,l,h,m):c.cf(l)?function(y,b,T,A,z){const O=T.paint.get("fill-extrusion-opacity");if(O===0)return;const{isRenderingToTexture:L}=z;if(y.renderPass==="translucent"){const N=new Qt(y.context.gl.LEQUAL,Qt.ReadWrite,y.depthRangeFor3D);if(O!==1||T.paint.get("fill-extrusion-pattern").constantOr(1))oa(y,b,T,A,N,Vt.disabled,hi.disabled,L),oa(y,b,T,A,N,y.stencilModeFor3D(),y.colorModeForRenderPass(),L);else{const Z=y.colorModeForRenderPass();oa(y,b,T,A,N,Vt.disabled,Z,L)}}}(e,n,l,h,m):c.cg(l)?function(y,b,T,A,z){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const{isRenderingToTexture:O}=z,L=y.context,N=y.style.projection.useSubdivision,Z=y.getDepthModeForSublayer(0,Qt.ReadOnly),ne=y.colorModeForRenderPass();if(y.renderPass==="offscreen")(function(ie,re,oe,fe,le,ge,ve){const ue=ie.context,Te=ue.gl;for(const Oe of oe){const ze=re.getTile(Oe),Re=ze.dem;if(!Re||!Re.data||!ze.needsHillshadePrepare)continue;const Be=Re.dim,gt=Re.stride,pt=Re.getPixels();if(ue.activeTexture.set(Te.TEXTURE1),ue.pixelStoreUnpackPremultiplyAlpha.set(!1),ze.demTexture=ze.demTexture||ie.getTileTexture(gt),ze.demTexture){const Mt=ze.demTexture;Mt.update(pt,{premultiply:!1}),Mt.bind(Te.NEAREST,Te.CLAMP_TO_EDGE)}else ze.demTexture=new c.T(ue,pt,Te.RGBA,{premultiply:!1}),ze.demTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE);ue.activeTexture.set(Te.TEXTURE0);let it=ze.fbo;if(!it){const Mt=new c.T(ue,{width:Be,height:Be,data:null},Te.RGBA);Mt.bind(Te.LINEAR,Te.CLAMP_TO_EDGE),it=ze.fbo=ue.createFramebuffer(Be,Be,!0,!1),it.colorAttachment.set(Mt.texture)}ue.bindFramebuffer.set(it.framebuffer),ue.viewport.set([0,0,Be,Be]),ie.useProgram("hillshadePrepare").draw(ue,Te.TRIANGLES,le,ge,ve,Kt.disabled,Uh(ze.tileID,Re),null,null,fe.id,ie.rasterBoundsBuffer,ie.quadTriangleIndexBuffer,ie.rasterBoundsSegments),ze.needsHillshadePrepare=!1}})(y,b,A,T,Z,Vt.disabled,ne),L.viewport.set([0,0,y.width,y.height]);else if(y.renderPass==="translucent")if(N){const[ie,re,oe]=y.stencilConfigForOverlapTwoPass(A);zo(y,b,T,oe,ie,Z,ne,!1,O),zo(y,b,T,oe,re,Z,ne,!0,O)}else{const[ie,re]=y.getStencilConfigForOverlapAndUpdateStencilID(A);zo(y,b,T,re,ie,Z,ne,!1,O)}}(e,n,l,h,m):c.ch(l)?function(y,b,T,A,z){if(y.renderPass!=="translucent"||!A.length)return;const{isRenderingToTexture:O}=z,L=y.style.projection.useSubdivision,N=y.getDepthModeForSublayer(0,Qt.ReadOnly),Z=y.colorModeForRenderPass();if(L){const[ne,ie,re]=y.stencilConfigForOverlapTwoPass(A);Ro(y,b,T,re,ne,N,Z,!1,O),Ro(y,b,T,re,ie,N,Z,!0,O)}else{const[ne,ie]=y.getStencilConfigForOverlapAndUpdateStencilID(A);Ro(y,b,T,ie,ne,N,Z,!1,O)}}(e,n,l,h,m):c.ci(l)?function(y,b,T,A,z){if(y.renderPass!=="translucent"||T.paint.get("raster-opacity")===0||!A.length)return;const{isRenderingToTexture:O}=z,L=b.getSource(),N=y.style.projection.useSubdivision;if(L instanceof yr)bn(y,b,T,A,null,!1,!1,L.tileCoords,L.flippedWindingOrder,O);else if(N){const[Z,ne,ie]=y.stencilConfigForOverlapTwoPass(A);bn(y,b,T,ie,Z,!1,!0,fc,!1,O),bn(y,b,T,ie,ne,!0,!0,fc,!1,O)}else{const[Z,ne]=y.getStencilConfigForOverlapAndUpdateStencilID(A);bn(y,b,T,ne,Z,!1,!0,fc,!1,O)}}(e,n,l,h,m):c.cj(l)?function(y,b,T,A,z){const O=T.paint.get("background-color"),L=T.paint.get("background-opacity");if(L===0)return;const{isRenderingToTexture:N}=z,Z=y.context,ne=Z.gl,ie=y.style.projection,re=y.transform,oe=re.tileSize,fe=T.paint.get("background-pattern");if(y.isPatternMissing(fe))return;const le=!fe&&O.a===1&&L===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==le)return;const ge=Vt.disabled,ve=y.getDepthModeForSublayer(0,le==="opaque"?Qt.ReadWrite:Qt.ReadOnly),ue=y.colorModeForRenderPass(),Te=y.useProgram(fe?"backgroundPattern":"background"),Oe=A||Ue(re,{tileSize:oe,terrain:y.style.map.terrain});fe&&(Z.activeTexture.set(ne.TEXTURE0),y.imageManager.bind(y.context));const ze=T.getCrossfadeParameters();for(const Re of Oe){const Be=re.getProjectionData({overscaledTileID:Re,applyGlobeMatrix:!N,applyTerrainMatrix:!0}),gt=fe?Nf(L,y,fe,{tileID:Re,tileSize:oe},ze):qc(L,O),pt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re),it=ie.getMeshFromTileID(Z,Re.canonical,!1,!0,"raster");Te.draw(Z,ne.TRIANGLES,ve,ge,ue,Kt.backCCW,gt,pt,Be,T.id,it.vertexBuffer,it.indexBuffer,it.segments)}}(e,0,l,h,m):c.ck(l)&&function(y,b,T,A){const{isRenderingGlobe:z}=A,O=y.context,L=T.implementation,N=y.style.projection,Z=y.transform,ne=Z.getProjectionDataForCustomLayer(z),ie={farZ:Z.farZ,nearZ:Z.nearZ,fov:Z.fov*Math.PI/180,modelViewProjectionMatrix:Z.modelViewProjectionMatrix,projectionMatrix:Z.projectionMatrix,shaderData:{variantName:N.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${N.shaderPreludeCode.vertexSource}`,define:N.shaderDefine},defaultProjectionData:ne},re=L.renderingMode?L.renderingMode:"2d";if(y.renderPass==="offscreen"){const oe=L.prerender;oe&&(y.setCustomLayerDefaults(),O.setColorMode(y.colorModeForRenderPass()),oe.call(L,O.gl,ie),O.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),O.setColorMode(y.colorModeForRenderPass()),O.setStencilMode(Vt.disabled);const oe=re==="3d"?y.getDepthModeFor3D():y.getDepthModeForSublayer(0,Qt.ReadOnly);O.setDepthMode(oe),L.render(O.gl,ie),O.setDirty(),y.setBaseState(),O.bindFramebuffer.set(null)}}(e,0,l,m))}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!n||!l}useProgram(e,n,l=!1,h=[]){this.cache=this.cache||{};const m=!!this.style.map.terrain,y=this.style.projection,b=l?Ua.projectionMercator:y.shaderPreludeCode,T=l?yo:y.shaderDefine,A=e+(n?n.cacheKey:"")+`/${l?Du:y.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(m?"/terrain":"")+(h?`/${h.join("/")}`:"");return this.cache[A]||(this.cache[A]=new Uc(this.context,Ua[e],n,zr[e],this._showOverdrawInspector,m,b,T,h)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}function Xa(d,e){let n,l=!1,h=null,m=null;const y=()=>{h=null,l&&(d.apply(m,n),h=setTimeout(y,e),l=!1)};return(...b)=>(l=!0,m=this,n=b,h||y(),h)}class Xr{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(l=h)}),(l&&l[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const l=n.join("/");let h=l;h.split("&").length>0&&(h=h.split("&")[0]),this._hashName&&(h=`${this._hashName}=${l}`);let m=window.location.hash.replace(h,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let y=window.location.href.replace(/(#.+)?$/,m);y=y.replace("&&","&"),window.history.replaceState(window.history.state,null,y)},this._updateHash=Xa(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,h),y=Math.round(n.lng*m)/m,b=Math.round(n.lat*m)/m,T=this._map.getBearing(),A=this._map.getPitch();let z="";if(z+=e?`/${y}/${b}/${l}`:`${l}/${b}/${y}`,(T||A)&&(z+="/"+Math.round(10*T)/10),A&&(z+=`/${Math.round(A)}`),this._hashName){const O=this._hashName;let L=!1;const N=window.location.hash.slice(1).split("&").map(Z=>{const ne=Z.split("=")[0];return ne===O?(L=!0,`${ne}=${z}`):Z}).filter(Z=>Z);return L||N.push(`${O}=${z}`),`#${N.join("&")}`}return`#${z}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new c.S(+e[2],+e[1])}catch{return!1}const n=+e[0],l=+(e[3]||0),h=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&l>=-180&&l<=180&&h>=this._map.getMinPitch()&&h<=this._map.getMaxPitch()}}const Yr={linearity:.3,easing:c.cl(0,0,.3,1)},Ir=c.e({deceleration:2500,maxSpeed:1400},Yr),pc=c.e({deceleration:20,maxSpeed:1400},Yr),Io=c.e({deceleration:1e3,maxSpeed:360},Yr),Do=c.e({deceleration:1e3,maxSpeed:90},Yr),mc=c.e({deceleration:1e3,maxSpeed:360},Yr);class qs{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:K.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=K.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)n.zoom+=m.zoomDelta||0,n.bearing+=m.bearingDelta||0,n.pitch+=m.pitchDelta||0,n.roll+=m.rollDelta||0,m.panDelta&&n.pan._add(m.panDelta),m.around&&(n.around=m.around),m.pinchAround&&(n.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,h={};if(n.pan.mag()){const m=_s(n.pan.mag(),l,c.e({},Ir,e||{})),y=n.pan.mult(m.amount/n.pan.mag()),b=this._map.cameraHelper.handlePanInertia(y,this._map.transform);h.center=b.easingCenter,h.offset=b.easingOffset,En(h,m)}if(n.zoom){const m=_s(n.zoom,l,pc);h.zoom=this._map.transform.zoom+m.amount,En(h,m)}if(n.bearing){const m=_s(n.bearing,l,Io);h.bearing=this._map.transform.bearing+c.ag(m.amount,-179,179),En(h,m)}if(n.pitch){const m=_s(n.pitch,l,Do);h.pitch=this._map.transform.pitch+m.amount,En(h,m)}if(n.roll){const m=_s(n.roll,l,mc);h.roll=this._map.transform.roll+c.ag(m.amount,-179,179),En(h,m)}if(h.zoom||h.bearing){const m=n.pinchAround===void 0?n.around:n.pinchAround;h.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),c.e(h,{noMoveStart:!0})}}function En(d,e){(!d.duration||d.duration<e.duration)&&(d.duration=e.duration,d.easing=e.easing)}function _s(d,e,n){const{maxSpeed:l,linearity:h,deceleration:m}=n,y=c.ag(d*h/(e/1e3),-l,l),b=Math.abs(y)/(m*h);return{easing:n.easing,duration:1e3*b,amount:y*(b/2)}}class Tr extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l,h={}){l=l instanceof MouseEvent?l:new MouseEvent(e,l);const m=Q.mousePos(n.getCanvas(),l),y=n.unproject(m);super(e,c.e({point:m,lngLat:y,originalEvent:l},h)),this._defaultPrevented=!1,this.target=n}}class Ia extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){const h=e==="touchend"?l.changedTouches:l.touches,m=Q.touchPos(n.getCanvasContainer(),h),y=m.map(T=>n.unproject(T)),b=m.reduce((T,A,z,O)=>T.add(A.div(O.length)),new c.P(0,0));super(e,{points:m,point:b,lngLats:y,lngLat:n.unproject(b),originalEvent:l}),this._defaultPrevented=!1}}class Wu extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class qh{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Wu(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Tr(e.type,this._map,e))}mouseup(e){this._map.fire(new Tr(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Tr(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Tr(e.type,this._map,e))}mouseover(e){this._map.fire(new Tr(e.type,this._map,e))}mouseout(e){this._map.fire(new Tr(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ia(e.type,this._map,e))}touchmove(e){this._map.fire(new Ia(e.type,this._map,e))}touchend(e){this._map.fire(new Ia(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ia(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fn{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Tr(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Tr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class $s{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(c.P.convert(e),this._map.terrain)}}class Lo{constructor(e,n){this._map=e,this._tr=new $s(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const l=n;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const h=this._startPos;this._lastPos=l,this._box||(this._box=Q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(h.x,l.x),y=Math.max(h.x,l.x),b=Math.min(h.y,l.y),T=Math.max(h.y,l.y);Q.setTransform(this._box,`translate(${m}px,${b}px)`),this._box.style.width=y-m+"px",this._box.style.height=T-b+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const l=this._startPos,h=n;if(this.reset(),Q.suppressClick(),l.x!==h.x||l.y!==h.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,h,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new c.l(e,{originalEvent:n}))}}function Hs(d,e){if(d.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${e.length}`);const n={};for(let l=0;l<d.length;l++)n[d[l].identifier]=e[l];return n}class Qc{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){const m=new c.P(0,0);for(const y of h)m._add(y);return m.div(h.length)}(n),this.touches=Hs(l,n)))}touchmove(e,n,l){if(this.aborted||!this.centroid)return;const h=Hs(l,n);for(const m in this.touches){const y=h[m];(!y||y.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,n,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const h=!this.aborted&&this.centroid;if(this.reset(),h)return h}}}class ys{constructor(e){this.singleTap=new Qc(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,l){this.singleTap.touchstart(e,n,l)}touchmove(e,n,l){this.singleTap.touchmove(e,n,l)}touchend(e,n,l){const h=this.singleTap.touchend(e,n,l);if(h){const m=e.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(h)<30;if(m&&y||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}}}class vs{constructor(e){this._tr=new $s(e),this._zoomIn=new ys({numTouches:1,numTaps:2}),this._zoomOut=new ys({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,l){this._zoomIn.touchstart(e,n,l),this._zoomOut.touchstart(e,n,l)}touchmove(e,n,l){this._zoomIn.touchmove(e,n,l),this._zoomOut.touchmove(e,n,l)}touchend(e,n,l){const h=this._zoomIn.touchend(e,n,l),m=this._zoomOut.touchend(e,n,l),y=this._tr;return h?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom+1,around:y.unproject(h)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:b=>b.easeTo({duration:300,zoom:y.zoom-1,around:y.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tl{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const h=Array.isArray(n)?n[0]:n;return!this._moved&&h.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=h,this._move(l,h))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Kr=0,Da=2,Qu={[Kr]:1,[Da]:2};class Cn{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=Q.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(n,l){const h=Qu[l];return n.buttons===void 0||(n.buttons&h)!==h}(e,this._eventButton)}isValidEndEvent(e){return Q.mouseButton(e)===this._eventButton}}class Xs{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class Jc{constructor(e=new Cn({checkCorrectEvent:()=>!0}),n=new Xs){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(e,n,l){return e instanceof MouseEvent?n(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?l(e):void 0}startMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.startMove(n),n=>this.oneFingerTouchMoveStateManager.startMove(n))}endMove(e){this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.endMove(n),n=>this.oneFingerTouchMoveStateManager.endMove(n))}isValidStartEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidStartEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n))}isValidMoveEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidMoveEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n))}isValidEndEvent(e){return this._executeRelevantHandler(e,n=>this.mouseMoveStateManager.isValidEndEvent(n),n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n))}}const gc=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=e=>{e.preventDefault()}};class _c{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,l){return this._calculateTransform(e,n,l)}touchmove(e,n,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,n,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,l){this._calculateTransform(e,n,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,l){l.length>0&&(this._active=!0);const h=Hs(l,n),m=new c.P(0,0),y=new c.P(0,0);let b=0;for(const A in h){const z=h[A],O=this._touches[A];O&&(m._add(z),y._add(z.sub(O)),b++,h[A]=z)}if(this._touches=h,this._shouldBePrevented(b)||!y.mag())return;const T=y.div(b);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(b),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,l){if(!this._firstTwoTouches)return;e.preventDefault();const[h,m]=this._firstTwoTouches,y=Ys(l,n,h),b=Ys(l,n,m);if(!y||!b)return;const T=this._aroundCenter?null:y.add(b).div(2);return this._move([y,b],T,e)}touchend(e,n,l){if(!this._firstTwoTouches)return;const[h,m]=this._firstTwoTouches,y=Ys(l,n,h),b=Ys(l,n,m);y&&b||(this._active&&Q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ys(d,e,n){for(let l=0;l<d.length;l++)if(d[l].identifier===n)return e[l]}function Ks(d,e){return Math.log(d/e)/Math.LN2}class La extends eu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Ks(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ks(this._distance,l),pinchAround:n}}}function xt(d,e){return 180*d.angleWith(e)/Math.PI}class tu extends eu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,l){const h=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:xt(this._vector,h),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,l=xt(e,this._startVector);return Math.abs(l)<n}}function xs(d){return Math.abs(d.y)>Math.abs(d.x)}class iu extends eu{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,l){super.touchstart(e,n,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,xs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const h=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(h,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(h.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,l){if(this._valid!==void 0)return this._valid;const h=e.mag()>=2,m=n.mag()>=2;if(!h&&!m)return;if(!h||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const y=e.y>0==n.y>0;return xs(e)&&xs(n)&&y}}const Sl={panStep:100,bearingStep:15,pitchStep:10};class Wr{constructor(e){this._tr=new $s(e);const n=Sl;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,l=0,h=0,m=0,y=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?h=1:(e.preventDefault(),y=-1);break;case 40:e.shiftKey?h=-1:(e.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(l=0,h=0),{cameraAnimation:b=>{const T=this._tr;b.easeTo({duration:300,easeId:"keyboardHandler",easing:yc,zoom:n?Math.round(T.zoom)+n*(e.shiftKey?2:1):T.zoom,bearing:T.bearing+l*this._bearingStep,pitch:T.pitch+h*this._pitchStep,offset:[-m*this._panStep,-y*this._panStep],center:T.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yc(d){return d*(2-d)}const oi=4.000244140625,Ya=1/450;class bs{constructor(e,n){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new $s(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ya}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=K.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,n!==0&&n%oi==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(h*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=Q.mousePos(this._map.getCanvas(),e),l=this._tr;this._aroundPoint=this._aroundCenter?l.transform.locationToScreenPoint(c.S.convert(l.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const b=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=b),typeof this._targetZoom=="number"&&(this._targetZoom+=b)}if(this._delta!==0){const b=this._type==="wheel"&&Math.abs(this._delta)>oi?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&T!==0&&(T=1/T);const A=typeof this._targetZoom!="number"?e.scale:c.ae(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),c.aj(A*T)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,l=this._startZoom,h=this._easing;let m,y=!1;if(this._type==="wheel"&&l&&h){const b=K.now()-this._lastWheelEventTime,T=Math.min((b+5)/200,1),A=h(T);m=c.C.number(l,n,A),T<1?this._frameId||(this._frameId=!0):y=!0}else m=n,y=!0;return this._active=!0,y&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=m,{noInertia:!0,needsRenderFrame:!y,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=c.cn;if(this._prevEase){const l=this._prevEase,h=(K.now()-l.start)/l.duration,m=l.easing(h+.01)-l.easing(h),y=.27/Math.sqrt(m*m+1e-4)*.01,b=Math.sqrt(.0729-y*y);n=c.cl(y,b,.25,1)}return this._prevEase={start:K.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ws{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ju{constructor(e){this._tr=new $s(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eh{constructor(){this._tap=new ys({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,l){if(!this._swipePoint)if(this._tapTime){const h=n[0],m=e.timeStamp-this._tapTime<500,y=this._tapPoint.dist(h)<30;m&&y?l.length>0&&(this._swipePoint=h,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,n,l)}touchmove(e,n,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const h=n[0],m=h.y-this._swipePoint.y;return this._swipePoint=h,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,n,l)}touchend(e,n,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const h=this._tap.touchend(e,n,l);h&&(this._tapTime=e.timeStamp,this._tapPoint=h)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ko{constructor(e,n,l){this._el=e,this._mousePan=n,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qs{constructor(e,n,l,h){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=n,this._mousePitch=l,this._mouseRoll=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class nu{constructor(e,n,l,h){this._el=e,this._touchZoom=n,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class th{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=Q.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),h=document.createElement("div");h.className="maplibregl-desktop-message",h.textContent=n,this._container.appendChild(h);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Ka=d=>d.zoom||d.drag||d.roll||d.pitch||d.rotate;class ru extends c.l{}function au(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta||d.rollDelta}class Wa{constructor(e,n){this.handleWindowEvent=h=>{this.handleEvent(h,`${h.type}Window`)},this.handleEvent=(h,m)=>{if(h.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const y=h.type==="renderFrame"?void 0:h,b={needsRenderFrame:!1},T={},A={};for(const{handlerName:L,handler:N,allowed:Z}of this._handlers){if(!N.isEnabled())continue;let ne;if(this._blockedByActive(A,Z,L))N.reset();else if(N[m||h.type]){if(c.co(h,m||h.type)){const ie=Q.mousePos(this._map.getCanvas(),h);ne=N[m||h.type](h,ie)}else if(c.cp(h,m||h.type)){const ie=this._getMapTouches(h.touches),re=Q.touchPos(this._map.getCanvas(),ie);ne=N[m||h.type](h,re,ie)}else c.cq(m||h.type)||(ne=N[m||h.type](h));this.mergeHandlerResult(b,T,ne,L,y),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()}(ne||N.isActive())&&(A[L]=N)}const z={};for(const L in this._previousActiveHandlers)A[L]||(z[L]=y);this._previousActiveHandlers=A,(Object.keys(z).length||au(b))&&(this._changes.push([b,T,z]),this._triggerRenderFrame()),(Object.keys(A).length||au(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:O}=b;O&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],O(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qs(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[h,m,y]of this._listeners)Q.addEventListener(h,m,h===document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[e,n,l]of this._listeners)Q.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const n=this._map,l=n.getCanvasContainer();this._add("mapEvent",new qh(n,e));const h=n.boxZoom=new Lo(n,e);this._add("boxZoom",h),e.interactive&&e.boxZoom&&h.enable();const m=n.cooperativeGestures=new th(n,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const y=new vs(n),b=new Ju(n);n.doubleClickZoom=new Ws(b,y),this._add("tapZoom",y),this._add("clickZoom",b),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const T=new eh;this._add("tapDragZoom",T);const A=n.touchPitch=new iu(n);this._add("touchPitch",A),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const z=()=>n.project(n.getCenter()),O=function({enable:le,clickTolerance:ge,aroundCenter:ve=!0,minPixelCenterThreshold:ue=100,rotateDegreesPerPixelMoved:Te=.8},Oe){const ze=new Cn({checkCorrectEvent:Re=>Q.mouseButton(Re)===0&&Re.ctrlKey||Q.mouseButton(Re)===2&&!Re.ctrlKey});return new Tl({clickTolerance:ge,move:(Re,Be)=>{const gt=Oe();if(ve&&Math.abs(gt.y-Re.y)>ue)return{bearingDelta:c.cm(new c.P(Re.x,Be.y),Be,gt)};let pt=(Be.x-Re.x)*Te;return ve&&Be.y<gt.y&&(pt=-pt),{bearingDelta:pt}},moveStateManager:ze,enable:le,assignEvents:gc})}(e,z),L=function({enable:le,clickTolerance:ge,pitchDegreesPerPixelMoved:ve=-.5}){const ue=new Cn({checkCorrectEvent:Te=>Q.mouseButton(Te)===0&&Te.ctrlKey||Q.mouseButton(Te)===2});return new Tl({clickTolerance:ge,move:(Te,Oe)=>({pitchDelta:(Oe.y-Te.y)*ve}),moveStateManager:ue,enable:le,assignEvents:gc})}(e),N=function({enable:le,clickTolerance:ge,rollDegreesPerPixelMoved:ve=.3},ue){const Te=new Cn({checkCorrectEvent:Oe=>Q.mouseButton(Oe)===2&&Oe.ctrlKey});return new Tl({clickTolerance:ge,move:(Oe,ze)=>{const Re=ue();let Be=(ze.x-Oe.x)*ve;return ze.y<Re.y&&(Be=-Be),{rollDelta:Be}},moveStateManager:Te,enable:le,assignEvents:gc})}(e,z);n.dragRotate=new Qs(e,O,L,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",L,["mouseRotate","mouseRoll"]),this._add("mouseRoll",N,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const Z=function({enable:le,clickTolerance:ge}){const ve=new Cn({checkCorrectEvent:ue=>Q.mouseButton(ue)===0&&!ue.ctrlKey});return new Tl({clickTolerance:ge,move:(ue,Te)=>({around:Te,panDelta:Te.sub(ue)}),activateOnStart:!0,moveStateManager:ve,enable:le,assignEvents:gc})}(e),ne=new _c(e,n);n.dragPan=new ko(l,Z,ne),this._add("mousePan",Z),this._add("touchPan",ne,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const ie=new tu,re=new La;n.touchZoomRotate=new nu(l,re,ie,T),this._add("touchRotate",ie,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const oe=n.scrollZoom=new bs(n,()=>this._triggerRenderFrame());this._add("scrollZoom",oe,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const fe=n.keyboard=new Wr(n);this._add("keyboard",fe),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Fn(n))}_add(e,n,l){this._handlers.push({handlerName:e,handler:n,allowed:l}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ka(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,l){for(const h in e)if(h!==l&&(!n||n.indexOf(h)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const l of e)this._el.contains(l.target)&&n.push(l);return n}mergeHandlerResult(e,n,l,h,m){if(!l)return;c.e(e,l);const y={handlerName:h,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(n.zoom=y),l.panDelta!==void 0&&(n.drag=y),l.rollDelta!==void 0&&(n.roll=y),l.pitchDelta!==void 0&&(n.pitch=y),l.bearingDelta!==void 0&&(n.rotate=y)}_applyChanges(){const e={},n={},l={};for(const[h,m,y]of this._changes)h.panDelta&&(e.panDelta=(e.panDelta||new c.P(0,0))._add(h.panDelta)),h.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+h.zoomDelta),h.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+h.bearingDelta),h.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+h.pitchDelta),h.rollDelta&&(e.rollDelta=(e.rollDelta||0)+h.rollDelta),h.around!==void 0&&(e.around=h.around),h.pinchAround!==void 0&&(e.pinchAround=h.pinchAround),h.noInertia&&(e.noInertia=h.noInertia),c.e(n,m),c.e(l,y);this._updateMapTransform(e,n,l),this._changes=[]}_updateMapTransform(e,n,l){const h=this._map,m=h._getTransformForUpdate(),y=h.terrain;if(!(au(e)||y&&this._terrainMovement))return this._fireEvents(n,l,!0);h._stop(!0);let{panDelta:b,zoomDelta:T,bearingDelta:A,pitchDelta:z,rollDelta:O,around:L,pinchAround:N}=e;N!==void 0&&(L=N),L=L||h.transform.centerPoint,y&&!m.isPointOnMapSurface(L)&&(L=m.centerPoint);const Z={panDelta:b,zoomDelta:T,rollDelta:O,pitchDelta:z,bearingDelta:A,around:L};this._map.cameraHelper.useGlobeControls&&!m.isPointOnMapSurface(L)&&(L=m.centerPoint);const ne=L.distSqr(m.centerPoint)<.01?m.center:m.screenPointToLocation(b?L.sub(b):L);y?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,m),this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?m.setCenter(m.screenPointToLocation(m.centerPoint.sub(b))):this._map.cameraHelper.handleMapControlsPan(Z,m,ne):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(Z,m,ne))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(Z,m),this._map.cameraHelper.handleMapControlsPan(Z,m,ne)),h._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,l,!0)}_fireEvents(e,n,l){const h=Ka(this._eventsInProgress),m=Ka(e),y={};for(const O in e){const{originalEvent:L}=e[O];this._eventsInProgress[O]||(y[`${O}start`]=L),this._eventsInProgress[O]=e[O]}!h&&m&&this._fireEvent("movestart",m.originalEvent);for(const O in y)this._fireEvent(O,y[O]);m&&this._fireEvent("move",m.originalEvent);for(const O in e){const{originalEvent:L}=e[O];this._fireEvent(O,L)}const b={};let T;for(const O in this._eventsInProgress){const{handlerName:L,originalEvent:N}=this._eventsInProgress[O];this._handlersById[L].isActive()||(delete this._eventsInProgress[O],T=n[L]||N,b[`${O}end`]=T)}for(const O in b)this._fireEvent(O,b[O]);const A=Ka(this._eventsInProgress),z=(h||m)&&!A;if(z&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const O=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&O.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(O)}if(l&&z){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=N=>N!==0&&-this._bearingSnap<N&&N<this._bearingSnap;!O||!O.essential&&K.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:T})),L(this._map.getBearing())&&this._map.resetNorth()):(L(O.bearing||this._map.getBearing())&&(O.bearing=0),O.freezeElevation=!0,this._map.easeTo(O,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new c.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new ru("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ui extends c.E{constructor(e,n,l){super(),this._renderFrameCallback=()=>{const h=Math.min((K.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(h)),h<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=l.bearingSnap,this.cameraHelper=n,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(e,n){e.apply(this.transform),this.transform=e,this.cameraHelper=n}getCenter(){return new c.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,n){return this.jumpTo({elevation:e},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,l){return e=c.P.convert(e).mult(-1),this.panTo(this.transform.center,c.e({offset:e},n),l)}panTo(e,n,l){return this.easeTo(c.e({center:e},n),l)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,l){return this.easeTo(c.e({zoom:e},n),l)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)).fire(new c.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,l){return this.easeTo(c.e({bearing:e},n),l)}resetNorth(e,n){return this.rotateTo(0,c.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}getRoll(){return this.transform.roll}setRoll(e,n){return this.jumpTo({roll:e},n),this}cameraForBounds(e,n){e=rn.convert(e).adjustAntiMeridian();const l=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,n)}_cameraForBoxAndBearing(e,n,l,h){const m={top:0,bottom:0,right:0,left:0};if(typeof(h=c.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},h)).padding=="number"){const A=h.padding;h.padding={top:A,bottom:A,right:A,left:A}}const y=c.e(m,h.padding);h.padding=y;const b=this.transform,T=new rn(e,n);return this.cameraHelper.cameraForBoxAndBearing(h,y,T,l,b)}fitBounds(e,n,l){return this._fitInternal(this.cameraForBounds(e,n),n,l)}fitScreenCoordinates(e,n,l,h,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(e)),this.transform.screenPointToLocation(c.P.convert(n)),l,h),h,m)}_fitInternal(e,n,l){return e?(delete(n=c.e(e,n)).padding,n.linear?this.easeTo(n,l):this.flyTo(n,l)):this}jumpTo(e,n){this.stop();const l=this._getTransformForUpdate();let h=!1,m=!1,y=!1;const b=l.zoom;this.cameraHelper.handleJumpToCenterZoom(l,e);const T=l.zoom!==b;return"elevation"in e&&l.elevation!==+e.elevation&&l.setElevation(+e.elevation),"bearing"in e&&l.bearing!==+e.bearing&&(h=!0,l.setBearing(+e.bearing)),"pitch"in e&&l.pitch!==+e.pitch&&(m=!0,l.setPitch(+e.pitch)),"roll"in e&&l.roll!==+e.roll&&(y=!0,l.setRoll(+e.roll)),e.padding==null||l.isPaddingEqual(e.padding)||l.setPadding(e.padding),this._applyUpdatedTransform(l),this.fire(new c.l("movestart",n)).fire(new c.l("move",n)),T&&this.fire(new c.l("zoomstart",n)).fire(new c.l("zoom",n)).fire(new c.l("zoomend",n)),h&&this.fire(new c.l("rotatestart",n)).fire(new c.l("rotate",n)).fire(new c.l("rotateend",n)),m&&this.fire(new c.l("pitchstart",n)).fire(new c.l("pitch",n)).fire(new c.l("pitchend",n)),y&&this.fire(new c.l("rollstart",n)).fire(new c.l("roll",n)).fire(new c.l("rollend",n)),this.fire(new c.l("moveend",n))}calculateCameraOptionsFromTo(e,n,l,h=0){const m=c.a0.fromLngLat(e,n),y=c.a0.fromLngLat(l,h),b=y.x-m.x,T=y.y-m.y,A=y.z-m.z,z=Math.hypot(b,T,A);if(z===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(b,T),L=c.aj(this.transform.cameraToCenterDistance/z/this.transform.tileSize),N=180*Math.atan2(b,-T)/Math.PI;let Z=180*Math.acos(O/z)/Math.PI;return Z=A<0?90-Z:90+Z,{center:y.toLngLat(),elevation:h,zoom:L,pitch:Z,bearing:N}}calculateCameraOptionsFromCameraLngLatAltRotation(e,n,l,h,m){const y=this.transform.calculateCenterFromCameraLngLatAlt(e,n,l,h);return{center:y.center,elevation:y.elevation,zoom:y.zoom,bearing:l,pitch:h,roll:m}}easeTo(e,n){this._stop(!1,e.easeId),((e=c.e({offset:[0,0],duration:500,easing:c.cn},e)).animate===!1||!e.essential&&K.prefersReducedMotion)&&(e.duration=0);const l=this._getTransformForUpdate(),h=this.getBearing(),m=l.pitch,y=l.roll,b="bearing"in e?this._normalizeBearing(e.bearing,h):h,T="pitch"in e?+e.pitch:m,A="roll"in e?this._normalizeBearing(e.roll,y):y,z="padding"in e?e.padding:l.padding,O=c.P.convert(e.offset);let L,N;e.around&&(L=c.S.convert(e.around),N=l.locationToScreenPoint(L));const Z={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ne=this.cameraHelper.handleEaseTo(l,{bearing:b,pitch:T,roll:A,padding:z,around:L,aroundPoint:N,offsetAsPoint:O,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||h!==b,this._pitching=this._pitching||T!==m,this._rolling=this._rolling||A!==y,this._padding=!l.isPaddingEqual(z),this._zooming=this._zooming||ne.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,Z),this.terrain&&this._prepareElevation(ne.elevationCenter),this._ease(ie=>{ne.easeFunc(ie),this.terrain&&!e.freezeElevation&&this._updateElevation(ie),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},ie=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,ie)},e),this}_prepareEase(e,n,l={}){this._moving=!0,n||l.moving||this.fire(new c.l("movestart",e)),this._zooming&&!l.zooming&&this.fire(new c.l("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new c.l("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new c.l("pitchstart",e)),this._rolling&&!l.rolling&&this.fire(new c.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(n-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(c.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const n=e.getCameraLngLat(),l=e.getCameraAltitude(),h=this.terrain?this.terrain.getElevationForLngLatZoom(n,e.zoom):0;if(l<h){const m=this.calculateCameraOptionsFromTo(n,h,e.center,e.elevation);return{pitch:m.pitch,zoom:m.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(n.push(h=>this._elevateCameraIfInsideTerrain(h)),this.transformCameraUpdate&&n.push(h=>this.transformCameraUpdate(h)),!n.length)return;const l=e.clone();for(const h of n){const m=l.clone(),{center:y,zoom:b,roll:T,pitch:A,bearing:z,elevation:O}=h(m);y&&m.setCenter(y),O!==void 0&&m.setElevation(O),b!==void 0&&m.setZoom(b),T!==void 0&&m.setRoll(T),A!==void 0&&m.setPitch(A),z!==void 0&&m.setBearing(z),l.apply(m)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new c.l("move",e)),this._zooming&&this.fire(new c.l("zoom",e)),this._rotating&&this.fire(new c.l("rotate",e)),this._pitching&&this.fire(new c.l("pitch",e)),this._rolling&&this.fire(new c.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const l=this._zooming,h=this._rotating,m=this._pitching,y=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,l&&this.fire(new c.l("zoomend",e)),h&&this.fire(new c.l("rotateend",e)),m&&this.fire(new c.l("pitchend",e)),y&&this.fire(new c.l("rollend",e)),this.fire(new c.l("moveend",e))}flyTo(e,n){if(!e.essential&&K.prefersReducedMotion){const Be=c.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(Be,n)}this.stop(),e=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cn},e);const l=this._getTransformForUpdate(),h=l.bearing,m=l.pitch,y=l.roll,b=l.padding,T="bearing"in e?this._normalizeBearing(e.bearing,h):h,A="pitch"in e?+e.pitch:m,z="roll"in e?this._normalizeBearing(e.roll,y):y,O="padding"in e?e.padding:l.padding,L=c.P.convert(e.offset);let N=l.centerPoint.add(L);const Z=l.screenPointToLocation(N),ne=this.cameraHelper.handleFlyTo(l,{bearing:T,pitch:A,roll:z,padding:O,locationAtOffset:Z,offsetAsPoint:L,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let ie=e.curve;const re=Math.max(l.width,l.height),oe=re/ne.scaleOfZoom,fe=ne.pixelPathLength;typeof ne.scaleOfMinZoom=="number"&&(ie=Math.sqrt(re/ne.scaleOfMinZoom/fe*2));const le=ie*ie;function ge(Be){const gt=(oe*oe-re*re+(Be?-1:1)*le*le*fe*fe)/(2*(Be?oe:re)*le*fe);return Math.log(Math.sqrt(gt*gt+1)-gt)}function ve(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function ue(Be){return(Math.exp(Be)+Math.exp(-Be))/2}const Te=ge(!1);let Oe=function(Be){return ue(Te)/ue(Te+ie*Be)},ze=function(Be){return re*((ue(Te)*(ve(gt=Te+ie*Be)/ue(gt))-ve(Te))/le)/fe;var gt},Re=(ge(!0)-Te)/ie;if(Math.abs(fe)<2e-6||!isFinite(Re)){if(Math.abs(re-oe)<1e-6)return this.easeTo(e,n);const Be=oe<re?-1:1;Re=Math.abs(Math.log(oe/re))/ie,ze=()=>0,Oe=gt=>Math.exp(Be*ie*gt)}return e.duration="duration"in e?+e.duration:1e3*Re/("screenSpeed"in e?+e.screenSpeed/ie:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=h!==T,this._pitching=A!==m,this._rolling=z!==y,this._padding=!l.isPaddingEqual(O),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(ne.targetCenter),this._ease(Be=>{const gt=Be*Re,pt=1/Oe(gt),it=ze(gt);this._rotating&&l.setBearing(c.C.number(h,T,Be)),this._pitching&&l.setPitch(c.C.number(m,A,Be)),this._rolling&&l.setRoll(c.C.number(y,z,Be)),this._padding&&(l.interpolatePadding(b,O,Be),N=l.centerPoint.add(L)),ne.easeFunc(Be,pt,it,N),this.terrain&&!e.freezeElevation&&this._updateElevation(Be),this._applyUpdatedTransform(l),this._fireMoveEvents(n)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const h=this._onEaseEnd;delete this._onEaseEnd,h.call(this,n)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,n,l){l.animate===!1||l.duration===0?(e(1),n()):(this._easeStart=K.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=c.aN(e,-180,180);const l=Math.abs(e-n);return Math.abs(e-360-n)<l&&(e-=360),Math.abs(e+360-n)<l&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(c.S.convert(e),this.transform.tileZoom):null}}const ua={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class li{constructor(e=ua){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=Q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const l=this._map._getUIString(`AttributionControl.${n}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(h=>typeof h!="string"?"":h)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const h=this._map.style.stylesheet;this.styleOwner=h.owner,this.styleId=h.id}const n=this._map.style.sourceCaches;for(const h in n){const m=n[h];if(m.used||m.usedForTerrain){const y=m.getSource();y.attribution&&e.indexOf(y.attribution)<0&&e.push(y.attribution)}}e=e.filter(h=>String(h).trim()),e.sort((h,m)=>h.length-m.length),e=e.filter((h,m)=>{for(let y=m+1;y<e.length;y++)if(e[y].indexOf(h)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=Q.sanitize(l),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ai{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=Q.create("div","maplibregl-ctrl");const n=Q.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class An{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,l=n?this._queue.concat(n):this._queue;for(const h of l)if(h.id===e)return void(h.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const l of n)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var vc=c.aI([{name:"a_pos3d",type:"Int16",components:3}]);class Ml extends c.E{constructor(e){super(),this._lastTilesetChange=K.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const l={};for(const h of Ue(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))l[h.key]=!0,this._renderableTilesKeys.push(h.key),this._tiles[h.key]||(h.terrainRttPosMatrix32f=new Float64Array(16),c.bX(h.terrainRttPosMatrix32f,0,c.$,c.$,0,0,1),this._tiles[h.key]=new tr(h,this.tileSize),this._lastTilesetChange=K.now());for(const h in this._tiles)l[h]||delete this._tiles[h]}freeRtt(e){for(const n in this._tiles){const l=this._tiles[n];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,n){return n?this._getTerrainCoordsForTileRanges(e,n):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const n={};for(const l of this._renderableTilesKeys){const h=this._tiles[l].tileID,m=e.clone(),y=c.b9();if(h.canonical.equals(e.canonical))c.bX(y,0,c.$,c.$,0,0,1);else if(h.canonical.isChildOf(e.canonical)){const b=h.canonical.z-e.canonical.z,T=h.canonical.x-(h.canonical.x>>b<<b),A=h.canonical.y-(h.canonical.y>>b<<b),z=c.$>>b;c.bX(y,0,z,z,0,0,1),c.M(y,y,[-T*z,-A*z,0])}else{if(!e.canonical.isChildOf(h.canonical))continue;{const b=e.canonical.z-h.canonical.z,T=e.canonical.x-(e.canonical.x>>b<<b),A=e.canonical.y-(e.canonical.y>>b<<b),z=c.$>>b;c.bX(y,0,c.$,c.$,0,0,1),c.M(y,y,[T*z,A*z,0]),c.N(y,y,[1/2**b,1/2**b,0])}}m.terrainRttPosMatrix32f=new Float32Array(y),n[l]=m}return n}_getTerrainCoordsForTileRanges(e,n){const l={};for(const h of this._renderableTilesKeys){const m=this._tiles[h].tileID;if(!this._isWithinTileRanges(m,n))continue;const y=e.clone(),b=c.b9();if(m.canonical.z===e.canonical.z){const T=e.canonical.x-m.canonical.x,A=e.canonical.y-m.canonical.y;c.bX(b,0,c.$,c.$,0,0,1),c.M(b,b,[T*c.$,A*c.$,0])}else if(m.canonical.z>e.canonical.z){const T=m.canonical.z-e.canonical.z,A=m.canonical.x-(m.canonical.x>>T<<T),z=m.canonical.y-(m.canonical.y>>T<<T),O=e.canonical.x-(m.canonical.x>>T),L=e.canonical.y-(m.canonical.y>>T),N=c.$>>T;c.bX(b,0,N,N,0,0,1),c.M(b,b,[-A*N+O*c.$,-z*N+L*c.$,0])}else{const T=e.canonical.z-m.canonical.z,A=e.canonical.x-(e.canonical.x>>T<<T),z=e.canonical.y-(e.canonical.y>>T<<T),O=(e.canonical.x>>T)-m.canonical.x,L=(e.canonical.y>>T)-m.canonical.y,N=c.$<<T;c.bX(b,0,N,N,0,0,1),c.M(b,b,[A*c.$+O*N,z*c.$+L*N,0])}y.terrainRttPosMatrix32f=new Float32Array(b),l[h]=y}return l}getSourceTile(e,n){const l=this.sourceCache._source;let h=e.overscaledZ-this.deltaZoom;if(h>l.maxzoom&&(h=l.maxzoom),h<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(h).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&n)for(;h>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(h--).key);return m}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,n){return n[e.canonical.z]&&e.canonical.x>=n[e.canonical.z].minTileX&&e.canonical.x<=n[e.canonical.z].maxTileX&&e.canonical.y>=n[e.canonical.z].minTileY&&e.canonical.y<=n[e.canonical.z].maxTileY}}class dr{constructor(e,n,l){this._meshCache={},this.painter=e,this.sourceCache=new Ml(n),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,l,h=c.$){var m;if(!(n>=0&&n<h&&l>=0&&l<h))return 0;const y=this.getTerrainData(e),b=(m=y.tile)===null||m===void 0?void 0:m.dem;if(!b)return 0;const T=c.cr([],[n/h*c.$,l/h*c.$],y.u_terrain_matrix),A=[T[0]*b.dim,T[1]*b.dim],z=Math.floor(A[0]),O=Math.floor(A[1]),L=A[0]-z,N=A[1]-O;return b.get(z,O)*(1-L)*(1-N)+b.get(z+1,O)*L*(1-N)+b.get(z,O+1)*(1-L)*N+b.get(z+1,O+1)*L*N}getElevationForLngLatZoom(e,n){if(!c.cs(n,e.wrap()))return 0;const{tileID:l,mercatorX:h,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(l,h%c.$,m%c.$,c.$)}getElevation(e,n,l,h=c.$){return this.getDEMElevation(e,n,l,h)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const h=this.painter.context,m=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(h,m,h.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(h,new c.R({width:1,height:1}),h.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.af([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const h=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new c.T(h,n.dem.getPixels(),h.gl.RGBA,{premultiply:!1}),n.demTexture.bind(h.gl.NEAREST,h.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const l=n&&n+n.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const h=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=h?m=e.canonical.z-h:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const y=e.canonical.x-(e.canonical.x>>m<<m),b=e.canonical.y-(e.canonical.y>>m<<m),T=c.ct(new Float64Array(16),[1/(c.$<<m),1/(c.$<<m),0]);c.M(T,T,[y*c.$,b*c.$,0]),this._demMatrixCache[e.key]={matrix:T,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,l=n.width/devicePixelRatio,h=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===h||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(n.context,{width:l,height:h,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(l,h,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,l,h))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,y=0;m<this._coordsTextureSize;m++)for(let b=0;b<this._coordsTextureSize;b++,y+=4)n[y+0]=255&b,n[y+1]=255&m,n[y+2]=b>>8<<4|m>>8,n[y+3]=0;const l=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),h=new c.T(e,l,e.gl.RGBA,{premultiply:!1});return h.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=h,h}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),l=this.painter.context,h=l.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),y=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),b=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),h.readPixels(m,b-y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null);const T=n[0]+(n[2]>>4<<8),A=n[1]+((15&n[2])<<8),z=this.coordsIndex[255-n[3]],O=z&&this.sourceCache.getTileByID(z);if(!O)return null;const L=this._coordsTextureSize,N=(1<<O.tileID.canonical.z)*L;return new c.a0((O.tileID.canonical.x*L+T)/N+O.tileID.wrap,(O.tileID.canonical.y*L+A)/N,this.getElevation(O.tileID,T,A,L))}depthAtPoint(e){const n=new Uint8Array(4),l=this.painter.context,h=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),h.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,h.RGBA,h.UNSIGNED_BYTE,n),l.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(e){var n;const l=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,h=l&&e.canonical.y===0,m=l&&e.canonical.y===(1<<e.canonical.z)-1,y=`m_${h?"n":""}_${m?"s":""}`;if(this._meshCache[y])return this._meshCache[y];const b=this.painter.context,T=new c.cu,A=new c.aM,z=this.meshSize,O=c.$/z,L=z*z;for(let ue=0;ue<=z;ue++)for(let Te=0;Te<=z;Te++)T.emplaceBack(Te*O,ue*O,0);for(let ue=0;ue<L;ue+=z+1)for(let Te=0;Te<z;Te++)A.emplaceBack(Te+ue,z+Te+ue+1,z+Te+ue+2),A.emplaceBack(Te+ue,z+Te+ue+2,Te+ue+1);const N=T.length,Z=N+(z+1),ne=(z+1)*z,ie=h?c.bg:0,re=h?0:1,oe=m?c.bh:c.$,fe=m?0:1;for(let ue=0;ue<=z;ue++)T.emplaceBack(ue*O,ie,re);for(let ue=0;ue<=z;ue++)T.emplaceBack(ue*O,oe,fe);for(let ue=0;ue<z;ue++)A.emplaceBack(ne+ue,Z+ue,Z+ue+1),A.emplaceBack(ne+ue,Z+ue+1,ne+ue+1),A.emplaceBack(0+ue,N+ue+1,N+ue),A.emplaceBack(0+ue,0+ue+1,N+ue+1);const le=T.length,ge=le+2*(z+1);for(const ue of[0,1])for(let Te=0;Te<=z;Te++)for(const Oe of[0,1])T.emplaceBack(ue*c.$,Te*O,Oe);for(let ue=0;ue<2*z;ue+=2)A.emplaceBack(le+ue,le+ue+1,le+ue+3),A.emplaceBack(le+ue,le+ue+3,le+ue+2),A.emplaceBack(ge+ue,ge+ue+3,ge+ue+1),A.emplaceBack(ge+ue,ge+ue+2,ge+ue+3);const ve=new Va(b.createVertexBuffer(T,vc.members),b.createIndexBuffer(A),c.aL.simpleSegment(0,0,T.length,A.length));return this._meshCache[y]=ve,ve}getMeshFrameDelta(e){return 2*Math.PI*c.bt/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,n){var l;const{tileID:h}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(l=this.getMinMaxElevation(h).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return n&&n.dem&&(l.minElevation=n.dem.min*this.exaggeration,l.maxElevation=n.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,n){const l=c.a0.fromLngLat(e.wrap()),h=(1<<n)*c.$,m=l.x*h,y=l.y*h,b=Math.floor(m/c.$),T=Math.floor(y/c.$);return{tileID:new c.Z(n,0,n,b,T),mercatorX:m,mercatorY:y}}}class Oo{constructor(e,n,l){this._context=e,this._size=n,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(l.texture),{id:e,fbo:n,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(n=>e.id!==n),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const wt={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class It{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new Oo(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(n)),this._coordsAscending={};for(const l in e.sourceCaches){this._coordsAscending[l]={};const h=e.sourceCaches[l].getVisibleCoordinates(),m=e.sourceCaches[l].getSource(),y=m instanceof yr?m.terrainTileRanges:null;for(const b of h){const T=this.terrain.sourceCache.getTerrainCoords(b,y);for(const A in T)this._coordsAscending[l][A]||(this._coordsAscending[l][A]=[]),this._coordsAscending[l][A].push(T[A])}}this._coordsAscendingStr={};for(const l of e._order){const h=e._layers[l],m=h.source;if(wt[h.type]&&!this._coordsAscendingStr[m]){this._coordsAscendingStr[m]={};for(const y in this._coordsAscending[m])this._coordsAscendingStr[m][y]=this._coordsAscending[m][y].map(b=>b.key).sort().join()}}for(const l of this._renderableTiles)for(const h in this._coordsAscendingStr){const m=this._coordsAscendingStr[h][l.tileID.key];m&&m!==l.rttCoords[h]&&(l.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const l=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),h=e.type,m=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(wt[h]&&(this._prevType&&wt[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(e.id),!y))return!0;if(wt[this._prevType]||wt[h]&&y){this._prevType=h;const b=this._stacks.length-1,T=this._stacks[b]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(hn(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[b]){const O=this.pool.getObjectForId(A.rtt[b].id);if(O.stamp===A.rtt[b].stamp){this.pool.useObject(O);continue}}const z=this.pool.getOrCreateFreeObject();this.pool.useObject(z),this.pool.stampObject(z),A.rtt[b]={id:z.id,stamp:z.stamp},m.context.bindFramebuffer.set(z.fbo.framebuffer),m.context.clear({color:c.be.transparent,stencil:0}),m.currentStencilSource=void 0;for(let O=0;O<T.length;O++){const L=m.style._layers[T[O]],N=L.source?this._coordsAscending[L.source][A.tileID.key]:[A.tileID];m.context.viewport.set([0,0,z.fbo.width,z.fbo.height]),m._renderTileClippingMasks(L,N,!0),m.renderLayer(m,m.style.sourceCaches[L.source],L,N,l),L.source&&(A.rttCoords[L.source]=this._coordsAscendingStr[L.source][A.tileID.key])}}return hn(this.painter,this.terrain,this._rttTiles,l),this._rttTiles=[],this.pool.freeAllObjects(),wt[h]}return!1}}const su={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},pn=pe,Bo={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ua,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},sr={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class ih{constructor(e,n,l=!1){this.mousedown=m=>{this.startMove(m,Q.mousePos(this.element,m)),Q.addEventListener(window,"mousemove",this.mousemove),Q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=m=>{this.move(m,Q.mousePos(this.element,m))},this.mouseup=m=>{this._rotatePitchHanlder.dragEnd(m),this.offTemp()},this.touchstart=m=>{m.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,m.targetTouches)[0],this.startMove(m,this._startPos),Q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.addEventListener(window,"touchend",this.touchend))},this.touchmove=m=>{m.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,m.targetTouches)[0],this.move(m,this._lastPos))},this.touchend=m=>{m.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const h=new Jc;this._rotatePitchHanlder=new Tl({clickTolerance:3,move:(m,y)=>{const b=n.getBoundingClientRect(),T=new c.P((b.bottom-b.top)/2,(b.right-b.left)/2);return{bearingDelta:c.cm(new c.P(m.x,y.y),y,T),pitchDelta:l?-.5*(y.y-m.y):void 0}},moveStateManager:h,enable:!0,assignEvents:()=>{}}),this.map=e,Q.addEventListener(n,"mousedown",this.mousedown),Q.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(n,"touchcancel",this.reset)}startMove(e,n){this._rotatePitchHanlder.dragStart(e,n),Q.disableDrag()}move(e,n){const l=this.map,{bearingDelta:h,pitchDelta:m}=this._rotatePitchHanlder.dragMove(e,n)||{};h&&l.setBearing(l.getBearing()+h),m&&l.setPitch(l.getPitch()+m)}off(){const e=this.element;Q.removeEventListener(e,"mousedown",this.mousedown),Q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend),Q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){Q.enableDrag(),Q.removeEventListener(window,"mousemove",this.mousemove),Q.removeEventListener(window,"mouseup",this.mouseup),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend)}}let Qn;function $h(d,e,n,l=!1){if(l||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return d?.wrap();const h=new c.S(d.lng,d.lat);if(d=new c.S(d.lng,d.lat),e){const m=new c.S(d.lng-360,d.lat),y=new c.S(d.lng+360,d.lat),b=n.locationToScreenPoint(d).distSqr(e);n.locationToScreenPoint(m).distSqr(e)<b?d=m:n.locationToScreenPoint(y).distSqr(e)<b&&(d=y)}for(;Math.abs(d.lng-n.center.lng)>180;){const m=n.locationToScreenPoint(d);if(m.x>=0&&m.y>=0&&m.x<=n.width&&m.y<=n.height)break;d.lng>n.center.lng?d.lng-=360:d.lng+=360}return d.lng!==h.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(d))?d:h}const ws={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ji(d,e,n){const l=d.classList;for(const h in ws)l.remove(`maplibregl-${n}-anchor-${h}`);l.add(`maplibregl-${n}-anchor-${e}`)}class on extends c.E{constructor(e){if(super(),this._onKeyPress=n=>{const l=n.code,h=n.charCode||n.keyCode;l!=="Space"&&l!=="Enter"&&h!==32&&h!==13||this.togglePopup()},this._onMapClick=n=>{const l=n.originalEvent.target,h=this._element;this._popup&&(l===h||h.contains(l))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const l=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!l)&&this._map.once("render",this._update),this._lngLat=$h(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(h=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let m="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?m="rotateX(0deg)":this._pitchAlignment==="map"&&(m=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,`${ws[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${m} ${h}`),K.frameAsync(new AbortController).then(()=>{this._updateOpacity(n&&n.type==="moveend")}).catch(()=>{})},this._onMove=n=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=c.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div");const n=Q.createNS("http://www.w3.org/2000/svg","svg"),l=41,h=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${l}px`),n.setAttributeNS(null,"width",`${h}px`),n.setAttributeNS(null,"viewBox",`0 0 ${h} ${l}`);const m=Q.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const y=Q.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"fill-rule","nonzero");const b=Q.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"transform","translate(3.0, 29.0)"),b.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const re of T){const oe=Q.createNS("http://www.w3.org/2000/svg","ellipse");oe.setAttributeNS(null,"opacity","0.04"),oe.setAttributeNS(null,"cx","10.5"),oe.setAttributeNS(null,"cy","5.80029008"),oe.setAttributeNS(null,"rx",re.rx),oe.setAttributeNS(null,"ry",re.ry),b.appendChild(oe)}const A=Q.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const z=Q.createNS("http://www.w3.org/2000/svg","path");z.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(z);const O=Q.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const L=Q.createNS("http://www.w3.org/2000/svg","path");L.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(L);const N=Q.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"transform","translate(6.0, 7.0)"),N.setAttributeNS(null,"fill","#FFFFFF");const Z=Q.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ne=Q.createNS("http://www.w3.org/2000/svg","circle");ne.setAttributeNS(null,"fill","#000000"),ne.setAttributeNS(null,"opacity","0.25"),ne.setAttributeNS(null,"cx","5.5"),ne.setAttributeNS(null,"cy","5.5"),ne.setAttributeNS(null,"r","5.4999962");const ie=Q.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),Z.appendChild(ne),Z.appendChild(ie),y.appendChild(b),y.appendChild(A),y.appendChild(O),y.appendChild(N),y.appendChild(Z),n.appendChild(y),n.setAttributeNS(null,"height",l*this._scale+"px"),n.setAttributeNS(null,"width",h*this._scale+"px"),this._element.appendChild(n),this._offset=c.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",n=>{n.preventDefault()}),this._element.addEventListener("mousedown",n=>{n.preventDefault()}),Ji(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=c.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const h=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(38.1-13.5+h)],"bottom-right":[-h,-1*(38.1-13.5+h)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,l;const h=(n=this._map)===null||n===void 0?void 0:n.terrain,m=this._map.transform.isLocationOccluded(this._lngLat);if(!h||m){const N=m?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==N&&(this._element.style.opacity=N))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,b=y.terrain.depthAtPoint(this._pos),T=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,T)-b<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/y.transform.pixelsPerMeter,z=Math.sin(y.getPitch()*Math.PI/180)*A,O=y.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),L=y.transform.lngLatToCameraDepth(this._lngLat,T+z)-O>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&L&&this._popup.remove(),this._element.style.opacity=L?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=c.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return(this._opacity===void 0||e===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const Sr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Vi=0,Qa=!1;const No={maxWidth:100,unit:"metric"};function Fo(d,e,n){const l=n&&n.maxWidth||100,h=d._container.clientHeight/2,m=d._container.clientWidth/2,y=d.unproject([m-l/2,h]),b=d.unproject([m+l/2,h]),T=Math.round(d.project(b).x-d.project(y).x),A=Math.min(l,T,d._container.clientWidth),z=y.distanceTo(b);if(n&&n.unit==="imperial"){const O=3.2808*z;O>5280?Ts(e,A,O/5280,d._getUIString("ScaleControl.Miles")):Ts(e,A,O,d._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Ts(e,A,z/1852,d._getUIString("ScaleControl.NauticalMiles")):z>=1e3?Ts(e,A,z/1e3,d._getUIString("ScaleControl.Kilometers")):Ts(e,A,z,d._getUIString("ScaleControl.Meters"))}function Ts(d,e,n,l){const h=function(m){const y=Math.pow(10,`${Math.floor(m)}`.length-1);let b=m/y;return b=b>=10?10:b>=5?5:b>=3?3:b>=2?2:b>=1?1:function(T){const A=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*A)/A}(b),y*b}(n);d.style.width=e*(h/n)+"px",d.innerHTML=`${h}&nbsp;${l}`}const Qr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},El=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cl(d){if(d){if(typeof d=="number"){const e=Math.round(Math.abs(d)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,d),"top-left":new c.P(e,e),"top-right":new c.P(-e,e),bottom:new c.P(0,-d),"bottom-left":new c.P(e,-e),"bottom-right":new c.P(-e,-e),left:new c.P(d,0),right:new c.P(-d,0)}}if(d instanceof c.P||Array.isArray(d)){const e=c.P.convert(d);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:c.P.convert(d.center||[0,0]),top:c.P.convert(d.top||[0,0]),"top-left":c.P.convert(d["top-left"]||[0,0]),"top-right":c.P.convert(d["top-right"]||[0,0]),bottom:c.P.convert(d.bottom||[0,0]),"bottom-left":c.P.convert(d["bottom-left"]||[0,0]),"bottom-right":c.P.convert(d["bottom-right"]||[0,0]),left:c.P.convert(d.left||[0,0]),right:c.P.convert(d.right||[0,0])}}return Cl(new c.P(0,0))}const xc=pe;E.AJAXError=c.cy,E.Event=c.l,E.Evented=c.E,E.LngLat=c.S,E.MercatorCoordinate=c.a0,E.Point=c.P,E.addProtocol=c.cz,E.config=c.a,E.removeProtocol=c.cA,E.AttributionControl=li,E.BoxZoomHandler=Lo,E.CanvasSource=ba,E.CooperativeGesturesHandler=th,E.DoubleClickZoomHandler=Ws,E.DragPanHandler=ko,E.DragRotateHandler=Qs,E.EdgeInsets=Ar,E.FullscreenControl=class extends c.E{constructor(d={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=Q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Q.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},E.GeoJSONSource=Nr,E.GeolocateControl=class extends c.E{constructor(d){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new c.S(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,h=this._map.getBearing(),m=c.e({bearing:h},this.options.fitBoundsOptions),y=rn.fromLngLat(n,l);this._map.fitBounds(y,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new c.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Qa)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Q.create("button","maplibregl-ctrl-geolocate",this._container),Q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new on({element:this._dotElement}),this._circleElement=Q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new on({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))})}},this.options=c.e({},Sr,d)}onAdd(d){return this._map=d,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return c._(this,arguments,void 0,function*(e=!1){if(Qn!==void 0&&!e)return Qn;if(window.navigator.permissions===void 0)return Qn=!!window.navigator.geolocation,Qn;try{Qn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Qn=!!window.navigator.geolocation}return Qn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Vi=0,Qa=!1}_isOutOfMapMaxBounds(d){const e=this._map.getMaxBounds(),n=d.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const d=this._map.getBounds(),e=d.getSouthEast(),n=d.getNorthEast(),l=e.distanceTo(n),h=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Vi--,Qa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Vi++,Vi>1?(d={maximumAge:6e5,timeout:0},Qa=!0):(d=this.options.positionOptions,Qa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},E.GlobeControl=class{constructor(){this._toggleProjection=()=>{var d;const e=(d=this._map.getProjection())===null||d===void 0?void 0:d.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var d;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((d=this._map.getProjection())===null||d===void 0?void 0:d.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(d){return this._map=d,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Q.create("button","maplibregl-ctrl-globe",this._container),Q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},E.Hash=Xr,E.ImageSource=yr,E.KeyboardHandler=Wr,E.LngLatBounds=rn,E.LogoControl=Ai,E.Map=class extends Ui{constructor(d){var e,n;c.cv.mark(c.cw.create);const l=Object.assign(Object.assign(Object.assign({},Bo),d),{canvasContextAttributes:Object.assign(Object.assign({},Bo.canvasContextAttributes),d.canvasContextAttributes)});if(l.minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const h=new cn,m=new Sa;if(l.minZoom!==void 0&&h.setMinZoom(l.minZoom),l.maxZoom!==void 0&&h.setMaxZoom(l.maxZoom),l.minPitch!==void 0&&h.setMinPitch(l.minPitch),l.maxPitch!==void 0&&h.setMaxPitch(l.maxPitch),l.renderWorldCopies!==void 0&&h.setRenderWorldCopies(l.renderWorldCopies),super(h,m,{bearingSnap:l.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new An,this._controls=[],this._mapId=c.a6(),this._contextLost=b=>{b.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.l("webglcontextlost",{originalEvent:b}))},this._contextRestored=b=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:b}))},this._onMapScroll=b=>{if(b.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=l.interactive,this._maxTileCacheSize=l.maxTileCacheSize,this._maxTileCacheZoomLevels=l.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},l.canvasContextAttributes),this._trackResize=l.trackResize===!0,this._bearingSnap=l.bearingSnap,this._centerClampedToGround=l.centerClampedToGround,this._refreshExpiredTiles=l.refreshExpiredTiles===!0,this._fadeDuration=l.fadeDuration,this._crossSourceCollisions=l.crossSourceCollisions===!0,this._collectResourceTiming=l.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},su),l.locale),this._clickTolerance=l.clickTolerance,this._overridePixelRatio=l.pixelRatio,this._maxCanvasSize=l.maxCanvasSize,this.transformCameraUpdate=l.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=l.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Je.addThrottleControl(()=>this.isMoving()),this._requestManager=new nt(l.transformRequest),typeof l.container=="string"){if(this._container=document.getElementById(l.container),!this._container)throw new Error(`Container '${l.container}' not found.`)}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(l.maxBounds&&this.setMaxBounds(l.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let b=!1;const T=Xa(A=>{this._trackResize&&!this._removed&&(this.resize(A),this.redraw())},50);this._resizeObserver=new ResizeObserver(A=>{b?T(A):b=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wa(this,l),this._hash=l.hash&&new Xr(typeof l.hash=="string"&&l.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:l.center,elevation:l.elevation,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch,roll:l.roll}),l.bounds&&(this.resize(),this.fitBounds(l.bounds,c.e({},l.fitBoundsOptions,{duration:0}))));const y=typeof l.style=="string"||((n=(e=l.style)===null||e===void 0?void 0:e.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,y),this._localIdeographFontFamily=l.localIdeographFontFamily,this._validateStyle=l.validateStyle,l.style&&this.setStyle(l.style,{localIdeographFontFamily:l.localIdeographFontFamily}),l.attributionControl&&this.addControl(new li(typeof l.attributionControl=="boolean"?void 0:l.attributionControl)),l.maplibreLogo&&this.addControl(new Ai,l.logoPosition),this.on("style.load",()=>{if(y||this._resizeTransform(),this.transform.unmodified){const b=c.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(b)}}),this.on("data",b=>{this._update(b.dataType==="style"),this.fire(new c.l(`${b.dataType}data`,b))}),this.on("dataloading",b=>{this.fire(new c.l(`${b.dataType}dataloading`,b))}),this.on("dataabort",b=>{this.fire(new c.l("sourcedataabort",b))})}_getMapId(){return this._mapId}setGlobalStateProperty(d,e){return this.style.setGlobalStateProperty(d,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(d,e){if(e===void 0&&(e=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=d.onAdd(this);this._controls.push(d);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(n,l.firstChild):l.appendChild(n),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(d);return e>-1&&this._controls.splice(e,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,e,n,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(d,e,n,l)}resize(d,e=!0){const[n,l]=this._containerDimensions(),h=this._getClampedPixelRatio(n,l);if(this._resizeCanvas(n,l,h),this.painter.resize(n,l,h),this.painter.overLimit()){const y=this.painter.context.gl;this._maxCanvasSize=[y.drawingBufferWidth,y.drawingBufferHeight];const b=this._getClampedPixelRatio(n,l);this._resizeCanvas(n,l,b),this.painter.resize(n,l,b)}this._resizeTransform(e);const m=!this._moving;return m&&(this.stop(),this.fire(new c.l("movestart",d)).fire(new c.l("move",d))),this.fire(new c.l("resize",d)),m&&this.fire(new c.l("moveend",d)),this}_resizeTransform(d=!0){var e;const[n,l]=this._containerDimensions();this.transform.resize(n,l,d),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,l,d)}_getClampedPixelRatio(d,e){const{0:n,1:l}=this._maxCanvasSize,h=this.getPixelRatio(),m=d*h,y=e*h;return Math.min(m>n?n/m:1,y>l?l/y:1)*h}getPixelRatio(){var d;return(d=this._overridePixelRatio)!==null&&d!==void 0?d:devicePixelRatio}setPixelRatio(d){this._overridePixelRatio=d,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(rn.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.setMinZoom(d),this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.setMaxZoom(d),this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.setMinPitch(d),this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(d>=this.transform.minPitch)return this.transform.setMaxPitch(d),this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.setRenderWorldCopies(d),this._update()}project(d){return this.transform.locationToScreenPoint(c.S.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.screenPointToLocation(c.P.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,e,n){if(d==="mouseenter"||d==="mouseover"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:m=>{const y=e.filter(T=>this.getLayer(T)),b=y.length!==0?this.queryRenderedFeatures(m.point,{layers:y}):[];b.length?l||(l=!0,n.call(this,new Tr(d,this,m.originalEvent,{features:b}))):l=!1},mouseout:()=>{l=!1}}}}if(d==="mouseleave"||d==="mouseout"){let l=!1;return{layers:e,listener:n,delegates:{mousemove:y=>{const b=e.filter(T=>this.getLayer(T));(b.length!==0?this.queryRenderedFeatures(y.point,{layers:b}):[]).length?l=!0:l&&(l=!1,n.call(this,new Tr(d,this,y.originalEvent)))},mouseout:y=>{l&&(l=!1,n.call(this,new Tr(d,this,y.originalEvent)))}}}}{const l=h=>{const m=e.filter(b=>this.getLayer(b)),y=m.length!==0?this.queryRenderedFeatures(h.point,{layers:m}):[];y.length&&(h.features=y,n.call(this,h),delete h.features)};return{layers:e,listener:n,delegates:{[d]:l}}}}_saveDelegatedListener(d,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(e)}_removeDelegatedListener(d,e,n){if(!this._delegatedListeners||!this._delegatedListeners[d])return;const l=this._delegatedListeners[d];for(let h=0;h<l.length;h++){const m=l[h];if(m.listener===n&&m.layers.length===e.length&&m.layers.every(y=>e.includes(y))){for(const y in m.delegates)this.off(y,m.delegates[y]);return void l.splice(h,1)}}}on(d,e,n){if(n===void 0)return super.on(d,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(d,l,n);this._saveDelegatedListener(d,h);for(const m in h.delegates)this.on(m,h.delegates[m]);return{unsubscribe:()=>{this._removeDelegatedListener(d,l,n)}}}once(d,e,n){if(n===void 0)return super.once(d,e);const l=typeof e=="string"?[e]:e,h=this._createDelegatedListener(d,l,n);for(const m in h.delegates){const y=h.delegates[m];h.delegates[m]=(...b)=>{this._removeDelegatedListener(d,l,n),y(...b)}}this._saveDelegatedListener(d,h);for(const m in h.delegates)this.once(m,h.delegates[m]);return this}off(d,e,n){return n===void 0?super.off(d,e):(this._removeDelegatedListener(d,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(d,e){if(!this.style)return[];let n;const l=d instanceof c.P||Array.isArray(d),h=l?d:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:d)||{},h instanceof c.P||typeof h[0]=="number")n=[c.P.convert(h)];else{const m=c.P.convert(h[0]),y=c.P.convert(h[1]);n=[m,new c.P(y.x,m.y),y,new c.P(m.x,y.y),m]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(d,e){return this.style.querySourceFeatures(d,e)}setStyle(d,e){return(e=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(d,e))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const e=this._locale[d];if(e==null)throw new Error(`Missing UI string '${d}'`);return e}_updateStyle(d,e){var n,l;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,e));const h=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new Ou(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,e,h):this.style.loadJSON(d,e,h),this):((l=(n=this.style)===null||n===void 0?void 0:n.projection)===null||l===void 0||l.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Ou(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,e){if(typeof d=="string"){const n=this._requestManager.transformRequest(d,"Style");c.j(n,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new c.k(l))})}else typeof d=="object"&&this._updateDiff(d,e)}_updateDiff(d,e){try{this.style.setState(d,e)&&this._update(!0)}catch(n){c.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(d,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(d,e){return this._lazyInitEmptyStyle(),this.style.addSource(d,e),this._update(!0)}isSourceLoaded(d){const e=this.style&&this.style.sourceCaches[d];if(e!==void 0)return e.loaded();this.fire(new c.k(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const e=this.style.sourceCaches[d.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const l=this.style._layers[n];l.type==="hillshade"&&l.source===d.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),l.type==="color-relief"&&l.source===d.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dr(this.painter,e,d),this.painter.renderToTexture=new It(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var l;n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==d.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((l=n.source)===null||l===void 0?void 0:l.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:d})),this}getTerrain(){var d,e;return(e=(d=this.terrain)===null||d===void 0?void 0:d.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const e in d){const n=d[e]._tiles;for(const l in n){const h=n[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}}return!0}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}setSourceTileLodParams(d,e,n){if(n){const l=this.getSource(n);if(!l)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);l.calculateTileZoom=Le(Math.max(1,d),Math.max(1,e))}else for(const l in this.style.sourceCaches)this.style.sourceCaches[l].getSource().calculateTileZoom=Le(Math.max(1,d),Math.max(1,e));return this._update(!0),this}refreshTiles(d,e){const n=this.style.sourceCaches[d];if(!n)throw new Error(`There is no source cache with ID "${d}", cannot refresh tile`);e===void 0?n.reload(!0):n.refreshTiles(e.map(l=>new c.a3(l.z,l.x,l.y)))}addImage(d,e,n={}){const{pixelRatio:l=1,sdf:h=!1,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:A}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||c.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:z,height:O,data:L}=e,N=e;return this.style.addImage(d,{data:new c.R({width:z,height:O},new Uint8Array(L)),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:A,sdf:h,version:0,userImage:N}),N.onAdd&&N.onAdd(this,d),this}}{const{width:z,height:O,data:L}=K.getImageData(e);this.style.addImage(d,{data:new c.R({width:z,height:O},L),pixelRatio:l,stretchX:m,stretchY:y,content:b,textFitWidth:T,textFitHeight:A,sdf:h,version:0})}}updateImage(d,e){const n=this.style.getImage(d);if(!n)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||c.b(e)?K.getImageData(e):e,{width:h,height:m,data:y}=l;if(h===void 0||m===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(h!==n.data.width||m!==n.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const b=!(e instanceof HTMLImageElement||c.b(e));return n.data.replace(y,b),this.style.updateImage(d,n),this}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d){return Je.getImage(this._requestManager.transformRequest(d,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(d,e){return this._lazyInitEmptyStyle(),this.style.addLayer(d,e),this._update(!0)}moveLayer(d,e){return this.style.moveLayer(d,e),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(d,e,n){return this.style.setLayerZoomRange(d,e,n),this._update(!0)}setFilter(d,e,n={}){return this.style.setFilter(d,e,n),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,e,n,l={}){return this.style.setPaintProperty(d,e,n,l),this._update(!0)}getPaintProperty(d,e){return this.style.getPaintProperty(d,e)}setLayoutProperty(d,e,n,l={}){return this.style.setLayoutProperty(d,e,n,l),this._update(!0)}getLayoutProperty(d,e){return this.style.getLayoutProperty(d,e)}setGlyphs(d,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,e,n,l=>{l||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,e,n=>{n||this._update(!0)}),this}setLight(d,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(d,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(d,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(d,e){return this.style.setFeatureState(d,e),this._update()}removeFeatureState(d,e){return this.style.removeFeatureState(d,e),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,e=0;return this._container&&(d=this._container.clientWidth||400,e=this._container.clientHeight||300),[d,e]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const e=this._canvasContainer=Q.create("div","maplibregl-canvas-container",d);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=Q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),l=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],l);const h=this._controlContainer=Q.create("div","maplibregl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{m[y]=Q.create("div",`maplibregl-ctrl-${y} `,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,e,n){this._canvas.width=Math.floor(n*d),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const d=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:d},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,d):this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d),!n){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Rr(n,this.transform),Ie.testSupport(n)}migrateProjection(d,e){super.migrateProjection(d,e),this.painter.transform=d,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){var e,n,l,h,m;const y=this._idleTriggered?this._fadeDuration:0,b=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let T=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,L=K.now();this.style.zoomHistory.update(O,L);const N=new c.F(O,{now:L,fadeDuration:y,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),Z=N.crossFadingFactor();Z===1&&Z===this._crossFadingFactor||(T=!0,this._crossFadingFactor=Z),this.style.update(N)}const A=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==b;(l=this.style.projection)===null||l===void 0||l.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((h=this.style.projection)===null||h===void 0?void 0:h.transitionState,(m=this.style.projection)===null||m===void 0?void 0:m.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||A)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,A),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cv.mark(c.cw.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||T)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const z=this._sourcesDirty||this._styleDirty||this._placementDirty;return z||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||z||(this._fullyLoaded=!0,c.cv.mark(c.cw.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Je.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Q.remove(this._canvasContainer),Q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cv.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,K.frame(this._frameRequest,d=>{c.cv.frame(d),this._frameRequest=null;try{this._render(d)}catch(e){if(!c.cx(e)&&!function(n){return n.message===Hu}(e))throw e}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return pn}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(d){return this._lazyInitEmptyStyle(),this.style.setProjection(d),this._update(!0)}},E.MapMouseEvent=Tr,E.MapTouchEvent=Ia,E.MapWheelEvent=Wu,E.Marker=on,E.NavigationControl=class{constructor(d){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,n)=>{const l=this._map._getUIString(`NavigationControl.${n}`);e.title=l,e.setAttribute("aria-label",l)},this.options=c.e({},sr,d),this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),Q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),Q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=Q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ih(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,e){const n=Q.create("button",d,this._container);return n.type="button",n.addEventListener("click",e),n}},E.Popup=class extends c.E{constructor(d){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const y of this.options.className.split(" "))this._container.classList.add(y);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=$h(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const n=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let l=this.options.anchor;const h=Cl(this.options.offset);if(!l){const y=this._container.offsetWidth,b=this._container.offsetHeight;let T;T=n.y+h.bottom.y<b?["top"]:n.y>this._map.transform.height-b?["bottom"]:[],n.x<y/2?T.push("left"):n.x>this._map.transform.width-y/2&&T.push("right"),l=T.length===0?"bottom":T.join("-")}let m=n.add(h[l]);this.options.subpixelPositioning||(m=m.round()),Q.setTransform(this._container,`${ws[l]} translate(${m.x}px,${m.y}px)`),Ji(this._container,l,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(Qr),d)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=c.S.convert(d),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const e=document.createDocumentFragment(),n=document.createElement("body");let l;for(n.innerHTML=d;l=n.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var d;return(d=this._container)===null||d===void 0?void 0:d.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){return this._container&&this._container.classList.add(d),this}removeClassName(d){return this._container&&this._container.classList.remove(d),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}setSubpixelPositioning(d){this.options.subpixelPositioning=d}_createCloseButton(){this.options.closeButton&&(this._closeButton=Q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(El);d&&d.focus()}},E.RasterDEMTileSource=Wi,E.RasterTileSource=il,E.ScaleControl=class{constructor(d){this._onMove=()=>{Fo(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Fo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},No),d)}getDefaultPosition(){return"bottom-left"}onAdd(d){return this._map=d,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},E.ScrollZoomHandler=bs,E.Style=Ou,E.TerrainControl=class{constructor(d){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=d}onAdd(d){return this._map=d,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Q.create("button","maplibregl-ctrl-terrain",this._container),Q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},E.TwoFingersTouchPitchHandler=iu,E.TwoFingersTouchRotateHandler=tu,E.TwoFingersTouchZoomHandler=La,E.TwoFingersTouchZoomRotateHandler=nu,E.VectorTileSource=ia,E.VideoSource=Rs,E.addSourceType=(d,e)=>c._(void 0,void 0,void 0,function*(){if(Is(d))throw new Error(`A source type called "${d}" already exists.`);((n,l)=>{ql[n]=l})(d,e)}),E.clearPrewarmedResources=function(){const d=dt;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(ye),dt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},E.createTileMesh=Lu,E.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},E.getRTLTextPluginStatus=function(){return an().getRTLTextPluginStatus()},E.getVersion=function(){return xc},E.getWorkerCount=function(){return He.workerCount},E.getWorkerUrl=function(){return c.a.WORKER_URL},E.importScriptInWorkers=function(d){return Yi().broadcast("IS",d)},E.prewarm=function(){Ht().acquire(ye)},E.setMaxParallelImageRequests=function(d){c.a.MAX_PARALLEL_IMAGE_REQUESTS=d},E.setRTLTextPlugin=function(d,e){return an().setRTLTextPlugin(d,e)},E.setWorkerCount=function(d){He.workerCount=d},E.setWorkerUrl=function(d){c.a.WORKER_URL=d}});var q=k;return q})}(Ip)),Ip.exports}var fg=oy();const ly=$m(fg),cy=mg({__proto__:null,default:ly},[fg]);</script>
    <style rel="stylesheet" crossorigin>:root{font-family:system-ui,Avenir,Helvetica,Arial,sans-serif;line-height:1.5;font-weight:400;color-scheme:light dark;color:#ffffffde;background-color:#242424;font-synthesis:none;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}a{font-weight:500;color:#646cff;text-decoration:inherit}a:hover{color:#535bf2}body{margin:0;min-width:320px;min-height:100vh;overflow:hidden}h1{font-size:3.2em;line-height:1.1}button{border-radius:8px;border:1px solid transparent;padding:.6em 1.2em;font-size:1em;font-weight:500;font-family:inherit;background-color:#1a1a1a;cursor:pointer;transition:border-color .25s}button:hover{border-color:#646cff}button:focus,button:focus-visible{outline:4px auto -webkit-focus-ring-color}.maplibregl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgb(0 0 0/0)}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px #0000001a}@media (forced-colors:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (forced-colors:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}@media (hover:hover){.maplibregl-ctrl button:not(:disabled):hover{background-color:#0000000d}}.maplibregl-ctrl button:not(:disabled):active{background-color:#0000000d}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8z'/%3E%3C/svg%3E")}}.maplibregl-ctrl button.maplibregl-ctrl-globe .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%23333' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-globe-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='none' stroke='%2333b5e5' viewBox='0 0 22 22'%3E%3Ccircle cx='11' cy='11' r='8.5'/%3E%3Cpath d='M17.5 11c0 4.819-3.02 8.5-6.5 8.5S4.5 15.819 4.5 11 7.52 2.5 11 2.5s6.5 3.681 6.5 8.5Z'/%3E%3Cpath d='M13.5 11c0 2.447-.331 4.64-.853 6.206-.262.785-.562 1.384-.872 1.777-.314.399-.58.517-.775.517s-.461-.118-.775-.517c-.31-.393-.61-.992-.872-1.777C8.831 15.64 8.5 13.446 8.5 11s.331-4.64.853-6.206c.262-.785.562-1.384.872-1.777.314-.399.58-.517.775-.517s.461.118.775.517c.31.393.61.992.872 1.777.522 1.565.853 3.76.853 6.206Z'/%3E%3Cpath d='M11 7.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138q.07-.058.224-.138c.299-.151.763-.302 1.379-.434C7.378 5.666 9.091 5.5 11 5.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138q-.07.058-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428ZM4.486 6.436ZM11 16.5c-1.909 0-3.622-.166-4.845-.428-.616-.132-1.08-.283-1.379-.434a1.3 1.3 0 0 1-.224-.138 1.3 1.3 0 0 1 .224-.138c.299-.151.763-.302 1.379-.434C7.378 14.666 9.091 14.5 11 14.5s3.622.166 4.845.428c.616.132 1.08.283 1.379.434.105.053.177.1.224.138a1.3 1.3 0 0 1-.224.138c-.299.151-.763.302-1.379.434-1.223.262-2.936.428-4.845.428Zm-6.514-1.064ZM11 12.5c-2.46 0-4.672-.222-6.255-.574-.796-.177-1.406-.38-1.805-.59a1.5 1.5 0 0 1-.39-.272.3.3 0 0 1-.047-.064.3.3 0 0 1 .048-.064c.066-.073.189-.167.389-.272.399-.21 1.009-.413 1.805-.59C6.328 9.722 8.54 9.5 11 9.5s4.672.222 6.256.574c.795.177 1.405.38 1.804.59.2.105.323.2.39.272a.3.3 0 0 1 .047.064.3.3 0 0 1-.048.064 1.4 1.4 0 0 1-.389.272c-.399.21-1.009.413-1.804.59-1.584.352-3.796.574-6.256.574Zm-8.501-1.51v.002zm0 .018v.002zm17.002.002v-.002zm0-.018v-.002z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{animation:maplibregl-spin 2s linear infinite}@media (forced-colors:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1m0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1z'/%3E%3C/svg%3E")}}@keyframes maplibregl-spin{0%{transform:rotate(0)}to{transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (forced-colors:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}@media (forced-colors:active) and (prefers-color-scheme:light){a.maplibregl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.25 1.25 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.25 1.25 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5 5 0 0 1 .314-.787l.009-.016a4.6 4.6 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.6 4.6 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4q.47.48.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.42 2.42 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.45 2.45 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675q.318.302.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.8 4.8 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.4 3.4 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.25 1.25 0 0 1 .689 1.004 4.7 4.7 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528q-.001.515-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.8 5.8 0 0 1-.548-2.512q0-.429.053-.843a1.3 1.3 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.8 4.8 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.5 4.5 0 0 1-1.935-.424 1.25 1.25 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.4 2.4 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.7 4.7 0 0 1-1.782 1.884 4.77 4.77 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.5 4.5 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a5 5 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.25 1.25 0 0 1-1.115.676h-.098a1.25 1.25 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15q.493-.356.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267q-.133-.329-.526-.658l-.032-.028a3.2 3.2 0 0 0-.668-.428l-.27-.12a3.3 3.3 0 0 0-1.235-.23q-1.136-.001-1.974.493a3.36 3.36 0 0 0-1.3 1.382q-.445.89-.444 2.074 0 1.2.51 2.107a3.8 3.8 0 0 0 1.382 1.381 3.9 3.9 0 0 0 1.893.477q.795 0 1.455-.33zm-2.789-5.38q-.576.675-.575 1.762 0 1.102.559 1.794.576.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.2 2.2 0 0 0 .468-.29l.178-.161a2.2 2.2 0 0 0 .397-.561q.244-.5.244-1.15v-.115q0-.708-.296-1.267l-.043-.077a2.2 2.2 0 0 0-.633-.709l-.13-.086-.047-.028a2.1 2.1 0 0 0-1.073-.285q-1.052 0-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.96.96 0 0 0-.353-.389.85.85 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.6 2.6 0 0 0 .331.423q.319.33.755.548l.173.074q.65.255 1.49.255 1.02 0 1.844-.493a3.45 3.45 0 0 0 1.316-1.4q.493-.904.493-2.089 0-1.909-.988-2.913-.988-1.02-2.584-1.02-.898 0-1.575.347a3 3 0 0 0-.415.262l-.199.166a3.4 3.4 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138q.206.29.48.5l.155.11.053.034q.51.296 1.119.297 1.07 0 1.645-.675.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.435 0-.835.16a2 2 0 0 0-.284.136 2 2 0 0 0-.363.254 2.2 2.2 0 0 0-.46.569l-.082.162a2.6 2.6 0 0 0-.213 1.072v.115q0 .707.296 1.267l.135.211zm.964-.818a1.1 1.1 0 0 0 .367.385.94.94 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a1 1 0 0 0-.503.135l-.012.007a.86.86 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.4 1.4 0 0 0 .14.66zm15.7-6.222q.347-.346.346-.856a1.05 1.05 0 0 0-.345-.79 1.18 1.18 0 0 0-.84-.329q-.51 0-.855.33a1.05 1.05 0 0 0-.346.79q0 .51.346.855.345.346.856.346.51 0 .839-.346zm4.337 9.314.033-1.332q.191.403.59.747l.098.081a4 4 0 0 0 .316.224l.223.122a3.2 3.2 0 0 0 1.44.322 3.8 3.8 0 0 0 1.875-.477 3.5 3.5 0 0 0 1.382-1.366q.527-.89.526-2.09 0-1.184-.444-2.073a3.24 3.24 0 0 0-1.283-1.399q-.823-.51-1.942-.51a3.5 3.5 0 0 0-1.527.344l-.086.043-.165.09a3 3 0 0 0-.33.214q-.432.315-.656.707a2 2 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.5 2.5 0 0 0 .566.7q.117.098.245.18l.144.08a2.1 2.1 0 0 0 .975.232q1.07 0 1.645-.675.576-.69.576-1.778 0-1.102-.576-1.777-.56-.691-1.645-.692a2.2 2.2 0 0 0-1.015.235q-.22.113-.415.282l-.15.142a2.1 2.1 0 0 0-.42.594q-.223.479-.223 1.1v.115q0 .705.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.87.87 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.1 1.1 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013q.345-.13.724-.14l.069-.002q.493 0 .642.099l.247-1.794q-.196-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2 2 0 0 0-.411.148 2.2 2.2 0 0 0-.4.249 2.5 2.5 0 0 0-.485.499 2.7 2.7 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884q0-.546.159-.943a1.5 1.5 0 0 1 .466-.636 2.5 2.5 0 0 1 .399-.253 2 2 0 0 1 .224-.099zm9.784 2.656.05-.922q0-1.743-.856-2.698-.838-.97-2.584-.97-1.119-.001-2.007.493a3.46 3.46 0 0 0-1.4 1.382q-.493.906-.493 2.106 0 1.07.428 1.975.428.89 1.332 1.432.906.526 2.255.526.973 0 1.668-.185l.044-.012.135-.04q.613-.184.984-.421l-.542-1.267q-.3.162-.642.274l-.297.087q-.51.131-1.3.131-.954 0-1.497-.444a1.6 1.6 0 0 1-.192-.193q-.366-.44-.512-1.234l-.004-.021zm-5.427-1.256-.003.022h3.752v-.138q-.011-.727-.288-1.118a1 1 0 0 0-.156-.176q-.46-.428-1.316-.428-.986 0-1.494.604-.379.45-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81q-1.02 0-1.893-.478a3.8 3.8 0 0 1-1.381-1.382q-.51-.906-.51-2.106 0-1.185.444-2.074a3.36 3.36 0 0 1 1.3-1.382q.839-.494 1.974-.494a3.3 3.3 0 0 1 1.234.231 3.3 3.3 0 0 1 .97.575q.396.33.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332q-.279.593-1.02 1.053a3.17 3.17 0 0 1-1.662.444zm.296-1.482q.938 0 1.58-.642.642-.66.642-1.711v-.115q0-.708-.296-1.267a2.2 2.2 0 0 0-.807-.872 2.1 2.1 0 0 0-1.119-.313q-1.053 0-1.629.692-.575.675-.575 1.76 0 1.103.559 1.795.577.675 1.645.675zm6.521-6.237h1.711v1.4q.906-1.597 2.83-1.597 1.596 0 2.584 1.02.988 1.005.988 2.914 0 1.185-.493 2.09a3.46 3.46 0 0 1-1.316 1.399 3.5 3.5 0 0 1-1.844.493q-.954 0-1.662-.329a2.67 2.67 0 0 1-1.086-.97l.017 5.134h-1.728zm4.048 6.22q1.07 0 1.645-.674.577-.69.576-1.762 0-1.119-.576-1.777-.558-.675-1.645-.675-.592 0-1.12.296-.51.28-.822.823-.296.527-.296 1.234v.115q0 .708.296 1.267.313.543.823.855.51.296 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.16 1.16 0 0 1-.856-.346 1.17 1.17 0 0 1-.346-.856 1.05 1.05 0 0 1 .346-.79q.346-.329.856-.329.494 0 .839.33a1.05 1.05 0 0 1 .345.79 1.16 1.16 0 0 1-.345.855q-.33.346-.84.346zm7.875 9.133a3.17 3.17 0 0 1-1.662-.444q-.723-.46-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283q.279-.658 1.086-1.119a3.5 3.5 0 0 1 1.778-.477q1.119 0 1.942.51a3.24 3.24 0 0 1 1.283 1.4q.445.888.444 2.072 0 1.201-.526 2.09a3.5 3.5 0 0 1-1.382 1.366 3.8 3.8 0 0 1-1.876.477zm-.296-1.481q1.069 0 1.645-.675.577-.69.577-1.778 0-1.102-.577-1.776-.56-.691-1.645-.692a2.12 2.12 0 0 0-1.58.659q-.642.641-.642 1.694v.115q0 .71.296 1.267a2.4 2.4 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481q.263-.757.856-1.217a2.14 2.14 0 0 1 1.349-.46q.527 0 .724.098l-.247 1.794q-.149-.099-.642-.099-.774 0-1.416.494-.626.493-.626 1.58v3.883h-1.777V9.242zm9.534 7.718q-1.35 0-2.255-.526-.904-.543-1.332-1.432a4.6 4.6 0 0 1-.428-1.975q0-1.2.493-2.106a3.46 3.46 0 0 1 1.4-1.382q.889-.495 2.007-.494 1.744 0 2.584.97.855.956.856 2.7 0 .444-.05.92h-5.43q.18 1.005.708 1.45.542.443 1.497.443.79 0 1.3-.131a4 4 0 0 0 .938-.362l.542 1.267q-.411.263-1.119.46-.708.198-1.711.197zm1.596-4.558q.016-1.02-.444-1.432-.46-.428-1.316-.428-1.728 0-1.991 1.86z'/%3E%3Cpath d='M5.074 15.948a.484.657 0 0 0-.486.659v1.84a.484.657 0 0 0 .486.659h4.101a.484.657 0 0 0 .486-.659v-1.84a.484.657 0 0 0-.486-.659zm3.56 1.16H5.617v.838h3.017z' style='fill:%23fff;fill-rule:evenodd;stroke-width:1.03600001'/%3E%3Cg style='stroke-width:1.12603545'%3E%3Cpath d='M-9.408-1.416c-3.833-.025-7.056 2.912-7.08 6.615-.02 3.08 1.653 4.832 3.107 6.268.903.892 1.721 1.74 2.32 2.902l-.525-.004c-.543-.003-.992.304-1.24.639a1.87 1.87 0 0 0-.362 1.121l-.011 1.877c-.003.402.104.787.347 1.125.244.338.688.653 1.23.656l4.142.028c.542.003.99-.306 1.238-.641a1.87 1.87 0 0 0 .363-1.121l.012-1.875a1.87 1.87 0 0 0-.348-1.127c-.243-.338-.688-.653-1.23-.656l-.518-.004c.597-1.145 1.425-1.983 2.348-2.87 1.473-1.414 3.18-3.149 3.2-6.226-.016-3.59-2.923-6.684-6.993-6.707m-.006 1.1v.002c3.274.02 5.92 2.532 5.9 5.6-.017 2.706-1.39 4.026-2.863 5.44-1.034.994-2.118 2.033-2.814 3.633-.018.041-.052.055-.075.065q-.013.004-.02.01a.34.34 0 0 1-.226.084.34.34 0 0 1-.224-.086l-.092-.077c-.699-1.615-1.768-2.669-2.781-3.67-1.454-1.435-2.797-2.762-2.78-5.478.02-3.067 2.7-5.545 5.975-5.523m-.02 2.826c-1.62-.01-2.944 1.315-2.955 2.96-.01 1.646 1.295 2.988 2.916 2.999h.002c1.621.01 2.943-1.316 2.953-2.961.011-1.646-1.294-2.988-2.916-2.998m-.005 1.1c1.017.006 1.829.83 1.822 1.89s-.83 1.874-1.848 1.867c-1.018-.006-1.829-.83-1.822-1.89s.83-1.874 1.848-1.868m-2.155 11.857 4.14.025c.271.002.49.305.487.676l-.013 1.875c-.003.37-.224.67-.495.668l-4.14-.025c-.27-.002-.487-.306-.485-.676l.012-1.875c.003-.37.224-.67.494-.668' style='color:%23000;font-style:normal;font-variant:normal;font-weight:400;font-stretch:normal;font-size:medium;line-height:normal;font-family:sans-serif;font-variant-ligatures:normal;font-variant-position:normal;font-variant-caps:normal;font-variant-numeric:normal;font-variant-alternates:normal;font-feature-settings:normal;text-indent:0;text-align:start;text-decoration:none;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:%23000;letter-spacing:normal;word-spacing:normal;text-transform:none;writing-mode:lr-tb;direction:ltr;text-orientation:mixed;dominant-baseline:auto;baseline-shift:baseline;text-anchor:start;white-space:normal;shape-padding:0;clip-rule:evenodd;display:inline;overflow:visible;visibility:visible;opacity:1;isolation:auto;mix-blend-mode:normal;color-interpolation:sRGB;color-interpolation-filters:linearRGB;solid-color:%23000;solid-opacity:1;vector-effect:none;fill:%23000;fill-opacity:.4;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;color-rendering:auto;image-rendering:auto;shape-rendering:auto;text-rendering:auto' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-9.415-.316C-12.69-.338-15.37 2.14-15.39 5.207c-.017 2.716 1.326 4.041 2.78 5.477 1.013 1 2.081 2.055 2.78 3.67l.092.076a.34.34 0 0 0 .225.086.34.34 0 0 0 .227-.083l.019-.01c.022-.009.057-.024.074-.064.697-1.6 1.78-2.64 2.814-3.634 1.473-1.414 2.847-2.733 2.864-5.44.02-3.067-2.627-5.58-5.901-5.601m-.057 8.784c1.621.011 2.944-1.315 2.955-2.96.01-1.646-1.295-2.988-2.916-2.999-1.622-.01-2.945 1.315-2.955 2.96s1.295 2.989 2.916 3' style='clip-rule:evenodd;fill:%23e1e3e9;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3Cpath d='M-11.594 15.465c-.27-.002-.492.297-.494.668l-.012 1.876c-.003.371.214.673.485.675l4.14.027c.271.002.492-.298.495-.668l.012-1.877c.003-.37-.215-.672-.485-.674z' style='clip-rule:evenodd;fill:%23fff;fill-opacity:1;fill-rule:evenodd;stroke:none;stroke-width:2.47727823;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:.4' transform='translate(15.553 2.85)scale(.88807)'/%3E%3C/g%3E%3C/svg%3E")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:#ffffff80;margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;color:#000;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:#ffffff80;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:#0000000d}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (forced-colors:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}@media screen and (forced-colors:active) and (prefers-color-scheme:light){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E")}}.maplibregl-ctrl-attrib a{color:#000000bf;text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:#ffffffbf;border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:#0000000d}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px #0000001a;padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;transition:opacity .2s;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{animation:maplibregl-user-location-dot-pulse 2s infinite;content:"";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px #00000059;box-sizing:border-box;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;transform:scale(1)}70%{opacity:0;transform:scale(3)}to{opacity:0;transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:#0006;color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(pointer:coarse){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}.map-container{width:100vw;height:100vh;position:absolute;top:0;left:0}.map-nav-control{margin-right:340px}@media (max-width: 768px){.map-nav-control{margin-right:16px}}@media (min-width: 769px) and (max-width: 1024px){.map-nav-control{margin-right:300px}}.sidebar{position:fixed;top:0;right:0;width:320px;min-width:250px;max-width:60vw;height:100vh;z-index:1000;transition:transform .3s ease-in-out;background-color:#fffffff2;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-left:1px solid rgba(0,0,0,.1);box-shadow:-2px 0 10px #0000001a}.resize-handle{position:absolute;left:0;top:0;width:4px;height:100%;background:transparent;cursor:ew-resize;z-index:10;border-left:2px solid transparent;transition:border-color .2s ease}.resize-handle:hover{border-left-color:#007bff80}.resize-handle:active{border-left-color:#007bffcc}.sidebar-visible{transform:translate(0)}.sidebar-hidden{transform:translate(100%)}.sidebar-content{width:100%;height:100%;padding:24px;box-sizing:border-box;display:flex;flex-direction:column;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;color:#333;overflow-y:auto}.sidebar-content::-webkit-scrollbar{width:6px}.sidebar-content::-webkit-scrollbar-track{background:transparent}.sidebar-content::-webkit-scrollbar-thumb{background:#0003;border-radius:3px}.sidebar-content::-webkit-scrollbar-thumb:hover{background:#0000004d}.sidebar-header{margin-bottom:32px;padding-bottom:20px;border-bottom:1px solid rgba(0,0,0,.1)}.sidebar-title{font-size:20px;font-weight:600;margin:0 0 4px;color:#1a1a1a}.sidebar-subtitle{font-size:14px;color:#666;margin:0;font-weight:400}.sidebar-section{margin-bottom:28px}.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}.section-title{font-size:16px;font-weight:600;margin:0;color:#1a1a1a}.fit-layers-btn{background:none;border:1px solid rgba(0,0,0,.1);border-radius:4px;padding:4px 8px;cursor:pointer;font-size:14px;opacity:.7;transition:all .2s ease}.fit-layers-btn:hover{opacity:1;background:#007bff0d;border-color:#007bff33}.layers-list{display:flex;flex-direction:column;gap:8px}.layer-item{display:flex;align-items:center;justify-content:space-between;padding:12px;background:#00000005;border-radius:6px;border:1px solid rgba(0,0,0,.05)}.layer-info{flex:1}.layer-name{font-size:14px;font-weight:500;margin:0 0 4px;color:#1a1a1a;cursor:pointer;transition:color .2s ease}.layer-name:hover{color:#007bff}.layer-name-input{font-size:14px;font-weight:500;margin:0 0 4px;color:#1a1a1a;border:none;background:transparent;padding:0;outline:none;font-family:inherit;width:100%;border-bottom:1px solid #007bff}.layer-type{font-size:12px;color:#666;margin:0;text-transform:uppercase;font-weight:500}.layer-actions{display:flex;gap:8px}.visibility-btn,.remove-btn{background:none;border:none;cursor:pointer;padding:4px;border-radius:4px;font-size:14px;opacity:.7;transition:opacity .2s ease}.visibility-btn:hover,.remove-btn:hover{opacity:1}.empty-state{text-align:center;color:#666;font-style:italic;padding:20px;margin:0}.instruction-block{display:flex;flex-direction:column;gap:16px}.instruction-item{display:flex;align-items:flex-start;gap:12px;padding:16px;background:#00000005;border-radius:8px;border:1px solid rgba(0,0,0,.05)}.drop-zone{cursor:pointer;transition:all .2s ease;position:relative}.drop-zone:hover{background:#007bff0d;border-color:#007bff33}.drop-zone.drag-over{background:#007bff1a;border-color:#007bff66;transform:scale(1.02)}.drop-zone.drag-over .instruction-text p{color:#007bff;font-weight:500}.instruction-icon{font-size:20px;flex-shrink:0;margin-top:2px}.instruction-text{flex:1}.instruction-text strong{display:block;font-size:14px;font-weight:600;color:#1a1a1a;margin-bottom:4px}.instruction-text p{font-size:13px;color:#666;margin:0;line-height:1.4}.format-list{display:flex;flex-wrap:wrap;gap:8px}.format-tag{display:inline-block;background:#f0f0f0;color:#333;padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}.layers-container{padding:0}.layers-container.empty{min-height:80px;padding:16px;display:flex;align-items:center;justify-content:center}.layers-container.has-layers{display:block}.empty-state{color:#999;font-size:14px;font-style:italic;margin:0}.layers-list{display:flex;flex-direction:column;width:100%}.layer-item{background:#fff;border:1px solid rgba(0,0,0,.15);border-radius:8px;padding:16px;margin-bottom:12px;transition:all .2s ease;display:flex;flex-direction:column;width:100%;box-sizing:border-box}.layer-item:hover{border-color:#0000001a;box-shadow:0 2px 4px #0000000d}.layer-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px;margin-left:4px;width:100%}.layer-info{display:flex;flex-direction:column;gap:2px;flex:1}.layer-name{font-size:14px;font-weight:600;color:#1a1a1a;margin:0;line-height:1.3}.layer-type{font-size:12px;color:#666;margin:0;text-transform:uppercase;font-weight:500;letter-spacing:.5px}.layer-actions{display:flex;gap:6px;align-items:center;justify-content:flex-end;flex-shrink:0}.layer-actions button{background:none;border:none;cursor:pointer;font-size:16px;padding:4px 6px;border-radius:4px;transition:all .15s ease;display:flex;align-items:center;justify-content:center}.layer-actions button:hover{background:#00000014;transform:scale(1.1)}.edit-btn:hover{background:#007bff1a}.visibility-btn:hover{background:#28a7451a}.remove-btn:hover{background:#dc35451a}.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.fit-layers-btn{background:#007bff1a;border:1px solid rgba(0,123,255,.2);color:#007bff;padding:6px 8px;border-radius:6px;cursor:pointer;font-size:14px;transition:all .2s ease;display:flex;align-items:center;justify-content:center}.fit-layers-btn:hover{background:#007bff33;border-color:#007bff4d;transform:scale(1.05)}.layer-actions-header{display:flex;gap:8px;align-items:center}.remove-all-layers-btn{background:#dc35451a;border:1px solid rgba(220,53,69,.2);color:#dc3545;padding:6px 8px;border-radius:6px;cursor:pointer;font-size:14px;transition:all .2s ease;display:flex;align-items:center}.remove-all-layers-btn:hover{background:#dc354533;border-color:#dc35454d;transform:scale(1.05)}.layer-content{width:100%;display:block}.layer-content-editor{width:100%;min-height:80px;padding:8px;border:1px solid rgba(0,0,0,.15);border-radius:4px;font-family:Monaco,Menlo,Ubuntu Mono,monospace;font-size:11px;line-height:1.4;background:#fffffff2;color:#333;resize:vertical;transition:border-color .2s ease;box-sizing:border-box;display:block;clear:both}.layer-content-editor:focus{outline:none;border-color:#007bff66;box-shadow:0 0 0 2px #007bff1a}.layer-content-editor::placeholder{color:#999;font-style:italic}.layer-content-editor.inline{min-height:60px;font-size:11px}@media (max-width: 768px){.sidebar{width:100%;max-width:400px;height:60vh;top:auto;bottom:0;right:0;border-left:none;border-top:1px solid rgba(0,0,0,.1);border-radius:16px 16px 0 0}.sidebar-hidden{transform:translateY(100%)}.sidebar-visible{transform:translateY(0)}.sidebar-content{padding:20px}.sidebar-header{margin-bottom:24px;padding-bottom:16px}.sidebar-title{font-size:18px}.sidebar-section{margin-bottom:24px}.instruction-item{padding:12px}.instruction-icon{font-size:18px}.instruction-text strong{font-size:13px}.instruction-text p{font-size:12px}.format-tag{padding:3px 6px;font-size:11px}}@media (max-width: 480px){.sidebar{width:100%;max-width:none;height:50vh}.sidebar-content{padding:16px}.sidebar-header{margin-bottom:20px;padding-bottom:12px}.sidebar-title{font-size:16px}.sidebar-subtitle{font-size:13px}.section-title{font-size:15px}.sidebar-section{margin-bottom:20px}.instruction-block{gap:12px}.instruction-item{padding:10px;gap:10px}.instruction-icon{font-size:16px}.instruction-text strong{font-size:12px}.instruction-text p{font-size:11px}.format-list{gap:6px}.format-tag{padding:2px 5px;font-size:10px}.layers-container{min-height:60px;padding:12px}.empty-state{font-size:13px}.layer-item{padding:10px}.layer-name{font-size:13px}.layer-type{font-size:11px}.layer-actions button{font-size:14px;padding:3px 5px}.layer-content-editor{font-size:10px;min-height:50px;padding:6px}}.layer-options{width:100%;margin-top:12px}.option-item{margin-bottom:8px}.option-label{display:flex;align-items:center;cursor:pointer;font-size:13px;color:#555}.option-label input[type=checkbox]{margin-right:8px;width:14px;height:14px;cursor:pointer}.option-text{-webkit-user-select:none;user-select:none}.color-pill-container{position:relative;display:inline-block}.color-pill-btn{background:none;border:none;cursor:pointer;padding:4px 6px;border-radius:4px;font-size:16px;transition:all .15s ease;display:flex;align-items:center;justify-content:center}.color-pill-btn:hover{background:#00000014;transform:scale(1.1)}.color-dropdown{position:absolute;top:100%;left:50%;transform:translate(-50%);background:#fff;border:1px solid rgba(0,0,0,.15);border-radius:8px;box-shadow:0 4px 12px #00000026;padding:8px;display:flex;flex-direction:column;gap:4px;z-index:1000;min-width:40px}.color-option{background:none;border:none;cursor:pointer;padding:6px 8px;border-radius:4px;font-size:16px;transition:all .15s ease;display:flex;align-items:center;justify-content:center}.color-option:hover{background:#0000000d;transform:scale(1.05)}.color-option.selected{background:#007bff1a;border:1px solid rgba(0,123,255,.3)}@media (min-width: 769px) and (max-width: 1024px){.sidebar{width:280px}.sidebar-content{padding:20px}}.notification{position:fixed;top:20px;right:20px;min-width:300px;max-width:400px;background:#fff;border-radius:8px;box-shadow:0 4px 12px #00000026;border-left:4px solid;opacity:0;transform:translate(100%);transition:all .3s ease-out;z-index:1000}.notification-visible{opacity:1;transform:translate(0)}.notification-success{border-left-color:#28a745}.notification-error{border-left-color:#dc3545}.notification-warning{border-left-color:#ffc107}.notification-info{border-left-color:#007bff}.notification-content{padding:16px}.notification-header{display:flex;align-items:flex-start;gap:8px}.notification-icon{font-size:16px;flex-shrink:0;margin-top:2px}.notification-title{flex:1;font-size:14px;font-weight:600;margin:0;line-height:1.4;color:#000}.notification-close{background:none;border:none;font-size:18px;cursor:pointer;padding:0;width:20px;height:20px;display:flex;align-items:center;justify-content:center;border-radius:4px;opacity:.6;transition:opacity .2s ease}.notification-close:hover{opacity:1;background:#0000000d}.notification-message{margin:8px 0 0 24px;font-size:13px;color:#666;line-height:1.4}.notification-container{position:fixed;top:20px;right:20px;z-index:1000;display:flex;flex-direction:column;gap:12px;pointer-events:none}.notification-container .notification{position:relative;top:0;right:0;pointer-events:auto}#root{width:100vw;height:100vh;margin:0;padding:0;overflow:hidden}.logo{height:6em;padding:1.5em;will-change:filter;transition:filter .3s}.logo:hover{filter:drop-shadow(0 0 2em #646cffaa)}.logo.react:hover{filter:drop-shadow(0 0 2em #61dafbaa)}@keyframes logo-spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media (prefers-reduced-motion: no-preference){a:nth-of-type(2) .logo{animation:logo-spin infinite 20s linear}}.card{padding:2em}.read-the-docs{color:#888}</style>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
